[
  {
    "original_filename": "1741_rvtsamp_zero_close",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n\n</head>\n\n<!---\n  \ntwitter:\n\nClose document, zero-doc RvtSamples and TBC samples for Revit 2020 and the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon http://bit.ly/zerodocsamples\n\nStill getting up to speed with Revit 2020 and my new virtual machine that I set up for it...\nFirst, however, an interesting adaptation of RvtSamples to run in zero document state\n&ndash; RvtSamples adapted for zero document state\n&ndash; Migrating The Building Coder samples to Revit 2020\n&ndash; Installing PowerTools Copy HTML Markup\n&ndash; Using <code>PostCommand</code> to close document...\n\nlinkedin:\n\nClose document, zero-doc RvtSamples and TBC samples for Revit 2020 and the #RevitAPI #bim #DynamoBim #ForgeDevCon #Revit #API #SDK\n\nhttp://bit.ly/zerodocsamples\n\nStill getting up to speed with Revit 2020 and my new virtual machine that I set up for it...\n\nFirst, however, an interesting adaptation of RvtSamples to run in zero document state:\n\n- RvtSamples adapted for zero document state\n- Migrating The Building Coder samples to Revit 2020\n- Installing PowerTools Copy HTML Markup\n- Using <code>PostCommand</code> to close document...\n\n\n-->"
  },
  {
    "original_filename": "1741_rvtsamp_zero_close",
    "header_text": "Close Doc and Zero Doc RvtSamples",
    "local_header_href": "#close-doc-and-zero-doc-rvtsamples",
    "chunk_text": "### Close Doc and Zero Doc RvtSamples\n\nStill getting up to speed with Revit 2020 and my new virtual machine that I set up for it...\n\nFirst, however, an interesting adaptation of RvtSamples to run in zero document state:\n\n- [RvtSamples adapted for zero document state](#2) \n- [Migrating The Building Coder samples to Revit 2020](#3) \n- [Installing PowerTools Copy HTML Markup](#4) \n- [Using `PostCommand` to close document](#5)"
  },
  {
    "original_filename": "1741_rvtsamp_zero_close",
    "header_text": "RvtSamples adapted for Zero Document State",
    "local_header_href": "#2",
    "chunk_text": "####<a name=\"2\"></a> RvtSamples adapted for Zero Document State\n\nBefore the release of Revit 2020, I had an interesting discussion with my French namesake Jérémie on running RvtSamples in zero document state.\n\nAs you may know, RvtSamples is simply an external application that reads a text file containing information on (a large number of) external commands and their assembly DLL locations to populate a menu making them all accessible in the Revit user interface without a need to install a separate add-in manifest for each one of them.\n\nIt is used to easily provide debugging and testing access to all the external commands provided by the Revit SDK samples.\n\nIn his [comment](https://thebuildingcoder.typepad.com/blog/2018/04/rvtsamples-2019.html#comment-4399937612)\non [RvtSamples for Revit 2019](https://thebuildingcoder.typepad.com/blog/2018/04/rvtsamples-2019.html#comment-4399937612),\nJérémie asks:\n\n**Question:** After several tries on Visual Studio 2017 I finally managed to load RvtSamples to Revit 2019! Thank you for this update!\n\nHowever, I have a question about this tool.\n\nThis application makes it possible to use all the examples of the SDK and also to add others.\nThe concern is that the manifest seems created by code from the `RvtSamples.txt` file and I do not find how to modify this code to add `VisibilityMode` `=` `AlwaysVisible`.\n\nPersonally, I need some of my addins (ExternalCommand) to be `VisibilityMode` `=` `AlwaysVisible` to allow their use from the opening of Revit.\n\nIs it possible to do this simply?\n\n**Answer:** Yes, sure you can simply set `VisibilityMode` `=` `AlwaysVisible` in the add-in manifest for any add-in you like.\n\nLook at the description\nof [Add-in Registration settings in the Developer Guide](http://help.autodesk.com/view/RVT/2019/ENU/?guid=Revit_API_Revit_API_Developers_Guide_Introduction_Add_In_Integration_Add_in_Registration_html).\n\nThe RvtSamples.txt text input file is not created by the program, but hand edited.\n\nI implemented it originally in 2008 to [load the Revit SDK samples](https://thebuildingcoder.typepad.com/blog/2008/09/loading-sdk-sam.html).\n\nAt that time, it only held four lines of text per external command to load.\n\nThat number was later expanded to seven, adding support for the tooltip text, small and large icon image.\n\nThe visibility mode could be added to the list of data to be read from that file, but is not currently so.\n\nYou could add that support yourself if you like, by modifying the RvtSamples application yourself.\n\nIt is probably simpler to implement the specific external commands that you wish to equip with this setting in a separate add-in with their own add-in manifest.\n\n**Response:** Yes, I have already split the `RvtSamples.txt` file to match what I want and it works without any worries.\n\nYes, that's exactly what I wanted to do: modify the code to add an 8th line to add this option (or more simply change the default to AlwaysVisible).\n\nUnfortunately, I have not yet managed to understand the code enough to do that. I will continue to search in this case.\n\n**Answer:** The code is simple. Edit the RvtSamples module `Application.cs`.\n\n`AddSample` reads seven lines of text from RvtSamples.txt.\n\nModify it to read eight lines instead.\n\nOr, as you suggest, set the default to `AlwaysVisible`. Oh no, this all makes no sense at all. AlwaysVisible applies to a standard external command loaded by Revit into the external tools menu. We are not loading anything at all into the external tools menu, but creating our own menu instead. Is the RvtSamples panel visible and active in zero document state?\n\n**Response:** The RvtSamples panel is visible but disabled in zero document state.\n\nBut now it works. I ended up finding what was blocking me in the article\non [enabling ribbon items in zero document state](http://thebuildingcoder.typepad.com/blog/2011/02/enable-ribbon-items-in-zero-document-state.html).\n\nTo implement this in RvtSamples, it's ultimately relatively simple.\n\n- Implement *public class Availability: IExternalCommandAvailability* (where `IsCommandAvailable` returns true) in every external DLL you want active in zero document state.\n- In the RvtSamples Application, set the `AvailabiltyClassName` property of the PushButton object to *namespaceOfTheExternalDll.Availability*.\n\nThank you for your help.\n\nHere is a [Dropbox link to a `7z` archive containing the project with this functionality](https://www.dropbox.com/s/j0dk8ifvw83l0n6/RvtSamplesMod.7z?dl=0).\n\nMany thanks to Jérémie for this initiative, discussion, research and project modification!\n\nFor posterity, I copied his `7z` archive to The Building Coder repository, also converted to a corresponding `zip` version:\n\n- [RvtSamplesEnabledInZeroDocState.7z](zip/RvtSamplesEnabledInZeroDocState.7z) (23816 bytes)\n- [RvtSamplesEnabledInZeroDocState.zip](zip/RvtSamplesEnabledInZeroDocState.zip) (45212 bytes)"
  },
  {
    "original_filename": "1741_rvtsamp_zero_close",
    "header_text": "Migrating The Building Coder Samples to Revit 2020",
    "local_header_href": "#3",
    "chunk_text": "####<a name=\"3\"></a> Migrating The Building Coder Samples to Revit 2020\n\nI migrated [The Building Coder samples](https://github.com/jeremytammik/the_building_coder_samples) to Revit 2020.\n\nAfter updating the Revit API assembly DLLs to the new version,\n[one error occurred](zip/tbc_samples_errors_warnings_1.txt):\n\n- Error CS1061 in CmdGetMaterials.cs line 736: `Application` does not contain a definition for `get_Assets` and no extension method `get_Assets` accepting a first argument of type `Application` could be found.\n\nThe removal of this property is indeed listed\nin [What's New in the Revit 2020 API](https://thebuildingcoder.typepad.com/blog/2019/04/whats-new-in-the-revit-2020-api.html)\nunder [obsolete API removal](https://thebuildingcoder.typepad.com/blog/2019/04/whats-new-in-the-revit-2020-api.html#4.1.6).\n\nIt was referenced in the method `ListAllAssets`, whose only purpose was to test this property.\nI guess it has no particular use.\nMaybe it never did?\nAnyway, since the method is never called, I simply commented it out.\n\nThe current version is [release 2020.0.145.0](https://github.com/jeremytammik/the_building_coder_samples/releases/tag/2020.0.145.0)."
  },
  {
    "original_filename": "1741_rvtsamp_zero_close",
    "header_text": "Installing PowerTools Copy HTML Markup",
    "local_header_href": "#4",
    "chunk_text": "####<a name=\"4\"></a> Installing PowerTools Copy HTML Markup\n\nI prefer to colourise the C# source code I publish here on the blog, cf. below.\n\nThis can be achieved by installing an additional tool in Visual Studio.\n\nLuckily I researched this topic three years ago\nmigrating [RvtSamples for Revit 2017](http://thebuildingcoder.typepad.com/blog/2016/04/rvtsamples-for-revit-2017.html) and\ndiscovered\nthe [Productivity Power Tools 2015](https://visualstudiogallery.msdn.microsoft.com/34ebc6a2-2777-421d-8914-e29c1dfa7f5d).\n\nI installed those and they still work fine:\n\n<center>\n<img src=\"img/visual_studio_2015_copy_html_markup_2.png\" alt=\"Copy Html Markup menu entry\" width=\"479\">\n</center>"
  },
  {
    "original_filename": "1741_rvtsamp_zero_close",
    "header_text": "Using PostCommand to Close Document",
    "local_header_href": "#5",
    "chunk_text": "####<a name=\"5\"></a> Using PostCommand to Close Document\n\nA long, long time ago, we discussed [closing the active document and why not to](https://thebuildingcoder.typepad.com/blog/2010/10/closing-the-active-document-and-why-not-to.html) do\nso using a Windows message workaround, later followed by another exploration on how\nto [close the last document](https://thebuildingcoder.typepad.com/blog/2012/12/closing-the-active-document.html) by\nfirst opening a dummy document so that the other 'real' document can be closed.\n\nBogdan just provided a new effective suggestion for closing the active document using `PostCommand` in\nhis [comment on the former post](https://thebuildingcoder.typepad.com/blog/2010/10/closing-the-active-document-and-why-not-to.html#comment-4435756188):\n\n> Maybe someone has already found this solution to close the active document in Revit; I found the following method:\n\n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:#2b91af;\">RevitCommandId</span>&nbsp;closeDoc\n&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style=\"color:#2b91af;\">RevitCommandId</span>.LookupPostableCommandId(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">PostableCommand</span>.Close&nbsp;);\n \n&nbsp;&nbsp;uiapp.PostCommand(&nbsp;closeDoc&nbsp;);\n</pre>\n\n(Voila, my first use of the new Copy HTML Markup menu item &nbsp; :-)\n\nI added the new method\nto [The Building Coder samples release 2020.0.145.1](https://github.com/jeremytammik/the_building_coder_samples/releases/tag/2020.0.145.1)."
  }
]