[
  {
    "original_filename": "0292_abg08_project_location",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0292_abg08_project_location",
    "header_text": "Project Location",
    "local_header_href": "#project-location",
    "chunk_text": "<h3>Project Location</h3><p>This is part 8 of Scott Conover's AU 2009 class on\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/01/analyse-building-geometry.html\">\nanalysing building geometry</a>,\n\ndealing with the project location and its effect on element transformations.\nWe aready looked at the project location in the discussion on\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/10/unrotate-north.html\">\nunrotate north</a>.\n\nHowever, as Scott pointed out, the results presented there are somewhat misleading and are subsumed by the following discussion.\nThe project location obviously also affects the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2008/10/azimuth.html\">\nazimuth</a> of \n\nan element, i.e. the angle between the element and true north, and our previous discussion on that topic can also be replaced by this post.\n\n<h4>Project location coordinates</h4>\n<p>Revit projects have another default coordinate system to take into account: the project location. The Document.ActiveProjectLocation provides access to the active ProjectPosition object, which contains:</p>\n<li>EastWest  east/west offset (X offset).\n<li>NorthSouth  the north/south offset (Y offset).\n<li>Elevation  the difference in elevation (Z offset).\n<li>Angle  the angle from true north.\n\n<p>You can use these properties to construct a transform between the default Revit coordinates and the actual coordinates in the project:</p>\n<pre class=\"code\">\n<span class=\"green\">// Obtain a rotation transform for the angle about true north</span>\n<span class=\"teal\">Transform</span> rotationTransform = <span class=\"teal\">Transform</span>.get_Rotation(\n  <span class=\"teal\">XYZ</span>.Zero, <span class=\"teal\">XYZ</span>.BasisZ, project_north_angle );\n \n<span class=\"green\">// Obtain a translation vector for the offsets</span>\n<span class=\"teal\">XYZ</span> translationVector = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>(\n  projectPosition.EastWest,\n  projectPosition.NorthSouth,\n  projectPosition.Elevation );\n \n<span class=\"teal\">Transform</span> translationTransform\n  = <span class=\"teal\">Transform</span>.get_Translation(\n    translationVector );\n \n<span class=\"green\">// Combine the transforms into one.</span>\n<span class=\"teal\">Transform</span> finalTransform\n  = translationTransform.Multiply(\n    rotationTransform );\n</pre>\n<h4>South Facing Elements Using Project Location</h4>\n<p>In this example we adapt the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/01/south-facing-walls.html\">\nsouth-facing walls</a> and \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/01/transformations.html#south_facing_windows\">\nsouth-facing windows</a> examples \n\nto deal with a project where true north is not aligned with the Revit coordinate system. \nThe facing vectors are rotated by the angle from true north before the calculation is run, and the following walls are now determined to be south facing:</p>\n<center>\n<img alt=\"South facing walls and windows using project location\" src=\"img/abg8_south_facing_walls_using_project_location.png\"/>\n</center>\n<p>The following windows are now facing south:</p>\n<center>\n<img alt=\"South facing windows and windows using project location\" src=\"img/abg8_south_facing_windows_using_project_location.png\"/>\n</center>\n<p>Here is the method TransformByProjectLocation that we use to transform a direction vector by the rotation angle of the ActiveProjectLocation.\nIt takes a given normalized direction as an input argument and returns the transformed location:</p>\n<pre class=\"code\">\n<span class=\"blue\">protected</span> <span class=\"teal\">XYZ</span> TransformByProjectLocation( \n  <span class=\"teal\">XYZ</span> direction )\n{\n  <span class=\"green\">// Obtain the active project location's position.</span>\n \n  <span class=\"teal\">ProjectPosition</span> position\n    = Document.ActiveProjectLocation.get_ProjectPosition(\n      <span class=\"teal\">XYZ</span>.Zero );\n \n  <span class=\"green\">// Construct a rotation transform from the position angle.</span>\n \n  <span class=\"teal\">Transform</span> transform = <span class=\"teal\">Transform</span>.get_Rotation(\n    <span class=\"teal\">XYZ</span>.Zero, <span class=\"teal\">XYZ</span>.BasisZ, position.Angle );\n \n  <span class=\"green\">// Rotate the input direction by the transform</span>\n  <span class=\"teal\">XYZ</span> rotatedDirection = transform.OfVector( direction );\n \n  <span class=\"blue\">return</span> rotatedDirection;\n}\n</pre>\n<p>Please refer to Scott's \n\n<a href=\"http://au.autodesk.com/?nd=class&amp;session_id=5256\">\nAU class material</a> for \n\nthe full source code of his sample project.\n\n<p>We will continue this series with a look at the powerful FindReferencesByDirection method coming up next.</p>\n</p></li></li></li></li></p>"
  },
  {
    "original_filename": "0292_abg08_project_location",
    "header_text": "Project location coordinates",
    "local_header_href": "#project-location-coordinates",
    "chunk_text": "<h4>Project location coordinates</h4><p>Revit projects have another default coordinate system to take into account: the project location. The Document.ActiveProjectLocation provides access to the active ProjectPosition object, which contains:</p><li>EastWest  east/west offset (X offset).\n<li>NorthSouth  the north/south offset (Y offset).\n<li>Elevation  the difference in elevation (Z offset).\n<li>Angle  the angle from true north.\n\n<p>You can use these properties to construct a transform between the default Revit coordinates and the actual coordinates in the project:</p>\n<pre class=\"code\">\n<span class=\"green\">// Obtain a rotation transform for the angle about true north</span>\n<span class=\"teal\">Transform</span> rotationTransform = <span class=\"teal\">Transform</span>.get_Rotation(\n  <span class=\"teal\">XYZ</span>.Zero, <span class=\"teal\">XYZ</span>.BasisZ, project_north_angle );\n \n<span class=\"green\">// Obtain a translation vector for the offsets</span>\n<span class=\"teal\">XYZ</span> translationVector = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>(\n  projectPosition.EastWest,\n  projectPosition.NorthSouth,\n  projectPosition.Elevation );\n \n<span class=\"teal\">Transform</span> translationTransform\n  = <span class=\"teal\">Transform</span>.get_Translation(\n    translationVector );\n \n<span class=\"green\">// Combine the transforms into one.</span>\n<span class=\"teal\">Transform</span> finalTransform\n  = translationTransform.Multiply(\n    rotationTransform );\n</pre>\n<h4>South Facing Elements Using Project Location</h4>\n<p>In this example we adapt the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/01/south-facing-walls.html\">\nsouth-facing walls</a> and \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/01/transformations.html#south_facing_windows\">\nsouth-facing windows</a> examples \n\nto deal with a project where true north is not aligned with the Revit coordinate system. \nThe facing vectors are rotated by the angle from true north before the calculation is run, and the following walls are now determined to be south facing:</p>\n<center>\n<img alt=\"South facing walls and windows using project location\" src=\"img/abg8_south_facing_walls_using_project_location.png\"/>\n</center>\n<p>The following windows are now facing south:</p>\n<center>\n<img alt=\"South facing windows and windows using project location\" src=\"img/abg8_south_facing_windows_using_project_location.png\"/>\n</center>\n<p>Here is the method TransformByProjectLocation that we use to transform a direction vector by the rotation angle of the ActiveProjectLocation.\nIt takes a given normalized direction as an input argument and returns the transformed location:</p>\n<pre class=\"code\">\n<span class=\"blue\">protected</span> <span class=\"teal\">XYZ</span> TransformByProjectLocation( \n  <span class=\"teal\">XYZ</span> direction )\n{\n  <span class=\"green\">// Obtain the active project location's position.</span>\n \n  <span class=\"teal\">ProjectPosition</span> position\n    = Document.ActiveProjectLocation.get_ProjectPosition(\n      <span class=\"teal\">XYZ</span>.Zero );\n \n  <span class=\"green\">// Construct a rotation transform from the position angle.</span>\n \n  <span class=\"teal\">Transform</span> transform = <span class=\"teal\">Transform</span>.get_Rotation(\n    <span class=\"teal\">XYZ</span>.Zero, <span class=\"teal\">XYZ</span>.BasisZ, position.Angle );\n \n  <span class=\"green\">// Rotate the input direction by the transform</span>\n  <span class=\"teal\">XYZ</span> rotatedDirection = transform.OfVector( direction );\n \n  <span class=\"blue\">return</span> rotatedDirection;\n}\n</pre>\n<p>Please refer to Scott's \n\n<a href=\"http://au.autodesk.com/?nd=class&amp;session_id=5256\">\nAU class material</a> for \n\nthe full source code of his sample project.\n\n<p>We will continue this series with a look at the powerful FindReferencesByDirection method coming up next.</p>\n</p></li></li></li></li>"
  },
  {
    "original_filename": "0292_abg08_project_location",
    "header_text": "South Facing Elements Using Project Location",
    "local_header_href": "#south-facing-elements-using-project-location",
    "chunk_text": "<h4>South Facing Elements Using Project Location</h4><p>In this example we adapt the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/01/south-facing-walls.html\">\nsouth-facing walls</a> and \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/01/transformations.html#south_facing_windows\">\nsouth-facing windows</a> examples \n\nto deal with a project where true north is not aligned with the Revit coordinate system. \nThe facing vectors are rotated by the angle from true north before the calculation is run, and the following walls are now determined to be south facing:</p><center>\n<img alt=\"South facing walls and windows using project location\" src=\"img/abg8_south_facing_walls_using_project_location.png\"/>\n</center><p>The following windows are now facing south:</p><center>\n<img alt=\"South facing windows and windows using project location\" src=\"img/abg8_south_facing_windows_using_project_location.png\"/>\n</center><p>Here is the method TransformByProjectLocation that we use to transform a direction vector by the rotation angle of the ActiveProjectLocation.\nIt takes a given normalized direction as an input argument and returns the transformed location:</p><pre class=\"code\">\n<span class=\"blue\">protected</span> <span class=\"teal\">XYZ</span> TransformByProjectLocation( \n  <span class=\"teal\">XYZ</span> direction )\n{\n  <span class=\"green\">// Obtain the active project location's position.</span>\n \n  <span class=\"teal\">ProjectPosition</span> position\n    = Document.ActiveProjectLocation.get_ProjectPosition(\n      <span class=\"teal\">XYZ</span>.Zero );\n \n  <span class=\"green\">// Construct a rotation transform from the position angle.</span>\n \n  <span class=\"teal\">Transform</span> transform = <span class=\"teal\">Transform</span>.get_Rotation(\n    <span class=\"teal\">XYZ</span>.Zero, <span class=\"teal\">XYZ</span>.BasisZ, position.Angle );\n \n  <span class=\"green\">// Rotate the input direction by the transform</span>\n  <span class=\"teal\">XYZ</span> rotatedDirection = transform.OfVector( direction );\n \n  <span class=\"blue\">return</span> rotatedDirection;\n}\n</pre><p>Please refer to Scott's \n\n<a href=\"http://au.autodesk.com/?nd=class&amp;session_id=5256\">\nAU class material</a> for \n\nthe full source code of his sample project.\n\n<p>We will continue this series with a look at the powerful FindReferencesByDirection method coming up next.</p>\n</p>"
  }
]