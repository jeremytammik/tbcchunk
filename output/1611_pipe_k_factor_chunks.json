[
  {
    "original_filename": "1611_pipe_k_factor",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<!--\n<script src=\"run_prettify.js\" type=\"text/javascript\"></script>\n<script src=\"https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js\" type=\"text/javascript\"></script>\n-->\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\n- 11843337 [PipeKfactor table]\n\n- 11843886 [Custom K factor calculation for pipe fittings.]\n  http://forums.autodesk.com/t5/revit-mep/custom-k-factor-calculation-for-pipe-fittings/m-p/6350133\n\n- [Forge DevCon 2017 class recordings now available](https://forge.autodesk.com/blog/forge-devcon-2017-class-recordings-now-available?linkId=45816608)\nRecordings of the presentations from Forge DevCon 2017 in Las Vegas are now available on the AU Online website. The recording library should include every class presented on Monday and most of the joint DevCon/AU classes presented on Tuesday, and can be watched online or downloaded. Many recordings are accompanied by additional downloadable material, such as handouts, slide decks and sample code. Thank you to all the speakers who contributed their expertise to make this Forge DevCon successful, and to fill this great knowledge repository.\nThis link takes you to a list of all the classes tagged as Forge DevCon Las Vegas 2017 - \nhttp://au.autodesk.com/au-online/classes-on-demand/search?full-text=DevCon&productName=&language=&year=2017&conference=Las+Vegas\nYou'll notice this library includes recordings for the Forge DevCon keynotes, but we recommend you watch the alternative (and better) recordings for those at https://forge.autodesk.com/devcon-2017#keynotes.\nEnjoy!\n\n- http://archi-lab.net/\n  http://archi-lab.net/create-your-own-tab-and-buttons-in-revit/\n  https://forums.autodesk.com/t5/revit-api-forum/api-to-make-installer-and-install-to-revit/m-p/7616236\n\nPipe Fitting K Factor, archi+lab blog and #RevitAPI add-in installer @AutodeskRevit #bim #dynamobim @AutodeskForge #ForgeDevCon http://bit.ly/pipekfactor\n\nTwo recent Revit MEP related cases brought up some new information on the pipe <code>K</code> factor table and custom calculations for pipe fittings, the Forge DevCon class recordings are now available, and I discovered Konrad Sobon's wonderful archi+lab Revit API blog, which helps resolve an installation and setup issue\n&ndash; Pipe <code>K</code> factor table\n&ndash; Custom <code>K</code> factor calculation for pipe fittings\n&ndash; Dynamo code to change loss coefficient\n&ndash; Forge DevCon 2017 class recordings\n&ndash; Archi+Lab\n&ndash; Revit add-in installer and buttons...\n\n--->"
  },
  {
    "original_filename": "1611_pipe_k_factor",
    "header_text": "Pipe Fitting K Factor, Archi+Lab and Installer",
    "local_header_href": "#pipe-fitting-k-factor-archilab-and-installer",
    "chunk_text": "### Pipe Fitting K Factor, Archi+Lab and Installer\n\nTwo recent Revit MEP related cases brought up some new information on the pipe `K` factor table and custom `K` factor calculation for pipe fittings.\n\nFurthermore, the Forge DevCon class recordings are now available, and I discovered Konrad Sobon's\nwonderful [archi+lab](http://archi-lab.net) Revit\nAPI blog, which helps resolve an installation and setup issue:\n\n- [Pipe `K` factor table](#2)\n- [Custom `K` factor calculation for pipe fittings](#3)\n- [Dynamo code to change loss coefficient](#4)\n- [Forge DevCon 2017 class recordings](#5)\n- [Archi+Lab](#6)\n- [Revit add-in installer and buttons](#7)\n\n\n####<a name=\"2\"></a>Pipe K Factor Table\n\n**Question:** I know that Revit calculates the pressure loss for the fittings and some pipe accessories with the factors that are defined in the file `pipekfactor.xml`.\n\nHowever, I do not know what formulas are actually user for the calculations. The mysterious numbers don't tell much.\n\nCould you clarify which formulas are used for the calculation of the pressure loss or where this information is available, please?\n\nHere are some fractions from `pipekfactors.xml`:\n\n<pre class=\"prettyprint\">\n&lt;SubTable Dimensions=\"1\" Number=\"3\" Result=\"K\"&gt;\n&lt;SubTableData1D X=\"Theta\"&gt;&lt;XAxis&gt;0 10 20 30 40 50 60 70 80 90 100 110 120 130 140 150 160 170 180&lt;/XAxis&gt;\n&lt;Data&gt; 0.0 0.18 0.4 0.675 0.9 1.05 1.1 1.125 1.1 1.075 1.06 1.05 1.045 1.035 1.025 1.015 1.01 1.005 1.0 &lt;/Data&gt;\n&lt;/SubTableData1D&gt;\n\n&lt;SubTable Dimensions=\"0\" Number=\"4\" Result=\"K\" DataUsage=\"UseLargePipeVelocity\"&gt;\n&lt;SubTableData Coefficient=\"Equation 2-27\"/&gt;\n&lt;Formula&gt;D1 &gt; D2 && Theta &gt; 45 && Theta &lt;= 180&lt;/Formula&gt;\n&lt;/SubTable&gt;\n&lt;Formula&gt;D1 &lt; D2 && Theta &lt; 180&lt;/Formula&gt;\n&lt;/SubTable&gt;\n</pre>\n\n**Answer:** The Revit UI provides a lot of detail on these calculations if you navigate to\n \n- Manage &gt; MEP Settings &gt; Mechanical Settings &gt; Pipe Settings &gt; Calculation\n \nAdditional information is provided in the Revit product help pages\non [Hydronic Pipe Sizing and Calculation Methods](http://help.autodesk.com/view/RVT/2017/ENU/?guid=GUID-7D4BF4BC-89DF-4EB2-93EB-52900B8583B5).\n \nIn general, the loss on a fitting is the velocity pressure multiplied by the loss coefficient. This can be confirmed in the pressure loss report:\n\n<center>\n<img src=\"img/pressure_loss_report.png\" alt=\"Pressure loss report\" width=\"934\"/>\n</center>\n\n\n\n####<a name=\"3\"></a>Custom K Factor Calculation for Pipe Fittings\n\nA related question was raised by Js1900 and Jared in\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread \non [custom `K` factor calculation for pipe fittings](http://forums.autodesk.com/t5/revit-mep/custom-k-factor-calculation-for-pipe-fittings/m-p/6350133):\n\n**Question:** We have a requirement to use our own numbers for the K factor calculation for pipe fittings.\n \nThis could be done through the API by implementing the `IPipeFittingAndAccessoryPressureDropServer` interface, but it seems like it could be simpler to just add an entry to\nthe file `PipeKFactors.xml`:\n\n- C:\\Program Files\\Autodesk\\Revit 201x\\PipeKFactors.xml\n\nIt looks to be a simple enough for elbows; we can just create a new table in the xml with the diameters and coefficients we need, and Revit will use it to get our value.\n \nHowever, for Tees, the table is more complex and Revit seems to be doing more behind the scenes. For example, we can put our coefficients in, but Revit seems to output a number 4 times larger than expected every time. It gets even more complex for the table *Converging/Diverging Tee/Wye*, which seems to have no numbers in the xml and instead references equations defined elsewhere.\n \nDoes anyone have any insight into the algorithm used on these tables so we can be sure we can get the right values? Or have an idea why our edits to the Tee coefficients (*Custom Welded Tee* in the [attached xml pipe_k_factors.xml](zip/pipe_k_factors.xml)) result in in Revit giving a factor 4 times greater when we inspect it through the pressure loss report?\n\n**Answer:** For the '4x greater' case of the custom tee, we tried to reproduce and were unable to do so.\n \nI had a different problem with it altogether, namely, no friction factor was found in the table at all (see image below).\n \nWhat would be helpful in this case is to get a sample model demonstrating this issue. In some cases, the family and/or its instance parameters are defined in such a way that factors are applied multiple times, so it may not necessarily be the XML at issue.\n \nCan you provide details of where you are getting your data from for your ‘Custom Welded Tee’? E.g., do you have table(s) of data you can provide for the various conditions through the tee?\n \nIt looks like you are trying to input the 'Custom Welded Tee' data in a format similar to the 'Converging/Diverging/Side Tee' in the default .xml file. Can you confirm that? Any details of what exactly was changed would probably be helpful as well.\n\n<center>\n<img src=\"img/no_friction_factor.png\" alt=\"No friction factor\" width=\"918\"/>\n</center>\n \nConverging/Diverging Tee/Wye is implemented in code, as it is not based on simple tabular data. It is based on the method in the Crane Technical Paper 410.\n\n**Response:** We had looked through those calculations in Revit help which are well explained for pipes.\n\nHowever, for fittings, it simply says you can choose a `K` Coefficient from table, without really saying how it gets the number.\n \nYou are right; 'Custom Tee' in our xml is simply the 'Converging/Diverging/Side Tee' table copied. Then we modified XAxis values, which appear to be diameter ratios, to be 2 numbers far apart. This was to cover all diameter values. We repeated data for these X values to avoid Revit interpolating between them (We only want this to cover equal tees, so perhaps we could have just had a single X value of 1.0?)\n\nThen we just put the K coefficients we wanted in the data element, mapped to the flow ratio.\n \nThis was all based on guesswork and some testing, and it does appear the logic makes sense, apart from the factor of 4!\n \nI have attached the data we are trying to get Revit to use for Tee coefficients, a basic test model and test PipeKFactors.xml\nin [custom_tee_test.zip](zip/custom_tee_test.zip).\n\nThe XML includes a Tee table with the data we want to use/4, along with some test tables containing only values of 1. Replacing the default PipeKFactors.xml and running a pressure loss report gives this result:\n\n<center>\n<img src=\"img/loss_report.png\" alt=\"Loss report\" width=\"1887\"/>\n</center>\n \nWe have just been using guesswork and experimentation to get this far in modifying the xml, but it does seem like we can get useful results, so appreciate any insight!\n \n####<a name=\"4\"></a>Dynamo Code to Change Loss Coefficient\n\nHugh Compton adds:\n\n> The attached Dynamo code\nin [BV Change Coefficient Loss Fitting Pipes.dyn](zip/bv_change_coefficient_loss_fitting_pipes.dyn) can\nchange those values.\nIf the Loss Method is NOT 'Specific Coefficient' on the element, then the first run will fail, but the second run will work. \n\nHere are the main functions extracted from the Dynamo code, in case you prefer reading it in-line:\n\n<pre class=\"prettyprint\">\ndef getServerById(serverGUID, serviceId):\n  service = ExternalServiceRegistry.GetService(serviceId)\n  if service != \"null\" and serverGUID != \"null\":\n    server = service.GetServer(serverGUID)\n    if server != \"null\":\n      return server\n  return null\n\ndef getLossMethods(serviceId):\n  service = ExternalServiceRegistry.GetService(serviceId)\n  serverIds = service.GetRegisteredServerIds()\n  list=List[ElementId]()\n  for serverId in serverIds:\n    server = getServerById(serverId, serviceId)\n    \n    id=serverId\n    name=server.GetName()\n    lc.append(id)\n    lc.append(name)\n    lc.append(server)\n    \n  return lc"
  },
  {
    "original_filename": "1611_pipe_k_factor",
    "header_text": "Set Coefficient?",
    "local_header_href": "#set-coefficient",
    "chunk_text": "# Set Coefficient?\n\nTransactionManager.Instance.EnsureInTransaction(doc)\n  param = fitting.get_Parameter(BuiltInParameter.RBS_PIPE_FITTING_LOSS_METHOD_SERVER_PARAM)\n  lc = getLossMethods(ExternalServices.BuiltInExternalServices.PipeFittingAndAccessoryPressureDropService)\n  schema = lc[8].GetDataSchema()\n  field = schema.GetField(\"Coefficient\")\n  entity=fitting.GetEntity(schema)\n    \n  param.Set(lc[6].ToString()) \n  TransactionManager.Instance.TransactionTaskDone()"
  },
  {
    "original_filename": "1611_pipe_k_factor",
    "header_text": "Set K Factor?",
    "local_header_href": "#set-k-factor",
    "chunk_text": "# Set K Factor?\n\nfitting = doc.GetElement(eleId)\n  param = fitting.get_Parameter(BuiltInParameter.RBS_PIPE_FITTING_LOSS_METHOD_SERVER_PARAM)\n  lc = getLossMethods(ExternalServices.BuiltInExternalServices.PipeFittingAndAccessoryPressureDropService)\n  schema = lc[8].GetDataSchema()\n  field = schema.GetField(\"KFactor\")\n  entity=fitting.GetEntity(schema)\n     \n  oldval = entity.Get[field.ValueType](field) # obtaining values\n  \n  TransactionManager.Instance.EnsureInTransaction(doc)\n  entity.Set[field.ValueType](field, SetNew) # installation of a new coefficient value of certain\n  fitting.SetEntity(entity)\n  TransactionManager.Instance.TransactionTaskDone()\n</pre>\n\nMany thanks to Hugh for sharing this!\n\n####<a name=\"5\"></a>Forge DevCon 2017 Class Recordings\n\nThe [Forge DevCon 2017 class recordings are now available](https://forge.autodesk.com/blog/forge-devcon-2017-class-recordings-now-available?linkId=45816608).\n\nRecordings of the presentations from Forge DevCon 2017 in Las Vegas are now available on\nthe [AU Online website](http://au.autodesk.com/au-online).\n\nThe recording library include every class presented on Monday and most of the joint DevCon/AU classes presented on Tuesday; they can be watched online or downloaded.\n\nMany recordings are accompanied by additional downloadable material, such as handouts, slide decks and sample code.\n\nThis link takes you to a list of [all classes tagged as Forge DevCon Las Vegas 2017](http://au.autodesk.com/au-online/classes-on-demand/search?full-text=DevCon&year=2017&conference=Las+Vegas).\n\nYou'll notice this library also includes recordings for the Forge DevCon keynotes. Please watch the alternative (and better) recordings for those\nat [forge.autodesk.com/devcon-2017#keynotes](https://forge.autodesk.com/devcon-2017#keynotes) instead.\n\nEnjoy!\n\n\n####<a name=\"6\"></a>Archi+Lab\n\nThe intro already said it all:\n\nKonrad Sobon publishes a wonderful blog on the Revit API, [archi+lab](http://archi-lab.net).\n\nHere are some of the recent posts:\n\n- [How to maintain Revit plug-ins for multiple versions](http://archi-lab.net/how-to-maintain-revit-plug-ins-for-multiple-versions)\n- [Code signing of your Revit plug-ins](http://archi-lab.net/code-signing-of-your-revit-plug-ins/)\n- [Printing PDFs from Revit](http://archi-lab.net/printing-pdfs-from-revit-why-is-it-so-hard/)\n\nThank you very much, Konrad, for this great resource!\n\nI searched unsuccessfully for an easy way to list all the posts... maybe Konrad can provide one.\n\nFor The Building Coder, for example, you can simply go to\nthe [tbc GitHub repository](https://github.com/jeremytammik/tbc) and look at\nthe [GitHub pages view of `index.html`](http://jeremytammik.github.io/tbc/a).\n\n\n####<a name=\"7\"></a>Revit Add-in Installer and Buttons\n\nI only noticed Konrad's blog thanks to [MarryTookMyCoffe](https://forums.autodesk.com/t5/user/viewprofilepage/user-id/3894260)'s answer to \nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread \non [API to make installer and install to Revit](https://forums.autodesk.com/t5/revit-api-forum/api-to-make-installer-and-install-to-revit/m-p/7616236):\n\n**Question:** Recently I finished my add-in coding using VS2013 and Revit 2016.\n\nNow I want to deploy and create an installer; how can I do that?\n\nSome mention WIX and Innosetup, also some blogs mention to use oneclick to make the installer.\n \nI managed to create an installer, but I have a problem after installing the add in: nothing happens.\n\nI copied the add-in file to the correct Revit location and ensured the path to reference my .DLL is correct.\n \nRevit now recognises my add in. It displays the correct name in the ribbon. but the panel doesn't display anything and remains totally blank.\n \nI'm not sure what exactly I missed out. Can somebody give me a hint which areas in VS I need to check? Is there a blog I can read on how to correctly deploy a Revit add-in?\n \n**Answer:** The [Revit API getting started material](http://thebuildingcoder.typepad.com/blog/about-the-author.html#2) includes\nall the information you require on the add-in architecture and installation basics.\n  \nFor a totally comprehensive and complete summary of the relevant information, you can also jump straight to \nthe [developer guide section on add-in installation](http://help.autodesk.com/view/RVT/2018/ENU/?guid=GUID-4BE74935-A15C-4536-BD9C-7778766CE392).\n\nIt does not cover the implementation of an installer or setup application, though.\n \nFor a sample of a very complete and professional working single-click setup installer, you might want to check out\nthe [RevitPythonShell](https://github.com/architecture-building-systems/revitpythonshell).\n \nIf your installer is working but the add-in ribbon panel is empty, you may have forgotten to add a button to it.\n\nHere is a link to a good explanation\nby [archi+lab](http://archi-lab.net) on how\nto [create your own tab and buttons in Revit](http://archi-lab.net/create-your-own-tab-and-buttons-in-revit).\n\n<center>\n<img src=\"img/revit_ui.jpg\" alt=\"Revit UI\" width=\"400\"/>\n</center>"
  }
]