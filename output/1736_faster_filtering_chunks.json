[
  {
    "original_filename": "1736_faster_filtering",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\n- slow, even slower, fast filter to determine\n  simplified by ParameterFilterRuleFactory\n  https://forums.autodesk.com/t5/revit-api-forum/is-it-show-filter/m-p/8712175\n\n- python\n  Get date and time when photo was taken from EXIF data using PIL\n  https://stackoverflow.com/questions/23064549/get-date-and-time-when-photo-was-taken-from-exif-data-using-pil\n  https://github.com/ianare/exif-py\n  /j/sh/ren2timestamp.py\n\n- population growth\n  [Hans Rosling: Global population growth, box by box](https://www.youtube.com/watch?v=fTznEIZRkLg)\n  [TED talk](http://www.ted.com)\n  The world's population will grow to 9 billion over the next 50 years &ndash; and only by raising the living standards of the poorest can we check population growth.\n  This is the paradoxical answer that Hans Rosling unveils at TED@Cannes using colorful new data display technology (you'll see).\n\n- [A quantum experiment suggests there’s no such thing as objective reality](https://www.technologyreview.com/s/613092/a-quantum-experiment-suggests-theres-no-such-thing-as-objective-reality)\n\n- [Can AI be a fair judge in court? Estonia thinks so](https://www.wired.com/story/can-ai-be-fair-judge-court-estonia-thinks-so/)\n\ntwitter:\n\nSlow, slower still and faster filtering in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon http://bit.ly/fasterfilter\n\nToday I discuss (once again) an important performance aspect of Revit element filtering, a Python script for tagging JPEG images with EXIF data, prompted by a recent ski tour, and three other interesting topics that caught my eye\n&ndash; Slow, slower still and faster filtering\n&ndash; Python JPEG EXIT filename tagging\n&ndash; TED talks and population growth\n&ndash; Objective reality does not exist\n&ndash; Artificial intelligence judge...\n\nlinkedin:\n\nSlow, slower still and faster filtering in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon http://bit.ly/fasterfilter\n\nToday I discuss (once again) an important performance aspect of Revit element filtering, a Python script for tagging JPEG images with EXIF data, prompted by a recent ski tour, and three other interesting topics that caught my eye:\n\n- Slow, slower still and faster filtering\n- Python JPEG EXIT filename tagging\n- TED talks and population growth\n- Objective reality does not exist\n- Artificial intelligence judge...\n\n-->"
  },
  {
    "original_filename": "1736_faster_filtering",
    "header_text": "Slow, Slower Still and Faster Filtering",
    "local_header_href": "#slow-slower-still-and-faster-filtering",
    "chunk_text": "### Slow, Slower Still and Faster Filtering\n\nToday I discuss (once again) an important performance aspect of Revit element filtering, a Python script for tagging JPEG images with EXIF data, prompted by a recent ski tour, and three other interesting topics that caught my eye:\n\n- [Slow, slower still and faster filtering](#2) \n- [Python JPEG EXIT filename tagging](#3) \n- [TED talks and population growth](#4) \n- [Objective reality does not exist](#5) \n- [Artificial intelligence judge](#6)"
  },
  {
    "original_filename": "1736_faster_filtering",
    "header_text": "<a name=\"2\"></a> Slow, Slower Still and Faster Filtering",
    "local_header_href": "#a-name2a-slow-slower-still-and-faster-filtering",
    "chunk_text": "#### <a name=\"2\"></a> Slow, Slower Still and Faster Filtering\n\nA question was raised in\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\nasking, [is it slow filter](https://forums.autodesk.com/t5/revit-api-forum/is-it-show-filter/m-p/8712175)?\n\nMeseems we need to point out yet again the difference between slow and fast filters.\n\nMuch more importantly, though, the difference between using Revit filters or post-processing results using .NET and or LINQ.\n\nThe latter will always be at least twice as slow as using Revit filters, regardless of whether they are fast or slow.\n\nThe process of marshalling the Revit element data out of the Revit memory space into the .NET environment always costs much more time than retrieving the data inside of Revit in the first place.\n\nTherefore, if you care about performance, use as many Revit filters as possible, regardless whether they are fast or slow.\n\nIn the following example, .NET post-processing is used to test a parameter value.\n\nThat can be speeded up by an order of magnitude by implementing a Revit parameter filter instead, which avoids the marshalling, post-processing, and is fast to boot:\n\n**Question:** I have used the following code:\n\n<pre class=\"code\">\n  string section_name = \"XXXXXXX\";\n\n  IEnumerable<Element> elems = collect\n    .OfClass(typeof(FamilyInstance))\n    .Where(x => x.get_Parameter(\n      BuiltInParameter.ELEM_FAMILY_PARAM)\n        .AsValueString() == section_name );\n</pre>\n\nIs it a slow filter?\n\n**Answer:** No, it is not. It is even slower than a slow filter.\n\nYour code retrieves the element data from Revit to the .NET add-in memory space, and then uses .NET and LINQ to post-process it.\n\nThe difference is explained in the discussion\nof [quick, slow and LINQ element filtering](http://thebuildingcoder.typepad.com/blog/2015/12/quick-slow-and-linq-element-filtering.html).\n\nYou could convert it to a fast filter by implementing\na [parameter filter to compare the family name](https://thebuildingcoder.typepad.com/blog/2018/06/forge-tutorials-and-filtering-for-a-parameter-value.html#3).\n\nThat discussion does not show how to actually implement the parameter filter.\n\nI therefore cleaned up The Building Coder sample code\ndemonstrating [retrieving named family symbols using either LINQ or a parameter filter](https://github.com/jeremytammik/the_building_coder_samples/blob/master/BuildingCoder/BuildingCoder/CmdCollectorPerformance.cs#L1203-L1255) for\nyou to illustrate how to do that:\n\n<pre class=\"code\">\n  <span style=\"color:blue;\">#region</span>&nbsp;Retrieve&nbsp;named&nbsp;family&nbsp;symbols&nbsp;using&nbsp;either&nbsp;LINQ&nbsp;or&nbsp;a&nbsp;parameter&nbsp;filter\n  <span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">FilteredElementCollector</span>\n  &nbsp;&nbsp;GetStructuralColumnSymbolCollector(\n  &nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Document</span>&nbsp;doc&nbsp;)\n  {\n  &nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">FilteredElementCollector</span>(&nbsp;doc&nbsp;)\n  &nbsp;&nbsp;&nbsp;&nbsp;.OfCategory(&nbsp;<span style=\"color:#2b91af;\">BuiltInCategory</span>.OST_StructuralColumns&nbsp;)\n  &nbsp;&nbsp;&nbsp;&nbsp;.OfClass(&nbsp;<span style=\"color:blue;\">typeof</span>(&nbsp;<span style=\"color:#2b91af;\">FamilySymbol</span>&nbsp;)&nbsp;);\n  }\n   \n  <span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">IEnumerable</span>&lt;<span style=\"color:#2b91af;\">Element</span>&gt;&nbsp;Linq(&nbsp;\n  &nbsp;&nbsp;<span style=\"color:#2b91af;\">Document</span>&nbsp;doc,&nbsp;\n  &nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;familySymbolName&nbsp;)\n  {\n  &nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;GetStructuralColumnSymbolCollector(&nbsp;doc&nbsp;)\n  &nbsp;&nbsp;&nbsp;&nbsp;.Where(&nbsp;x&nbsp;=&gt;&nbsp;x.Name&nbsp;==&nbsp;familySymbolName&nbsp;);\n  }\n   \n  <span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">IEnumerable</span>&lt;<span style=\"color:#2b91af;\">Element</span>&gt;&nbsp;Linq2(&nbsp;\n  &nbsp;&nbsp;<span style=\"color:#2b91af;\">Document</span>&nbsp;doc,&nbsp;\n  &nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;familySymbolName&nbsp;)\n  {\n  &nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;GetStructuralColumnSymbolCollector(&nbsp;doc&nbsp;)\n  &nbsp;&nbsp;&nbsp;&nbsp;.Where(&nbsp;x&nbsp;=&gt;&nbsp;x.get_Parameter(&nbsp;\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">BuiltInParameter</span>.SYMBOL_NAME_PARAM&nbsp;)\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.AsString()&nbsp;==&nbsp;familySymbolName&nbsp;);\n  }\n   \n  <span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">IEnumerable</span>&lt;<span style=\"color:#2b91af;\">Element</span>&gt;&nbsp;FilterRule(&nbsp;\n  &nbsp;&nbsp;<span style=\"color:#2b91af;\">Document</span>&nbsp;doc,&nbsp;\n  &nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;familySymbolName&nbsp;)\n  {\n  &nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;GetStructuralColumnSymbolCollector(&nbsp;doc&nbsp;)\n  &nbsp;&nbsp;&nbsp;&nbsp;.WherePasses(\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">ElementParameterFilter</span>(\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">FilterStringRule</span>(\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">ParameterValueProvider</span>(\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">ElementId</span>(&nbsp;<span style=\"color:#2b91af;\">BuiltInParameter</span>.SYMBOL_NAME_PARAM&nbsp;)&nbsp;),\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">FilterStringEquals</span>(),&nbsp;familySymbolName,&nbsp;<span style=\"color:blue;\">true</span>&nbsp;)&nbsp;)&nbsp;);\n  }\n   \n  <span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">IEnumerable</span>&lt;<span style=\"color:#2b91af;\">Element</span>&gt;&nbsp;Factory(&nbsp;\n  &nbsp;&nbsp;<span style=\"color:#2b91af;\">Document</span>&nbsp;doc,&nbsp;\n  &nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;familySymbolName&nbsp;)\n  {\n  &nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;GetStructuralColumnSymbolCollector(&nbsp;doc&nbsp;)\n  &nbsp;&nbsp;&nbsp;&nbsp;.WherePasses(\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">ElementParameterFilter</span>(\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">ParameterFilterRuleFactory</span>.CreateEqualsRule(\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">ElementId</span>(&nbsp;<span style=\"color:#2b91af;\">BuiltInParameter</span>.SYMBOL_NAME_PARAM&nbsp;),\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;familySymbolName,&nbsp;<span style=\"color:blue;\">true</span>&nbsp;)&nbsp;)&nbsp;);\n  }\n  <span style=\"color:blue;\">#endregion</span>&nbsp;<span style=\"color:green;\">//&nbsp;Retrieve&nbsp;named&nbsp;family&nbsp;symbols&nbsp;using&nbsp;either&nbsp;LINQ&nbsp;or&nbsp;a&nbsp;parameter&nbsp;filter</span>\n</pre>\n\nIt demonstrates two ways to implement the highly efficient parameter filter.\n\nFirst, the explicit solution, implementing the separate `ElementParameterFilter`, `FilterStringRule`, and `ParameterValueProvider` components one by one.\n\nSecond, a much more succinct solution using the `ParameterFilterRuleFactory` `CreateEqualsRule` method.\n\nHere are some other examples of using the `ParameterFilterRuleFactory`:\n\n- [Isolating elements of a given system](https://thebuildingcoder.typepad.com/blog/2015/01/isolating-elements-of-a-given-system.html)\n- [Retrieving elements visible in view](https://thebuildingcoder.typepad.com/blog/2017/05/retrieving-elements-visible-in-view.html)\n- [A new way to retrieve a parameter id](https://thebuildingcoder.typepad.com/blog/2018/08/revit-20191-cefsharp-forge-accelerator-in-rome.html#7)\n\nI hope this clarifies.\n\nNow for some non-Revit-related topics:"
  },
  {
    "original_filename": "1736_faster_filtering",
    "header_text": "<a name=\"3\"></a> Python JPEG EXIT Filename Tagging",
    "local_header_href": "#a-name3a-python-jpeg-exit-filename-tagging",
    "chunk_text": "#### <a name=\"3\"></a> Python JPEG EXIT Filename Tagging\n\nI went on a ski tour in the Silvretta area with some friends two weeks ago, climbing Haagspitze, Hintere Jamspitze, Ochsenkopf, Sattelkopf and above all Piz Buin.\n\nHere I am crossing the Piz Buin summit ridge:\n\n<center>\n<img src=\"img/20190323_121516_jk_8144_jeremy_on_ridge_1024x768.jpg\" alt=\"Jeremy on the Piz Buin summit ridge\" width=\"512\">\n</center>\n\nThat excursion prompted me to implement a Python script to tag the photos shared by the participants after the tour.\n\nHow to easily sort all the different pictures chronologically?\n\nWell, most cameras embed a timestamp in EXIF data when they generate a JPEG image.\n\nThis information can be easily accessed and used to rename each image file, e.g., prepending the timestamp to the filename.\n\nIn case of multiple photographers, it also makes sense to add the photographer initials to the filename.\n\nI implemented a really minute little Python script `ren2timestamp.py` that does this for me, using a hint from the StackOverflow discussion\non [getting date and time when photo was taken from EXIF data using PIL](  https://stackoverflow.com/questions/23064549/get-date-and-time-when-photo-was-taken-from-exif-data-using-pil) and\nthe [`exif-py` easy-to-use Python module to extract Exif metadata from tiff and jpeg files](https://github.com/ianare/exif-py):\n\n<pre class=\"prettyprint\">\n#!/usr/bin/env python"
  },
  {
    "original_filename": "1736_faster_filtering",
    "header_text": "ren2timestamp.py - rename files to add their exif timestamp as a prefix",
    "local_header_href": "#ren2timestamppy-rename-files-to-add-their-exif-timestamp-as-a-prefix",
    "chunk_text": "# ren2timestamp.py - rename files to add their exif timestamp as a prefix\n\n"
  },
  {
    "original_filename": "1736_faster_filtering",
    "header_text": "Copyright (C) 2018 by Jeremy Tammik, Autodesk Inc.",
    "local_header_href": "#copyright-c-2018-by-jeremy-tammik-autodesk-inc",
    "chunk_text": "# Copyright (C) 2018 by Jeremy Tammik, Autodesk Inc.\n\nimport exifread, datetime, os, sys, time\n\nfiles = sys.argv[1:]\n\nexif_ts_key = 'EXIF DateTimeOriginal'\n\ndef exif_timestamp(filename):\n  with open(filename, 'rb') as fh:\n    tags = exifread.process_file(fh, stop_tag=exif_ts_key)\n    if tags.has_key(exif_ts_key):\n      return tags[exif_ts_key]\n    else:\n      return ''\n\nphotographer_initials = 'jt'\n\nfor g in files:\n  ts3 = exif_timestamp(g)\n  ts3 = str(ts3).replace(':','').replace(' ','_')\n  newname = ts3 + '_' + photographer_initials + '_' + g\n  print(\"%s --> '%s'\" % (g,newname))\n  os.rename(g, newname)\n</pre>\n\nHere is the closing picture of the entire group on the Sattelkopf summit:\n\n<center>\n<img src=\"img/20190324_123346_wk_1091_gruppenfoto_sattelkopf_912x606.jpg\" alt=\"Group photo on Sattelkopf\" width=\"456\">\n</center>"
  },
  {
    "original_filename": "1736_faster_filtering",
    "header_text": "<a name=\"4\"></a> TED Talks and Population Growth",
    "local_header_href": "#a-name4a-ted-talks-and-population-growth",
    "chunk_text": "#### <a name=\"4\"></a> TED Talks and Population Growth\n\n[TED](http://www.ted.com) is a non-profit organisation devoted to spreading ideas, usually in the form of short, powerful talks (18 minutes or less).\nTED is also a global community, welcoming people from every discipline and culture who seek a deeper understanding of the world.\nTED believes passionately in the power of ideas to change attitudes, lives and, ultimately, the world.\nTED.com is a clearinghouse of free knowledge from the world's most inspired thinkers.\n\nI have listened to many TED talks, enjoyed and appreciated them very much, and highlighted several of them here in the past.\n\nHere is an illuminating one with a paradoxical answer by [Hans Rosling on Global population growth, box by box](https://youtu.be/fTznEIZRkLg):\n\n<center>\n<iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/fTznEIZRkLg\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n</center>\n\nThe world's population will grow to 9 billion over the next 50 years &ndash; and only by raising the living standards of the poorest can we check population growth."
  },
  {
    "original_filename": "1736_faster_filtering",
    "header_text": "<a name=\"5\"></a> Objective Reality Does Not Exist",
    "local_header_href": "#a-name5a-objective-reality-does-not-exist",
    "chunk_text": "#### <a name=\"5\"></a> Objective Reality Does Not Exist\n\n[A quantum experiment suggests there’s no such thing as objective reality](https://www.technologyreview.com/s/613092/a-quantum-experiment-suggests-theres-no-such-thing-as-objective-reality)."
  },
  {
    "original_filename": "1736_faster_filtering",
    "header_text": "<a name=\"6\"></a> Artificial Intelligence Judge",
    "local_header_href": "#a-name6a-artificial-intelligence-judge",
    "chunk_text": "#### <a name=\"6\"></a> Artificial Intelligence Judge\n\n[Can AI be a fair judge in court? Estonia thinks so](https://www.wired.com/story/can-ai-be-fair-judge-court-estonia-thinks-so)."
  }
]