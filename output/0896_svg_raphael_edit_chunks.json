[
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta content=\"text/html; charset=utf-8\" http-equiv=\"Content-Type\"/>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "2D SVG Editing on Mobile Device with Raphaël",
    "local_header_href": "#2d-svg-editing-on-mobile-device-with-raphaël",
    "chunk_text": "<h3>2D SVG Editing on Mobile Device with Raphaël</h3><p>As I mentioned last week, I took another look at displaying a 2D view of a Revit model on mobile devices using SVG to enhance the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/10/room-polygon-and-furniture-picker-in-svg.html\">\nroom polygon and furniture picker in SVG</a>.\n\n<p>That implementation displays a read-only view of the model, useful for picking and identifying elements, e.g. for querying or adding metadata to them.</p>\n<p>It would also be nice to be able to edit some data graphically, e.g. enable translation and rotation of the furniture and other family instances.</p>\n<p>The long-term goal is to implement a cloud-based round-trip 2D Revit model editing on any mobile device using SVG.\n\n<p>The advantage of SVG is that it enables display and edit of a 2D scene, e.g. a rendering of a Revit model, on any mobile device with no need for installation of any additional software whatsoever beyond a browser.\n\n<p>The parts that I still want to explore include a Revit add-in to export polygon renderings of room boundaries and other elements such as furniture and equipment to a cloud-based repository, and querying the repository from the mobile device.\n\n<p>To simplify editing the model, I wrapped all the SVG interaction in a JavaScript library.</p>\n<p>After some research and comparison of different available open source SVG libraries and editors, I chose the\n\n<a href=\"#0\">Raphaël JavaScript library</a>.\n\nI then worked through the following series of incremental implementation steps to first recreate the state I had already achieved previously, then add drag, rotate, and button support:</p>\n<ol>\n<li><a href=\"#1\">Curves</a></li>\n<li><a href=\"#2\">Grid</a></li>\n<li><a href=\"#3\">Room</a></li>\n<li><a href=\"#4\">Reporting text and click handler</a></li>\n<li><a href=\"#5\">Furniture</a></li>\n<li><a href=\"#6\">Drag</a></li>\n<li><a href=\"#7\">Rotate</a></li>\n<li><a href=\"#8\">Button</a></li>\n<li><a href=\"#9\">Conclusion</a></li>\n</ol>\n<p>To immediately jump into my testing playground, you can simply access\n\n<a href=\"http://thebuildingcoder.typepad.com/svg\">The Building Coder SVG</a> folder.</p>\n<a name=\"0\"></a>\n<h4>The Raphaël JavaScript Library</h4>\n<p><a href=\"http://raphaeljs.com\">Raphaël</a> ['ræfeɪəl] is\n\na small JavaScript library that simplifies work with vector graphics on the web.</p>\n<p>Raphaël uses the SVG W3C Recommendation and VML as a base for creating graphics.\nThis means every graphical object is also a DOM object, so JavaScript event handlers can be attached and the objects can be dynamically modified.\nThe stated goal is to provide an adapter to make drawing vector art compatible cross-browser and easy.</p>\n<p>Raphaël supports the current versions of Firefox, Safari, Chrome, Opera and Internet Explorer.</p>\n<a name=\"1\"></a>\n<h4>Curves</h4>\n<p>The first step I took was to extract one of the Raphaël demo pages, <a href=\"http://raphaeljs.com/curver.html\">curver.html</a>, and host it on my own page to ensure that it has no other dependencies and continues to work in my environment:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/01-curves.htm\"><img alt=\"The Building Coder Raphaël curves demo\" src=\"img/svg_raph_01.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/01-curves.htm\">Curves</a>\n</center>\n<p>It shows how curves can be drawn and hooked up with event handlers to react to dragging.</p>\n<p>To explore this or any other of the Raphaël demo implementations, simply navigate to it and view the source.</p>\n<a name=\"2\"></a>\n<h4>Grid</h4>\n<p>Once I had that in place and up and running, my next steps dealt with reimplementing the state of the existing\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/10/room-polygon-and-furniture-picker-in-svg.html\">\npure SVG equipment picker</a> using\n\nRaphaël instead.\n\n<p>The first step is easy, simply setting up the canvas and a rectangular grid:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/02-grid.htm\"><img alt=\"Grid\" src=\"img/svg_raph_02.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/02-grid.htm\">Grid</a>\n</center>\n<p>Here is the source code HTML achieving this (copy to a text editor or view source to see the truncated lines in full):</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n<span style=\"color:#004a43; \">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"</span><span style=\"color:#5555dd; \">http://www.w3.org/TR/html4/strict.dtd</span><span style=\"color:#004a43; \">\"&gt;</span>\n<span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">html</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">lang</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"en\"</span><span style=\"color:#a65700; \">&gt;</span>\n  <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">head</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">meta</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">http-equiv</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"Content-Type\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">content</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"text/html; charset=ascii\"</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">title</span><span style=\"color:#a65700; \">&gt;</span>Jeremy's <span style=\"color:#008c00; \">2</span>D Mobile Device Revit Model Editor Grid<span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">title</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">link</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">rel</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"stylesheet\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">href</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"demo.css\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">type</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"text/css\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">media</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"screen\"</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">link</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">rel</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"stylesheet\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">href</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"demo-print.css\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">type</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"text/css\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">media</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"print\"</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">script src=\"raphael-min-jt.js\" type=\"text/javascript\" charset=\"ascii\"</span><span style=\"color:#a65700; \">&gt;</span><span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">script</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">script type=\"text/javascript\" charset=\"ascii\"</span><span style=\"color:#a65700; \">&gt;</span>\n      window<span style=\"color:#808030; \">.</span>onload <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n        <span style=\"color:#800000; font-weight:bold; \">var</span> w <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">600</span><span style=\"color:#808030; \">,</span> h <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">400</span><span style=\"color:#800080; \">;</span>\n        <span style=\"color:#800000; font-weight:bold; \">var</span> r <span style=\"color:#808030; \">=</span> Raphael<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">holder</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> w<span style=\"color:#808030; \">,</span> h<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n        <span style=\"color:#808030; \">--</span>w<span style=\"color:#800080; \">;</span>\n        <span style=\"color:#808030; \">--</span>h<span style=\"color:#800080; \">;</span>\n        r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">0</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">0</span><span style=\"color:#808030; \">,</span> w<span style=\"color:#808030; \">,</span> h<span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">10</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#666</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n        <span style=\"color:#696969; \">// grid</span>\n        <span style=\"color:#800000; font-weight:bold; \">var</span> d <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">50</span><span style=\"color:#808030; \">,</span> i<span style=\"color:#800080; \">;</span>\n        <span style=\"color:#800000; font-weight:bold; \">for</span> <span style=\"color:#808030; \">(</span>i <span style=\"color:#808030; \">=</span> d<span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">&lt;</span> h<span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">+=</span> d<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n          r<span style=\"color:#808030; \">.</span>path<span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">[</span><span style=\"color:#808030; \">[</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">M</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">0</span><span style=\"color:#808030; \">,</span> i<span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">,</span> <span style=\"color:#808030; \">[</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">L</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> w<span style=\"color:#808030; \">,</span> i<span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#666</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n        <span style=\"color:#800080; \">}</span>\n        <span style=\"color:#800000; font-weight:bold; \">for</span> <span style=\"color:#808030; \">(</span>i <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">50</span><span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">&lt;</span> <span style=\"color:#008c00; \">600</span><span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">+=</span> <span style=\"color:#008c00; \">50</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n          r<span style=\"color:#808030; \">.</span>path<span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">[</span><span style=\"color:#808030; \">[</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">M</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> i<span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">0</span><span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">,</span> <span style=\"color:#808030; \">[</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">L</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> i<span style=\"color:#808030; \">,</span> w<span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#666</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n        <span style=\"color:#800080; \">}</span>\n      <span style=\"color:#800080; \">}</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">script</span><span style=\"color:#a65700; \">&gt;</span>\n  <span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">head</span><span style=\"color:#a65700; \">&gt;</span>\n  <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">body</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">div</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">id</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"holder\"</span><span style=\"color:#a65700; \">&gt;</span><span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">div</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">p</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">id</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"copy\"</span><span style=\"color:#a65700; \">&gt;</span>Jeremy Tammik, Autodesk Inc<span style=\"color:#008c00; \">.</span> using the <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">a</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">href</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"http://raphaeljs.com\"</span><span style=\"color:#a65700; \">&gt;</span>Raphael<span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">a</span><span style=\"color:#a65700; \">&gt;</span> JavaScript vector library<span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">p</span><span style=\"color:#a65700; \">&gt;</span>\n  <span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">body</span><span style=\"color:#a65700; \">&gt;</span>\n<span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">html</span><span style=\"color:#a65700; \">&gt;</span>\n</pre>\n<a name=\"3\"></a>\n<h4>Room Polygon</h4>\n<p>Next, display the static room polygon on the grid:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\"><img alt=\"Room\" src=\"img/svg_raph_03.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\">Room</a>\n</center>\n<p>Basically, we simply add the following line of code:</p>\n<pre class=\"code\">\n  // room - outer loop anti-clockwise, inner clockwise\n\n  r.path(\"M 40 40 L 440 40 440 300 300 300 300 200 40 200\"\n    + \" Z M 320 240 L 320 280 420 280 420 240 Z\")\n    .attr({stroke: \"blue\", fill:\"lightblue\"});\n</pre>\n<p>There are several different ways to implement the hole.\nNote that the oddeven fill rule is applied by default and requires strict adherence to the clockwise and anti-clockwise orientation of loop vertices.\nI found the hints on\n\n<a href=\"http://stackoverflow.com/questions/3349651/how-to-achieve-donut-holes-with-paths-in-raphael\">\nhow to achieve donut holes with paths</a> useful.</p>\n<a name=\"4\"></a>\n<h4>Reporting Text and Click Handler</h4>\n<p>The main feature of the original furniture picker was the identification and dynamic reporting of the room polygon, furniture, or equipment picked on screen.\nThe reporting function could of course be expanded to display or edit any other information desired, including updating some repository with modified data.</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\"><img alt=\"Text\" src=\"img/svg_raph_04.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\">Text</a>\n</center>\n<p>To achieve this in the Raphaël environment, I implemented a JavaScript event handler:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  jOnClick <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">var</span> s <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">Id </span><span style=\"color:#800000; \">\"</span> <span style=\"color:#808030; \">+</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>id<span style=\"color:#808030; \">.</span><span style=\"color:#800000; font-weight:bold; \">toString</span><span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">+</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">: </span><span style=\"color:#800000; \">\"</span> <span style=\"color:#808030; \">+</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    t<span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>text<span style=\"color:#800080; \">:</span>s<span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre>\n<p>The clicked object is displayed using a new text element, and both the background rectangle and the room polygon are assigned a 'jid' identifier and subscribe to the click event to trigger the event handler:\n\n<pre class=\"code\">\n  // room - outer loop anti-clockwise, inner clockwise\n\n  var room = r\n    .path(\"M 40 40 L 440 40 440 300 300 300 300 200 40 200 Z\"\n      + \"M 320 240 L 320 280 420 280 420 240 Z\")\n    .attr({stroke: \"blue\", fill:\"lightblue\"})\n    .data(\"jid\", \"room\")\n    .click(jOnClick);\n\n  // reporting text\n\n  var t = r\n    .text(300, 380, \"Welcome. Please click around.\")\n    .attr({stroke: \"#fff\"});\n</pre>\n<a name=\"5\"></a>\n<h4>Furniture and Equipment</h4>\n<p>Next, I added the furniture, consisting of table and chair placeholders:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\"><img alt=\"Furniture\" src=\"img/svg_raph_05.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\">Furniture</a>\n</center>\n<p>Each one is implemented similarly to the room polygon, equipped with its own identifier, and obviously subscribing to the click event:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// furniture</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">200</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">40</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">table</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">75</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">110</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair1</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">118</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair2</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">158</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair3</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">198</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair4</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">238</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair5</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n</pre>\n<p>With that, we have arrived at the same stage of functionality as we already had using just pure SVG with no additional toolkit support.\nNow comes the new fun stuff.</p>\n<a name=\"6\"></a>\n<h4>Drag</h4>\n<p>Raphaël supports dragging.\nHere, the furniture has been dragged away from its original locations:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\"><img alt=\"Drag\" src=\"img/svg_raph_06.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\">Drag</a>\n</center>\n<p>Drag event subscription requires event handlers for the drag initialisation, move and mouse up actions:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// drag support</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> dragger <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#800080; \">?</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">x</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">cx</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#800080; \">?</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">y</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">cy</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>animate<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">fill-opacity</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008000; \">.5</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n  move <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span>dx<span style=\"color:#808030; \">,</span> dy<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">var</span> att <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span>\n      <span style=\"color:#800080; \">?</span> <span style=\"color:#800080; \">{</span>x<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">+</span> dx<span style=\"color:#808030; \">,</span> y<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">+</span> dy<span style=\"color:#800080; \">}</span>\n      <span style=\"color:#800080; \">:</span> <span style=\"color:#800080; \">{</span>cx<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">+</span> dx<span style=\"color:#808030; \">,</span> cy<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">+</span> dy<span style=\"color:#800080; \">}</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span>att<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    r<span style=\"color:#808030; \">.</span>safari<span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n  up <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>animate<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">fill-opacity</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">1</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n</pre>\n<p>To subscribe to the drag event efficiently, I reimplemented the furniture as an array that I can iterate over uniformly:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// furniture</span>\n\n  furniture <span style=\"color:#808030; \">=</span> <span style=\"color:#808030; \">[</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">200</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">40</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">table</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">75</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">110</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair1</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">118</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair2</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">158</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair3</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">198</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair4</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">238</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair5</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n  <span style=\"color:#808030; \">]</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> n <span style=\"color:#808030; \">=</span> furniture<span style=\"color:#808030; \">.</span>length<span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">for</span> <span style=\"color:#808030; \">(</span>i <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">0</span><span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">&lt;</span> n<span style=\"color:#800080; \">;</span> <span style=\"color:#808030; \">++</span>i<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    furniture<span style=\"color:#808030; \">[</span>i<span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">.</span>drag<span style=\"color:#808030; \">(</span>move<span style=\"color:#808030; \">,</span> dragger<span style=\"color:#808030; \">,</span> up<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre>\n<a name=\"7\"></a>\n<h4>Rotate</h4>\n<p>I fiddled around for a while to implement the rotation.\nHere is some dragged and rotated furniture:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\"><img alt=\"Rotate\" src=\"img/svg_raph_07.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\">Rotate</a>\n</center>\n<p>In order to handle dragging, I ended up implementing a text element that triggers a rotation of the currently selected element.\nA sibling text element reverses the rotation, i.e. rotates counter-clockwise.</p>\n<p>The Raphaël rotation handling seems somewhat controversial, as far as I can tell from numerous discussions on the topic that I referred to.\nWhen dragging a rotated element, I first unrotate it back to its original state.\nOtherwise, the drag operation on a rotated element takes the rotation into account, causing the drag direction to differ from the visible cursor movement.</p>\n<p>Here are the rotation handlers:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// rototion support</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> current_furniture <span style=\"color:#808030; \">=</span> <span style=\"color:#0f4d75; \">null</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_item <span style=\"color:#808030; \">(</span><span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">,</span> angle<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">if</span><span style=\"color:#808030; \">(</span> <span style=\"color:#0f4d75; \">null</span> <span style=\"color:#808030; \">!=</span> <span style=\"color:#800000; font-weight:bold; \">item</span> <span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n      <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>rotate<span style=\"color:#808030; \">(</span> angle <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n      <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">angle</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span>\n        <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">angle</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#808030; \">)</span> <span style=\"color:#808030; \">+</span> angle <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800080; \">}</span>\n  <span style=\"color:#800080; \">}</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_current_cw <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    rotate_item<span style=\"color:#808030; \">(</span> current_furniture<span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span> <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_current_ccw <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    rotate_item<span style=\"color:#808030; \">(</span> current_furniture<span style=\"color:#808030; \">,</span> <span style=\"color:#808030; \">-</span><span style=\"color:#008c00; \">5</span> <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre>\n<p>Here are the two text elements used to trigger rotation of the currently selected element:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// rotate selected element</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> t2 <span style=\"color:#808030; \">=</span> r\n    <span style=\"color:#808030; \">.</span>text<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">380</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">Rotate selected item</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>fill<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#fff</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">font-size</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">12</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span> rotate_current_cw <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> t3 <span style=\"color:#808030; \">=</span> r\n    <span style=\"color:#808030; \">.</span>text<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">580</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">380</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">ccw</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>fill<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#fff</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">font-size</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">12</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span> rotate_current_ccw <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n</pre>\n<p>I had a problem with the rotation on the iPad: apparently, on that platform, the drag-move-up handler overrides the click handler, which initially made it impossible to click any element to select it for rotation.\nThe final solution I wound up with was adding functionality to the drag handler so that it handles the click event stuff as well.\n\n\n<a name=\"8\"></a>\n<h4>Button</h4>\n<p>Finally, a rather trivial enhancement to clarify the usage of the text rotation elements.\nI simply added a rectangle around them to make it more obvious that they are actually buttons:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"Button\" src=\"img/svg_raph_08.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a>\n</center>\n<a name=\"9\"></a>\n<h4>Conclusion</h4>\n<p>So far I am happy with everything I have learned about both SVG and the Raphaël toolkit.</p>\n<p>My original plan to implement a cloud-based round-trip 2D Revit model editing workflow on any mobile device using SVG still seems feasible.</p>\n<p>One possible next step might be to implement a Revit add-in to export room boundaries and family instances representing furniture or other equipment.\nFor the latter, a simplistic approach might export only the bounding box, or the largest area horizontal face, or, better still, the real outline looking from above.\nAnother step would be implementing a cloud-based repository for this data.\nIt can be retrieved and displayed using SVG on the mobile device and edited as shown above.\nThe editing can include updating the repository data.\nThe original Revit model can be updated on an explicit command call, or automatically, e.g. using the Idling event, e.g. via a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/11/drive-revit-through-a-wcf-service.html\">\nWCF service</a>.\n\n\n\n<hr/>\n<h1>Cloud and Mobile</h1>\n<h3>2D SVG Editing on Mobile Device with Raphaël</h3>\n<!-- <p style=\"text-align: right\"><i> -->\n<p>By\n\n<a href=\"http://adndevblog.typepad.com/cloud_and_mobile/jeremy-tammik.html\">\nJeremy</a>\n<a href=\"http://thebuildingcoder.typepad.com/blog/about-the-author.html\">\nTammik</a>.</p>\n<p>I spent some more time exploring how to display and interact with 2D graphics in a browser using SVG and JavaScript.\n\n<p>In my last foray into the area, I demonstrated display and interactive picking by implementing a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/10/room-polygon-and-furniture-picker-in-svg.html\">\nroom polygon and furniture picker in SVG</a>.\n\n<p>It enables picking and identifying objects and proves  that the same code and interaction is supported on all mobile devices, in particular both Android and Safari on iOS.\n\n<p>I now went one step further and explored\n\n<a href=\"\">2D SVG editing on a mobile device with Raphaël</a>,\n\nwhich adds interactive dragging and rotation of the polygons representing furniture or equipment, making use of the\n\n<a href=\"http://raphaeljs.com\">Raphaël</a> JavaScript library.</p>\n<p>If you would like to circumvent all explanations and just jump straight into the final result, take a look at\n\n<a href=\"http://thebuildingcoder.typepad.com/svg\">The Building Coder SVG</a> folder,\n\nor access the step-by-step evolution of the demo directly from here:</p>\n<ol>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/01-curves.htm\">Curves</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/02-grid.htm\">Grid</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\">Room</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\">Reporting text and click handler</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\">Furniture</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\">Drag</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\">Rotate</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a></li>\n</ol>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"2D SVG editing on a mobile device with Raphaël\" src=\"img/svg_raph_09.png\" width=\"300\"/></a>\n</center>\n<p>You can test each step interactively, then see how it works by viewing the source.</p>\n<p>I hope you find this useful.\nHave fun, and good luck!</p>\n</p></p></p></p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "The Raphaël JavaScript Library",
    "local_header_href": "#the-raphaël-javascript-library",
    "chunk_text": "<h4>The Raphaël JavaScript Library</h4><p><a href=\"http://raphaeljs.com\">Raphaël</a> ['ræfeɪəl] is\n\na small JavaScript library that simplifies work with vector graphics on the web.</p><p>Raphaël uses the SVG W3C Recommendation and VML as a base for creating graphics.\nThis means every graphical object is also a DOM object, so JavaScript event handlers can be attached and the objects can be dynamically modified.\nThe stated goal is to provide an adapter to make drawing vector art compatible cross-browser and easy.</p><p>Raphaël supports the current versions of Firefox, Safari, Chrome, Opera and Internet Explorer.</p><a name=\"1\"></a>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Curves",
    "local_header_href": "#curves",
    "chunk_text": "<h4>Curves</h4><p>The first step I took was to extract one of the Raphaël demo pages, <a href=\"http://raphaeljs.com/curver.html\">curver.html</a>, and host it on my own page to ensure that it has no other dependencies and continues to work in my environment:</p><center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/01-curves.htm\"><img alt=\"The Building Coder Raphaël curves demo\" src=\"img/svg_raph_01.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/01-curves.htm\">Curves</a>\n</center><p>It shows how curves can be drawn and hooked up with event handlers to react to dragging.</p><p>To explore this or any other of the Raphaël demo implementations, simply navigate to it and view the source.</p><a name=\"2\"></a>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Grid",
    "local_header_href": "#grid",
    "chunk_text": "<h4>Grid</h4><p>Once I had that in place and up and running, my next steps dealt with reimplementing the state of the existing\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/10/room-polygon-and-furniture-picker-in-svg.html\">\npure SVG equipment picker</a> using\n\nRaphaël instead.\n\n<p>The first step is easy, simply setting up the canvas and a rectangular grid:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/02-grid.htm\"><img alt=\"Grid\" src=\"img/svg_raph_02.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/02-grid.htm\">Grid</a>\n</center>\n<p>Here is the source code HTML achieving this (copy to a text editor or view source to see the truncated lines in full):</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n<span style=\"color:#004a43; \">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"</span><span style=\"color:#5555dd; \">http://www.w3.org/TR/html4/strict.dtd</span><span style=\"color:#004a43; \">\"&gt;</span>\n<span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">html</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">lang</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"en\"</span><span style=\"color:#a65700; \">&gt;</span>\n  <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">head</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">meta</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">http-equiv</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"Content-Type\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">content</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"text/html; charset=ascii\"</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">title</span><span style=\"color:#a65700; \">&gt;</span>Jeremy's <span style=\"color:#008c00; \">2</span>D Mobile Device Revit Model Editor Grid<span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">title</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">link</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">rel</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"stylesheet\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">href</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"demo.css\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">type</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"text/css\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">media</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"screen\"</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">link</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">rel</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"stylesheet\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">href</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"demo-print.css\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">type</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"text/css\"</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">media</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"print\"</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">script src=\"raphael-min-jt.js\" type=\"text/javascript\" charset=\"ascii\"</span><span style=\"color:#a65700; \">&gt;</span><span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">script</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">script type=\"text/javascript\" charset=\"ascii\"</span><span style=\"color:#a65700; \">&gt;</span>\n      window<span style=\"color:#808030; \">.</span>onload <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n        <span style=\"color:#800000; font-weight:bold; \">var</span> w <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">600</span><span style=\"color:#808030; \">,</span> h <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">400</span><span style=\"color:#800080; \">;</span>\n        <span style=\"color:#800000; font-weight:bold; \">var</span> r <span style=\"color:#808030; \">=</span> Raphael<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">holder</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> w<span style=\"color:#808030; \">,</span> h<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n        <span style=\"color:#808030; \">--</span>w<span style=\"color:#800080; \">;</span>\n        <span style=\"color:#808030; \">--</span>h<span style=\"color:#800080; \">;</span>\n        r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">0</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">0</span><span style=\"color:#808030; \">,</span> w<span style=\"color:#808030; \">,</span> h<span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">10</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#666</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n        <span style=\"color:#696969; \">// grid</span>\n        <span style=\"color:#800000; font-weight:bold; \">var</span> d <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">50</span><span style=\"color:#808030; \">,</span> i<span style=\"color:#800080; \">;</span>\n        <span style=\"color:#800000; font-weight:bold; \">for</span> <span style=\"color:#808030; \">(</span>i <span style=\"color:#808030; \">=</span> d<span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">&lt;</span> h<span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">+=</span> d<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n          r<span style=\"color:#808030; \">.</span>path<span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">[</span><span style=\"color:#808030; \">[</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">M</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">0</span><span style=\"color:#808030; \">,</span> i<span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">,</span> <span style=\"color:#808030; \">[</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">L</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> w<span style=\"color:#808030; \">,</span> i<span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#666</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n        <span style=\"color:#800080; \">}</span>\n        <span style=\"color:#800000; font-weight:bold; \">for</span> <span style=\"color:#808030; \">(</span>i <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">50</span><span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">&lt;</span> <span style=\"color:#008c00; \">600</span><span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">+=</span> <span style=\"color:#008c00; \">50</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n          r<span style=\"color:#808030; \">.</span>path<span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">[</span><span style=\"color:#808030; \">[</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">M</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> i<span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">0</span><span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">,</span> <span style=\"color:#808030; \">[</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">L</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> i<span style=\"color:#808030; \">,</span> w<span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#666</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n        <span style=\"color:#800080; \">}</span>\n      <span style=\"color:#800080; \">}</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">script</span><span style=\"color:#a65700; \">&gt;</span>\n  <span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">head</span><span style=\"color:#a65700; \">&gt;</span>\n  <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">body</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">div</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">id</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"holder\"</span><span style=\"color:#a65700; \">&gt;</span><span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">div</span><span style=\"color:#a65700; \">&gt;</span>\n    <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">p</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">id</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"copy\"</span><span style=\"color:#a65700; \">&gt;</span>Jeremy Tammik, Autodesk Inc<span style=\"color:#008c00; \">.</span> using the <span style=\"color:#a65700; \">&lt;</span><span style=\"color:#800000; font-weight:bold; \">a</span><span style=\"color:#274796; \"> </span><span style=\"color:#074726; \">href</span><span style=\"color:#808030; \">=</span><span style=\"color:#0000e6; \">\"http://raphaeljs.com\"</span><span style=\"color:#a65700; \">&gt;</span>Raphael<span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">a</span><span style=\"color:#a65700; \">&gt;</span> JavaScript vector library<span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">p</span><span style=\"color:#a65700; \">&gt;</span>\n  <span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">body</span><span style=\"color:#a65700; \">&gt;</span>\n<span style=\"color:#a65700; \">&lt;/</span><span style=\"color:#800000; font-weight:bold; \">html</span><span style=\"color:#a65700; \">&gt;</span>\n</pre>\n<a name=\"3\"></a>\n<h4>Room Polygon</h4>\n<p>Next, display the static room polygon on the grid:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\"><img alt=\"Room\" src=\"img/svg_raph_03.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\">Room</a>\n</center>\n<p>Basically, we simply add the following line of code:</p>\n<pre class=\"code\">\n  // room - outer loop anti-clockwise, inner clockwise\n\n  r.path(\"M 40 40 L 440 40 440 300 300 300 300 200 40 200\"\n    + \" Z M 320 240 L 320 280 420 280 420 240 Z\")\n    .attr({stroke: \"blue\", fill:\"lightblue\"});\n</pre>\n<p>There are several different ways to implement the hole.\nNote that the oddeven fill rule is applied by default and requires strict adherence to the clockwise and anti-clockwise orientation of loop vertices.\nI found the hints on\n\n<a href=\"http://stackoverflow.com/questions/3349651/how-to-achieve-donut-holes-with-paths-in-raphael\">\nhow to achieve donut holes with paths</a> useful.</p>\n<a name=\"4\"></a>\n<h4>Reporting Text and Click Handler</h4>\n<p>The main feature of the original furniture picker was the identification and dynamic reporting of the room polygon, furniture, or equipment picked on screen.\nThe reporting function could of course be expanded to display or edit any other information desired, including updating some repository with modified data.</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\"><img alt=\"Text\" src=\"img/svg_raph_04.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\">Text</a>\n</center>\n<p>To achieve this in the Raphaël environment, I implemented a JavaScript event handler:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  jOnClick <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">var</span> s <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">Id </span><span style=\"color:#800000; \">\"</span> <span style=\"color:#808030; \">+</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>id<span style=\"color:#808030; \">.</span><span style=\"color:#800000; font-weight:bold; \">toString</span><span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">+</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">: </span><span style=\"color:#800000; \">\"</span> <span style=\"color:#808030; \">+</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    t<span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>text<span style=\"color:#800080; \">:</span>s<span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre>\n<p>The clicked object is displayed using a new text element, and both the background rectangle and the room polygon are assigned a 'jid' identifier and subscribe to the click event to trigger the event handler:\n\n<pre class=\"code\">\n  // room - outer loop anti-clockwise, inner clockwise\n\n  var room = r\n    .path(\"M 40 40 L 440 40 440 300 300 300 300 200 40 200 Z\"\n      + \"M 320 240 L 320 280 420 280 420 240 Z\")\n    .attr({stroke: \"blue\", fill:\"lightblue\"})\n    .data(\"jid\", \"room\")\n    .click(jOnClick);\n\n  // reporting text\n\n  var t = r\n    .text(300, 380, \"Welcome. Please click around.\")\n    .attr({stroke: \"#fff\"});\n</pre>\n<a name=\"5\"></a>\n<h4>Furniture and Equipment</h4>\n<p>Next, I added the furniture, consisting of table and chair placeholders:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\"><img alt=\"Furniture\" src=\"img/svg_raph_05.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\">Furniture</a>\n</center>\n<p>Each one is implemented similarly to the room polygon, equipped with its own identifier, and obviously subscribing to the click event:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// furniture</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">200</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">40</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">table</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">75</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">110</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair1</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">118</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair2</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">158</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair3</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">198</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair4</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">238</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair5</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n</pre>\n<p>With that, we have arrived at the same stage of functionality as we already had using just pure SVG with no additional toolkit support.\nNow comes the new fun stuff.</p>\n<a name=\"6\"></a>\n<h4>Drag</h4>\n<p>Raphaël supports dragging.\nHere, the furniture has been dragged away from its original locations:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\"><img alt=\"Drag\" src=\"img/svg_raph_06.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\">Drag</a>\n</center>\n<p>Drag event subscription requires event handlers for the drag initialisation, move and mouse up actions:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// drag support</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> dragger <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#800080; \">?</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">x</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">cx</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#800080; \">?</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">y</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">cy</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>animate<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">fill-opacity</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008000; \">.5</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n  move <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span>dx<span style=\"color:#808030; \">,</span> dy<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">var</span> att <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span>\n      <span style=\"color:#800080; \">?</span> <span style=\"color:#800080; \">{</span>x<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">+</span> dx<span style=\"color:#808030; \">,</span> y<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">+</span> dy<span style=\"color:#800080; \">}</span>\n      <span style=\"color:#800080; \">:</span> <span style=\"color:#800080; \">{</span>cx<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">+</span> dx<span style=\"color:#808030; \">,</span> cy<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">+</span> dy<span style=\"color:#800080; \">}</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span>att<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    r<span style=\"color:#808030; \">.</span>safari<span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n  up <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>animate<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">fill-opacity</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">1</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n</pre>\n<p>To subscribe to the drag event efficiently, I reimplemented the furniture as an array that I can iterate over uniformly:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// furniture</span>\n\n  furniture <span style=\"color:#808030; \">=</span> <span style=\"color:#808030; \">[</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">200</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">40</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">table</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">75</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">110</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair1</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">118</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair2</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">158</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair3</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">198</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair4</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">238</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair5</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n  <span style=\"color:#808030; \">]</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> n <span style=\"color:#808030; \">=</span> furniture<span style=\"color:#808030; \">.</span>length<span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">for</span> <span style=\"color:#808030; \">(</span>i <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">0</span><span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">&lt;</span> n<span style=\"color:#800080; \">;</span> <span style=\"color:#808030; \">++</span>i<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    furniture<span style=\"color:#808030; \">[</span>i<span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">.</span>drag<span style=\"color:#808030; \">(</span>move<span style=\"color:#808030; \">,</span> dragger<span style=\"color:#808030; \">,</span> up<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre>\n<a name=\"7\"></a>\n<h4>Rotate</h4>\n<p>I fiddled around for a while to implement the rotation.\nHere is some dragged and rotated furniture:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\"><img alt=\"Rotate\" src=\"img/svg_raph_07.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\">Rotate</a>\n</center>\n<p>In order to handle dragging, I ended up implementing a text element that triggers a rotation of the currently selected element.\nA sibling text element reverses the rotation, i.e. rotates counter-clockwise.</p>\n<p>The Raphaël rotation handling seems somewhat controversial, as far as I can tell from numerous discussions on the topic that I referred to.\nWhen dragging a rotated element, I first unrotate it back to its original state.\nOtherwise, the drag operation on a rotated element takes the rotation into account, causing the drag direction to differ from the visible cursor movement.</p>\n<p>Here are the rotation handlers:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// rototion support</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> current_furniture <span style=\"color:#808030; \">=</span> <span style=\"color:#0f4d75; \">null</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_item <span style=\"color:#808030; \">(</span><span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">,</span> angle<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">if</span><span style=\"color:#808030; \">(</span> <span style=\"color:#0f4d75; \">null</span> <span style=\"color:#808030; \">!=</span> <span style=\"color:#800000; font-weight:bold; \">item</span> <span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n      <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>rotate<span style=\"color:#808030; \">(</span> angle <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n      <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">angle</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span>\n        <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">angle</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#808030; \">)</span> <span style=\"color:#808030; \">+</span> angle <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800080; \">}</span>\n  <span style=\"color:#800080; \">}</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_current_cw <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    rotate_item<span style=\"color:#808030; \">(</span> current_furniture<span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span> <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_current_ccw <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    rotate_item<span style=\"color:#808030; \">(</span> current_furniture<span style=\"color:#808030; \">,</span> <span style=\"color:#808030; \">-</span><span style=\"color:#008c00; \">5</span> <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre>\n<p>Here are the two text elements used to trigger rotation of the currently selected element:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// rotate selected element</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> t2 <span style=\"color:#808030; \">=</span> r\n    <span style=\"color:#808030; \">.</span>text<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">380</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">Rotate selected item</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>fill<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#fff</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">font-size</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">12</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span> rotate_current_cw <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> t3 <span style=\"color:#808030; \">=</span> r\n    <span style=\"color:#808030; \">.</span>text<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">580</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">380</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">ccw</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>fill<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#fff</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">font-size</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">12</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span> rotate_current_ccw <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n</pre>\n<p>I had a problem with the rotation on the iPad: apparently, on that platform, the drag-move-up handler overrides the click handler, which initially made it impossible to click any element to select it for rotation.\nThe final solution I wound up with was adding functionality to the drag handler so that it handles the click event stuff as well.\n\n\n<a name=\"8\"></a>\n<h4>Button</h4>\n<p>Finally, a rather trivial enhancement to clarify the usage of the text rotation elements.\nI simply added a rectangle around them to make it more obvious that they are actually buttons:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"Button\" src=\"img/svg_raph_08.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a>\n</center>\n<a name=\"9\"></a>\n<h4>Conclusion</h4>\n<p>So far I am happy with everything I have learned about both SVG and the Raphaël toolkit.</p>\n<p>My original plan to implement a cloud-based round-trip 2D Revit model editing workflow on any mobile device using SVG still seems feasible.</p>\n<p>One possible next step might be to implement a Revit add-in to export room boundaries and family instances representing furniture or other equipment.\nFor the latter, a simplistic approach might export only the bounding box, or the largest area horizontal face, or, better still, the real outline looking from above.\nAnother step would be implementing a cloud-based repository for this data.\nIt can be retrieved and displayed using SVG on the mobile device and edited as shown above.\nThe editing can include updating the repository data.\nThe original Revit model can be updated on an explicit command call, or automatically, e.g. using the Idling event, e.g. via a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/11/drive-revit-through-a-wcf-service.html\">\nWCF service</a>.\n\n\n\n<hr/>\n<h1>Cloud and Mobile</h1>\n<h3>2D SVG Editing on Mobile Device with Raphaël</h3>\n<!-- <p style=\"text-align: right\"><i> -->\n<p>By\n\n<a href=\"http://adndevblog.typepad.com/cloud_and_mobile/jeremy-tammik.html\">\nJeremy</a>\n<a href=\"http://thebuildingcoder.typepad.com/blog/about-the-author.html\">\nTammik</a>.</p>\n<p>I spent some more time exploring how to display and interact with 2D graphics in a browser using SVG and JavaScript.\n\n<p>In my last foray into the area, I demonstrated display and interactive picking by implementing a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/10/room-polygon-and-furniture-picker-in-svg.html\">\nroom polygon and furniture picker in SVG</a>.\n\n<p>It enables picking and identifying objects and proves  that the same code and interaction is supported on all mobile devices, in particular both Android and Safari on iOS.\n\n<p>I now went one step further and explored\n\n<a href=\"\">2D SVG editing on a mobile device with Raphaël</a>,\n\nwhich adds interactive dragging and rotation of the polygons representing furniture or equipment, making use of the\n\n<a href=\"http://raphaeljs.com\">Raphaël</a> JavaScript library.</p>\n<p>If you would like to circumvent all explanations and just jump straight into the final result, take a look at\n\n<a href=\"http://thebuildingcoder.typepad.com/svg\">The Building Coder SVG</a> folder,\n\nor access the step-by-step evolution of the demo directly from here:</p>\n<ol>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/01-curves.htm\">Curves</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/02-grid.htm\">Grid</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\">Room</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\">Reporting text and click handler</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\">Furniture</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\">Drag</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\">Rotate</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a></li>\n</ol>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"2D SVG editing on a mobile device with Raphaël\" src=\"img/svg_raph_09.png\" width=\"300\"/></a>\n</center>\n<p>You can test each step interactively, then see how it works by viewing the source.</p>\n<p>I hope you find this useful.\nHave fun, and good luck!</p>\n</p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Room Polygon",
    "local_header_href": "#room-polygon",
    "chunk_text": "<h4>Room Polygon</h4><p>Next, display the static room polygon on the grid:</p><center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\"><img alt=\"Room\" src=\"img/svg_raph_03.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\">Room</a>\n</center><p>Basically, we simply add the following line of code:</p><pre class=\"code\">\n  // room - outer loop anti-clockwise, inner clockwise\n\n  r.path(\"M 40 40 L 440 40 440 300 300 300 300 200 40 200\"\n    + \" Z M 320 240 L 320 280 420 280 420 240 Z\")\n    .attr({stroke: \"blue\", fill:\"lightblue\"});\n</pre><p>There are several different ways to implement the hole.\nNote that the oddeven fill rule is applied by default and requires strict adherence to the clockwise and anti-clockwise orientation of loop vertices.\nI found the hints on\n\n<a href=\"http://stackoverflow.com/questions/3349651/how-to-achieve-donut-holes-with-paths-in-raphael\">\nhow to achieve donut holes with paths</a> useful.</p><a name=\"4\"></a>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Reporting Text and Click Handler",
    "local_header_href": "#reporting-text-and-click-handler",
    "chunk_text": "<h4>Reporting Text and Click Handler</h4><p>The main feature of the original furniture picker was the identification and dynamic reporting of the room polygon, furniture, or equipment picked on screen.\nThe reporting function could of course be expanded to display or edit any other information desired, including updating some repository with modified data.</p><center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\"><img alt=\"Text\" src=\"img/svg_raph_04.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\">Text</a>\n</center><p>To achieve this in the Raphaël environment, I implemented a JavaScript event handler:</p><pre style=\"color:#000000;background:#ffffff;\">\n  jOnClick <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">var</span> s <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">Id </span><span style=\"color:#800000; \">\"</span> <span style=\"color:#808030; \">+</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>id<span style=\"color:#808030; \">.</span><span style=\"color:#800000; font-weight:bold; \">toString</span><span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">+</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">: </span><span style=\"color:#800000; \">\"</span> <span style=\"color:#808030; \">+</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    t<span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>text<span style=\"color:#800080; \">:</span>s<span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre><p>The clicked object is displayed using a new text element, and both the background rectangle and the room polygon are assigned a 'jid' identifier and subscribe to the click event to trigger the event handler:\n\n<pre class=\"code\">\n  // room - outer loop anti-clockwise, inner clockwise\n\n  var room = r\n    .path(\"M 40 40 L 440 40 440 300 300 300 300 200 40 200 Z\"\n      + \"M 320 240 L 320 280 420 280 420 240 Z\")\n    .attr({stroke: \"blue\", fill:\"lightblue\"})\n    .data(\"jid\", \"room\")\n    .click(jOnClick);\n\n  // reporting text\n\n  var t = r\n    .text(300, 380, \"Welcome. Please click around.\")\n    .attr({stroke: \"#fff\"});\n</pre>\n<a name=\"5\"></a>\n<h4>Furniture and Equipment</h4>\n<p>Next, I added the furniture, consisting of table and chair placeholders:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\"><img alt=\"Furniture\" src=\"img/svg_raph_05.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\">Furniture</a>\n</center>\n<p>Each one is implemented similarly to the room polygon, equipped with its own identifier, and obviously subscribing to the click event:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// furniture</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">200</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">40</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">table</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">75</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">110</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair1</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">118</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair2</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">158</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair3</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">198</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair4</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">238</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair5</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n</pre>\n<p>With that, we have arrived at the same stage of functionality as we already had using just pure SVG with no additional toolkit support.\nNow comes the new fun stuff.</p>\n<a name=\"6\"></a>\n<h4>Drag</h4>\n<p>Raphaël supports dragging.\nHere, the furniture has been dragged away from its original locations:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\"><img alt=\"Drag\" src=\"img/svg_raph_06.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\">Drag</a>\n</center>\n<p>Drag event subscription requires event handlers for the drag initialisation, move and mouse up actions:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// drag support</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> dragger <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#800080; \">?</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">x</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">cx</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#800080; \">?</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">y</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">cy</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>animate<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">fill-opacity</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008000; \">.5</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n  move <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span>dx<span style=\"color:#808030; \">,</span> dy<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">var</span> att <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span>\n      <span style=\"color:#800080; \">?</span> <span style=\"color:#800080; \">{</span>x<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">+</span> dx<span style=\"color:#808030; \">,</span> y<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">+</span> dy<span style=\"color:#800080; \">}</span>\n      <span style=\"color:#800080; \">:</span> <span style=\"color:#800080; \">{</span>cx<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">+</span> dx<span style=\"color:#808030; \">,</span> cy<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">+</span> dy<span style=\"color:#800080; \">}</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span>att<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    r<span style=\"color:#808030; \">.</span>safari<span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n  up <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>animate<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">fill-opacity</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">1</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n</pre>\n<p>To subscribe to the drag event efficiently, I reimplemented the furniture as an array that I can iterate over uniformly:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// furniture</span>\n\n  furniture <span style=\"color:#808030; \">=</span> <span style=\"color:#808030; \">[</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">200</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">40</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">table</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">75</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">110</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair1</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">118</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair2</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">158</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair3</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">198</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair4</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">238</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair5</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n  <span style=\"color:#808030; \">]</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> n <span style=\"color:#808030; \">=</span> furniture<span style=\"color:#808030; \">.</span>length<span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">for</span> <span style=\"color:#808030; \">(</span>i <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">0</span><span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">&lt;</span> n<span style=\"color:#800080; \">;</span> <span style=\"color:#808030; \">++</span>i<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    furniture<span style=\"color:#808030; \">[</span>i<span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">.</span>drag<span style=\"color:#808030; \">(</span>move<span style=\"color:#808030; \">,</span> dragger<span style=\"color:#808030; \">,</span> up<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre>\n<a name=\"7\"></a>\n<h4>Rotate</h4>\n<p>I fiddled around for a while to implement the rotation.\nHere is some dragged and rotated furniture:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\"><img alt=\"Rotate\" src=\"img/svg_raph_07.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\">Rotate</a>\n</center>\n<p>In order to handle dragging, I ended up implementing a text element that triggers a rotation of the currently selected element.\nA sibling text element reverses the rotation, i.e. rotates counter-clockwise.</p>\n<p>The Raphaël rotation handling seems somewhat controversial, as far as I can tell from numerous discussions on the topic that I referred to.\nWhen dragging a rotated element, I first unrotate it back to its original state.\nOtherwise, the drag operation on a rotated element takes the rotation into account, causing the drag direction to differ from the visible cursor movement.</p>\n<p>Here are the rotation handlers:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// rototion support</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> current_furniture <span style=\"color:#808030; \">=</span> <span style=\"color:#0f4d75; \">null</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_item <span style=\"color:#808030; \">(</span><span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">,</span> angle<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">if</span><span style=\"color:#808030; \">(</span> <span style=\"color:#0f4d75; \">null</span> <span style=\"color:#808030; \">!=</span> <span style=\"color:#800000; font-weight:bold; \">item</span> <span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n      <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>rotate<span style=\"color:#808030; \">(</span> angle <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n      <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">angle</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span>\n        <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">angle</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#808030; \">)</span> <span style=\"color:#808030; \">+</span> angle <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800080; \">}</span>\n  <span style=\"color:#800080; \">}</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_current_cw <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    rotate_item<span style=\"color:#808030; \">(</span> current_furniture<span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span> <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_current_ccw <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    rotate_item<span style=\"color:#808030; \">(</span> current_furniture<span style=\"color:#808030; \">,</span> <span style=\"color:#808030; \">-</span><span style=\"color:#008c00; \">5</span> <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre>\n<p>Here are the two text elements used to trigger rotation of the currently selected element:</p>\n<pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// rotate selected element</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> t2 <span style=\"color:#808030; \">=</span> r\n    <span style=\"color:#808030; \">.</span>text<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">380</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">Rotate selected item</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>fill<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#fff</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">font-size</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">12</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span> rotate_current_cw <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> t3 <span style=\"color:#808030; \">=</span> r\n    <span style=\"color:#808030; \">.</span>text<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">580</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">380</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">ccw</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>fill<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#fff</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">font-size</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">12</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span> rotate_current_ccw <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n</pre>\n<p>I had a problem with the rotation on the iPad: apparently, on that platform, the drag-move-up handler overrides the click handler, which initially made it impossible to click any element to select it for rotation.\nThe final solution I wound up with was adding functionality to the drag handler so that it handles the click event stuff as well.\n\n\n<a name=\"8\"></a>\n<h4>Button</h4>\n<p>Finally, a rather trivial enhancement to clarify the usage of the text rotation elements.\nI simply added a rectangle around them to make it more obvious that they are actually buttons:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"Button\" src=\"img/svg_raph_08.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a>\n</center>\n<a name=\"9\"></a>\n<h4>Conclusion</h4>\n<p>So far I am happy with everything I have learned about both SVG and the Raphaël toolkit.</p>\n<p>My original plan to implement a cloud-based round-trip 2D Revit model editing workflow on any mobile device using SVG still seems feasible.</p>\n<p>One possible next step might be to implement a Revit add-in to export room boundaries and family instances representing furniture or other equipment.\nFor the latter, a simplistic approach might export only the bounding box, or the largest area horizontal face, or, better still, the real outline looking from above.\nAnother step would be implementing a cloud-based repository for this data.\nIt can be retrieved and displayed using SVG on the mobile device and edited as shown above.\nThe editing can include updating the repository data.\nThe original Revit model can be updated on an explicit command call, or automatically, e.g. using the Idling event, e.g. via a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/11/drive-revit-through-a-wcf-service.html\">\nWCF service</a>.\n\n\n\n<hr/>\n<h1>Cloud and Mobile</h1>\n<h3>2D SVG Editing on Mobile Device with Raphaël</h3>\n<!-- <p style=\"text-align: right\"><i> -->\n<p>By\n\n<a href=\"http://adndevblog.typepad.com/cloud_and_mobile/jeremy-tammik.html\">\nJeremy</a>\n<a href=\"http://thebuildingcoder.typepad.com/blog/about-the-author.html\">\nTammik</a>.</p>\n<p>I spent some more time exploring how to display and interact with 2D graphics in a browser using SVG and JavaScript.\n\n<p>In my last foray into the area, I demonstrated display and interactive picking by implementing a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/10/room-polygon-and-furniture-picker-in-svg.html\">\nroom polygon and furniture picker in SVG</a>.\n\n<p>It enables picking and identifying objects and proves  that the same code and interaction is supported on all mobile devices, in particular both Android and Safari on iOS.\n\n<p>I now went one step further and explored\n\n<a href=\"\">2D SVG editing on a mobile device with Raphaël</a>,\n\nwhich adds interactive dragging and rotation of the polygons representing furniture or equipment, making use of the\n\n<a href=\"http://raphaeljs.com\">Raphaël</a> JavaScript library.</p>\n<p>If you would like to circumvent all explanations and just jump straight into the final result, take a look at\n\n<a href=\"http://thebuildingcoder.typepad.com/svg\">The Building Coder SVG</a> folder,\n\nor access the step-by-step evolution of the demo directly from here:</p>\n<ol>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/01-curves.htm\">Curves</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/02-grid.htm\">Grid</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\">Room</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\">Reporting text and click handler</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\">Furniture</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\">Drag</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\">Rotate</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a></li>\n</ol>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"2D SVG editing on a mobile device with Raphaël\" src=\"img/svg_raph_09.png\" width=\"300\"/></a>\n</center>\n<p>You can test each step interactively, then see how it works by viewing the source.</p>\n<p>I hope you find this useful.\nHave fun, and good luck!</p>\n</p></p></p></p></p></p>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Furniture and Equipment",
    "local_header_href": "#furniture-and-equipment",
    "chunk_text": "<h4>Furniture and Equipment</h4><p>Next, I added the furniture, consisting of table and chair placeholders:</p><center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\"><img alt=\"Furniture\" src=\"img/svg_raph_05.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\">Furniture</a>\n</center><p>Each one is implemented similarly to the room polygon, equipped with its own identifier, and obviously subscribing to the click event:</p><pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// furniture</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">200</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">40</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">table</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">75</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">110</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair1</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">118</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair2</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">158</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair3</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">198</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair4</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">238</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair5</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n</pre><p>With that, we have arrived at the same stage of functionality as we already had using just pure SVG with no additional toolkit support.\nNow comes the new fun stuff.</p><a name=\"6\"></a>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Drag",
    "local_header_href": "#drag",
    "chunk_text": "<h4>Drag</h4><p>Raphaël supports dragging.\nHere, the furniture has been dragged away from its original locations:</p><center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\"><img alt=\"Drag\" src=\"img/svg_raph_06.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\">Drag</a>\n</center><p>Drag event subscription requires event handlers for the drag initialisation, move and mouse up actions:</p><pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// drag support</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> dragger <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#800080; \">?</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">x</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">cx</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#800080; \">?</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">y</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">cy</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>animate<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">fill-opacity</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008000; \">.5</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n  move <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span>dx<span style=\"color:#808030; \">,</span> dy<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">var</span> att <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>type <span style=\"color:#808030; \">==</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">rect</span><span style=\"color:#800000; \">\"</span>\n      <span style=\"color:#800080; \">?</span> <span style=\"color:#800080; \">{</span>x<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">+</span> dx<span style=\"color:#808030; \">,</span> y<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">+</span> dy<span style=\"color:#800080; \">}</span>\n      <span style=\"color:#800080; \">:</span> <span style=\"color:#800080; \">{</span>cx<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>ox <span style=\"color:#808030; \">+</span> dx<span style=\"color:#808030; \">,</span> cy<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>oy <span style=\"color:#808030; \">+</span> dy<span style=\"color:#800080; \">}</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span>att<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    r<span style=\"color:#808030; \">.</span>safari<span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n  up <span style=\"color:#808030; \">=</span> <span style=\"color:#800000; font-weight:bold; \">function</span> <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">this</span><span style=\"color:#808030; \">.</span>animate<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">fill-opacity</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">1</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">,</span>\n</pre><p>To subscribe to the drag event efficiently, I reimplemented the furniture as an array that I can iterate over uniformly:</p><pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// furniture</span>\n\n  furniture <span style=\"color:#808030; \">=</span> <span style=\"color:#808030; \">[</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">100</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">200</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">40</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">table</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">75</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">110</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair1</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">118</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair2</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">158</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair3</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">198</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair4</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">,</span>\n    r<span style=\"color:#808030; \">.</span>rect<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">238</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">150</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">22</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">16</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span><span style=\"color:#808030; \">)</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">jid</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">chair5</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n  <span style=\"color:#808030; \">]</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> n <span style=\"color:#808030; \">=</span> furniture<span style=\"color:#808030; \">.</span>length<span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">for</span> <span style=\"color:#808030; \">(</span>i <span style=\"color:#808030; \">=</span> <span style=\"color:#008c00; \">0</span><span style=\"color:#800080; \">;</span> i <span style=\"color:#808030; \">&lt;</span> n<span style=\"color:#800080; \">;</span> <span style=\"color:#808030; \">++</span>i<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    furniture<span style=\"color:#808030; \">[</span>i<span style=\"color:#808030; \">]</span><span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>stroke<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> fill<span style=\"color:#800080; \">:</span><span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">blue</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span>jOnClick<span style=\"color:#808030; \">)</span>\n      <span style=\"color:#808030; \">.</span>drag<span style=\"color:#808030; \">(</span>move<span style=\"color:#808030; \">,</span> dragger<span style=\"color:#808030; \">,</span> up<span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre><a name=\"7\"></a>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Rotate",
    "local_header_href": "#rotate",
    "chunk_text": "<h4>Rotate</h4><p>I fiddled around for a while to implement the rotation.\nHere is some dragged and rotated furniture:</p><center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\"><img alt=\"Rotate\" src=\"img/svg_raph_07.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\">Rotate</a>\n</center><p>In order to handle dragging, I ended up implementing a text element that triggers a rotation of the currently selected element.\nA sibling text element reverses the rotation, i.e. rotates counter-clockwise.</p><p>The Raphaël rotation handling seems somewhat controversial, as far as I can tell from numerous discussions on the topic that I referred to.\nWhen dragging a rotated element, I first unrotate it back to its original state.\nOtherwise, the drag operation on a rotated element takes the rotation into account, causing the drag direction to differ from the visible cursor movement.</p><p>Here are the rotation handlers:</p><pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// rototion support</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> current_furniture <span style=\"color:#808030; \">=</span> <span style=\"color:#0f4d75; \">null</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_item <span style=\"color:#808030; \">(</span><span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">,</span> angle<span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    <span style=\"color:#800000; font-weight:bold; \">if</span><span style=\"color:#808030; \">(</span> <span style=\"color:#0f4d75; \">null</span> <span style=\"color:#808030; \">!=</span> <span style=\"color:#800000; font-weight:bold; \">item</span> <span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n      <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>rotate<span style=\"color:#808030; \">(</span> angle <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n      <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">angle</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span>\n        <span style=\"color:#800000; font-weight:bold; \">item</span><span style=\"color:#808030; \">.</span>data<span style=\"color:#808030; \">(</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">angle</span><span style=\"color:#800000; \">\"</span> <span style=\"color:#808030; \">)</span> <span style=\"color:#808030; \">+</span> angle <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n    <span style=\"color:#800080; \">}</span>\n  <span style=\"color:#800080; \">}</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_current_cw <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    rotate_item<span style=\"color:#808030; \">(</span> current_furniture<span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">5</span> <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">function</span> rotate_current_ccw <span style=\"color:#808030; \">(</span><span style=\"color:#808030; \">)</span> <span style=\"color:#800080; \">{</span>\n    rotate_item<span style=\"color:#808030; \">(</span> current_furniture<span style=\"color:#808030; \">,</span> <span style=\"color:#808030; \">-</span><span style=\"color:#008c00; \">5</span> <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n  <span style=\"color:#800080; \">}</span>\n</pre><p>Here are the two text elements used to trigger rotation of the currently selected element:</p><pre style=\"color:#000000;background:#ffffff;\">\n  <span style=\"color:#696969; \">// rotate selected element</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> t2 <span style=\"color:#808030; \">=</span> r\n    <span style=\"color:#808030; \">.</span>text<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">500</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">380</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">Rotate selected item</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>fill<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#fff</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">font-size</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">12</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span> rotate_current_cw <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n\n  <span style=\"color:#800000; font-weight:bold; \">var</span> t3 <span style=\"color:#808030; \">=</span> r\n    <span style=\"color:#808030; \">.</span>text<span style=\"color:#808030; \">(</span><span style=\"color:#008c00; \">580</span><span style=\"color:#808030; \">,</span> <span style=\"color:#008c00; \">380</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">ccw</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>attr<span style=\"color:#808030; \">(</span><span style=\"color:#800080; \">{</span>fill<span style=\"color:#800080; \">:</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">#fff</span><span style=\"color:#800000; \">\"</span><span style=\"color:#808030; \">,</span> <span style=\"color:#800000; \">\"</span><span style=\"color:#0000e6; \">font-size</span><span style=\"color:#800000; \">\"</span><span style=\"color:#800080; \">:</span> <span style=\"color:#008c00; \">12</span><span style=\"color:#800080; \">}</span><span style=\"color:#808030; \">)</span>\n    <span style=\"color:#808030; \">.</span>click<span style=\"color:#808030; \">(</span> rotate_current_ccw <span style=\"color:#808030; \">)</span><span style=\"color:#800080; \">;</span>\n</pre><p>I had a problem with the rotation on the iPad: apparently, on that platform, the drag-move-up handler overrides the click handler, which initially made it impossible to click any element to select it for rotation.\nThe final solution I wound up with was adding functionality to the drag handler so that it handles the click event stuff as well.\n\n\n<a name=\"8\"></a>\n<h4>Button</h4>\n<p>Finally, a rather trivial enhancement to clarify the usage of the text rotation elements.\nI simply added a rectangle around them to make it more obvious that they are actually buttons:</p>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"Button\" src=\"img/svg_raph_08.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a>\n</center>\n<a name=\"9\"></a>\n<h4>Conclusion</h4>\n<p>So far I am happy with everything I have learned about both SVG and the Raphaël toolkit.</p>\n<p>My original plan to implement a cloud-based round-trip 2D Revit model editing workflow on any mobile device using SVG still seems feasible.</p>\n<p>One possible next step might be to implement a Revit add-in to export room boundaries and family instances representing furniture or other equipment.\nFor the latter, a simplistic approach might export only the bounding box, or the largest area horizontal face, or, better still, the real outline looking from above.\nAnother step would be implementing a cloud-based repository for this data.\nIt can be retrieved and displayed using SVG on the mobile device and edited as shown above.\nThe editing can include updating the repository data.\nThe original Revit model can be updated on an explicit command call, or automatically, e.g. using the Idling event, e.g. via a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/11/drive-revit-through-a-wcf-service.html\">\nWCF service</a>.\n\n\n\n<hr/>\n<h1>Cloud and Mobile</h1>\n<h3>2D SVG Editing on Mobile Device with Raphaël</h3>\n<!-- <p style=\"text-align: right\"><i> -->\n<p>By\n\n<a href=\"http://adndevblog.typepad.com/cloud_and_mobile/jeremy-tammik.html\">\nJeremy</a>\n<a href=\"http://thebuildingcoder.typepad.com/blog/about-the-author.html\">\nTammik</a>.</p>\n<p>I spent some more time exploring how to display and interact with 2D graphics in a browser using SVG and JavaScript.\n\n<p>In my last foray into the area, I demonstrated display and interactive picking by implementing a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/10/room-polygon-and-furniture-picker-in-svg.html\">\nroom polygon and furniture picker in SVG</a>.\n\n<p>It enables picking and identifying objects and proves  that the same code and interaction is supported on all mobile devices, in particular both Android and Safari on iOS.\n\n<p>I now went one step further and explored\n\n<a href=\"\">2D SVG editing on a mobile device with Raphaël</a>,\n\nwhich adds interactive dragging and rotation of the polygons representing furniture or equipment, making use of the\n\n<a href=\"http://raphaeljs.com\">Raphaël</a> JavaScript library.</p>\n<p>If you would like to circumvent all explanations and just jump straight into the final result, take a look at\n\n<a href=\"http://thebuildingcoder.typepad.com/svg\">The Building Coder SVG</a> folder,\n\nor access the step-by-step evolution of the demo directly from here:</p>\n<ol>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/01-curves.htm\">Curves</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/02-grid.htm\">Grid</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\">Room</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\">Reporting text and click handler</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\">Furniture</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\">Drag</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\">Rotate</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a></li>\n</ol>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"2D SVG editing on a mobile device with Raphaël\" src=\"img/svg_raph_09.png\" width=\"300\"/></a>\n</center>\n<p>You can test each step interactively, then see how it works by viewing the source.</p>\n<p>I hope you find this useful.\nHave fun, and good luck!</p>\n</p></p></p></p></p>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Button",
    "local_header_href": "#button",
    "chunk_text": "<h4>Button</h4><p>Finally, a rather trivial enhancement to clarify the usage of the text rotation elements.\nI simply added a rectangle around them to make it more obvious that they are actually buttons:</p><center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"Button\" src=\"img/svg_raph_08.png\" width=\"300\"/></a>\n<br/>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a>\n</center><a name=\"9\"></a>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Conclusion",
    "local_header_href": "#conclusion",
    "chunk_text": "<h4>Conclusion</h4><p>So far I am happy with everything I have learned about both SVG and the Raphaël toolkit.</p><p>My original plan to implement a cloud-based round-trip 2D Revit model editing workflow on any mobile device using SVG still seems feasible.</p><p>One possible next step might be to implement a Revit add-in to export room boundaries and family instances representing furniture or other equipment.\nFor the latter, a simplistic approach might export only the bounding box, or the largest area horizontal face, or, better still, the real outline looking from above.\nAnother step would be implementing a cloud-based repository for this data.\nIt can be retrieved and displayed using SVG on the mobile device and edited as shown above.\nThe editing can include updating the repository data.\nThe original Revit model can be updated on an explicit command call, or automatically, e.g. using the Idling event, e.g. via a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/11/drive-revit-through-a-wcf-service.html\">\nWCF service</a>.\n\n\n\n<hr/>\n<h1>Cloud and Mobile</h1>\n<h3>2D SVG Editing on Mobile Device with Raphaël</h3>\n<!-- <p style=\"text-align: right\"><i> -->\n<p>By\n\n<a href=\"http://adndevblog.typepad.com/cloud_and_mobile/jeremy-tammik.html\">\nJeremy</a>\n<a href=\"http://thebuildingcoder.typepad.com/blog/about-the-author.html\">\nTammik</a>.</p>\n<p>I spent some more time exploring how to display and interact with 2D graphics in a browser using SVG and JavaScript.\n\n<p>In my last foray into the area, I demonstrated display and interactive picking by implementing a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/10/room-polygon-and-furniture-picker-in-svg.html\">\nroom polygon and furniture picker in SVG</a>.\n\n<p>It enables picking and identifying objects and proves  that the same code and interaction is supported on all mobile devices, in particular both Android and Safari on iOS.\n\n<p>I now went one step further and explored\n\n<a href=\"\">2D SVG editing on a mobile device with Raphaël</a>,\n\nwhich adds interactive dragging and rotation of the polygons representing furniture or equipment, making use of the\n\n<a href=\"http://raphaeljs.com\">Raphaël</a> JavaScript library.</p>\n<p>If you would like to circumvent all explanations and just jump straight into the final result, take a look at\n\n<a href=\"http://thebuildingcoder.typepad.com/svg\">The Building Coder SVG</a> folder,\n\nor access the step-by-step evolution of the demo directly from here:</p>\n<ol>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/01-curves.htm\">Curves</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/02-grid.htm\">Grid</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\">Room</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\">Reporting text and click handler</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\">Furniture</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\">Drag</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\">Rotate</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a></li>\n</ol>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"2D SVG editing on a mobile device with Raphaël\" src=\"img/svg_raph_09.png\" width=\"300\"/></a>\n</center>\n<p>You can test each step interactively, then see how it works by viewing the source.</p>\n<p>I hope you find this useful.\nHave fun, and good luck!</p>\n</p></p></p></p>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "Cloud and Mobile",
    "local_header_href": "#cloud-and-mobile",
    "chunk_text": "<h1>Cloud and Mobile</h1>"
  },
  {
    "original_filename": "0896_svg_raphael_edit",
    "header_text": "2D SVG Editing on Mobile Device with Raphaël",
    "local_header_href": "#2d-svg-editing-on-mobile-device-with-raphaël",
    "chunk_text": "<h3>2D SVG Editing on Mobile Device with Raphaël</h3><p>By\n\n<a href=\"http://adndevblog.typepad.com/cloud_and_mobile/jeremy-tammik.html\">\nJeremy</a>\n<a href=\"http://thebuildingcoder.typepad.com/blog/about-the-author.html\">\nTammik</a>.</p><p>I spent some more time exploring how to display and interact with 2D graphics in a browser using SVG and JavaScript.\n\n<p>In my last foray into the area, I demonstrated display and interactive picking by implementing a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/10/room-polygon-and-furniture-picker-in-svg.html\">\nroom polygon and furniture picker in SVG</a>.\n\n<p>It enables picking and identifying objects and proves  that the same code and interaction is supported on all mobile devices, in particular both Android and Safari on iOS.\n\n<p>I now went one step further and explored\n\n<a href=\"\">2D SVG editing on a mobile device with Raphaël</a>,\n\nwhich adds interactive dragging and rotation of the polygons representing furniture or equipment, making use of the\n\n<a href=\"http://raphaeljs.com\">Raphaël</a> JavaScript library.</p>\n<p>If you would like to circumvent all explanations and just jump straight into the final result, take a look at\n\n<a href=\"http://thebuildingcoder.typepad.com/svg\">The Building Coder SVG</a> folder,\n\nor access the step-by-step evolution of the demo directly from here:</p>\n<ol>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/01-curves.htm\">Curves</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/02-grid.htm\">Grid</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/03-room.htm\">Room</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/04-text.htm\">Reporting text and click handler</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/05-furniture.htm\">Furniture</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/06-drag.htm\">Drag</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/07-rotate.htm\">Rotate</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\">Button</a></li>\n</ol>\n<center>\n<a href=\"http://thebuildingcoder.typepad.com/svg/08-button.htm\"><img alt=\"2D SVG editing on a mobile device with Raphaël\" src=\"img/svg_raph_09.png\" width=\"300\"/></a>\n</center>\n<p>You can test each step interactively, then see how it works by viewing the source.</p>\n<p>I hope you find this useful.\nHave fun, and good luck!</p>\n</p></p></p>"
  }
]