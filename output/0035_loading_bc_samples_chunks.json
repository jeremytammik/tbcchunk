[
  {
    "original_filename": "0035_loading_bc_samples",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<style>\n.blue { color: blue; }\n.teal { color: teal; }\n.maroon { color: maroon; }\n.green { color: green; }\n</style>"
  },
  {
    "original_filename": "0035_loading_bc_samples",
    "header_text": "Loading The Building Coder Samples",
    "local_header_href": "#loading-the-building-coder-samples",
    "chunk_text": "<h3>Loading The Building Coder Samples</h3><p>As I write these blog entries, I continuously add new commands to The Building Coder sample project.\nWhile doing so, I wish keep my list of external commands up to date with a minimum of effort.\nI have several important requirements:</p><ul>\n<li>Maintain one single file listing the command information.</li>\n<li>Automatically create an entry point in Revit for each command.</li>\n<li>Reuse the same file in all flavours of Revit, with no additional effort.</li>\n<li>Integrate the command data with other ADN samples that I maintain.</li>\n</ul><p>The easiest way to achieve these goals is to make use of the Revit SDK sample external application RvtSamples, which I described in more detail in the post on\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2008/09/loading-sdk-sam.html\">\nLoading SDK Samples</a>.</p><p>So far, however, I have actually been duplicating the information, because on one hand, I wanted to keep it in a separate file. On the other hand, I had to copy it into the RvtSamples input file, RvtSamples.txt.</p><p>For quite a while, I have been thinking that a simple solution to this problem would be for RvtSamples to support an #include mechanism, like the C and C++ pre-processors do. The C #include pragma allows one file to reference another one, and the reference behaves just as if the content of the referenced file were inserted into the referencing one at the #include pragma location.</p><p>Once I started looking at the implementation, it turned out to be very simple. The original RvtSamples module Application.cs reads in the contents of RvtSamples.txt in the line:</p><pre class=\"code\">\n  <span class=\"blue\">string</span>[] lines = <span class=\"teal\">File</span>.ReadAllLines(filename);\n</pre><p>I defined a new helper method ReadAllLinesWithInclude and replaced that call by:</p><pre class=\"code\">\n  <span class=\"blue\">string</span>[] lines = ReadAllLinesWithInclude( filename );\n</pre><p>Here is the implementation of ReadAllLinesWithInclude:</p><pre class=\"code\">\n<span class=\"blue\">char</span>[] _trimChars = <span class=\"blue\">new</span> <span class=\"blue\">char</span>[] {\n  <span class=\"maroon\">' '</span>, <span class=\"maroon\">'\"'</span>, <span class=\"maroon\">'\\''</span>, <span class=\"maroon\">'&lt;'</span>, <span class=\"maroon\">'&gt;'</span> };\n \n<span class=\"blue\">string</span>[] ReadAllLinesWithInclude(\n  <span class=\"blue\">string</span> filename )\n{\n  <span class=\"blue\">if</span>( !<span class=\"teal\">File</span>.Exists( filename ) )\n  {\n    ErrorMsg( filename + <span class=\"maroon\">\" not found.\"</span> );\n    <span class=\"blue\">return</span> <span class=\"blue\">new</span> <span class=\"blue\">string</span>[] { };\n  }\n  <span class=\"blue\">string</span>[] lines = <span class=\"teal\">File</span>.ReadAllLines(\n    filename );\n \n  <span class=\"blue\">int</span> n = lines.GetLength(0);\n  <span class=\"teal\">ArrayList</span> all_lines = <span class=\"blue\">new</span> <span class=\"teal\">ArrayList</span>( n );\n  <span class=\"blue\">foreach</span>( <span class=\"blue\">string</span> line <span class=\"blue\">in</span> lines )\n  {\n    <span class=\"blue\">string</span> s = line.TrimStart();\n    <span class=\"blue\">if</span>( s.ToLower().StartsWith( <span class=\"maroon\">\"#include\"</span> ) )\n    {\n      <span class=\"blue\">string</span> filename2 = s.Substring( 8 );\n      filename2 = filename2.Trim( _trimChars );\n      all_lines.AddRange( ReadAllLinesWithInclude(\n        filename2 ) );\n    }\n    <span class=\"blue\">else</span>\n    {\n      all_lines.Add( line );\n    }\n  }\n  <span class=\"blue\">return</span> all_lines.ToArray( <span class=\"blue\">typeof</span>( <span class=\"blue\">string</span> ) )\n    <span class=\"blue\">as</span> <span class=\"blue\">string</span>[];\n}\n</pre><p>Now, I have added only two lines to the end of RvtSamples.txt, one each for the ADN and The Building Coder samples, and these two lines will never need to be edited again:</p><pre>\n  #include C:/a/j/adn/train/revit/2009/src/AdnSamples.txt\n  #include C:/a/j/adn/train/revit/2009/src/bc/BcSamples.txt\n</pre><p>Here are the entire contents of BcSamples.txt, with the header informational comments removed, and the binary path somewhat shortened for the sake of clarity:</p><pre>\n  /&amp;ADN/&amp;Bc/List Walls\n  List wall lengths and areas\n  C:/bin/BuildingCoder.dll\n  BuildingCoder.CmdListWalls\n\n  /&amp;ADN/&amp;Bc/Wall Dimensions\n  Extract wall solid and list all its dimensions\n  C:/bin/BuildingCoder.dll\n  BuildingCoder.CmdWallDimensions\n\n  /&amp;ADN/&amp;Bc/Relationship Inverter\n  Determine opening &gt; wall host relationships and invert them to wall &gt; opening\n  C:/bin/BuildingCoder.dll\n  BuildingCoder.CmdRelationshipInverter\n\n  /&amp;ADN/&amp;Bc/Filter Performance\n  Compare Type Filter versus using an anonymous method to filter elements\n  C:/bin/BuildingCoder.dll\n  BuildingCoder.CmdFilterPerformance\n\n  /&amp;ADN/&amp;Bc/Element Materials\n  Retrieve building element materials\n  C:/bin/BuildingCoder.dll\n  BuildingCoder.CmdGetMaterials\n\n  /&amp;ADN/&amp;Bc/Azimuth\n  Calculate azimuth\n  C:/bin/BuildingCoder.dll\n  BuildingCoder.CmdAzimuth\n\n  /&amp;ADN/&amp;Bc/Bounding Box\n  Retrieve Element Bounding Box\n  C:/bin/BuildingCoder.dll\n  BuildingCoder.CmdBoundingBox\n\n  /&amp;ADN/&amp;Bc/Slab Boundaries\n  Determine polygonal floor slab boundary loops\n  C:/bin/BuildingCoder.dll\n  BuildingCoder.CmdSlabBoundary\n\n  /&amp;ADN/&amp;Bc/Slab Sides\n  Determine floor slab side faces\n  C:/bin/BuildingCoder.dll\n  BuildingCoder.CmdSlabSides\n</pre><p>By the way, note that you can use an ampersand sign '&amp;' to define keyboard mnemonics to provide shortcut access to the menu items when defining them through an external application. I find this especially handy when I need to start a command repeatedly to debug an application.</p><p>Here is my updated version of\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/files/RvtSamples1010.zip\">\nRvtSamples 1.0.1.0 supporting #include</a>.\n\nI incremented the version number from 1.0.0.0 to 1.0.1.0.</p>"
  }
]