[
  {
    "original_filename": "0203_wall_bottom_face",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0203_wall_bottom_face",
    "header_text": "Bottom Face of a Wall",
    "local_header_href": "#bottom-face-of-a-wall",
    "chunk_text": "<h3>Bottom Face of a Wall</h3><p>We already went into quite a bit of detail analysing the geometry of walls and other elements, but the topic keeps cropping up again anyway.\nAn overview of the preceding posts on this topic is given in the discussion of \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/04/cylindrical-column.html\">\ncylindrical columns</a>.\n\nHere is a case handled by Joe Ye which I thought might complement the previous posts on this topic, since it is so simple and minimal.\n\n<p><strong>Question:</strong>\nHow can I find the bottom face of a wall?</p>\n<p><strong>Answer:</strong>\nWe can query the wall for its solid geometry using the Element.Geometry property, which is accessed by the get_Geometry method in C#.\nFrom the returned solid, all faces can be accessed. \nThe bottom face of the wall has a normal vector equal to (0,0,-1), and in most cases this is the unique for the bottom face. \nSo we just iterate over all faces, and stop when we find one whose normal vector is vertical and has a negative Z coordinate.</p>\n<p>I implemented a new external command named CmdWallBottomFace to demonstrate this.\nHere is the code of its Execute method.\nAs always, it returns Failed even if it did in fact succeed, so that no changes are registered in the BIM, since the command does nothing to modify the model:</p>\n<pre class=\"code\">\n<span class=\"teal\">Application</span> app = commandData.Application;\n<span class=\"teal\">Document</span> doc = app.ActiveDocument;\n \n<span class=\"blue\">string</span> s = <span class=\"maroon\">\"a wall, to retrieve its bottom face\"</span>;\n \n<span class=\"teal\">Wall</span> wall = <span class=\"teal\">Util</span>.SelectSingleElementOfType(\n  doc, <span class=\"blue\">typeof</span>( <span class=\"teal\">Wall</span> ), s ) <span class=\"blue\">as</span> <span class=\"teal\">Wall</span>;\n \n<span class=\"blue\">if</span>( <span class=\"blue\">null</span> == wall )\n{\n  message = <span class=\"maroon\">\"Please select a wall.\"</span>;\n}\n<span class=\"blue\">else</span>\n{\n  <span class=\"teal\">Options</span> opt = app.Create.NewGeometryOptions();\n  <span class=\"teal\">GeoElement</span> e = wall.get_Geometry( opt );\n \n  <span class=\"blue\">foreach</span>( <span class=\"teal\">GeometryObject</span> obj <span class=\"blue\">in</span> e.Objects )\n  {\n    <span class=\"teal\">Solid</span> solid = obj <span class=\"blue\">as</span> <span class=\"teal\">Solid</span>;\n    <span class=\"blue\">if</span>( <span class=\"blue\">null</span> != solid )\n    {\n      <span class=\"blue\">foreach</span>( <span class=\"teal\">Face</span> face <span class=\"blue\">in</span> solid.Faces )\n      {\n        <span class=\"teal\">PlanarFace</span> pf = face <span class=\"blue\">as</span> <span class=\"teal\">PlanarFace</span>;\n        <span class=\"blue\">if</span>( <span class=\"blue\">null</span> != pf )\n        {\n          <span class=\"blue\">if</span>( <span class=\"teal\">Util</span>.IsVertical( pf.Normal, _tolerance )\n            &amp;&amp; pf.Normal.Z &lt; 0 )\n          {\n            <span class=\"teal\">Util</span>.InfoMsg( <span class=\"blue\">string</span>.Format(\n              <span class=\"maroon\">\"The bottom face area is {0},\"</span>\n              + <span class=\"maroon\">\" and its origin is at {1}.\"</span>,\n              <span class=\"teal\">Util</span>.RealString( pf.Area ),\n              <span class=\"teal\">Util</span>.PointString( pf.Origin ) ) );\n            <span class=\"blue\">break</span>;\n          }\n        }\n      }\n    }\n  }\n}\n<span class=\"blue\">return</span> <span class=\"teal\">CmdResult</span>.Failed;\n</pre>\n<p>When the command is executed and a wall selected, the area and origin point of its bottom face is reported in a message box and in the Visual Studio debug output window:</p>\n<center>\n<img alt=\"Wall bottom face area and origin\" src=\"img/wall_bottom_face.png\"/>\n</center>\n<pre>\nThe bottom face area is 265.82, \nand its origin is at (30.76,20.57,-9.84).\n</pre>\n<p>Here is\n\n<a href=\"zip/bc11044.zip\">\nversion 1.1.0.44</a>\n\nof the complete Visual Studio solution including the new command.</p>\n<p>Thank you very much Joe for this answer!\n</p></p>"
  }
]