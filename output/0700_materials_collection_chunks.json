[
  {
    "original_filename": "0700_materials_collection",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0700_materials_collection",
    "header_text": "Materials Collection and Filtering",
    "local_header_href": "#materials-collection-and-filtering",
    "chunk_text": "<h3>Materials Collection and Filtering</h3><p>We already mentioned that null entries may be returned when \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html\">\nretrieving materials</a> from\n\nthe document settings Materials collection.\nThis raised a couple of more points, e.g. more on the \n\n<a href=\"#2\">\nnull entries</a> and\n\n<a href=\"#3\">\nusing LINQ and filtered element collectors</a> to \n\nretrieve materials.\n\nIn the same context, we can also look at \n\n<a href=\"#4\">\nretrieving all materials used by an element</a> and\n\n<a href=\"#5\">\nremoving the deprecated material related API calls</a> in\n\nThe Building Coder samples.\n\n\n\n\n<a name=\"2\"></a>\n<h4>Materials Collection May Contain Null Entries</h4>\n<p>Quite a while ago, Rudolf Honke observed that the Document.Settings.Materials collection may contain empty entries.\n\n<p>This came up in a case where he wanted to list all the Materials sorted by name.\nThe materials returned from the collection may have null values, in which case trying to access their name will obviously throw an exception:</p>\n<center>\n<img alt=\"Null entry in Materials collection\" src=\"img/materials_null.png\"/>\n</center>\n<p>In this case, you can simply skip the invalid material entries before sorting them, because otherwise the null values will make the Sort method crash.\n\n<!-- That's another case in the never-ending series called 'don't rely on Revit properties' because in this case Revit itself gives you results which must handled with caution. -->\n<p>Here is an example of how this can be handled to create a sorted generic .NET list of materials:\n\n<pre class=\"code\">\n  <span class=\"gray\">///</span><span class=\"green\"> </span><span class=\"gray\">&lt;summary&gt;</span>\n  <span class=\"gray\">///</span><span class=\"green\"> Return a list of the document's </span>\n  <span class=\"gray\">///</span><span class=\"green\"> non-null materials sorted by name.</span>\n  <span class=\"gray\">///</span><span class=\"green\"> </span><span class=\"gray\">&lt;/summary&gt;</span>\n  <span class=\"teal\">List</span>&lt;<span class=\"teal\">Material</span>&gt; GetSortedMaterials( <span class=\"teal\">Document</span> doc )\n  {\n    <span class=\"teal\">Materials</span> doc_materials = doc.Settings.Materials;\n    <span class=\"blue\">int</span> n = doc_materials.Size;\n \n    <span class=\"teal\">List</span>&lt;<span class=\"teal\">Material</span>&gt; materials_sorted \n      = <span class=\"blue\">new</span> <span class=\"teal\">List</span>&lt;<span class=\"teal\">Material</span>&gt;( n );\n \n    <span class=\"blue\">foreach</span>( <span class=\"teal\">Material</span> m <span class=\"blue\">in</span> doc_materials )\n    {\n      <span class=\"blue\">if</span>( m != <span class=\"blue\">null</span> )\n      {\n        materials_sorted.Add( m );\n      }\n    }\n    materials_sorted.Sort( \n      <span class=\"blue\">delegate</span>( <span class=\"teal\">Material</span> m1, <span class=\"teal\">Material</span> m2 )\n      {\n        <span class=\"blue\">return</span> m1.Name.CompareTo( m2.Name );\n      }\n    );\n    <span class=\"blue\">return</span> materials_sorted;\n  }\n</pre>\n<p>As said, though, you can also use the filtered element collector to retrieve materials, e.g. using\n\n<pre class=\"code\">\n  <span class=\"blue\">new</span> <span class=\"teal\">FilteredElementCollector</span>( doc )\n    .OfClass( <span class=\"blue\">typeof</span>( <span class=\"teal\">Material</span> ) );\n</pre>\n<a name=\"3\"></a>\n<h4>Material Filtering Using LINQ and Filtered Element Collectors</h4>\n<p>Victor Chekalin reported another issue in his \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html?cid=6a00e553e1689788330162fde14500970d#comment-6a00e553e1689788330162fde14500970d\">\ncomment</a> on\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html\">\nretrieving materials</a>:\n\n<p><strong>Question:</strong> I've got a NullReferenceException when I used document.Settings.Materials.get_Item(\"Concrete\");\n\n<p>This error occurred in a big real project. \nI discovered that the Document.Materials collection contains null items. \nHow is it possible? \nIs it a Revit internal database error or something else?\n\n<p>I solved my problem using Linq:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> material = document\n    .Settings\n    .Materials\n    .OfType&lt;<span class=\"teal\">Material</span>&gt;()\n    .FirstOrDefault( m =&gt; m.Name.Equals( <span class=\"maroon\">\"Concrete\"</span> ) );\n</pre>\n<p><strong>Answer:</strong> The materials collection in the Document.Settings.Materials property may indeed contain empty entries.\n\n<p>You need to check for null values and skip these invalid materials before trying to access them.\n\n<p>I guess that in your code snippet, the OfType filter eliminates the null entries.\n\n<p><strong>Response:</strong> Yes, of course I skip null entries when I iterate materials in loop or using Ling query.\n\n<p>But Materials.get_Item(string) it is a standard Revit method and it doesn't work when collection contains null entries. \nSo this needs to be fixed.\n\n<p>I used this method many times in my project because I thought it would work correctly and it must work in spite of the collection containing nulls. \nBut now, unfortunately for me, I must rewrite my code and change this method to my own :-(\n\n<p>One more problem that I'm interesting in: why does the Materials.get_Item method require an open transaction? \nI'm just reading some data. \nFor example, when I read Element parameters, no transaction is required.\n\n<p><strong>Answer:</strong> As you may be aware, we have been if the process of replacing the material management in Revit by a new cross-product Autodesk materials library for several releases now.\nThis will enhance interoperability between the products and provide many other benefits as well.\nFor now, the simplest and most effective solution is to ignore the Materials collection and use a filtered element collector instead as described above.\n\n<p><strong>Response:</strong> Yes, you are right.  \nThe FilteredElementCollector works without errors.\n\n<p>Here is a suggestion for extension methods to retrieve the collection of all materials and an individual material by name:\n\n<pre class=\"code\">\n  <span class=\"blue\">public</span> <span class=\"blue\">static</span> <span class=\"blue\">class</span> <span class=\"teal\">DocumentExtensions</span>\n  {\n    <span class=\"blue\">public</span> <span class=\"blue\">static</span> <span class=\"teal\">IEnumerable</span>&lt;Material&gt; GetMaterials( \n      <span class=\"blue\">this</span> Document doc )\n    {\n      FilteredElementCollector collector \n        = <span class=\"blue\">new</span> FilteredElementCollector( doc );\n \n      <span class=\"blue\">return</span> collector\n        .OfClass( <span class=\"blue\">typeof</span>( Material ) )\n        .OfType&lt;Material&gt;();\n    }\n \n    <span class=\"blue\">public</span> <span class=\"blue\">static</span> Material GetMaterialByName( \n      <span class=\"blue\">this</span> Materials materials, \n      <span class=\"blue\">string</span> materialName )\n    {\n      <span class=\"blue\">return</span> materials\n        .OfType&lt;Material&gt;()\n        .FirstOrDefault( \n          m =&gt; m.Name.Equals( materialName ) );\n    }\n  }\n</pre>\n<p>They can be used like this:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> materialsInDocument = doc.GetMaterials();\n \n  <span class=\"blue\">var</span> concreteMaterial = doc.Settings.Materials\n    .GetMaterialByName( materialName );\n</pre>\n<p>However, I can now see some new interesting effects :-) \n\n<p>The number of materials retrieved via the collector differs from the Settings.Materials count. \nIn my test project, the collector retrieves 894 materials instead 853 materials in Settings.Materials.\n\n<p>Do you know why?\n\n\n\n<a name=\"4\"></a>\n<h4>Retrieving Element and Material Relationships</h4>\n<p>To wrap this up, here is another question from the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html#comment-6a00e553e16897883301675ec00258970b\">\ncomment</a> by\n\n<a href=\"http://www.facebook.com/dan.tartaglia1\">\nDan Tartaglia</a> on \n\nthe same post:\n\n<p><strong>Question:</strong> Is there an easy way to know if a material is being used by an object in the active file?\n\n<p><strong>Answer:</strong> I am not aware of any other method than iterating over all elements and checking what they use, which is presumably exactly what you are <b>not</b> looking for.\n\n<p>Victor replied and added an example implementation:\n\n<p>As Jeremy says, the only way is to iterate all materials in all elements.\n\n<p>I use the following code to get all elements used by material:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> elementsWithMaterials =\n    ( <span class=\"blue\">from</span> el <span class=\"blue\">in</span> elements\n      <span class=\"blue\">from</span> <span class=\"teal\">Material</span> m <span class=\"blue\">in</span> el.Materials\n      <span class=\"blue\">select</span> <span class=\"blue\">new</span> ElementMaterial( el, m ) )\n    .ToList();\n</pre>\n<p>Here I get element and materials in each element collection:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> groupedElementsInMaterial\n    = elementsWithMaterials\n      .GroupBy( x =&gt; x.Material, <span class=\"blue\">new</span> ElementComparer() )\n      .OrderBy( x =&gt; x.Key.Name );\n</pre>\n<p>Here, I group elements by material.\n\n<p>This gives the following nice tri-lingual result:</p>\n<center>\n<!-- <img src=\"http://s005.radikal.ru/i209/1112/18/c22f9d4b44bf.png\" alt=\"Elements grouped by material\"/> -->\n<img alt=\"Elements grouped by material\" src=\"img/materials_grouped.png\"/>\n</center>\n<a name=\"5\"></a>\n<h4>Cleaned Up Building Coder Samples</h4>\n<p>While we are at it, here is \n\n<a href=\"zip/bc_12_96_3.zip\">\nversion 2012.0.96.3</a> of\n\nThe Building Coder samples with the deprecated material related methods in CmdGetMaterials.cs replaced by new code which no longer produces any warnings in Revit the 2012 API.\nThe obsolete lines are marked with comments saying '// 2011', and their replacements are marked '// 2012'.\n\n<p>There are still compilation warnings due to use of one deprecated method FindReferencesByDirection, which I plan to address soon as well.\n</p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0700_materials_collection",
    "header_text": "Materials Collection May Contain Null Entries",
    "local_header_href": "#materials-collection-may-contain-null-entries",
    "chunk_text": "<h4>Materials Collection May Contain Null Entries</h4><p>Quite a while ago, Rudolf Honke observed that the Document.Settings.Materials collection may contain empty entries.\n\n<p>This came up in a case where he wanted to list all the Materials sorted by name.\nThe materials returned from the collection may have null values, in which case trying to access their name will obviously throw an exception:</p>\n<center>\n<img alt=\"Null entry in Materials collection\" src=\"img/materials_null.png\"/>\n</center>\n<p>In this case, you can simply skip the invalid material entries before sorting them, because otherwise the null values will make the Sort method crash.\n\n<!-- That's another case in the never-ending series called 'don't rely on Revit properties' because in this case Revit itself gives you results which must handled with caution. -->\n<p>Here is an example of how this can be handled to create a sorted generic .NET list of materials:\n\n<pre class=\"code\">\n  <span class=\"gray\">///</span><span class=\"green\"> </span><span class=\"gray\">&lt;summary&gt;</span>\n  <span class=\"gray\">///</span><span class=\"green\"> Return a list of the document's </span>\n  <span class=\"gray\">///</span><span class=\"green\"> non-null materials sorted by name.</span>\n  <span class=\"gray\">///</span><span class=\"green\"> </span><span class=\"gray\">&lt;/summary&gt;</span>\n  <span class=\"teal\">List</span>&lt;<span class=\"teal\">Material</span>&gt; GetSortedMaterials( <span class=\"teal\">Document</span> doc )\n  {\n    <span class=\"teal\">Materials</span> doc_materials = doc.Settings.Materials;\n    <span class=\"blue\">int</span> n = doc_materials.Size;\n \n    <span class=\"teal\">List</span>&lt;<span class=\"teal\">Material</span>&gt; materials_sorted \n      = <span class=\"blue\">new</span> <span class=\"teal\">List</span>&lt;<span class=\"teal\">Material</span>&gt;( n );\n \n    <span class=\"blue\">foreach</span>( <span class=\"teal\">Material</span> m <span class=\"blue\">in</span> doc_materials )\n    {\n      <span class=\"blue\">if</span>( m != <span class=\"blue\">null</span> )\n      {\n        materials_sorted.Add( m );\n      }\n    }\n    materials_sorted.Sort( \n      <span class=\"blue\">delegate</span>( <span class=\"teal\">Material</span> m1, <span class=\"teal\">Material</span> m2 )\n      {\n        <span class=\"blue\">return</span> m1.Name.CompareTo( m2.Name );\n      }\n    );\n    <span class=\"blue\">return</span> materials_sorted;\n  }\n</pre>\n<p>As said, though, you can also use the filtered element collector to retrieve materials, e.g. using\n\n<pre class=\"code\">\n  <span class=\"blue\">new</span> <span class=\"teal\">FilteredElementCollector</span>( doc )\n    .OfClass( <span class=\"blue\">typeof</span>( <span class=\"teal\">Material</span> ) );\n</pre>\n<a name=\"3\"></a>\n<h4>Material Filtering Using LINQ and Filtered Element Collectors</h4>\n<p>Victor Chekalin reported another issue in his \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html?cid=6a00e553e1689788330162fde14500970d#comment-6a00e553e1689788330162fde14500970d\">\ncomment</a> on\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html\">\nretrieving materials</a>:\n\n<p><strong>Question:</strong> I've got a NullReferenceException when I used document.Settings.Materials.get_Item(\"Concrete\");\n\n<p>This error occurred in a big real project. \nI discovered that the Document.Materials collection contains null items. \nHow is it possible? \nIs it a Revit internal database error or something else?\n\n<p>I solved my problem using Linq:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> material = document\n    .Settings\n    .Materials\n    .OfType&lt;<span class=\"teal\">Material</span>&gt;()\n    .FirstOrDefault( m =&gt; m.Name.Equals( <span class=\"maroon\">\"Concrete\"</span> ) );\n</pre>\n<p><strong>Answer:</strong> The materials collection in the Document.Settings.Materials property may indeed contain empty entries.\n\n<p>You need to check for null values and skip these invalid materials before trying to access them.\n\n<p>I guess that in your code snippet, the OfType filter eliminates the null entries.\n\n<p><strong>Response:</strong> Yes, of course I skip null entries when I iterate materials in loop or using Ling query.\n\n<p>But Materials.get_Item(string) it is a standard Revit method and it doesn't work when collection contains null entries. \nSo this needs to be fixed.\n\n<p>I used this method many times in my project because I thought it would work correctly and it must work in spite of the collection containing nulls. \nBut now, unfortunately for me, I must rewrite my code and change this method to my own :-(\n\n<p>One more problem that I'm interesting in: why does the Materials.get_Item method require an open transaction? \nI'm just reading some data. \nFor example, when I read Element parameters, no transaction is required.\n\n<p><strong>Answer:</strong> As you may be aware, we have been if the process of replacing the material management in Revit by a new cross-product Autodesk materials library for several releases now.\nThis will enhance interoperability between the products and provide many other benefits as well.\nFor now, the simplest and most effective solution is to ignore the Materials collection and use a filtered element collector instead as described above.\n\n<p><strong>Response:</strong> Yes, you are right.  \nThe FilteredElementCollector works without errors.\n\n<p>Here is a suggestion for extension methods to retrieve the collection of all materials and an individual material by name:\n\n<pre class=\"code\">\n  <span class=\"blue\">public</span> <span class=\"blue\">static</span> <span class=\"blue\">class</span> <span class=\"teal\">DocumentExtensions</span>\n  {\n    <span class=\"blue\">public</span> <span class=\"blue\">static</span> <span class=\"teal\">IEnumerable</span>&lt;Material&gt; GetMaterials( \n      <span class=\"blue\">this</span> Document doc )\n    {\n      FilteredElementCollector collector \n        = <span class=\"blue\">new</span> FilteredElementCollector( doc );\n \n      <span class=\"blue\">return</span> collector\n        .OfClass( <span class=\"blue\">typeof</span>( Material ) )\n        .OfType&lt;Material&gt;();\n    }\n \n    <span class=\"blue\">public</span> <span class=\"blue\">static</span> Material GetMaterialByName( \n      <span class=\"blue\">this</span> Materials materials, \n      <span class=\"blue\">string</span> materialName )\n    {\n      <span class=\"blue\">return</span> materials\n        .OfType&lt;Material&gt;()\n        .FirstOrDefault( \n          m =&gt; m.Name.Equals( materialName ) );\n    }\n  }\n</pre>\n<p>They can be used like this:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> materialsInDocument = doc.GetMaterials();\n \n  <span class=\"blue\">var</span> concreteMaterial = doc.Settings.Materials\n    .GetMaterialByName( materialName );\n</pre>\n<p>However, I can now see some new interesting effects :-) \n\n<p>The number of materials retrieved via the collector differs from the Settings.Materials count. \nIn my test project, the collector retrieves 894 materials instead 853 materials in Settings.Materials.\n\n<p>Do you know why?\n\n\n\n<a name=\"4\"></a>\n<h4>Retrieving Element and Material Relationships</h4>\n<p>To wrap this up, here is another question from the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html#comment-6a00e553e16897883301675ec00258970b\">\ncomment</a> by\n\n<a href=\"http://www.facebook.com/dan.tartaglia1\">\nDan Tartaglia</a> on \n\nthe same post:\n\n<p><strong>Question:</strong> Is there an easy way to know if a material is being used by an object in the active file?\n\n<p><strong>Answer:</strong> I am not aware of any other method than iterating over all elements and checking what they use, which is presumably exactly what you are <b>not</b> looking for.\n\n<p>Victor replied and added an example implementation:\n\n<p>As Jeremy says, the only way is to iterate all materials in all elements.\n\n<p>I use the following code to get all elements used by material:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> elementsWithMaterials =\n    ( <span class=\"blue\">from</span> el <span class=\"blue\">in</span> elements\n      <span class=\"blue\">from</span> <span class=\"teal\">Material</span> m <span class=\"blue\">in</span> el.Materials\n      <span class=\"blue\">select</span> <span class=\"blue\">new</span> ElementMaterial( el, m ) )\n    .ToList();\n</pre>\n<p>Here I get element and materials in each element collection:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> groupedElementsInMaterial\n    = elementsWithMaterials\n      .GroupBy( x =&gt; x.Material, <span class=\"blue\">new</span> ElementComparer() )\n      .OrderBy( x =&gt; x.Key.Name );\n</pre>\n<p>Here, I group elements by material.\n\n<p>This gives the following nice tri-lingual result:</p>\n<center>\n<!-- <img src=\"http://s005.radikal.ru/i209/1112/18/c22f9d4b44bf.png\" alt=\"Elements grouped by material\"/> -->\n<img alt=\"Elements grouped by material\" src=\"img/materials_grouped.png\"/>\n</center>\n<a name=\"5\"></a>\n<h4>Cleaned Up Building Coder Samples</h4>\n<p>While we are at it, here is \n\n<a href=\"zip/bc_12_96_3.zip\">\nversion 2012.0.96.3</a> of\n\nThe Building Coder samples with the deprecated material related methods in CmdGetMaterials.cs replaced by new code which no longer produces any warnings in Revit the 2012 API.\nThe obsolete lines are marked with comments saying '// 2011', and their replacements are marked '// 2012'.\n\n<p>There are still compilation warnings due to use of one deprecated method FindReferencesByDirection, which I plan to address soon as well.\n</p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0700_materials_collection",
    "header_text": "Material Filtering Using LINQ and Filtered Element Collectors",
    "local_header_href": "#material-filtering-using-linq-and-filtered-element-collectors",
    "chunk_text": "<h4>Material Filtering Using LINQ and Filtered Element Collectors</h4><p>Victor Chekalin reported another issue in his \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html?cid=6a00e553e1689788330162fde14500970d#comment-6a00e553e1689788330162fde14500970d\">\ncomment</a> on\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html\">\nretrieving materials</a>:\n\n<p><strong>Question:</strong> I've got a NullReferenceException when I used document.Settings.Materials.get_Item(\"Concrete\");\n\n<p>This error occurred in a big real project. \nI discovered that the Document.Materials collection contains null items. \nHow is it possible? \nIs it a Revit internal database error or something else?\n\n<p>I solved my problem using Linq:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> material = document\n    .Settings\n    .Materials\n    .OfType&lt;<span class=\"teal\">Material</span>&gt;()\n    .FirstOrDefault( m =&gt; m.Name.Equals( <span class=\"maroon\">\"Concrete\"</span> ) );\n</pre>\n<p><strong>Answer:</strong> The materials collection in the Document.Settings.Materials property may indeed contain empty entries.\n\n<p>You need to check for null values and skip these invalid materials before trying to access them.\n\n<p>I guess that in your code snippet, the OfType filter eliminates the null entries.\n\n<p><strong>Response:</strong> Yes, of course I skip null entries when I iterate materials in loop or using Ling query.\n\n<p>But Materials.get_Item(string) it is a standard Revit method and it doesn't work when collection contains null entries. \nSo this needs to be fixed.\n\n<p>I used this method many times in my project because I thought it would work correctly and it must work in spite of the collection containing nulls. \nBut now, unfortunately for me, I must rewrite my code and change this method to my own :-(\n\n<p>One more problem that I'm interesting in: why does the Materials.get_Item method require an open transaction? \nI'm just reading some data. \nFor example, when I read Element parameters, no transaction is required.\n\n<p><strong>Answer:</strong> As you may be aware, we have been if the process of replacing the material management in Revit by a new cross-product Autodesk materials library for several releases now.\nThis will enhance interoperability between the products and provide many other benefits as well.\nFor now, the simplest and most effective solution is to ignore the Materials collection and use a filtered element collector instead as described above.\n\n<p><strong>Response:</strong> Yes, you are right.  \nThe FilteredElementCollector works without errors.\n\n<p>Here is a suggestion for extension methods to retrieve the collection of all materials and an individual material by name:\n\n<pre class=\"code\">\n  <span class=\"blue\">public</span> <span class=\"blue\">static</span> <span class=\"blue\">class</span> <span class=\"teal\">DocumentExtensions</span>\n  {\n    <span class=\"blue\">public</span> <span class=\"blue\">static</span> <span class=\"teal\">IEnumerable</span>&lt;Material&gt; GetMaterials( \n      <span class=\"blue\">this</span> Document doc )\n    {\n      FilteredElementCollector collector \n        = <span class=\"blue\">new</span> FilteredElementCollector( doc );\n \n      <span class=\"blue\">return</span> collector\n        .OfClass( <span class=\"blue\">typeof</span>( Material ) )\n        .OfType&lt;Material&gt;();\n    }\n \n    <span class=\"blue\">public</span> <span class=\"blue\">static</span> Material GetMaterialByName( \n      <span class=\"blue\">this</span> Materials materials, \n      <span class=\"blue\">string</span> materialName )\n    {\n      <span class=\"blue\">return</span> materials\n        .OfType&lt;Material&gt;()\n        .FirstOrDefault( \n          m =&gt; m.Name.Equals( materialName ) );\n    }\n  }\n</pre>\n<p>They can be used like this:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> materialsInDocument = doc.GetMaterials();\n \n  <span class=\"blue\">var</span> concreteMaterial = doc.Settings.Materials\n    .GetMaterialByName( materialName );\n</pre>\n<p>However, I can now see some new interesting effects :-) \n\n<p>The number of materials retrieved via the collector differs from the Settings.Materials count. \nIn my test project, the collector retrieves 894 materials instead 853 materials in Settings.Materials.\n\n<p>Do you know why?\n\n\n\n<a name=\"4\"></a>\n<h4>Retrieving Element and Material Relationships</h4>\n<p>To wrap this up, here is another question from the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html#comment-6a00e553e16897883301675ec00258970b\">\ncomment</a> by\n\n<a href=\"http://www.facebook.com/dan.tartaglia1\">\nDan Tartaglia</a> on \n\nthe same post:\n\n<p><strong>Question:</strong> Is there an easy way to know if a material is being used by an object in the active file?\n\n<p><strong>Answer:</strong> I am not aware of any other method than iterating over all elements and checking what they use, which is presumably exactly what you are <b>not</b> looking for.\n\n<p>Victor replied and added an example implementation:\n\n<p>As Jeremy says, the only way is to iterate all materials in all elements.\n\n<p>I use the following code to get all elements used by material:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> elementsWithMaterials =\n    ( <span class=\"blue\">from</span> el <span class=\"blue\">in</span> elements\n      <span class=\"blue\">from</span> <span class=\"teal\">Material</span> m <span class=\"blue\">in</span> el.Materials\n      <span class=\"blue\">select</span> <span class=\"blue\">new</span> ElementMaterial( el, m ) )\n    .ToList();\n</pre>\n<p>Here I get element and materials in each element collection:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> groupedElementsInMaterial\n    = elementsWithMaterials\n      .GroupBy( x =&gt; x.Material, <span class=\"blue\">new</span> ElementComparer() )\n      .OrderBy( x =&gt; x.Key.Name );\n</pre>\n<p>Here, I group elements by material.\n\n<p>This gives the following nice tri-lingual result:</p>\n<center>\n<!-- <img src=\"http://s005.radikal.ru/i209/1112/18/c22f9d4b44bf.png\" alt=\"Elements grouped by material\"/> -->\n<img alt=\"Elements grouped by material\" src=\"img/materials_grouped.png\"/>\n</center>\n<a name=\"5\"></a>\n<h4>Cleaned Up Building Coder Samples</h4>\n<p>While we are at it, here is \n\n<a href=\"zip/bc_12_96_3.zip\">\nversion 2012.0.96.3</a> of\n\nThe Building Coder samples with the deprecated material related methods in CmdGetMaterials.cs replaced by new code which no longer produces any warnings in Revit the 2012 API.\nThe obsolete lines are marked with comments saying '// 2011', and their replacements are marked '// 2012'.\n\n<p>There are still compilation warnings due to use of one deprecated method FindReferencesByDirection, which I plan to address soon as well.\n</p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0700_materials_collection",
    "header_text": "Retrieving Element and Material Relationships",
    "local_header_href": "#retrieving-element-and-material-relationships",
    "chunk_text": "<h4>Retrieving Element and Material Relationships</h4><p>To wrap this up, here is another question from the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/08/retrieving-materials.html#comment-6a00e553e16897883301675ec00258970b\">\ncomment</a> by\n\n<a href=\"http://www.facebook.com/dan.tartaglia1\">\nDan Tartaglia</a> on \n\nthe same post:\n\n<p><strong>Question:</strong> Is there an easy way to know if a material is being used by an object in the active file?\n\n<p><strong>Answer:</strong> I am not aware of any other method than iterating over all elements and checking what they use, which is presumably exactly what you are <b>not</b> looking for.\n\n<p>Victor replied and added an example implementation:\n\n<p>As Jeremy says, the only way is to iterate all materials in all elements.\n\n<p>I use the following code to get all elements used by material:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> elementsWithMaterials =\n    ( <span class=\"blue\">from</span> el <span class=\"blue\">in</span> elements\n      <span class=\"blue\">from</span> <span class=\"teal\">Material</span> m <span class=\"blue\">in</span> el.Materials\n      <span class=\"blue\">select</span> <span class=\"blue\">new</span> ElementMaterial( el, m ) )\n    .ToList();\n</pre>\n<p>Here I get element and materials in each element collection:\n\n<pre class=\"code\">\n  <span class=\"blue\">var</span> groupedElementsInMaterial\n    = elementsWithMaterials\n      .GroupBy( x =&gt; x.Material, <span class=\"blue\">new</span> ElementComparer() )\n      .OrderBy( x =&gt; x.Key.Name );\n</pre>\n<p>Here, I group elements by material.\n\n<p>This gives the following nice tri-lingual result:</p>\n<center>\n<!-- <img src=\"http://s005.radikal.ru/i209/1112/18/c22f9d4b44bf.png\" alt=\"Elements grouped by material\"/> -->\n<img alt=\"Elements grouped by material\" src=\"img/materials_grouped.png\"/>\n</center>\n<a name=\"5\"></a>\n<h4>Cleaned Up Building Coder Samples</h4>\n<p>While we are at it, here is \n\n<a href=\"zip/bc_12_96_3.zip\">\nversion 2012.0.96.3</a> of\n\nThe Building Coder samples with the deprecated material related methods in CmdGetMaterials.cs replaced by new code which no longer produces any warnings in Revit the 2012 API.\nThe obsolete lines are marked with comments saying '// 2011', and their replacements are marked '// 2012'.\n\n<p>There are still compilation warnings due to use of one deprecated method FindReferencesByDirection, which I plan to address soon as well.\n</p></p></p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0700_materials_collection",
    "header_text": "Cleaned Up Building Coder Samples",
    "local_header_href": "#cleaned-up-building-coder-samples",
    "chunk_text": "<h4>Cleaned Up Building Coder Samples</h4><p>While we are at it, here is \n\n<a href=\"zip/bc_12_96_3.zip\">\nversion 2012.0.96.3</a> of\n\nThe Building Coder samples with the deprecated material related methods in CmdGetMaterials.cs replaced by new code which no longer produces any warnings in Revit the 2012 API.\nThe obsolete lines are marked with comments saying '// 2011', and their replacements are marked '// 2012'.\n\n<p>There are still compilation warnings due to use of one deprecated method FindReferencesByDirection, which I plan to address soon as well.\n</p></p>"
  }
]