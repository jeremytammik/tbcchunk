[
  {
    "original_filename": "0482_createairhandler_connector",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0482_createairhandler_connector",
    "header_text": "Connector Direction and CreateAirHandler Sample",
    "local_header_href": "#connector-direction-and-createairhandler-sample",
    "chunk_text": "<h3>Connector Direction and CreateAirHandler Sample</h3><p>Here is an update to the CreateAirHandler SDK sample provided by my colleague Greg Wesner together with an interesting analysis of MEP connector directions.\n\n<!--\n\n156_mep_2010_api.htm:<li><strong>CreateAirHandler:</st\n199_family_api.htm:<h5>CreateAirHandler - RME</h5>\n199_family_api.htm:<p>CreateAirHandler is a Revit MEP\n219_mep_api.htm:<li>CreateAirHandler: Create an air ha\n362_mep_2011_api.htm:<li>CreateAirHandler\n\n\n130_mep_connectors.htm\n204_rvtmgddbg_mep_connectors.htm\n312_connector_orientation.htm\n407_modeless_loose_connectors.htm\n398_retrieve_mep_elements.htm\n\n-->\n<p>We looked at various aspects of MEP connectors several times in the past:\n\n<ul>\n<li>The difference between the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/04/mep-connectors.html\">\nfamily connector elements</a> and the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/04/mep-connectors.html\">\nproject connector class</a>.\n\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2009/08/fixing-rvtmgddbg-for-mep-connectors.html\">\nEnhancing RevitLookup for MEP</a>, previously known as RvtMgdDbg.\n\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2010/03/connector-orientation.html\">\nConnector orientation</a>.\n\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2010/06/retrieve-mep-elements-and-connectors.html\">\nRetrieving MEP elements and connectors</a>.\n\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2010/07/modeless-loose-connectors.html\">\nModeless loose connector navigator</a>.\n\n</li></li></li></li></li></ul>\n<p>The CreateAirHandler SDK sample shows how to create an MEP air handling device including its connectors.\nIt was introduced with the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/06/revit-mep-api.html\">\nRevit MEP 2010 API</a> and is also a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/08/the-revit-family-api.html#3\">\nfamily API sample</a>.\n\nWe since also discussed the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/09/the-revit-mep-api.html#6\">\nRevit MEP API in general</a> and the current situation in the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/05/the-revit-mep-2011-api.html\">\nRevit MEP 2011 API</a>.\n\n<p>Here are Greg's observations and fixes:\n\n<p>I found some issues with the CreateAirHandler SDK sample that are easy to fix.\nHere is an image of the family as it is generated by the current sample implementation:</p>\n<center>\n<img alt=\"Current CreateAirHandler result\" src=\"img/CreateAirHandlerWrong.png\"/>\n</center>\n<p>Notice that the supply and return connectors and voids are not on the extruded solid that represents the air handler itself. Neither is the top hydronic supply. If you look at the supply connector (the smaller green rectangle), it should be in the same plane as the orange void. And it\ns hard to see here, but the direction indicator for the return connector is pointing in the wrong direction.\nHere is what I think it should look like:</p>\n<center>\n<img alt=\"Correct CreateAirHandler result\" src=\"img/CreateAirHandlerCorrect.png\"/>\n</center>\n<p>Here is\n\n<a href=\"zip/CreateAirHandlerCommand.cs\">\nCommand.cs</a>\n\ncontaining the corrected command implementation, and here are\n\n<a href=\"zip/CreateAirHandlerFixes.html\">\nthe diffs, i.e. the changes I made</a> to fix these issues.\n\n<h4>Connector Direction Reversal</h4>\n<p>I originally implemented this update based on Revit 2010.\nWhen I tested the same code on Revit 2011, I noticed is that the connector direction changed between Revit 2010 and 2011.\n\n<p>After I fixed the air handler creation to my satisfaction for the 2010 version, the connectors point outwards as I expect:</p>\n<center>\n<img alt=\"Connectors point outwards in Revit 2010\" src=\"img/CreateAirHandler2010.png\"/>\n</center>\n<p>Running the exact same code in Revit 2011, however, causes them to point inwards instead:</p>\n<center>\n<img alt=\"Connectors point inwards in Revit 2011\" src=\"img/CreateAirHandler2011.png\"/>\n</center>\n<p>Note that the arrows for the supply and return connectors point inward in 2011. \nThat's actually the opposite of the normal for the face of the object they are attached to. \nI verified this using Revit Lookup and looking at the normal of the faces I attach to.\n\n<p>I also notice that the hydronic connectors at the bottom didn't change. \nThe only thing I can think of is that the supply and return ducts actually attach to a void extrusion whereas the hydronic connectors attach to a solid. \nI guess that Revit inverts the normal for the connector when it is attached to a void extrusion?\nThat would explain why the arrows are reversed for the air connectors.\n\n<h4>Reverse the Reversal</h4>\n<p>This leads to an additional fix:\n\n<p>In the initial code update, I changed the face that the connector is associated with to the outside face of the void extrusions. \nThis results in the direction indicator pointing in towards the centre of the air handler in Revit 2011. \n\n<p>In order to keep them pointing outwards, you may want to associate the opposite face instead. \nTo do so, in the CreateConnectors method, change m_planarFaces[0] to m_planarFaces[1].\nThat affects the following line for the supply air connector:\n\n<pre class=\"code\">\n  <span class=\"green\">// create the Supply Air duct connector</span>\n  <span class=\"teal\">DuctConnector</span> connSupplyAir \n    = f.NewDuctConnector(\n      m_planarFaces[1].Reference,\n      <span class=\"teal\">DuctSystemType</span>.SupplyAir );\n</pre>\n<p>Similarly, the following line for the return air connector:\n\n<pre class=\"code\">\n  <span class=\"green\">// create the Return Air duct connector</span>\n  <span class=\"teal\">DuctConnector</span> connReturnAir \n    = f.NewDuctConnector(\n      m_planarFaces[1].Reference,\n      <span class=\"teal\">DuctSystemType</span>.ReturnAir);\n</pre>\n<p>This will put the connectors on the inside faces of the voids, but at least the direction arrow will point in the correct direction. \nNormally, of course, one would expect the connector to be on the exterior of the unit.\n\n</p></p></p></p></p></p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0482_createairhandler_connector",
    "header_text": "Connector Direction Reversal",
    "local_header_href": "#connector-direction-reversal",
    "chunk_text": "<h4>Connector Direction Reversal</h4><p>I originally implemented this update based on Revit 2010.\nWhen I tested the same code on Revit 2011, I noticed is that the connector direction changed between Revit 2010 and 2011.\n\n<p>After I fixed the air handler creation to my satisfaction for the 2010 version, the connectors point outwards as I expect:</p>\n<center>\n<img alt=\"Connectors point outwards in Revit 2010\" src=\"img/CreateAirHandler2010.png\"/>\n</center>\n<p>Running the exact same code in Revit 2011, however, causes them to point inwards instead:</p>\n<center>\n<img alt=\"Connectors point inwards in Revit 2011\" src=\"img/CreateAirHandler2011.png\"/>\n</center>\n<p>Note that the arrows for the supply and return connectors point inward in 2011. \nThat's actually the opposite of the normal for the face of the object they are attached to. \nI verified this using Revit Lookup and looking at the normal of the faces I attach to.\n\n<p>I also notice that the hydronic connectors at the bottom didn't change. \nThe only thing I can think of is that the supply and return ducts actually attach to a void extrusion whereas the hydronic connectors attach to a solid. \nI guess that Revit inverts the normal for the connector when it is attached to a void extrusion?\nThat would explain why the arrows are reversed for the air connectors.\n\n<h4>Reverse the Reversal</h4>\n<p>This leads to an additional fix:\n\n<p>In the initial code update, I changed the face that the connector is associated with to the outside face of the void extrusions. \nThis results in the direction indicator pointing in towards the centre of the air handler in Revit 2011. \n\n<p>In order to keep them pointing outwards, you may want to associate the opposite face instead. \nTo do so, in the CreateConnectors method, change m_planarFaces[0] to m_planarFaces[1].\nThat affects the following line for the supply air connector:\n\n<pre class=\"code\">\n  <span class=\"green\">// create the Supply Air duct connector</span>\n  <span class=\"teal\">DuctConnector</span> connSupplyAir \n    = f.NewDuctConnector(\n      m_planarFaces[1].Reference,\n      <span class=\"teal\">DuctSystemType</span>.SupplyAir );\n</pre>\n<p>Similarly, the following line for the return air connector:\n\n<pre class=\"code\">\n  <span class=\"green\">// create the Return Air duct connector</span>\n  <span class=\"teal\">DuctConnector</span> connReturnAir \n    = f.NewDuctConnector(\n      m_planarFaces[1].Reference,\n      <span class=\"teal\">DuctSystemType</span>.ReturnAir);\n</pre>\n<p>This will put the connectors on the inside faces of the voids, but at least the direction arrow will point in the correct direction. \nNormally, of course, one would expect the connector to be on the exterior of the unit.\n\n</p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0482_createairhandler_connector",
    "header_text": "Reverse the Reversal",
    "local_header_href": "#reverse-the-reversal",
    "chunk_text": "<h4>Reverse the Reversal</h4><p>This leads to an additional fix:\n\n<p>In the initial code update, I changed the face that the connector is associated with to the outside face of the void extrusions. \nThis results in the direction indicator pointing in towards the centre of the air handler in Revit 2011. \n\n<p>In order to keep them pointing outwards, you may want to associate the opposite face instead. \nTo do so, in the CreateConnectors method, change m_planarFaces[0] to m_planarFaces[1].\nThat affects the following line for the supply air connector:\n\n<pre class=\"code\">\n  <span class=\"green\">// create the Supply Air duct connector</span>\n  <span class=\"teal\">DuctConnector</span> connSupplyAir \n    = f.NewDuctConnector(\n      m_planarFaces[1].Reference,\n      <span class=\"teal\">DuctSystemType</span>.SupplyAir );\n</pre>\n<p>Similarly, the following line for the return air connector:\n\n<pre class=\"code\">\n  <span class=\"green\">// create the Return Air duct connector</span>\n  <span class=\"teal\">DuctConnector</span> connReturnAir \n    = f.NewDuctConnector(\n      m_planarFaces[1].Reference,\n      <span class=\"teal\">DuctSystemType</span>.ReturnAir);\n</pre>\n<p>This will put the connectors on the inside faces of the voids, but at least the direction arrow will point in the correct direction. \nNormally, of course, one would expect the connector to be on the exterior of the unit.\n\n</p></p></p></p></p>"
  }
]