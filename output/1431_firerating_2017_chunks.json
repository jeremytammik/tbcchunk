[
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"run_prettify.js\" type=\"text/javascript\"></script>\n<!--\n<script src=\"https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js\" type=\"text/javascript\"></script>\n-->\n</head>\n\n<!---\n\nReal-Time BIM Update with FireRatingCloud 2017 #revitAPI #3dwebcoder @AutodeskRevit #adsk #aec #bim @AutodeskForge #3dwebaccel\n\nYesterday, I migrated RoomEditorApp to Revit 2017 and mentioned the BIM and cloud related projects I am working on.\nNext, let's focus on the FireRatingCloud sample.\nThe main goal there is to implement fully automatic real-time BIM update from the cloud.\nNow, 24 hours after writing the previous sentence, I can tell you that I succeeded.\nWell, add another six hours to edit this post...\nHere is the updated FireRatingCloud custom ribbon tab with its new set of commands...\n\n-->"
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "Real-Time BIM Update with FireRatingCloud 2017",
    "local_header_href": "#real-time-bim-update-with-fireratingcloud-2017",
    "chunk_text": "### Real-Time BIM Update with FireRatingCloud 2017\n\nYesterday,\nI [migrated RoomEditorApp to Revit 2017](http://thebuildingcoder.typepad.com/blog/2016/04/room-editor-first-revit-2017-addin-migration.html#3) and\nmentioned\nthe [BIM and cloud related projects](http://thebuildingcoder.typepad.com/blog/2016/04/room-editor-first-revit-2017-addin-migration.html#1) I am working on.\n\nNext, let's focus on\nthe [FireRatingCloud](https://github.com/jeremytammik/FireRatingCloud) sample.\n\nThe main goal there is to implement fully automatic real-time BIM update from the cloud.\n\nNow, 24 hours after writing the previous sentence, I can tell you that I succeeded.\n\nWell, add another six hours to edit this post...\n\nAnd yet another six hours to struggle with Typepad, which is blocking me from publishing this...\n\nHere is the updated FireRatingCloud custom ribbon tab with its new set of commands:\n\n<center>\n<img src=\"img/firerating_2017_ribbon_tab.png\" alt=\"FireRatingCloud ribbon tab and commands in Revit 2017\" width=\"442\">\n</center>\n\nThe commands are now:\n\n- Cmd_0_About.cs &ndash; display an About... box.\n- Cmd_1_CreateAndBindSharedParameter &ndash; I won't ever tell.\n- Cmd_2a_ExportSharedParameterValues &ndash; upload data to cloud database using individual REST API calls for each record.\n- Cmd_2b_ExportSharedParameterValuesBatch &ndash; batch upload data to cloud database using one single REST API call.\n- Cmd_3_ImportSharedParameterValues &ndash; interactively download data and update BIM from cloud database.\n- Cmd_4_Subscribe &ndash; subscribe to automatic real-time BIM updates.\n\nAchieving that required the following steps:\n\n- [Already done and yet to do](#2)\n- [Migration to Revit 2017](#3)\n- [Reusing the RoomEditorApp infrastructure](#4)\n- [Redesign](#5)\n    - [Typepad blocking source code in the blog post](#5.0)\n    - [App.cs](#5.1)\n    - [BimUpdater.cs](#5.2)\n    - [Cmd_4_Subscribe.cs](#5.3)\n    - [DbAccessor.cs](#5.4)\n- [FireRatingCloud video recording](#9)\n- [Download](#10)\n- [To do](#11)"
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"2\"></a>Already Done and Yet To Do",
    "local_header_href": "#a-name2aalready-done-and-yet-to-do",
    "chunk_text": "#### <a name=\"2\"></a>Already Done and Yet To Do\n\nAs said, our main goal right now is the support of a round-trip data exchange with the cloud with an optional automatic real-time update of the BIM.\n\nFireRatingCloud will require almost exactly the same functionality as our trusty old [RoomEditorApp](https://github.com/jeremytammik/RoomEditorApp) sample to support that.\n\nWe can reuse a lot of the RoomEditorApp implementation, e.g., its external application managing the database polling in a separate thread, the external event to update the BIM when the polling returns modified records, the ribbon user interface for the growing number of commands, the toggle button to turn subscription on and off, etc.\n\nSome tasks that I already addressed for this project include:\n\n- [REST API batch upload and Windows client](http://the3dwebcoder.typepad.com/blog/2016/03/fireratingcloud-rest-api-batch-upload-and-windows-client.html) &ndash; the original FireRatingCloud sample made a separate REST API call for each door firerating shared parameter value that it exported to the cloud database. Reimporting modified values uses one single REST call for the whole batch. This enhancement exports in batch as well.\n- [Database document modification timestamp](http://the3dwebcoder.typepad.com/blog/2016/04/fireratingcloud-document-modification-timestamp.html) &ndash; in order to retrieve modified database records only, a timestamp is required.\n- [Retrieving updated docs](http://the3dwebcoder.typepad.com/blog/2016/04/fireratingcloud-query-retrieving-updated-docs.html) &ndash; implementation and testing of the timestamp marker and retrieval.\n\nNow I am ready to address the main goal, almost the holy grail:\n\n- Implement automatic round-trip real-time BIM update from the cloud\n\nThis entails a couple of subtasks:\n\n- Implement an external event to poll the cloud database for updated records, making use of the document modification timestamp and retrieval of updated docs already implemented.\n- Implement an external application to manage the external event.\n- Implement a custom ribbon tab and buttons for the user interface to handle the real-time update subscription toggle button.\n- Migrate to Revit 2017. I already migrated\nthe [RoomEditorApp](https://github.com/jeremytammik/RoomEditorApp) sample and am reusing its implementation for several of the preceding items.\n\nOnce we have completed the FireRatingCloud sample, here are a few more exciting upcoming cloud related tasks:\n\n- Document and improve [FireRatingClient](), the stand-alone Windows client &ndash; we will need this to demonstrate the real-time BIM update from arbitrary sources more nicely than the simple setup I discuss below.\n- Completely rewrite the existing [RoomEditorApp](https://github.com/jeremytammik/RoomEditorApp) sample to move it from CouchDB to node.js plus MongoDB.\n- Implement the database portion of the [TrackChangesCloud](https://github.com/jeremytammik/TrackChangesCloud) sample."
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"3\"></a>Migration to Revit 2017",
    "local_header_href": "#a-name3amigration-to-revit-2017",
    "chunk_text": "#### <a name=\"3\"></a>Migration to Revit 2017\n\nMigrating the [RoomEditorApp](https://github.com/jeremytammik/RoomEditorApp) to Revit 2017 yesterday was really easy.\n\nNow let's do the same for FireRatingCloud before anything else.\n\nAs always, I need to reference the new Revit API assemblies.\n\nFor Revit 2017, I also need to switch from Visual Studio 2012 to 2015 and update the .NET framework version from 4.5 to 4.5.2.\n\nFurthermore, FireRatingCloud references the [RestSharp library](http://restsharp.org), which provides separate assemblies for those two .NET framework versions, so we need to update those references as well.\n\nThat was it.\n\nNo code changes required, nor anything else further at all.\n\nHere is the full solution in Visual Studio 2015 after implementing all the further enhancements described below:\n\n<center>\n<img src=\"img/firerating_2017_sln.png\" alt=\"FireRatingCloud solution in Visual Studio 2015\" width=\"276\">\n</center>\n\nThe initial [release 2017.0.0.0](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.0) is live in\nthe [FireRatingCloud GitHub repository](https://github.com/jeremytammik/FireRatingCloud),\nand you can examine the flat migration changes by looking at\nthe [diffs](https://github.com/jeremytammik/FireRatingCloud/compare/2016.0.0.25...2017.0.0.0).\n\nThere is much more coming, though."
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"4\"></a>Reusing the RoomEditorApp Infrastructure",
    "local_header_href": "#a-name4areusing-the-roomeditorapp-infrastructure",
    "chunk_text": "#### <a name=\"4\"></a>Reusing the RoomEditorApp Infrastructure\n\nThe migration was trivial, and only a minute part of the task I am addressing.\n\nOnce that was done, I was able to integrate and reuse all the important RoomEditorApp infrastructure to implementing the external application, external event, ribbon UI, command buttons, subscription command toggle button and database polling loop in a separate thread.\n\nThat took about a day."
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"5\"></a>Redesign",
    "local_header_href": "#a-name5aredesign",
    "chunk_text": "#### <a name=\"5\"></a>Redesign\n\nI spent another day cleaning up the result to make it cleaner and easier to understand.\n\nOne important cleanup step, for instance, was to separate the misleadingly named DbUpdater class into two separate classes named BimUpdater and DbAccessor.\n\nThe former implements the actual shared parameter value update in the BIM using a method that is used both by the interactive import command and the external event triggered by the database polling when it detects modification to be applied. It also implements this external event.\n\nThe latter reads records from the database, also for both the external command and the external event. It also implements the database polling loop that runs in a separate thread and raises the external event when it finds pending modification to be applied.\n\nCan you imagine how much easier it is to understand the architecture when these two components are cleanly separated, and how confusing it is when they are bunched together into one, like they were before?\n\nIt all has historical reasons, of course.\n\nAnyway, this sample is now hopefully much easier to comprehend than the RoomEditorApp.\n\nHence my aim to completely rewrite RoomEditorApp, basing it on this sample next time.\n\nYou can possibly get an idea of the various enhancement steps I made by looking at the list of intermediate releases:\n\n- [2017.0.0.1](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.1) &ndash; implemented real-time bim update: external app, external event, ribbon ui, subscribe command and toggle button\n- [2017.0.0.2](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.2) &ndash; converted timestamp to unsigned\n- [2017.0.0.3](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.3) &ndash; split DbUpdater into separate DbAccessor and BimUpdater classes\n- [2017.0.0.4](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.4) &ndash; moved and renamed UpdateBimFromDb to BimUpdater.UpdateBim\n- [2017.0.0.5](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.5) &ndash; cleanup: all except DbAccessor and BimUpdater is now clear\n- [2017.0.0.6](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.6) &ndash; rewrote UpdateBim to take list of modified doors from DbAccessor or import command\n- [2017.0.0.7](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.7) &ndash; remove obsolete external commands from add-in manifest and clean up\n- [2017.0.0.8](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.8) &ndash; replace Debug.Print by Util.Log and clean up using namespace statements\n- [2017.0.0.9](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.9) &ndash; fixed and created recording\n- [2017.0.0.10](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.10) &ndash; added readme documents for the two subprojects\n\nFireRatingCloud now consists of the following modules:\n\n- App.cs\n- BimUpdater.cs\n- Cmd_0_About.cs\n- Cmd_1_CreateAndBindSharedParameter.cs\n- Cmd_2a_ExportSharedParameterValues.cs\n- Cmd_2b_ExportSharedParameterValuesBatch.cs\n- Cmd_3_ImportSharedParameterValues.cs\n- Cmd_4_Subscribe.cs\n- DbAccessor.cs\n- DoorData.cs\n- Util.cs\n\nThe most interesting parts are the new additions, of course:\n\n- [App.cs](#5.1) implements the external application, ribbon UI, command buttons, subscription command toggle button, and manages the external event.\n- [BimUpdater.cs](#5.2) implements the external event and the method updating the Revit shared parameters.\n- [Cmd_4_Subscribe.cs](#5.3) implements the new subscription external command.\n- [DbAccessor.cs](#5.4) implements the database polling loop in a separate thread and raises the external event when external modifications are detected.\n\nLet's look at them one by one.\n\nI checked all the code comments.\n\nThey are just about as extensive as they ought to be, no more, no less, and all up to date.\n\nSo please read them as well  :-)"
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"5.0\"></a>Typepad Blocking Source Code in the Blog Post",
    "local_header_href": "#a-name50atypepad-blocking-source-code-in-the-blog-post",
    "chunk_text": "#### <a name=\"5.0\"></a>Typepad Blocking Source Code in the Blog Post\n\nTypepad blocked me from posting the four following source code sections.\n\nEvery time I tried, it triggered a message saying I have been blocked for security reasons:\n\n> Sorry, you have been blocked. You are unable to access typepad.com. Why have I been blocked? This website is using a security service to protect itself from online attacks. The action you just performed triggered the security solution. There are several actions that could trigger this block including submitting a certain word or phrase, a SQL command or malformed data. CloudFlare Ray ID: 29a278666db82690 &ndash; Your IP: XXXXX &ndash; Performance & security by CloudFlare...\n\nI submitted a ticket...\n\nI experienced this once already, last month, and it took hours to resolve, wasted for both me and them. More on my side, of course. Painful.\n\nMeanwhile, you can read the [full post](http://jeremytammik.github.io/tbc/a/1431_firerating_2017.html) in the [tbc GitHub repository](https://github.com/jeremytammik/tbc) without the Typepad support.\n\n24 hours later and after several email exchanges and ticket submissions, they say the problem is resolved.\n\nLet's see... yes, it works!"
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"5.1\"></a>App.cs",
    "local_header_href": "#a-name51aappcs",
    "chunk_text": "#### <a name=\"5.1\"></a>App.cs\n\nImplements the external application, ribbon UI, command buttons, subscription command toggle button, and manages the external event:\n\n<pre class=\"code\">\n<span style=\"color:blue;\">class</span>&nbsp;<span style=\"color:#2b91af;\">App</span>&nbsp;:&nbsp;<span style=\"color:#2b91af;\">IExternalApplication</span>\n{\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Caption</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">const</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;Caption&nbsp;=&nbsp;<span style=\"color:#a31515;\">&quot;FireRatingCloud&quot;</span>;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Switch&nbsp;between&nbsp;subscribe&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;and&nbsp;unsubscribe&nbsp;commands.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">const</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;_subscribe&nbsp;=&nbsp;<span style=\"color:#a31515;\">&quot;Subscribe&quot;</span>;\n&nbsp;&nbsp;<span style=\"color:blue;\">const</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;_unsubscribe&nbsp;=&nbsp;<span style=\"color:#a31515;\">&quot;Unsubscribe&quot;</span>;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Subscription&nbsp;debugging&nbsp;benchmark&nbsp;timer.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:green;\">//static&nbsp;JtTimer&nbsp;_timer&nbsp;=&nbsp;null;</span>\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Store&nbsp;the&nbsp;external&nbsp;event.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">ExternalEvent</span>&nbsp;_event&nbsp;=&nbsp;<span style=\"color:blue;\">null</span>;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Executing&nbsp;assembly&nbsp;namespace</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;_namespace&nbsp;=&nbsp;<span style=\"color:blue;\">typeof</span>(&nbsp;<span style=\"color:#2b91af;\">App</span>&nbsp;).Namespace;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Command&nbsp;name&nbsp;prefix</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">const</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;_cmd_prefix&nbsp;=&nbsp;<span style=\"color:#a31515;\">&quot;Cmd_&quot;</span>;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Currently&nbsp;executing&nbsp;assembly&nbsp;path</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;_path&nbsp;=&nbsp;<span style=\"color:blue;\">typeof</span>(&nbsp;<span style=\"color:#2b91af;\">App</span>&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;.Assembly.Location;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Keep&nbsp;track&nbsp;of&nbsp;our&nbsp;ribbon&nbsp;&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;buttons&nbsp;to&nbsp;toggle&nbsp;their&nbsp;text.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">RibbonItem</span>[]&nbsp;_buttons;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Kepp&nbsp;track&nbsp;of&nbsp;subscription&nbsp;command&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;button&nbsp;whose&nbsp;text&nbsp;is&nbsp;toggled.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">int</span>&nbsp;_subscribeButtonIndex&nbsp;=&nbsp;4;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">#region</span>&nbsp;Icon&nbsp;resource,&nbsp;bitmap&nbsp;image&nbsp;and&nbsp;ribbon&nbsp;panel&nbsp;stuff\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Return&nbsp;path&nbsp;to&nbsp;embedded&nbsp;resource&nbsp;icon</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;IconResourcePath(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;name,\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;size&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;_namespace\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;.&quot;</span>&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;Icon&quot;</span>&nbsp;<span style=\"color:green;\">//&nbsp;folder&nbsp;name</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;.&quot;</span>&nbsp;+&nbsp;name&nbsp;+&nbsp;size&nbsp;<span style=\"color:green;\">//&nbsp;icon&nbsp;name</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;.png&quot;</span>;&nbsp;<span style=\"color:green;\">//&nbsp;filename&nbsp;extension</span>\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Load&nbsp;a&nbsp;new&nbsp;icon&nbsp;bitmap&nbsp;from&nbsp;embedded&nbsp;resources.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;For&nbsp;the&nbsp;BitmapImage,&nbsp;make&nbsp;sure&nbsp;you&nbsp;reference&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;WindowsBase&nbsp;and&nbsp;PresentationCore,&nbsp;and&nbsp;import&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;the&nbsp;System.Windows.Media.Imaging&nbsp;namespace.&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">BitmapImage</span>&nbsp;GetBitmapImage(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Assembly</span>&nbsp;a,\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;path&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;to&nbsp;read&nbsp;from&nbsp;an&nbsp;external&nbsp;file:</span>\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//return&nbsp;new&nbsp;BitmapImage(&nbsp;new&nbsp;Uri(</span>\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;&nbsp;Path.Combine(&nbsp;_imageFolder,&nbsp;imageName&nbsp;)&nbsp;)&nbsp;);</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>[]&nbsp;names&nbsp;=&nbsp;a.GetManifestResourceNames();\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Stream</span>&nbsp;s&nbsp;=&nbsp;a.GetManifestResourceStream(&nbsp;path&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Debug</span>.Assert(&nbsp;<span style=\"color:blue;\">null</span>&nbsp;!=&nbsp;s,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;expected&nbsp;valid&nbsp;icon&nbsp;resource&quot;</span>&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">BitmapImage</span>&nbsp;img&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">BitmapImage</span>();\n\n&nbsp;&nbsp;&nbsp;&nbsp;img.BeginInit();\n&nbsp;&nbsp;&nbsp;&nbsp;img.StreamSource&nbsp;=&nbsp;s;\n&nbsp;&nbsp;&nbsp;&nbsp;img.EndInit();\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;img;\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Create&nbsp;our&nbsp;custom&nbsp;ribbon&nbsp;panel&nbsp;and&nbsp;populate</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;it&nbsp;with&nbsp;our&nbsp;commands,&nbsp;saving&nbsp;the&nbsp;resulting</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;ribbon&nbsp;items&nbsp;for&nbsp;later&nbsp;access.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">void</span>&nbsp;AddRibbonPanel(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">UIControlledApplication</span>&nbsp;a&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>[]&nbsp;tooltip&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:blue;\">string</span>[]&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Create&nbsp;and&nbsp;bind&nbsp;shared&nbsp;parameter&nbsp;definition.&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Export&nbsp;shared&nbsp;parameter&nbsp;values&nbsp;one&nbsp;by&nbsp;one&nbsp;creating&nbsp;new&nbsp;and&nbsp;updating&nbsp;existing&nbsp;documents.&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Export&nbsp;shared&nbsp;parameter&nbsp;values&nbsp;in&nbsp;batch&nbsp;after&nbsp;deleting&nbsp;all&nbsp;existing&nbsp;project&nbsp;documents.&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Import&nbsp;shared&nbsp;parameter&nbsp;values.&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Subscribe&nbsp;to&nbsp;or&nbsp;unsubscribe&nbsp;from&nbsp;updates.&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;About&nbsp;&quot;</span>&nbsp;+&nbsp;Caption&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;:&nbsp;...&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;};\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>[]&nbsp;text&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:blue;\">string</span>[]&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Bind&nbsp;Shared&nbsp;Parameter&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Export&nbsp;one&nbsp;by&nbsp;one&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Export&nbsp;batch&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Import&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Subscribe&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;About...&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;};\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>[]&nbsp;classNameStem&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:blue;\">string</span>[]&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;1_CreateAndBindSharedParameter&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;2a_ExportSharedParameterValues&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;2b_ExportSharedParameterValuesBatch&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;3_ImportSharedParameterValues&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;4_Subscribe&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;0_About&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;};\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>[]&nbsp;iconName&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:blue;\">string</span>[]&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Knot&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;1Up&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;2Up&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;1Down&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;ZigZagRed&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Question&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;};\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">int</span>&nbsp;n&nbsp;=&nbsp;classNameStem.Length;\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Debug</span>.Assert(&nbsp;text.Length&nbsp;==&nbsp;n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;tooltip.Length&nbsp;==&nbsp;n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;iconName.Length&nbsp;==&nbsp;n,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;expected&nbsp;equal&nbsp;number&nbsp;of&nbsp;text&nbsp;and&nbsp;class&nbsp;name&nbsp;entries&quot;</span>&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Debug</span>.Assert(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text[_subscribeButtonIndex].Equals(&nbsp;_subscribe&nbsp;),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Did&nbsp;you&nbsp;set&nbsp;the&nbsp;correct&nbsp;_subscribeButtonIndex?&quot;</span>&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;_buttons&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">RibbonItem</span>[n];\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">RibbonPanel</span>&nbsp;panel\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;a.CreateRibbonPanel(&nbsp;Caption&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">SplitButtonData</span>&nbsp;splitBtnData\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">SplitButtonData</span>(&nbsp;Caption,&nbsp;Caption&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">SplitButton</span>&nbsp;splitBtn&nbsp;=&nbsp;panel.AddItem(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;splitBtnData&nbsp;)&nbsp;<span style=\"color:blue;\">as</span>&nbsp;<span style=\"color:#2b91af;\">SplitButton</span>;\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Assembly</span>&nbsp;asm&nbsp;=&nbsp;<span style=\"color:blue;\">typeof</span>(&nbsp;<span style=\"color:#2b91af;\">App</span>&nbsp;).Assembly;\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">for</span>(&nbsp;<span style=\"color:blue;\">int</span>&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;n;&nbsp;++i&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">PushButtonData</span>&nbsp;d&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">PushButtonData</span>(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classNameStem[i],&nbsp;text[i],&nbsp;_path,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_namespace&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;.&quot;</span>&nbsp;+&nbsp;_cmd_prefix\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;classNameStem[i]&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.ToolTip&nbsp;=&nbsp;tooltip[i];\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.Image&nbsp;=&nbsp;GetBitmapImage(&nbsp;asm,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IconResourcePath(&nbsp;iconName[i],&nbsp;<span style=\"color:#a31515;\">&quot;16&quot;</span>&nbsp;)&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.LargeImage&nbsp;=&nbsp;GetBitmapImage(&nbsp;asm,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IconResourcePath(&nbsp;iconName[i],&nbsp;<span style=\"color:#a31515;\">&quot;32&quot;</span>&nbsp;)&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.ToolTipImage&nbsp;=&nbsp;GetBitmapImage(&nbsp;asm,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IconResourcePath(&nbsp;iconName[i],&nbsp;<span style=\"color:#a31515;\">&quot;&quot;</span>&nbsp;)&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_buttons[i]&nbsp;=&nbsp;splitBtn.AddPushButton(&nbsp;d&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n&nbsp;&nbsp;<span style=\"color:gray;\">#endregion</span>&nbsp;<span style=\"color:green;\">//&nbsp;Icon&nbsp;resource,&nbsp;bitmap&nbsp;image&nbsp;and&nbsp;ribbon&nbsp;panel&nbsp;stuff</span>\n\n&nbsp;&nbsp;<span style=\"color:gray;\">#region</span>&nbsp;External&nbsp;event&nbsp;subscription&nbsp;and&nbsp;handling\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Are&nbsp;we&nbsp;currently&nbsp;subscribed&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;to&nbsp;automatic&nbsp;cloud&nbsp;updates?</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">bool</span>&nbsp;Subscribed\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">get</span>\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">bool</span>&nbsp;rc&nbsp;=&nbsp;_buttons[_subscribeButtonIndex]\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.ItemText.Equals(&nbsp;_unsubscribe&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Debug</span>.Assert(&nbsp;(&nbsp;_event&nbsp;!=&nbsp;<span style=\"color:blue;\">null</span>&nbsp;)&nbsp;==&nbsp;rc,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;expected&nbsp;synchronised&nbsp;handler&nbsp;and&nbsp;button&nbsp;text&quot;</span>&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;rc;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Toggle&nbsp;on&nbsp;and&nbsp;off&nbsp;subscription&nbsp;to&nbsp;automatic&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;cloud&nbsp;updates.&nbsp;Return&nbsp;true&nbsp;when&nbsp;subscribed.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">bool</span>&nbsp;ToggleSubscription2(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">IExternalEventHandler</span>&nbsp;handler&nbsp;)&nbsp;\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;Subscribed&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.Log(&nbsp;<span style=\"color:#a31515;\">&quot;Unsubscribing...&quot;</span>&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_event.Dispose();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_event&nbsp;=&nbsp;<span style=\"color:blue;\">null</span>;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_buttons[_subscribeButtonIndex].ItemText&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;_subscribe;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//_timer.Stop();</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//_timer.Report(&nbsp;&quot;Subscription&nbsp;timing&quot;&nbsp;);</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//_timer&nbsp;=&nbsp;null;</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.Log(&nbsp;<span style=\"color:#a31515;\">&quot;Unsubscribed.&quot;</span>&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">else</span>\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.Log(&nbsp;<span style=\"color:#a31515;\">&quot;Subscribing...&quot;</span>&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_event&nbsp;=&nbsp;<span style=\"color:#2b91af;\">ExternalEvent</span>.Create(&nbsp;handler&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_buttons[_subscribeButtonIndex].ItemText&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;_unsubscribe;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//_timer&nbsp;=&nbsp;new&nbsp;JtTimer(&nbsp;&quot;Subscription&quot;&nbsp;);</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.Log(&nbsp;<span style=\"color:#a31515;\">&quot;Subscribed.&quot;</span>&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:blue;\">null</span>&nbsp;!=&nbsp;_event;\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Provide&nbsp;public&nbsp;read-only&nbsp;access&nbsp;to&nbsp;external&nbsp;event.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">ExternalEvent</span>&nbsp;Event\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">get</span>&nbsp;{&nbsp;<span style=\"color:blue;\">return</span>&nbsp;_event;&nbsp;}\n&nbsp;&nbsp;}\n&nbsp;&nbsp;<span style=\"color:gray;\">#endregion</span>&nbsp;<span style=\"color:green;\">//&nbsp;External&nbsp;event&nbsp;subscription&nbsp;and&nbsp;handling</span>\n\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:#2b91af;\">Result</span>&nbsp;OnStartup(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">UIControlledApplication</span>&nbsp;a&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;AddRibbonPanel(&nbsp;a&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:#2b91af;\">Result</span>.Succeeded;\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:#2b91af;\">Result</span>&nbsp;OnShutdown(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">UIControlledApplication</span>&nbsp;a&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;Subscribed&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_event.Dispose();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_event&nbsp;=&nbsp;<span style=\"color:blue;\">null</span>;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:#2b91af;\">Result</span>.Succeeded;\n&nbsp;&nbsp;}\n}\n</pre>"
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"5.2\"></a>BimUpdater.cs",
    "local_header_href": "#a-name52abimupdatercs",
    "chunk_text": "#### <a name=\"5.2\"></a>BimUpdater.cs\n\nImplements the external event and the method updating the Revit shared parameters:\n\n<pre class=\"code\">\n<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;BIM&nbsp;updater,&nbsp;driven&nbsp;both&nbsp;via&nbsp;external&nbsp;</span>\n<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;command&nbsp;and&nbsp;external&nbsp;event&nbsp;handler.</span>\n<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n<span style=\"color:blue;\">class</span>&nbsp;<span style=\"color:#2b91af;\">BimUpdater</span>&nbsp;:&nbsp;<span style=\"color:#2b91af;\">IExternalEventHandler</span>\n{\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Update&nbsp;the&nbsp;BIM&nbsp;with&nbsp;the&nbsp;given&nbsp;database&nbsp;records.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">bool</span>&nbsp;UpdateBim(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Document</span>&nbsp;doc,\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">List</span>&lt;FireRating.<span style=\"color:#2b91af;\">DoorData</span>&gt;&nbsp;doors,\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">ref</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;error_message&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Guid</span>&nbsp;paramGuid;\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>&nbsp;(&nbsp;!<span style=\"color:#2b91af;\">Util</span>.GetSharedParamGuid(&nbsp;doc.Application,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">out</span>&nbsp;paramGuid&nbsp;)&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_message&nbsp;=&nbsp;<span style=\"color:#a31515;\">&quot;Shared&nbsp;parameter&nbsp;GUID&nbsp;not&nbsp;found.&quot;</span>;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:blue;\">false</span>;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Stopwatch</span>&nbsp;stopwatch&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">Stopwatch</span>();\n&nbsp;&nbsp;&nbsp;&nbsp;stopwatch.Start();\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;doors&nbsp;and&nbsp;update&nbsp;&nbsp;&nbsp;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;their&nbsp;firerating&nbsp;parameter&nbsp;values.</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>&nbsp;(&nbsp;<span style=\"color:blue;\">null</span>&nbsp;!=&nbsp;doors&nbsp;&amp;&amp;&nbsp;0&nbsp;&lt;&nbsp;doors.Count&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">using</span>&nbsp;(&nbsp;<span style=\"color:#2b91af;\">Transaction</span>&nbsp;t&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">Transaction</span>(&nbsp;doc&nbsp;)&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Start(&nbsp;<span style=\"color:#a31515;\">&quot;Import&nbsp;Fire&nbsp;Rating&nbsp;Values&quot;</span>&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Retrieve&nbsp;element&nbsp;unique&nbsp;id&nbsp;and&nbsp;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;FireRating&nbsp;parameter&nbsp;values.</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">foreach</span>&nbsp;(&nbsp;FireRating.<span style=\"color:#2b91af;\">DoorData</span>&nbsp;d&nbsp;<span style=\"color:blue;\">in</span>&nbsp;doors&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;uid&nbsp;=&nbsp;d._id;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Element</span>&nbsp;e&nbsp;=&nbsp;doc.GetElement(&nbsp;uid&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>&nbsp;(&nbsp;<span style=\"color:blue;\">null</span>&nbsp;==&nbsp;e&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_message&nbsp;=&nbsp;<span style=\"color:blue;\">string</span>.Format(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Error&nbsp;retrieving&nbsp;element&nbsp;for&nbsp;&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;unique&nbsp;id&nbsp;{0}.&quot;</span>,&nbsp;uid&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:blue;\">false</span>;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Parameter</span>&nbsp;p&nbsp;=&nbsp;e.get_Parameter(&nbsp;paramGuid&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>&nbsp;(&nbsp;<span style=\"color:blue;\">null</span>&nbsp;==&nbsp;p&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_message&nbsp;=&nbsp;<span style=\"color:blue;\">string</span>.Format(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Error&nbsp;retrieving&nbsp;shared&nbsp;parameter&nbsp;on&nbsp;&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;&nbsp;element&nbsp;with&nbsp;unique&nbsp;id&nbsp;{0}.&quot;</span>,&nbsp;uid&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:blue;\">false</span>;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">object</span>&nbsp;fire_rating&nbsp;=&nbsp;d.firerating;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.Set(&nbsp;(<span style=\"color:blue;\">double</span>)&nbsp;fire_rating&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;e.get_Parameter(&nbsp;<span style=\"color:#2b91af;\">DoorData</span>.BipMark&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>&nbsp;(&nbsp;<span style=\"color:blue;\">null</span>&nbsp;==&nbsp;p&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_message&nbsp;=&nbsp;<span style=\"color:blue;\">string</span>.Format(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Error&nbsp;retrieving&nbsp;ALL_MODEL_MARK&nbsp;&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;built-in&nbsp;parameter&nbsp;on&nbsp;element&nbsp;with&nbsp;&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;unique&nbsp;id&nbsp;{0}.&quot;</span>,&nbsp;uid&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:blue;\">false</span>;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.Set(&nbsp;(<span style=\"color:blue;\">string</span>)&nbsp;d.tag&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Commit();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;stopwatch.Stop();\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.Log(&nbsp;<span style=\"color:blue;\">string</span>.Format(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;{0}&nbsp;milliseconds&nbsp;to&nbsp;import&nbsp;{1}&nbsp;element{2}.&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stopwatch.ElapsedMilliseconds,&nbsp;doors.Count,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.PluralSuffix(&nbsp;doors.Count)&nbsp;)&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:blue;\">true</span>;\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Execute&nbsp;method&nbsp;invoked&nbsp;by&nbsp;Revit&nbsp;via&nbsp;the&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;external&nbsp;event&nbsp;as&nbsp;a&nbsp;reaction&nbsp;to&nbsp;a&nbsp;call&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;to&nbsp;its&nbsp;Raise&nbsp;method.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">void</span>&nbsp;Execute(&nbsp;<span style=\"color:#2b91af;\">UIApplication</span>&nbsp;a&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">uint</span>&nbsp;timestamp_before_bim_update&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style=\"color:#2b91af;\">Util</span>.UnixTimestamp();\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Document</span>&nbsp;doc&nbsp;=&nbsp;a.ActiveUIDocument.Document;\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Debug</span>.Assert(&nbsp;<span style=\"color:#2b91af;\">Util</span>.GetProjectIdentifier(&nbsp;doc&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Equals(&nbsp;<span style=\"color:#2b91af;\">DbAccessor</span>.ProjectId&nbsp;),&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;expected&nbsp;same&nbsp;project&quot;</span>&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;error_message&nbsp;=&nbsp;<span style=\"color:blue;\">null</span>;\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">bool</span>&nbsp;rc&nbsp;=&nbsp;UpdateBim(&nbsp;doc,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">DbAccessor</span>.ModifiedDoors,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">ref</span>&nbsp;error_message&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;rc&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">DbAccessor</span>.Timestamp&nbsp;=&nbsp;timestamp_before_bim_update;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">else</span>\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">throw</span>&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">SystemException</span>(&nbsp;error_message&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Required&nbsp;IExternalEventHandler&nbsp;interface&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;method&nbsp;returning&nbsp;a&nbsp;descriptive&nbsp;name.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;GetName()\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:#2b91af;\">App</span>.Caption&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;&nbsp;&quot;</span>&nbsp;+&nbsp;GetType().Name;\n&nbsp;&nbsp;}\n}\n</pre>"
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"5.3\"></a>Cmd_4_Subscribe.cs",
    "local_header_href": "#a-name53acmd_4_subscribecs",
    "chunk_text": "#### <a name=\"5.3\"></a>Cmd_4_Subscribe.cs\n\nImplements the new subscription external command:\n\n<pre class=\"code\">\n[<span style=\"color:#2b91af;\">Transaction</span>(&nbsp;<span style=\"color:#2b91af;\">TransactionMode</span>.ReadOnly&nbsp;)]\n<span style=\"color:blue;\">class</span>&nbsp;<span style=\"color:#2b91af;\">Cmd_4_Subscribe</span>&nbsp;:&nbsp;<span style=\"color:#2b91af;\">IExternalCommand</span>\n{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:#2b91af;\">Result</span>&nbsp;Execute(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">ExternalCommandData</span>&nbsp;commandData,\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">ref</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;message,\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">ElementSet</span>&nbsp;elements&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">UIApplication</span>&nbsp;uiapp&nbsp;=&nbsp;commandData.Application;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Document</span>&nbsp;doc&nbsp;=&nbsp;uiapp.ActiveUIDocument.Document;\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Determine&nbsp;custom&nbsp;project&nbsp;identifier.</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;project_id&nbsp;=&nbsp;<span style=\"color:#2b91af;\">Util</span>.GetProjectIdentifier(&nbsp;doc&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>&nbsp;(&nbsp;!<span style=\"color:#2b91af;\">App</span>.Subscribed&nbsp;&amp;&amp;&nbsp;0&nbsp;==&nbsp;<span style=\"color:#2b91af;\">DbAccessor</span>.Timestamp&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">DbAccessor</span>.Init(&nbsp;project_id&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">DbAccessor</span>.ToggleSubscription(&nbsp;uiapp&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:#2b91af;\">Result</span>.Succeeded;\n&nbsp;&nbsp;}\n}\n</pre>"
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"5.4\"></a>DbAccessor.cs",
    "local_header_href": "#a-name54adbaccessorcs",
    "chunk_text": "#### <a name=\"5.4\"></a>DbAccessor.cs\n\nImplements the database polling loop in a separate thread and raises the external event when external modifications are detected:\n\n<pre class=\"code\">\n<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Read&nbsp;records&nbsp;from&nbsp;the&nbsp;database,&nbsp;optionally&nbsp;filtering&nbsp;</span>\n<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;according&nbsp;to&nbsp;the&nbsp;modified&nbsp;timestamp,&nbsp;and&nbsp;manage&nbsp;the&nbsp;</span>\n<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;separate&nbsp;thread&nbsp;running&nbsp;the&nbsp;database&nbsp;polling&nbsp;loop&nbsp;</span>\n<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;for&nbsp;the&nbsp;subscription&nbsp;command.</span>\n<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n<span style=\"color:blue;\">class</span>&nbsp;<span style=\"color:#2b91af;\">DbAccessor</span>\n{\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Current&nbsp;document&nbsp;project&nbsp;id.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Todo:&nbsp;update&nbsp;this&nbsp;when&nbsp;switching&nbsp;Revit&nbsp;documents.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;_project_id&nbsp;=&nbsp;<span style=\"color:blue;\">null</span>;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Return&nbsp;the&nbsp;current&nbsp;Revit&nbsp;project&nbsp;id.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;ProjectId\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">get</span>\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;_project_id;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;For&nbsp;subscription&nbsp;to&nbsp;automatic&nbsp;BIM&nbsp;updates,</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;retrieve&nbsp;database&nbsp;records&nbsp;modified&nbsp;after&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;this&nbsp;timestamp.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">uint</span>&nbsp;Timestamp\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">get</span>;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">set</span>;\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Initialise&nbsp;project&nbsp;id&nbsp;and&nbsp;set&nbsp;the&nbsp;timestamp&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;to&nbsp;start&nbsp;polling&nbsp;for&nbsp;database&nbsp;updates.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">uint</span>&nbsp;Init(&nbsp;<span style=\"color:blue;\">string</span>&nbsp;project_id&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;_project_id&nbsp;=&nbsp;project_id;\n\n&nbsp;&nbsp;&nbsp;&nbsp;Timestamp&nbsp;=&nbsp;<span style=\"color:#2b91af;\">Util</span>.UnixTimestamp();\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.InfoMsg(&nbsp;<span style=\"color:blue;\">string</span>.Format(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Timestamp&nbsp;set&nbsp;to&nbsp;{0}.&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;\\nChanges&nbsp;from&nbsp;now&nbsp;on&nbsp;will&nbsp;be&nbsp;retrieved.&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Timestamp&nbsp;)&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;Timestamp;\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Store&nbsp;the&nbsp;modified&nbsp;door&nbsp;records&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;retrieved&nbsp;from&nbsp;the&nbsp;database.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">List</span>&lt;FireRating.<span style=\"color:#2b91af;\">DoorData</span>&gt;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;_modified_door_records&nbsp;=&nbsp;<span style=\"color:blue;\">null</span>;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Return&nbsp;the&nbsp;current&nbsp;modified&nbsp;door&nbsp;records&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;retrieved&nbsp;from&nbsp;the&nbsp;cloud&nbsp;database.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">List</span>&lt;FireRating.<span style=\"color:#2b91af;\">DoorData</span>&gt;&nbsp;ModifiedDoors\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">get</span>\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;_modified_door_records;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Retrieve&nbsp;all&nbsp;door&nbsp;documents&nbsp;for&nbsp;the&nbsp;specified&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Revit&nbsp;project&nbsp;identifier,&nbsp;optionally&nbsp;filtering&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;for&nbsp;documents&nbsp;modified&nbsp;after&nbsp;the&nbsp;specified&nbsp;timestamp.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">List</span>&lt;FireRating.<span style=\"color:#2b91af;\">DoorData</span>&gt;&nbsp;GetDoorRecords(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;project_id,\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">uint</span>&nbsp;timestamp&nbsp;=&nbsp;0&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Get&nbsp;all&nbsp;doors&nbsp;referencing&nbsp;this&nbsp;project.</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;query&nbsp;=&nbsp;<span style=\"color:#a31515;\">&quot;doors/project/&quot;</span>&nbsp;+&nbsp;project_id;\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>&nbsp;(&nbsp;0&nbsp;&lt;&nbsp;timestamp&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Add&nbsp;timestamp&nbsp;to&nbsp;query.</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.Log(&nbsp;<span style=\"color:blue;\">string</span>.Format(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;Retrieving&nbsp;door&nbsp;documents&nbsp;modified&nbsp;after&nbsp;{0}&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timestamp&nbsp;)&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query&nbsp;+=&nbsp;<span style=\"color:#a31515;\">&quot;/newer/&quot;</span>&nbsp;+&nbsp;timestamp.ToString();\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:#2b91af;\">Util</span>.Get(&nbsp;query&nbsp;);\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Count&nbsp;total&nbsp;number&nbsp;of&nbsp;checks&nbsp;for</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;database&nbsp;updates&nbsp;made&nbsp;so&nbsp;far.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">int</span>&nbsp;_nLoopCount&nbsp;=&nbsp;0;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Count&nbsp;total&nbsp;number&nbsp;of&nbsp;checks&nbsp;for</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;database&nbsp;updates&nbsp;made&nbsp;so&nbsp;far.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">int</span>&nbsp;_nCheckCount&nbsp;=&nbsp;0;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Count&nbsp;total&nbsp;number&nbsp;of&nbsp;database&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;updates&nbsp;requested&nbsp;so&nbsp;far.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">int</span>&nbsp;_nUpdatesRequested&nbsp;=&nbsp;0;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Number&nbsp;of&nbsp;milliseconds&nbsp;to&nbsp;wait&nbsp;and&nbsp;relinquish</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;CPU&nbsp;control&nbsp;before&nbsp;next&nbsp;check&nbsp;for&nbsp;pending</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;database&nbsp;updates.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">int</span>&nbsp;_timeout&nbsp;=&nbsp;500;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">#region</span>&nbsp;Windows&nbsp;API&nbsp;DLL&nbsp;Imports\n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;DLL&nbsp;imports&nbsp;from&nbsp;user32.dll&nbsp;to&nbsp;set&nbsp;focus&nbsp;to</span>\n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Revit&nbsp;to&nbsp;force&nbsp;it&nbsp;to&nbsp;forward&nbsp;the&nbsp;external&nbsp;event</span>\n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Raise&nbsp;to&nbsp;actually&nbsp;call&nbsp;the&nbsp;external&nbsp;event&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Execute.</span>\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;The&nbsp;GetForegroundWindow&nbsp;function&nbsp;returns&nbsp;a&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;handle&nbsp;to&nbsp;the&nbsp;foreground&nbsp;window.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;[<span style=\"color:#2b91af;\">DllImport</span>(&nbsp;<span style=\"color:#a31515;\">&quot;user32.dll&quot;</span>&nbsp;)]\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">extern</span>&nbsp;<span style=\"color:#2b91af;\">IntPtr</span>&nbsp;GetForegroundWindow();\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Move&nbsp;the&nbsp;window&nbsp;associated&nbsp;with&nbsp;the&nbsp;passed&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;handle&nbsp;to&nbsp;the&nbsp;front.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;[<span style=\"color:#2b91af;\">DllImport</span>(&nbsp;<span style=\"color:#a31515;\">&quot;user32.dll&quot;</span>&nbsp;)]\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">extern</span>&nbsp;<span style=\"color:blue;\">bool</span>&nbsp;SetForegroundWindow(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">IntPtr</span>&nbsp;hWnd&nbsp;);\n&nbsp;&nbsp;<span style=\"color:gray;\">#endregion</span>&nbsp;<span style=\"color:green;\">//&nbsp;Windows&nbsp;API&nbsp;DLL&nbsp;Imports</span>\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;This&nbsp;method&nbsp;runs&nbsp;in&nbsp;a&nbsp;separate&nbsp;thread&nbsp;and</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;continuously&nbsp;polls&nbsp;the&nbsp;database&nbsp;for&nbsp;modified</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;records.&nbsp;If&nbsp;any&nbsp;are&nbsp;detected,&nbsp;raise&nbsp;an&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;external&nbsp;event&nbsp;to&nbsp;update&nbsp;the&nbsp;BIM.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Relinquish&nbsp;control&nbsp;and&nbsp;wait&nbsp;for&nbsp;the&nbsp;specified</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;timeout&nbsp;period&nbsp;between&nbsp;each&nbsp;attempt.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">void</span>&nbsp;CheckForPendingDatabaseChanges()\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">while</span>&nbsp;(&nbsp;<span style=\"color:blue;\">null</span>&nbsp;!=&nbsp;<span style=\"color:#2b91af;\">App</span>.Event&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++_nLoopCount;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>&nbsp;(&nbsp;<span style=\"color:#2b91af;\">App</span>.Event.IsPending&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.Log(&nbsp;<span style=\"color:blue;\">string</span>.Format(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;CheckForPendingDatabaseChanges&nbsp;loop&nbsp;{0}&nbsp;-&nbsp;&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;database&nbsp;update&nbsp;event&nbsp;is&nbsp;pending&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_nLoopCount&nbsp;)&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">else</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//using(&nbsp;JtTimer&nbsp;pt&nbsp;=&nbsp;new&nbsp;JtTimer(</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;&nbsp;&quot;CheckForPendingDatabaseChanges&quot;&nbsp;)&nbsp;)</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++_nCheckCount;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.Log(&nbsp;<span style=\"color:blue;\">string</span>.Format(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;CheckForPendingDatabaseChanges&nbsp;loop&nbsp;{0}&nbsp;-&nbsp;&quot;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style=\"color:#a31515;\">&quot;check&nbsp;for&nbsp;changes&nbsp;{1}&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_nLoopCount,&nbsp;_nCheckCount&nbsp;)&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_modified_door_records&nbsp;=&nbsp;GetDoorRecords(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_project_id,&nbsp;Timestamp&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>&nbsp;(&nbsp;<span style=\"color:blue;\">null</span>&nbsp;!=&nbsp;_modified_door_records&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;0&nbsp;&lt;&nbsp;_modified_door_records.Count&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">App</span>.Event.Raise();\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++_nUpdatesRequested;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Util</span>.Log(&nbsp;<span style=\"color:blue;\">string</span>.Format(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;database&nbsp;update&nbsp;pending&nbsp;event&nbsp;raised&nbsp;{0}&nbsp;times&quot;</span>,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_nUpdatesRequested&nbsp;)&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Set&nbsp;focus&nbsp;to&nbsp;Revit&nbsp;for&nbsp;a&nbsp;moment.</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Otherwise,&nbsp;it&nbsp;may&nbsp;take&nbsp;a&nbsp;while&nbsp;before&nbsp;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Revit&nbsp;reacts&nbsp;to&nbsp;the&nbsp;raised&nbsp;event&nbsp;and</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;actually&nbsp;calls&nbsp;the&nbsp;event&nbsp;handler&nbsp;Execute&nbsp;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;method.</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">IntPtr</span>&nbsp;hBefore&nbsp;=&nbsp;GetForegroundWindow();\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetForegroundWindow(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">ComponentManager</span>.ApplicationWindow&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetForegroundWindow(&nbsp;hBefore&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Wait&nbsp;and&nbsp;relinquish&nbsp;control&nbsp;before</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;next&nbsp;check&nbsp;for&nbsp;pending&nbsp;database&nbsp;updates.</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Thread</span>.Sleep(&nbsp;_timeout&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Separate&nbsp;thread&nbsp;running&nbsp;the&nbsp;loop</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;polling&nbsp;for&nbsp;pending&nbsp;database&nbsp;changes.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:#2b91af;\">Thread</span>&nbsp;_thread&nbsp;=&nbsp;<span style=\"color:blue;\">null</span>;\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Toggle&nbsp;subscription&nbsp;to&nbsp;automatic&nbsp;database&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;updates.&nbsp;Forward&nbsp;the&nbsp;call&nbsp;to&nbsp;the&nbsp;external&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;application&nbsp;that&nbsp;creates&nbsp;the&nbsp;external&nbsp;event,</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;store&nbsp;it&nbsp;and&nbsp;launch&nbsp;a&nbsp;separate&nbsp;thread&nbsp;checking&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;for&nbsp;database&nbsp;updates.&nbsp;When&nbsp;changes&nbsp;are&nbsp;pending,</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;invoke&nbsp;the&nbsp;external&nbsp;event&nbsp;Raise&nbsp;method.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">static</span>&nbsp;<span style=\"color:blue;\">void</span>&nbsp;ToggleSubscription(\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">UIApplication</span>&nbsp;uiapp&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Todo:&nbsp;stop&nbsp;thread&nbsp;first!</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>&nbsp;(&nbsp;<span style=\"color:#2b91af;\">App</span>.ToggleSubscription2(&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">BimUpdater</span>()&nbsp;)&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Start&nbsp;a&nbsp;new&nbsp;thread&nbsp;to&nbsp;regularly&nbsp;check&nbsp;the</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;database&nbsp;status&nbsp;and&nbsp;raise&nbsp;the&nbsp;external&nbsp;event</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;when&nbsp;updates&nbsp;are&nbsp;pending.</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_thread&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">Thread</span>(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CheckForPendingDatabaseChanges&nbsp;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_thread.Start();\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">else</span>\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_thread.Abort();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_thread&nbsp;=&nbsp;<span style=\"color:blue;\">null</span>;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n}\n</pre>"
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"9\"></a>FireRatingCloud Video Recording",
    "local_header_href": "#a-name9afireratingcloud-video-recording",
    "chunk_text": "#### <a name=\"9\"></a>FireRatingCloud Video Recording\n\nHere is an eight and a half minute recording demonstrating the final result, [FireRatingCloud up and running in Revit 2017](https://youtu.be/8VsQJkikXbA):\n\n<center>\n<iframe width=\"420\" height=\"315\" src=\"https://www.youtube.com/embed/8VsQJkikXbA?rel=0\" frameborder=\"0\" allowfullscreen></iframe>\n</center>"
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"10\"></a>Download",
    "local_header_href": "#a-name10adownload",
    "chunk_text": "#### <a name=\"10\"></a>Download\n\nThe version presented above\nis [release 2017.0.0.12](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.12),\navailable from the [FireRatingCloud GitHub repository](https://github.com/jeremytammik/FireRatingCloud)."
  },
  {
    "original_filename": "1431_firerating_2017",
    "header_text": "<a name=\"11\"></a>To Do",
    "local_header_href": "#a-name11ato-do",
    "chunk_text": "#### <a name=\"11\"></a>To Do\n\nAs already mentioned above, I have several more exciting tasks lined up, all related to connecting BIM and the cloud:\n\n- Document and improve [FireRatingClient](https://github.com/jeremytammik/FireRatingCloud/tree/master/FireRatingClient),\nthe stand-alone Windows client &ndash; we will need this to demonstrate the real-time BIM update from arbitrary sources more elegantly than I did above using the minimalistic and rudimentary mongolab web site.\n- Completely rewrite the existing [RoomEditorApp](https://github.com/jeremytammik/RoomEditorApp) sample to move it from CouchDB to node.js plus MongoDB.\n- Implement the database portion of the [TrackChangesCloud](https://github.com/jeremytammik/TrackChangesCloud) sample.\n\nStay tuned and wish me luck.\n\nAnd lots of extra time &ndash; I could use a lot more than 24 hours per day, man.\n\nWell, who couldn't?"
  }
]