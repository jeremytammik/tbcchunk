[
  {
    "original_filename": "2018_topo_mat_came_targ",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\n- Toposolid\n  https://autodesk.slack.com/archives/C0SR6NAP8/p1700155564738649\n  The creation of the type is based on this thread: https://autodesk.slack.com/archives/C0SR6NAP8/p1673638599787309\n\n- Camera Target\n  https://autodesk.slack.com/archives/C0SR6NAP8/p1700492804688869\n  Jeff Hotchkiss\n  I'm looking to convert Revit views for transfer into cloud REST API calls e.g. into LMV. Looking over supplied Revit help on the subject, I've found most of what I need but I'm curious if there's any way in API to retrieve the view camera target point as listed in that documentation? The docs suggest that the target can be reset to the fov centre, but not how to get the existing value, or whether the value has any significance to Revit e.g. orbit point. Thanks in advance for any assistance. (edited)\n  Alex Pytel\n\ntwitter:\n\nImplement a Chromium browser in your add-in WPF control using the built-in @AutodeskRevit CefSharp, and setting the Toposolid subdivision material and camera target using the #RevitAPI @AutodeskAPS  #BIM @DynamoBIM https://autode.sk/toposubdivmaterial\n\nA quick look at CefSharp and conversations shedding light on Toposolids and camera settings\n&ndash; Using the built-in CefSharp browser\n&ndash; Toposolid subdivision material\n&ndash; Camera target...\n\nlinkedin:\n\nImplement a Chromium browser in your add-in WPF control using the built-in Revit CefSharp, and setting the Toposolid subdivision material and camera target using the #RevitAPI\n\nhttps://autode.sk/toposubdivmaterial\n\n- Using the built-in CefSharp browser\n- Toposolid subdivision material\n- Camera target...\n\n#BIM #DynamoBIM #AutodeskAPS #Revit #API #IFC #SDK #Autodesk #AEC #adsk\n\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\n\n<center>\n<img src=\"img/\" alt=\"\" title=\"\" width=\"600\"/>\n<p style=\"font-size: 80%; font-style:italic\"></p>\n</center>\n\n-->"
  },
  {
    "original_filename": "2018_topo_mat_came_targ",
    "header_text": "Camera Target and Toposolid Subdivision Material",
    "local_header_href": "#camera-target-and-toposolid-subdivision-material",
    "chunk_text": "### Camera Target and Toposolid Subdivision Material\n\nToday, let's take a quick look at CefSharp and two conversations shedding light on specific aspects of Toposolids and camera settings:\n\n- [Using the built-in CefSharp browser](#2)\n- [Toposolid subdivision material](#3)\n- [Camera target](#4)"
  },
  {
    "original_filename": "2018_topo_mat_came_targ",
    "header_text": "Using the Built-In CefSharp Browser",
    "local_header_href": "#2",
    "chunk_text": "####<a name=\"2\"></a> Using the Built-In CefSharp Browser\n\nAndrej Licanin of [Bimexperts](https://bimexperts.com/sr/home) shared\na nice succinct little solution demonstrating how to use the Revit built-in CefSharp installation to display a browser in a WPF control in\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\non [simple WPF with a chromium browser guide](https://forums.autodesk.com/t5/revit-api-forum/simple-wpf-with-a-chromium-browser-guide/td-p/12396552):\n\n> This is for all the lost souls out there, may you avoid my suffering.\n\n> To create a chromium web browser in your Revit addin, you need to reference cefsharp dlls.\nThis is where I had a major hiccup, because I just installed the newest one by nuget.\nDon't do this.\nRevit already has them and it initializes them on start-up.\nYou just need to add references to them like the other Revit API .dlls.\nThey are in the CefSharp folder.\nFor me, that is *C:\\Program Files\\Autodesk\\Revit 2022\\CefSharp*,\nand the files are:\n\n> - CefSharp\n- CefSharp.BrowserSubprocess.Core\n- CefSharp.Core\n- CefSharp.Wpf\n\nOnce installed, you can just add a WPF window, reference the namespace and embed a chromium browser like this:\n\n<pre class=\"prettyprint\">\n&lt;Window x:Class=\"RevitTestProject.TestWindow\"\n  xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n  xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n  xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n  xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n  xmlns:local=\"clr-namespace:RevitTestProject\"\n  xmlns:cef=\"clr-namespace:CefSharp.Wpf;assembly=CefSharp.Wpf\"\n  mc:Ignorable=\"d\"\n  Width=\"1000\" Height=\"500\"&gt;\n  &lt;Grid Background=\"PapayaWhip\"&gt;\n    &lt;cef:ChromiumWebBrowser Name=\"ChromiumBrowser\"\n      Address=\"http://www.google.com\"\n      Width=\"900\" Height=\"450\"/&gt;\n  &lt;/Grid&gt;\n&lt;/Window&gt;\n</pre>\n\nHope this helps someone, as I lost an entire day figuring this out.\n\nThank you very much, Andrej!"
  },
  {
    "original_filename": "2018_topo_mat_came_targ",
    "header_text": "Toposolid Subdivision Material",
    "local_header_href": "#3",
    "chunk_text": "####<a name=\"3\"></a> Toposolid Subdivision Material\n\nA Toposolid subdivision material can be set using a specific built-in parameter to hold the material id:\n\n**Question:**\nIn Revit 2024, I'm creating a Toposolid using a ToposolidType that has a finish layer with a texture in the material.\nI then use Toposolid.CreateSubDivision to create a subdivision in the toposolid, but this subdivision is not inheriting the material from the hosting toposolid.\nAny ideas what I need to do to get the material to show properly?\nIs there a way to set the material for the top face of a Toposolid?\n\n<center>\n<img src=\"img/toposolid_subdiv_mat_1.png\" alt=\"Toposolid subdivision material\" title=\"Toposolid subdivision material\" width=\"600\"/>\n<p/>\n<img src=\"img/toposolid_subdiv_mat_2.png\" alt=\"Toposolid subdivision material\" title=\"Toposolid subdivision material\" width=\"600\"/>\n</center>\n\nThe brown areas are the subdivisions.\n\n**Answer:** The subdivision is designed NOT to inherit materials from the host toposolid.\nAlso, \"Edit Type\" is not enabled in the UI.\nAs an alternative, could you try to change the material Id of the subdivision element and see if that works?\n\n**Response:** Toposolid does not have a MaterialID.\nThat's why I had to bake the material into the ToposolidType.\n\n**Answer:** The subdivision has a `BuiltInParameter` `TOPOSOLID_SUBDIVIDE_MATERIAL` to control the material.\nIt can only be set to one material id.\nI did a quick example.\nPlease check out the following code for reference:\n\n<pre class=\"prettyprint\">\n  [Transaction(TransactionMode.Manual)]\n  public class ChangeSubdivisionMaterial : IExternalCommand\n  {\n    public Result Execute(ExternalCommandData commandData, ref string message, ElementSet elements)\n    {\n      var uidoc = commandData.Application.ActiveUIDocument;\n      var doc = uidoc.Document;\n      var sel = uidoc.Selection;\n\n      Toposolid topo = doc.GetElement(sel.PickObject(\n        ObjectType.Element, new ToposolidFilter())) as Toposolid;\n      ToposolidType topoType = doc.GetElement(topo.GetTypeId()) as ToposolidType;\n      ElementId materialId = topoType.GetCompoundStructure().GetLayers().First().MaterialId;\n\n      List&lt;Toposolid&gt; subdivisions = new FilteredElementCollector(doc)\n        .OfClass(typeof(Toposolid))\n        .OfType&lt;Toposolid&gt;()\n        .Where(t =&gt; t.HostTopoId == topo.Id)\n        .ToList();\n      Transaction trans = new Transaction(doc, \"change material\");\n      trans.Start();\n      subdivisions.ForEach(t =&gt; t.get_Parameter(\n        BuiltInParameter.TOPOSOLID_SUBDIVIDE_MATERIAL)\n          .Set(materialId));\n      trans.Commit();\n\n      return Result.Succeeded;\n    }\n  }\n</pre>\n\n<center>\n<img src=\"img/toposolid_subdiv_mat_3.gif\" alt=\"Toposolid subdivision material\" title=\"Toposolid subdivision material\" width=\"600\"/>\n</center>\n\nThanks to Greg Marr and Yueqiang Ni for this explanation."
  },
  {
    "original_filename": "2018_topo_mat_came_targ",
    "header_text": "Camera Target",
    "local_header_href": "#4",
    "chunk_text": "####<a name=\"4\"></a> Camera Target\n\nThe Revit API does not care much about the camera target, but other environments do:\n\n**Question:**\nI'm looking to convert Revit views for transfer into cloud REST API calls e.g. into LMV.\nLooking over supplied Revit help on the subject, I've found most of what I need but I'm curious if there's any way in API to retrieve the view camera target point as listed in that documentation?\nThe docs suggest that the target can be reset to the FOV centre, but not how to get the existing value, or whether the value has any significance to Revit e.g. orbit point.\n\nI looked at some existing related articles, e.g.:\n\n- [Custom Exporter GetCameraInfo](http://thebuildingcoder.typepad.com/blog/2014/09/custom-exporter-getcamerainfo.html)\n- [Revit Camera Settings, Project Plasma, DA4R and AI](https://thebuildingcoder.typepad.com/blog/2019/06/revit-camera-settings-project-plasma-da4r-and-ai.html)\n- [Revit Camera FOV, Forge Partner Talks and Jobs](https://thebuildingcoder.typepad.com/blog/2020/04/revit-camera-fov-forge-partner-talks-and-jobs.html)\n- [Save and Restore 3D View Camera Settings](https://thebuildingcoder.typepad.com/blog/2020/10/save-and-restore-3d-view-camera-settings.html)\n\nThey help confirm aspects covered by the linked documentation.\nThe challenge is that going the other way, creating a valid target for APS, is less easily grasped since Revit doesn't expose this in the API.\nSo far I'm extrapolating from the crop box, and it doesn't seem to matter if I pick e.g. a ray through the near clipping plane or far clipping plane, LMV gets the general idea.\nIt's not quite right in result yet, though.\n\n**Answer:**\nI am not finding a way to get the target using the API.\nAs a workaround, I can suggest trying to fake the target location.\nFor example, if you look from above, the field of view makes a triangle.\nIf you know the horizontal extent of the view, you can find how far the base of the triangle is from the camera's eye.\nNote that this is different from the distance to near / far planes.\nYou could also perform a calculation based on the bounding box of the scene (view outline).\nIf you can get the outline in view coordinates (and have it axis-aligned), then you can assume that the target is on the far face of the box. (This is still different from the far clipping plane.)\nUnfortunately, the target is not used consistently in Revit, including for navigation.\nSo, it is fair to say that the significance of the location is not great.\nThis might explain why it has been neglected in API.\n\n**Response:**\nI think I grasp the fundamentals you mean but am unsure which components in the API describe them.\nFor example, you mention a distinction between the base of the view's frustum (triangle as seen from above when including the origin) and the far clipping plane.\nYet the diagram in the docs (lets' start with perspective) shows the Crop Box of the view as describing the clipping planes.\nNot clear to me which object contains this smaller frustum you reference. (of course this is all hard to convey in text, we might need a diagram :laughing:).\nI should also have been specific in that the views of interest for us are 3D at this time.\n\n**Answer:**\nThe crop box is view aligned and all six sides are potentially clipping planes.\nNear/Far as used with perspective are generally independently managed.\nFor your case, I would suggest that you disregard perspective near/far and just try to obtain some sensible values based on the crop box and view outline.\nIn other words, a workaround for not having a target position is to try to locate the target based on scene depth.\nYou could place the fake target in the center of some bounding volume of the scene or on its far side.\nYou could even try to shoot a ray and intersect the closest object.\nI think that can be done using the API.\nIt will not be the camera's exact target, however.\nBut, as I said, it is not consistently used for navigation, so it might not be that useful anyway.\n\n**Response:** Sounds good &ndash; I think my current code uses the far side of the crop box at the moment.\nI'll experiment further.\nSome of this will likely depend on what LMV and related tooling does with the input anyway.\na follow-up, if you know &ndash; is it feasible to find out from the Revit API the actual navigation pivot point?\n\n**Answer:**\nI doubt it, because it is a dynamic concept.\nFor example, if you have something selected, then the pivot point can be the center of selection.\nIt looks like you might be able to get/set a home camera using ViewNavigationToolSettings.\nAnd it has a pivot point (but no target).\nThat seems to be the closest one can get...\nFor completeness, there is a target value one can get during the custom exporter process, but it is a fake value, which is computed as I roughly described above.\nIt's something like\n\n<pre class=\"prettyprint\">\n  0.5 * view width / tan(fov / 2)\n</pre>\n\n**Response:**\nThanks very much!\nAnd target and pivot are not the same.\n\nThanks to Jeff Hotchkiss and Alex Pytel for this clarification."
  }
]