[
  {
    "original_filename": "0675_set_family_param",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0675_set_family_param",
    "header_text": "Set Family Parameter Requires Type",
    "local_header_href": "#set-family-parameter-requires-type",
    "chunk_text": "<h3>Set Family Parameter Requires Type</h3><p>I was running down to town to have tea with my friend Otto on Saturday morning, and happened to see this autumn leaf lying on the ground. \nTurned back, picked it up, and made a picture of it in the sunshine on Otto's veranda. \nIt is completely unretouched, I promise!\n\n<center>\n<img alt=\"Autumn leaf\" src=\"file:////j/photo/jeremy/2011/2011-11-12_autumn_leaf/autumn_leaf_narrow.jpg\" width=\"400\"/>\n</center>\n<p>Back to the Revit API, here is a short note on another issue run into by Ishwar Nagwani, Technical Consultant in our Bangalore organisation, who recently contributed the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/11/pick-corners-and-create-floor.html\">\npick points to create a new a floor</a> sample, and answered by Harry Mattison of the Revit development team.\n\n<p><strong>Question:</strong> I am trying to update an existing family parameter and set its value, but it is always throwing an InvalidOperationException saying \"There is no current type\".\nWhat is wrong?\n\n<p>Here is some minimal sample code to reproduce the issue.\nOnly the family file name is hardcoded.\n\n<pre class=\"code\">\n<span class=\"blue\">public</span> <span class=\"blue\">class</span> <span class=\"teal\">Command</span> : <span class=\"teal\">IExternalCommand</span>\n{\n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> Execute(\n    <span class=\"teal\">ExternalCommandData</span> commandData,\n    <span class=\"blue\">ref</span> <span class=\"blue\">string</span> message,\n    <span class=\"teal\">ElementSet</span> elements )\n  {\n    <span class=\"teal\">UIApplication</span> uiapp = commandData.Application;\n \n    uiapp.OpenAndActivateDocument( \n      <span class=\"maroon\">\"C:\\\\Projects\\\\FY12\\\\GE Revit\\\\SWBD-AV2.rfa\"</span> );\n \n    <span class=\"teal\">UIDocument</span> uidoc = uiapp.ActiveUIDocument;\n    <span class=\"teal\">Application</span> app = uiapp.Application;\n    <span class=\"teal\">Document</span> doc = uidoc.Document;\n \n    <span class=\"teal\">FamilyManager</span> familyMgr = doc.FamilyManager;\n \n    <span class=\"teal\">FamilyParameter</span> param = familyMgr.get_Parameter( \n      <span class=\"maroon\">\"Width\"</span> );\n \n    <span class=\"blue\">if</span>( <span class=\"blue\">null</span> == param )\n    {\n      param = doc.FamilyManager.AddParameter( \n        <span class=\"maroon\">\"Width\"</span>, <span class=\"teal\">BuiltInParameterGroup</span>.PG_GEOMETRY, \n        <span class=\"teal\">ParameterType</span>.Length, <span class=\"blue\">true</span> );\n    }\n \n    familyMgr.Set( param, 0.2 ); <span class=\"green\">// set the value</span>\n \n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n}\n</pre>\n<p><strong>Answer:</strong> The exception message actually says it all, albeit rather succinctly: \"There is no current type\".\n\n<p>FamilyManager.Set is used to set the value of a parameter for the current family type. \nThe family you are working with had no types defined, therefore Set could not work. \nYou can remedy this by adding a family type manually or with the following two lines:\n\n<pre class=\"code\">\n  <span class=\"blue\">if</span>( doc.FamilyManager.Types.Size == 0 )\n    doc.FamilyManager.NewType( <span class=\"maroon\">\"Type 1\"</span> );\n\n  familyMgr.Set( param, 0.2 );\n</pre>\n<p>Again, thanks to Ishwar for sharing this!\n\n\n<h4>Addendum – SetValueString Works Without Type</h4>\n<p>Alexander, Александр Пекшев, points out another possibility below, saying:</p>\n<p>You do not have to create a type! You can use the method <code>SetValueString</code> instead of the <code>Set</code> method – it does not require pre-creation of a type, and does what it needs – it sets the value for the parameter!</p>\n</p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0675_set_family_param",
    "header_text": "Addendum – SetValueString Works Without Type",
    "local_header_href": "#addendum-setvaluestring-works-without-type",
    "chunk_text": "<h4>Addendum – SetValueString Works Without Type</h4><p>Alexander, Александр Пекшев, points out another possibility below, saying:</p><p>You do not have to create a type! You can use the method <code>SetValueString</code> instead of the <code>Set</code> method – it does not require pre-creation of a type, and does what it needs – it sets the value for the parameter!</p>"
  }
]