[
  {
    "original_filename": "0309_newellipse",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0309_newellipse",
    "header_text": "NewEllipse Parameters",
    "local_header_href": "#newellipse-parameters",
    "chunk_text": "<h3>NewEllipse Parameters</h3><p>Here I am back at work again. \nI see I have a large number of backed up comments to answer, and lots of other interesting new information to discuss.\nOne recent case handled by my colleague Joe Ye discovered an issue with the API documentation of the NewEllipse method that is worth pointing out:\n\n<p><strong>Question:</strong> I am having an issue converting ellipses from AutoCAD into Revit. \nI have the geometry of the ellipse converted correctly, but there are some issues with the length of partial ellipses. \nI have checked my calculations and conversions, and to me they seem to be correct. \nI am wondering whether there may be something wrong with the Application.Create.NewEllipse method. \nPlease let me know whether there is an issue with the Revit API in this area.\n\n<p><strong>Answer:</strong> I have a good message for you. \nThe issue is not caused by the NewEllipse method itself, but from its description in the API documentation. \nThe last two arguments are not the start and end angle, but represent the start and end parameter values of the partial ellipse. \n\n<p>Given the start and end angles, however, we may not know the start and end point parameter values before creating the ellipse.\nTo solve this, one can first create a complete ellipse, then determine the start and end point parameters by geometrical analysis, and finally reset the start and end parameter values using the Ellipse.MakeBound method.\n\n<p>Here is a code snippet showing how to create an elliptical arc geometry object using this approach:</p>\n<pre class=\"code\">\n<span class=\"teal\">Ellipse</span> CreateEllipse( <span class=\"teal\">Application</span> app )\n{\n  <span class=\"teal\">XYZ</span> center = <span class=\"teal\">XYZ</span>.Zero;\n \n  <span class=\"blue\">double</span> radX = 30;\n  <span class=\"blue\">double</span> radY = 50;\n \n  <span class=\"teal\">XYZ</span> xVec = <span class=\"teal\">XYZ</span>.BasisX;\n  <span class=\"teal\">XYZ</span> yVec = <span class=\"teal\">XYZ</span>.BasisY;\n \n  <span class=\"blue\">double</span> param0 = 0.0;\n  <span class=\"blue\">double</span> param1 = 2 * <span class=\"teal\">Math</span>.PI;\n \n  <span class=\"teal\">Ellipse</span> e = app.Create.NewEllipse( center,\n    radX, radY, xVec, yVec, param0, param1 );\n \n  <span class=\"green\">// Create a line from ellipse center in </span>\n  <span class=\"green\">// direction of target angle:</span>\n \n  <span class=\"blue\">double</span> targetAngle = <span class=\"teal\">Math</span>.PI / 3.0;\n \n  <span class=\"teal\">XYZ</span> direction = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>( \n    <span class=\"teal\">Math</span>.Cos( targetAngle ), \n    <span class=\"teal\">Math</span>.Sin( targetAngle ), \n    0 );\n \n  <span class=\"teal\">Line</span> line = app.Create.NewLineUnbound( \n    center, direction );\n \n  <span class=\"green\">// Find intersection between line and ellipse:</span>\n \n  <span class=\"teal\">IntersectionResultArray</span> results;\n  e.Intersect( line, <span class=\"blue\">out</span> results );\n \n  <span class=\"green\">// Find the shortest intersection segment:</span>\n \n  <span class=\"blue\">foreach</span>( <span class=\"teal\">IntersectionResult</span> result <span class=\"blue\">in</span> results )\n  {\n    <span class=\"blue\">double</span> p = result.UVPoint.U;\n    <span class=\"blue\">if</span>( p &lt; param1 )\n    {\n      param1 = p;\n    }\n  }\n \n  <span class=\"green\">// Apply parameter to the ellipse:</span>\n \n  e.MakeBound( param0, param1 );\n \n  <span class=\"blue\">return</span> e;\n} \n</pre>\n<p>The API documentation will be updated soon.\n\n<p><strong>Response:</strong> I updated my code and it now works using the StartParameter and EndParameter obtained directly from the AutoCAD Ellipse entity. \nThe calculations are basically the same as the angles and the results are correct now.\nGetting the parameter value directly from AutoCAD saves some coding and improves performance. \n\n<p>Here is\n\n<a href=\"zip/bc11062.zip\">\nversion 1.1.0.62</a>\n\nof the complete Building Coder source code and Visual Studio solution including a new external command CmdEllipticalArc implementing this method.</p>\n<p>Many thanks to Joe for this solution!\n</p></p></p></p></p></p></p>"
  }
]