[
  {
    "original_filename": "1546_wta_mech_prov_void",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<!-- <script src=\"run_prettify.js\" type=\"text/javascript\"></script> --> \n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\n- 12826620 [An automation experiment, family placement, its tag and then a remote tag]\n  https://forums.autodesk.com/t5/revit-api-forum/an-automation-experiment-family-placement-its-tag-and-then-a/m-p/6976559\n\n #RevitAPI @AutodeskRevit #aec #bim #dynamobim @AutodeskForge \n\nToday is the last day of the Forge accelerator, and I am still working on the ForgeFader project.\nThe topics today are mainly related to Revit, though\n&ndash; Google prettifier on GitHub\n&ndash; WTA mechanical family placement add-in\n&ndash; Provision for void\n&ndash; What is a provision for void?\n&ndash; Creating a provision for void...\n\n-->"
  },
  {
    "original_filename": "1546_wta_mech_prov_void",
    "header_text": "WTA Mech and TTT for Provision for Voids",
    "local_header_href": "#wta-mech-and-ttt-for-provision-for-voids",
    "chunk_text": "### WTA Mech and TTT for Provision for Voids\n\nToday is the last day of \nthe [Forge accelerator](http://thebuildingcoder.typepad.com/blog/2017/03/events-uv-coordinates-and-rooms-on-level.html#2),\nand I am still working on \nthe [ForgeFader](https://github.com/jeremytammik/forgefader) project.\n\nThe topics today are mainly related to Revit, though:\n\n- [Google prettifier on GitHub](#2)\n- [WTA mechanical family placement add-in](#3)\n- [Provision for void](#4)\n- [What is a provision for void?](#5)\n- [Creating a provision for void](#6)\n- [Provision for void user interface](#7)"
  },
  {
    "original_filename": "1546_wta_mech_prov_void",
    "header_text": "<a name=\"2\"></a>Google Prettifier on GitHub",
    "local_header_href": "#a-name2agoogle-prettifier-on-github",
    "chunk_text": "#### <a name=\"2\"></a>Google Prettifier on GitHub\n\nI happened to notice yesterday that the\nGoogle [JavaScript code prettifier](https://github.com/google/code-prettify) moved\nand now lives in GitHub.\n\nThe script can now be loaded like this:\n\n<pre class=\"prettyprint\">\n&lt;script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\"&gt;&lt;/script&gt;\n</pre>\n\nI use that to present JavaScript sample code here on the blog."
  },
  {
    "original_filename": "1546_wta_mech_prov_void",
    "header_text": "<a name=\"3\"></a>WTA Mechanical Family Placement Add-in",
    "local_header_href": "#a-name3awta-mechanical-family-placement-add-in",
    "chunk_text": "#### <a name=\"3\"></a>WTA Mechanical Family Placement Add-in\n\nAllan\n[@aksaks](https://forums.autodesk.com/t5/user/viewprofilepage/user-id/540057)\n[@akseidel](https://github.com/akseidel)\nSeidel made a number of contributions here in the past, including:\n\n- [Stacked Ribbon Button Panel Options](http://thebuildingcoder.typepad.com/blog/2016/09/stacked-ribbon-button-panel-options.html)\n- [FireP and 3d Aimer](http://thebuildingcoder.typepad.com/blog/2017/03/wta-firep-and-3d-aimer-tools.html)\n    - Ribbon panel implementation sample\n    - Fire protection related family placement tools\n    - 3d Aimer that \"aims\" a special Revit family instance at a target\n- [WTA Elec &ndash; another family plunk and concept share](http://thebuildingcoder.typepad.com/blog/2017/03/wta-firep-and-3d-aimer-tools.html#5)\n\n[Revit, Add-in, complex family placement using the plunk class](https://www.youtube.com/watch?v=_x7yyx4Yk_I)\n\n<iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/_x7yyx4Yk_I?rel=0\" frameborder=\"0\" allowfullscreen></iframe>\n\nThis sequence shows a complex placement of three family instances as handled by a \"plunk\" class intended to provide a universal placement handling.\n\nHis newest sample is presented in\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread \non [an automation experiment, family placement, its tag and then a remote tag](https://forums.autodesk.com/t5/revit-api-forum/an-automation-experiment-family-placement-its-tag-and-then-a/m-p/6976559).\n\nIt provides a similar ribbon panel and tool collection for family instance placement and management for tasks primarily oriented towards the mechanical domain:\n\n> Apologizing for beginning to wear out a welcome, here is a video and code share for yet another custom ribbon specific task command involving family placement and tags. The ribbon panel split button control being used is a variant of what is mentioned\nin [stacked ribbon button panel options](http://thebuildingcoder.typepad.com/blog/2016/09/stacked-ribbon-button-panel-options.html).\n\n> One idea presented is a remote tag. Maybe this is commonly done in Revit practice.\nThe remote tag here is simply a tag on item where the tag itself is placed in proximity to a different item that is a system client to the former item. What is really needed is for Revit tags to show values from an indexed object instead of the object the tag tags. Perhaps it does this. Anyway, that is part of what is seen in the video.\n\n> - [YouTube video](https://www.youtube.com/watch?v=_x7yyx4Yk_I)\n> - [GitHub repository](https://github.com/akseidel/WTA_MECH)\n \n> Other items of interest are \"Host face normal direction used to drive symbology orientation\" and \"User settings for family names, types and tag parameter names\". The first is a way used to orient based on which direction the host face faces. The idea could be used with a complex family that is capable of rotating within itself to produce a face based family placement that is \"always level\" so to speak. Only a crude family is used in the demonstration but the code behind does provide the necessary angle to \"level\". The second is an attempt to externalize family names, family types and parameter names outside of the hard coded add-in. The need is necessary for any type of task related ribbon customization where aspects to the task are not static.   \n\n<center>\n<iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/_x7yyx4Yk_I?rel=0\" frameborder=\"0\" allowfullscreen></iframe>\n</center>\n\nHere is Allan's more detailed description from the GitHub repo:\n\n<center>\n<img src=\"img/akseidel_MechRibbonTab.png\" alt=\"WTA_MECH mechanical ribbon tab\" width=\"500\"/>\n</center>\n\nRevit Add-in in C# &mdash; Creates a custom ribbon tab with discipline related tools. The tools at this writing are for placing specific Revit family types with some families requiring parameter settings made on the fly.\n\nThis repository is provided for sharing and learning purposes. Perhaps someone might provide improvements or education. Perhaps it will help to boost someone further up the steep learning curve needed to create Revit task add-ins. Hopefully it does not show too much of the wrong way.  \n\nThe tools in this ribbon use classes that provide Revit family instance placement functionality with less overhead the standard Revit user interface.\nThe classes are intended to provide a universal mechanism for placing some types of families, including tags.\nThe custom tab employs menu methods not commonly explained, for example a split button sets a family placement mode that is exposed to the functions called by command picks.\nOther tools use add-in application settings as a way to persist settings or communicate to code that runs subsequently within a command that provides a task workflow.\n\nThis add-in demonstrates many of the typical tasks and implementation required for a family placement tab menu interface, e.g.:\n\n* Creating a ribbon tab populated with some controls\n  - Tool tips\n  - Image file to button image\n  - Communication between controls and commands the controls execute\n* Establishing the family type for placement\n  - Determine if the correct pairing exists in the current file\n  - Automatically discovering and loading the family if it does not exist in the current file but does exist somewhere starting from some set directory\n* Providing the family type placement interface\n  - In multiple mode or one shot mode\n  - With a heads-up status/instruction interface form\n    - As WPF with independent behaviour\n      - Sending focus back to the Revit view\n  - Returning the family instance placement for further processing after the instance has been placed\n  - Managing an escape out from the process\n  - Handling correct view type context\n* Changing family parameter values\n\nMuch of the code is by others. Its mangling and ignorant misuse is my ongoing doing. Much thanks to the professionals like Jeremy Tammik who provided the means directly or by mention one way or another for probably all the code needed.\n\nHere are some aspects that may be of specific interest:\n\n- **Hybrid splitbutton behaviour** &mdash; A splitbutton control with four buttons, where the top two execute one of two types of the same task and the bottom two invoke a settings panel for one of the corresponding task types. The top two buttons, being tasks the user is likely going to repeat, remain as the last button selected. The bottom two buttons are incidental tasks the user would not need to repeat nor want to be the splitbutton's face button. The splitbutton face button reverts back to what is was before the user selected one of the bottom two button. That is the hybrid behaviour. This idea was discussed here: [thebuildingcoder &ndash; stacked-ribbon-button-panel-options](http://thebuildingcoder.typepad.com/blog/2016/09/stacked-ribbon-button-panel-options.html)\n- **Host face normal direction used to drive symbology orientation** &mdash; The HVAC sensor family placed by the tools has two symbology orientations, because Revit does not really support a universal \"view independent text\". The family's symbology would be wrong 50% of the time it were placed. The code attempts to use the host face normal direction to more correctly pick which of the two orientations to make visible. Each orientation's visibility is controlled by a parameter. Only one parameter needs to be set, because the other parameter is function controlled in the family to be `not(the_other)`.\n- **User settings for family names, types and tag parameter names** &mdash; As a way to side step the problem of hard coding family names, types and tag parameter names, the user can set the names to some other values. Not implemented, but planned: an external file text to also house the standard settings.\n- **Remote equipment tag** &mdash; Sensors, like thermostats, for example, are often the client to a piece of a mechanical system. The mechanical system name the sensor is a client for, an ID number for example, is typically placed next to the sensor on construction plans. That ID number is part of the mechanical equipment properties, but not the sensor properties, unless it is duplicated to the sensor. Therefore, tagging the sensor using the latter method involves more effort and maintenance. The remote equipment tag is a tag to the mechanical equipment placed at the sensor. That is what this add-in is doing. It would be nice if Revit were to support an indirect tag value, like the way a microprocessor does indirect addressing. Then the sensor could be tagged with a tag that gets its value from the parameter values of an indirectly addressed object.\n- **Multiple view annotation placement** &mdash; This add-in can place the annotations, the tags, simultaneously in more than one view at a time. The final tag placement code iterates through a list of candidate views when placing the tag. That list is developed by a single function using specific rules, which one has to adapt to one's needs, operating on parent view names. For example, if the active view is a dependent view, its parent view name is used in the candidate logic. The reason for this feature is due to one of Revit's worst usability problems, where annotation is relegated to the output composition task and not visible during the more important design and engineering tasks."
  },
  {
    "original_filename": "1546_wta_mech_prov_void",
    "header_text": "<a name=\"4\"></a>Provision for Void",
    "local_header_href": "#a-name4aprovision-for-void",
    "chunk_text": "#### <a name=\"4\"></a>Provision for Void\n\nWe discussed numerous examples of the temporary transaction trick in the past,\nthe last one just last week, \nto [obtain a section marker endpoint](http://thebuildingcoder.typepad.com/blog/2017/03/ttt-to-obtain-section-marker-endpoint.html).\n\nThat and others are listed in The Building Coder topic group \non [handling transactions and transaction groups](http://thebuildingcoder.typepad.com/blog/about-the-author.html#5.53).\n\nHere is another clever use to obtain provisions for void, last mentioned in the discussion\non [using `ReferenceIntersector` in linked files](http://thebuildingcoder.typepad.com/blog/2015/07/using-referenceintersector-in-linked-files.html).\n\nHåvard Dagsvik of [Symetri](http://www.symetri.com), who contributed to numerous discussions in the past, e.g., \n[determining wall opening areas per room](http://thebuildingcoder.typepad.com/blog/2016/04/determining-wall-opening-areas-per-room.html#4),\nbrought up a new idea:\n\nJust wanted to share with you something I came across the other day about ProvisionForVoids.\nThose are basically \"proposals for openings that are to be coordinated between HVAC and architectural/structural design applications\".\nWe create those proposals as FamilyInstances."
  },
  {
    "original_filename": "1546_wta_mech_prov_void",
    "header_text": "<a name=\"5\"></a>What is a Provision for Void?",
    "local_header_href": "#a-name5awhat-is-a-provision-for-void",
    "chunk_text": "#### <a name=\"5\"></a>What is a Provision for Void?\n\nA ProvisionForVoid is a request/proposal for an opening in a structural element such as a wall or floor.\n \nBuildingSmart published\nthe [#CV-2x3-157 agreement on a particular type of building element proxy to exchange provisions for voids](http://www.buildingsmart-tech.org/implementation/ifc-implementation/ifc-impl-agreements/cv-2x3-157) saying,\n\"Such 'proposals for openings' &ndash; or provisions for voids are 3D bodies that indicate the required void for building service flow segments.\nThe voids are not yet subtractions of the building element (wall, slab), but placeholders,\nthat have to be converted into \"real\" openings by the architect or structural designer.\"\n \nSo the request/proposal is a 3D body, a solid simulating a void.\nOne request is one FamilyInstance.\nIf the Structural Engineer approves the request he will create the actual void with the requested size.\n \nIt could be you are an architect with a Door in a structural wall.\n(That wall belongs to the structural engineer)\nOr you may be an MEP engineer with a CableTray passing through the wall.\nBoth will need an opening."
  },
  {
    "original_filename": "1546_wta_mech_prov_void",
    "header_text": "<a name=\"6\"></a>Creating a Provision for Void",
    "local_header_href": "#a-name6acreating-a-provision-for-void",
    "chunk_text": "#### <a name=\"6\"></a>Creating a Provision for Void\n\nGetting the size of an opening cut for a door is not straight forward.\nI implemented working code doing it that either is much too slow, using `EditFamily`,\nor becomes too long, by analysing invisible lines obtained in the project file.\n \nThen I realized if you set a door as demolished,\nRevit will automagically create the \"provision\" element.\nRevit creates an \"infill\" wall because the element got demolished.\n \nSo, by using some ideas shared by The Building Coder, I put together the following solution.\nIn this case, it's about provisions.\nBut it can be used with the \"RoomSurfaceMaterial\" code we did some time ago.\nThis is tested somewhat large scale and works well, seems very reliable and fast :-)\nA bit similar to the temporary deletion trick you have mentioned.\nBut this will get you the actual opening element.\n \n<pre class=\"code\">\n  <span style=\"color:blue;\">using</span>( <span style=\"color:#2b91af;\">TransactionGroup</span> transGroup \n    = <span style=\"color:blue;\">new</span> <span style=\"color:#2b91af;\">TransactionGroup</span>( doc ) )\n  {\n    transGroup.Start( <span style=\"color:#a31515;\">&quot;TempRollback&quot;</span> );\n   \n    <span style=\"color:green;\">// register the updater;</span>\n  \n    doc.Application.DocumentChanged \n      += <span style=\"color:blue;\">new</span> <span style=\"color:#2b91af;\">EventHandler</span>&lt;\n        Autodesk.Revit.DB.Events\n          .<span style=\"color:#2b91af;\">DocumentChangedEventArgs</span>&gt;( \n            application_DocumentChanged );\n   \n    <span style=\"color:#2b91af;\">FamilyInstance</span> door = <span style=\"color:blue;\">null</span>; <span style=\"color:green;\">// get the door here;</span>\n  \n    <span style=\"color:blue;\">using</span>( <span style=\"color:#2b91af;\">Transaction</span> t = <span style=\"color:blue;\">new</span> <span style=\"color:#2b91af;\">Transaction</span>( doc ) )\n    {\n      t.Start( <span style=\"color:#a31515;\">&quot;name&quot;</span> );\n      door.DemolishedPhaseId = door.CreatedPhaseId;\n      t.Commit();\n      <span style=\"color:green;\">// Revit has now created the &quot;infill&quot; element;</span>\n    }\n   \n    <span style=\"color:#2b91af;\">Wall</span> provision = <span style=\"color:blue;\">null</span>;\n   \n    <span style=\"color:green;\">// &quot;addedIds&quot; contains the &quot;infill&quot; element;</span>\n\n    <span style=\"color:blue;\">foreach</span>( <span style=\"color:#2b91af;\">ElementId</span> id <span style=\"color:blue;\">in</span> addedIds )\n    {\n      <span style=\"color:#2b91af;\">Element</span> e = doc.GetElement( id ) <span style=\"color:blue;\">as</span> <span style=\"color:#2b91af;\">Element</span>;\n      <span style=\"color:blue;\">if</span>( e <span style=\"color:blue;\">is</span> <span style=\"color:#2b91af;\">Wall</span> )\n        provision = e <span style=\"color:blue;\">as</span> <span style=\"color:#2b91af;\">Wall</span>;\n    }\n   \n    <span style=\"color:blue;\">if</span>( provision != <span style=\"color:blue;\">null</span> )\n    {\n      <span style=\"color:green;\">// collect whatever info you need </span>\n      <span style=\"color:green;\">// about void geometry</span>\n    }\n   \n    <span style=\"color:green;\">// unregister the updater;</span>\n  \n    doc.Application.DocumentChanged \n      -= <span style=\"color:blue;\">new</span> <span style=\"color:#2b91af;\">EventHandler</span>&lt;\n        Autodesk.Revit.DB.Events\n          .<span style=\"color:#2b91af;\">DocumentChangedEventArgs</span>&gt;( \n            application_DocumentChanged );\n   \n    transGroup.RollBack();\n  }\n\n  <span style=\"color:green;\">// the variable</span>\n\n  <span style=\"color:blue;\">private</span> <span style=\"color:blue;\">static</span> <span style=\"color:#2b91af;\">ICollection</span>&lt;<span style=\"color:#2b91af;\">ElementId</span>&gt; addedIds\n  {\n    <span style=\"color:blue;\">get</span>;\n    <span style=\"color:blue;\">set</span>;\n  }\n \n  <span style=\"color:green;\">// pick up the &quot;infill&quot; element Revit just created\n  // when we set the door as demolished</span>\n  \n  <span style=\"color:blue;\">private</span> <span style=\"color:blue;\">static</span> <span style=\"color:blue;\">void</span> application_DocumentChanged(\n    <span style=\"color:blue;\">object</span> sender,\n    <span style=\"color:#2b91af;\">DocumentChangedEventArgs</span> args )\n  {\n    addedIds = args.GetAddedElementIds();\n  }\n}\n</pre>\n\nHere is [a sample project](zip/hd_provision_for_void.zip).\nIt demonstrates how to get the opening void for doors and windows as a solid using the temporary demolish trick.\n \nThere's also a second method in there that gets the curve framework of the void.\nSomewhat mysterious curves they are not visible in the project or the family.\nFrom those curves, it is possible to create a solid.\nThat is what I ended up doing in my final application.\n(Or I might do a mix if the curve method fails).\n \nHowever way you get that transient solid it can be used for a lot purposes.\nIn this case, I was working on creating ProvisionsForVoids as FamilyInstances.\nSo I use the size of the solid as size for each FamilyInstance.\n \nThese methods can also be used to improve\nthe [SpatialElementGeometryCalculator](https://github.com/jeremytammik/SpatialElementGeometryCalculator) project\ndescribed\nin [Håvard's SpatialElementGeometryCalculator enhancement](http://thebuildingcoder.typepad.com/blog/2016/04/determining-wall-opening-areas-per-room.html#5).\n \nThis add-in shows how you can obtain the opening size you need to request.\nIn our final add-in we use the solids it creates as basis for size and rotation when creating FamilyInstances.\nIt shows two different ways you can get that size/3D body for Doors/Windows.\nWithout having to rely on how the family is made, or its parameters.\nFamilies can be made in an infinite number of different ways.\nTheir visible geometry is hard to analyse with a consistent result.\nI needed a consistent way of getting that opening request correct in every case.\n\nHopefully what we have here can be of use to someone out there ;-)\n\nMany thanks to Håvard for this advanced and well-tested yet simple solution to a very challenging task!"
  },
  {
    "original_filename": "1546_wta_mech_prov_void",
    "header_text": "<a name=\"7\"></a>Provision for Void User Interface",
    "local_header_href": "#a-name7aprovision-for-void-user-interface",
    "chunk_text": "#### <a name=\"7\"></a>Provision for Void User Interface\n\nAn additional comment on the user interface...\n\nI implemented a modeless environment with an exit button to interact with this functionality.\n \nThe UI looks like this:\n\n<center>\n<img src=\"img/hd_provision_for_void_ui.jpg\" alt=\"Provision for void user interface\" width=\"600\"/>\n</center>\n\nThe ProvisionForVoid code above is launched from this UI when the user selects \"Doors\" or \"Wall\" and presses \"Create\".\n\nAnd we are using this type of UI in several ways now; this is another example that writes Fire or Acoustic codes to elements:\n\n<center>\n<img src=\"img/hd_fire_or_acoustic_ui.jpg\" alt=\"Fire or Acoustic code user interface\" width=\"600\"/>\n</center>\n\nBoth of them could have been done \"the usual way\" with a Windows Form.\n\nThis is just so much better, \"modeless\" but still inside a valid API context.\n\nNo need for `OnIdling` or external events here, a few others, but not those."
  }
]