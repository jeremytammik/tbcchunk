[
  {
    "original_filename": "1635_contextualhelp",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<!--\n<script src=\"run_prettify.js\" type=\"text/javascript\"></script>\n<script src=\"https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js\" type=\"text/javascript\"></script>\n-->\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\n\nContextual help best practice in #RevitAPI @AutodeskRevit #bim #dynamobim @AutodeskForge #ForgeDevCon http://bit.ly/contextualhelp\n\nDragos Turmac of the Revit development team solved\nthe Revit API discussion forum questions\non contextual help not working from within a command and\non F1 help for add-in only by\nexplaining the current best practice to implement online help\n&ndash; Question: I'm trying to add contextual help for all commands (press F1 to go to a location).\nIt's working fine when the tooltip is shown for my commands, but, when the add-in form is open, pressing F1 opens the Autodesk knowledge site for Revit instead...\n\n--->"
  },
  {
    "original_filename": "1635_contextualhelp",
    "header_text": "Contextual Help Best Practice",
    "local_header_href": "#contextual-help-best-practice",
    "chunk_text": "### Contextual Help Best Practice\n\nDragos Turmac of the Revit development team solved\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) questions\non [contextual help not working from within a command](https://forums.autodesk.com/t5/revit-api-forum/contextual-help-not-working-from-within-a-command/m-p/7842882) and\non [F1 help for add-in only](https://forums.autodesk.com/t5/revit-api-forum/f1-help-for-addin-only/m-p/7522730) by\nexplaining the current best practice to implement online help:\n\n**Question:** I'm trying to add contextual help for all commands (press F1 to go to a location).\n\nIt's working fine when the tooltip is shown for my commands, but, when the add-in form is open, pressing F1 opens the Autodesk knowledge site for Revit instead.\n\nI looked at the documentation \non [Ribbon panels and controls](https://knowledge.autodesk.com/search-result/caas/CloudHelp/cloudhelp/2017/ENU/Revit-API/files/GUID-1547E521-59BD-4819-A989-F5A238B9F2B3-htm.html) and this part:\n\n> The `ContextualHelp` class has a `Launch` method that can be called to display the help topic specified by the contents of this `ContextualHelp` object at any time, the same as when the F1 key is pressed when the control is active. This allows the association of help topics with user interface components inside dialogs created by an add-in application.\n\nThis leads me to believe that one should be able to press F1 from within a command and get the correct contextual help.\n\nWhat am I missing?\n\n**Question 2:** This seems to be a repeat of my original request\nfor [F1 help for add-in only](https://forums.autodesk.com/t5/revit-api-forum/f1-help-for-addin-only/m-p/7522730):\n\n> I am adding Help to my add-in and want the F1 key to call my help file (CHM) for the whole form, not just for the control that has focus. I am using the following code which is working fine. My problem is that F1 triggers Revit's online help after calling mine. Is there a way to prevent this keystroke going on to Revit?\n\n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:blue;\">protected</span>&nbsp;<span style=\"color:blue;\">override</span>&nbsp;<span style=\"color:blue;\">bool</span>&nbsp;ProcessCmdKey(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">ref</span>&nbsp;Message&nbsp;msg,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;Keys&nbsp;keyData&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;F1&nbsp;for&nbsp;help&nbsp;on&nbsp;any&nbsp;control</span>\n\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;keyData&nbsp;==&nbsp;Keys.F1&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HelpClick();\n \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;This&nbsp;keystroke&nbsp;was&nbsp;handled,&nbsp;don&#39;t&nbsp;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;pass&nbsp;to&nbsp;the&nbsp;control&nbsp;with&nbsp;the&nbsp;focus</span>\n \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:blue;\">true</span>;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:blue;\">base</span>.ProcessCmdKey(&nbsp;<span style=\"color:blue;\">ref</span>&nbsp;msg,&nbsp;keyData&nbsp;);\n&nbsp;&nbsp;}\n</pre>\n\n\n**Answer:** I used the contextual help functionality a couple of times in the past and never encountered the behaviour you describe:\n\n<!-----\n$ lb ContextualHelp\n0800_multi_version_addin.htm:21\n0904_whats_new_2013.htm:3\n1114_balloon_tip.htm:2\n1283_directobjloader.htm:1\n\n$ blbare 0800 0904 1114 1283\n---->\n\n- [Multi-Version Add-in](http://thebuildingcoder.typepad.com/blog/2012/07/multi-version-add-in.html)\n- [What's New in the Revit 2013 API](http://thebuildingcoder.typepad.com/blog/2013/03/whats-new-in-the-revit-2013-api.html) &gt; Contextual help support\n- [Using Balloon Tips in Revit](http://thebuildingcoder.typepad.com/blog/2014/03/using-balloon-tips-in-revit.html)\n- [From Hack to App &ndash; OBJ Mesh Import to DirectShape](http://thebuildingcoder.typepad.com/blog/2015/02/from-hack-to-app-obj-mesh-import-to-directshape.htm...)\n \nUnfortunately, all of these date rather far back, so I cannot guarantee that they behave as expected nowadays.\n\nHappily, Dragos solved the issue by explaining the up-to-date solution and best practice implementing online help:\n\nAn F1 key hit in a modal C# form is normally caught using the `HelpRequested` control event, like this:\n\n<pre class=\"code\">\n  <span style=\"color:green;\">//&nbsp;in&nbsp;designer</span>\n\n  <span style=\"color:blue;\">this</span>.HelpRequested&nbsp;+=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;System.Windows.Forms\n  &nbsp;&nbsp;.<span style=\"color:#2b91af;\">HelpEventHandler</span>(&nbsp;<span style=\"color:blue;\">this</span>.OnHelpRequested&nbsp;);\n\n  <span style=\"color:green;\">//&nbsp;in&nbsp;form&#39;s&nbsp;code</span>\n\n  <span style=\"color:blue;\">private</span>&nbsp;<span style=\"color:blue;\">void</span>&nbsp;OnHelpRequested(&nbsp;\n  &nbsp;&nbsp;<span style=\"color:blue;\">object</span>&nbsp;sender,&nbsp;\n  &nbsp;&nbsp;HelpEventArgs&nbsp;hlpevent&nbsp;)\n  {\n  &nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Do&nbsp;stuff&nbsp;here,&nbsp;whatever&nbsp;you&nbsp;wish.&nbsp;\n    // Once&nbsp;this&nbsp;event&nbsp;is&nbsp;called,&nbsp;Revit&nbsp;no&nbsp;longer&nbsp;follows</span>\n\n  &nbsp;&nbsp;Help.ShowPopup(&nbsp;<span style=\"color:blue;\">this</span>,&nbsp;<span style=\"color:#a31515;\">&quot;test&nbsp;help&quot;</span>,&nbsp;\n  &nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">Point</span>(&nbsp;somewhere.x,&nbsp;somewhere.y&nbsp;)&nbsp;);\n  }\n</pre>\n\nIf the above event is not subscribed to, Revit opens its own help.\n\nIf it is, Revit does nothing.\n\nAttached a small add-in\nin [contextual_help_test_addin.zip](zip//a/case/sfdc/12806669/contextual_help_test_addin.zip) that\nonly shows a Windows form on which an F1 press will show up a test popup help and Revit does nothing about it.\n\nIt implements a start-up command and a test dialogue.\n\nHere is the complete code for the command:\n\n<pre class=\"code\">\n<span style=\"color:blue;\">using</span>&nbsp;Autodesk.Revit.UI;\n<span style=\"color:blue;\">using</span>&nbsp;Autodesk.Revit.DB;\n<span style=\"color:blue;\">using</span>&nbsp;Autodesk.Revit.Attributes;\n \n<span style=\"color:blue;\">namespace</span>&nbsp;TestAddin\n{\n&nbsp;&nbsp;[<span style=\"color:#2b91af;\">Transaction</span>(&nbsp;<span style=\"color:#2b91af;\">TransactionMode</span>.Manual&nbsp;)]\n&nbsp;&nbsp;[<span style=\"color:#2b91af;\">Regeneration</span>(&nbsp;<span style=\"color:#2b91af;\">RegenerationOption</span>.Manual&nbsp;)]\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">class</span>&nbsp;<span style=\"color:#2b91af;\">StartUpCmd</span>&nbsp;:&nbsp;<span style=\"color:#2b91af;\">IExternalCommand</span>\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:#2b91af;\">Result</span>&nbsp;Execute(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">ExternalCommandData</span>&nbsp;commandData,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">ref</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;message,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">ElementSet</span>&nbsp;elements&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">TestDlg</span>&nbsp;testDlg&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">TestDlg</span>();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testDlg.ShowDialog();\n \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:#2b91af;\">Result</span>.Succeeded;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n}\n</pre>\n\nThe C# portion of the test dialogue implementation looks like this:\n\n<pre class=\"code\">\n<span style=\"color:blue;\">using</span>&nbsp;System.Drawing;\n<span style=\"color:blue;\">using</span>&nbsp;System.Windows.Forms;\n \n<span style=\"color:blue;\">namespace</span>&nbsp;TestAddin\n{\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">partial</span>&nbsp;<span style=\"color:blue;\">class</span>&nbsp;<span style=\"color:#2b91af;\">TestDlg</span>&nbsp;:&nbsp;<span style=\"color:#2b91af;\">Form</span>\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;TestDlg()\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InitializeComponent();\n&nbsp;&nbsp;&nbsp;&nbsp;}\n \n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">private</span>&nbsp;<span style=\"color:blue;\">void</span>&nbsp;OnHelpRequested(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">object</span>&nbsp;sender,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">HelpEventArgs</span>&nbsp;hlpevent&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Help</span>.ShowPopup(&nbsp;<span style=\"color:blue;\">this</span>,&nbsp;<span style=\"color:#a31515;\">&quot;test&nbsp;help&quot;</span>,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">Point</span>(&nbsp;Top,&nbsp;Left&nbsp;)&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n}\n</pre>\n\n**Response:** I can confirm that I used your original snippet to call my context help routine, and all worked perfectly.\n\nMany thanks to Dragos for this very clear explanation and succinct sample!\n\n<center>\n<img src=\"img/help.png\" alt=\"Help\" width=\"228\"/>\n</center>"
  }
]