[
  {
    "original_filename": "1109_textnote_leader_align",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n<meta content=\"text/html; charset=utf-8\" http-equiv=\"Content-Type\"/>\n</head>"
  },
  {
    "original_filename": "1109_textnote_leader_align",
    "header_text": "TextNote Leader Alignment",
    "local_header_href": "#textnote-leader-alignment",
    "chunk_text": "<h3>TextNote Leader Alignment</h3><p>Let us explore <a href=\"#2\">TextNote leader alignment</a>.</p><p>Before getting to that, I'll just briefly mention that I still have unused vacation days from last year to use up, so I am going away again, this time on a desert hike near\n\n<a href=\"http://en.wikipedia.org/wiki/Zagora,_Morocco\">Zagora</a> in Morocco.</p><center>\n<img alt=\"Desert dune\" src=\"img/220px_Maroc_dune_de_Chegaga.jpg\" width=\"220\"/>\n</center><p>No computer, no Internet, no blog...</p><a name=\"2\"></a>"
  },
  {
    "original_filename": "1109_textnote_leader_align",
    "header_text": "TextNote Leader Alignment",
    "local_header_href": "#textnote-leader-alignment",
    "chunk_text": "<h4>TextNote Leader Alignment</h4><p>Here is one last topic before I leave, contributed by my colleague\n\n<a href=\"http://adndevblog.typepad.com/aec/katsuaki-takamizawa.html\">Katsuaki Takamizawa</a>, with help from Jim Jia and Pawel Madej of the Revit development team:</p><p><strong>Question:</strong> I am calling the NewTextNote method and specifying the leader elbow and text origin at the same height in an attempt to make the second leader segment horizontal.\n\n<p>However, the text is always shifted down a bit like this:</p>\n<center>\n<img alt=\"TextNote leader shifted downwards\" src=\"img/textnote_leader_1.jpeg\" width=\"459\"/>\n</center>\n<p>As you can see, the text  is shifted downward in comparison to the horizontal detail line segment.</p>\n<p>I produced this test by drawing a detail line vertically and then horizontally, running my add-in and picking the points for the leader end, leader elbow, and text position along this detail line.</p>\n<p>How can I make the second leader segment horizontal?</p>\n<p><strong>Answer 1:</strong> A workaround to make the second segment horizontal is provided by this code snippet:\n\n<pre class=\"code\">\n  <span class=\"green\">// Create text note without leader first</span>\n \n  <span class=\"teal\">TextNote</span> text = doc.Create.NewTextNote(\n    view, ptTextOrigin, baseVec, ptVec,\n    lineWidth, textAlign, strText);\n \n  <span class=\"green\">// Create leader for the new text: </span>\n  <span class=\"green\">// change the leader elbow and end;</span>\n  <span class=\"green\">// note that the elbow's Y should not be </span>\n  <span class=\"green\">// changed to keep horizontal!</span>\n \n  <span class=\"blue\">if</span> (bLeader)\n  {\n    <span class=\"teal\">Leader</span> noteLeader = text.AddLeader(\n      <span class=\"teal\">TextNoteLeaderTypes</span>.TNLT_STRAIGHT_R);\n \n    <span class=\"green\">// Use default Y!</span>\n \n    noteLeader.Elbow = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span> (point1.X,\n      noteLeader.Elbow.Y, point1.Z );\n \n    noteLeader.End = point1;\n  }\n</pre>\n<p>Note that the workaround unfortunately introduces another issue: the specified elbow end Y doesn’t take effect anymore.</p>\n<p><strong>Answer 2:</strong> You can combine the desired text alignment flags using bit-wise Boolean operations.</p>\n<p>In your original code, you are using</p>\n<pre class=\"code\">\n  <span class=\"teal\">TextAlignFlags</span> textAlign\n    = <span class=\"teal\">TextAlignFlags</span>.TEF_ALIGN_CENTER;\n</pre>\n<p>Try using this instead:</p>\n<pre class=\"code\">\n  <span class=\"teal\">TextAlignFlags</span> textAlign\n    = <span class=\"teal\">TextAlignFlags</span>.TEF_ALIGN_MIDDLE\n    | <span class=\"teal\">TextAlignFlags</span>.TEF_ALIGN_CENTER;\n</pre>\n<p>The result is close to horizontal:</p>\n<center>\n<img alt=\"TextNote leader almost horizontal\" src=\"img/textnote_leader_2.png\" width=\"332\"/>\n</center>\n<p><strong>Response:</strong> I combined the two suggested approaches to obtain a very good result.</p>\n<p>Here are some resulting samples using different TextAlignFlags values:</p>\n<center>\n<img alt=\"TextNote leader alignment\" src=\"img/textnote_leader_3.jpeg\" width=\"589\"/>\n</center>\n<p>Here is the code that I used to generate these:</p>\n<pre class=\"code\">\n  <span class=\"teal\">XYZ</span> leaderOrigin = uidoc.Selection.PickPoint(\n    <span class=\"maroon\">\"Pick Leader End\"</span> );\n \n  <span class=\"green\">//XYZ leaderElbow = uidoc.Selection.PickPoint(</span>\n  <span class=\"green\">//  \"Pick Leader Elbow\");</span>\n \n  <span class=\"teal\">XYZ</span> ptTextOrigin = uidoc.Selection.PickPoint(\n    <span class=\"maroon\">\"Pick Text Origin\"</span> );\n \n  <span class=\"blue\">using</span>( <span class=\"teal\">Transaction</span> tr = <span class=\"blue\">new</span> <span class=\"teal\">Transaction</span>( doc ) )\n  {\n    tr.Start( <span class=\"maroon\">\"NewTextNote\"</span> );\n \n    <span class=\"teal\">XYZ</span> baseVec = <span class=\"teal\">XYZ</span>.BasisX;\n    <span class=\"teal\">XYZ</span> upVec = <span class=\"teal\">XYZ</span>.BasisY;\n \n    <span class=\"blue\">double</span> lineWidth = 0.06;\n \n    <span class=\"green\">//TextAlignFlags textAlign </span>\n    <span class=\"green\">//  = TextAlignFlags.TEF_ALIGN_CENTER;</span>\n \n    <span class=\"green\">//TextAlignFlags textAlign </span>\n    <span class=\"green\">//  = TextAlignFlags.TEF_ALIGN_MIDDLE </span>\n    <span class=\"green\">//  | TextAlignFlags.TEF_ALIGN_CENTER;</span>\n \n    <span class=\"teal\">TextAlignFlags</span> textAlign\n      = <span class=\"teal\">TextAlignFlags</span>.TEF_ALIGN_MIDDLE\n      | <span class=\"teal\">TextAlignFlags</span>.TEF_ALIGN_RIGHT;\n \n    <span class=\"blue\">string</span> strText = <span class=\"maroon\">\"ABCDEFGH\"</span>;\n \n    <span class=\"green\">// Create text note without leader first</span>\n \n    <span class=\"teal\">TextNote</span> text = doc.Create.NewTextNote(\n      view, ptTextOrigin, baseVec, baseVec,\n      lineWidth, textAlign, strText );\n \n    <span class=\"green\">// Create leader for the new text: </span>\n    <span class=\"green\">// change the leader elbow and end;</span>\n    <span class=\"green\">// note that the elbow's Y should not be </span>\n    <span class=\"green\">// changed to keep horizontal!</span>\n \n    <span class=\"teal\">Leader</span> noteLeader = text.AddLeader(\n      <span class=\"teal\">TextNoteLeaderTypes</span>.TNLT_STRAIGHT_R );\n \n    <span class=\"green\">// Use default Y!</span>\n \n    noteLeader.Elbow = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>( leaderOrigin.X,\n      noteLeader.Elbow.Y, leaderOrigin.Z );\n \n    noteLeader.End = leaderOrigin;\n \n    tr.Commit();\n  }\n</pre>\n<p>Many thanks to Katsu-san, Jim and Pawel for this useful research and solution!</p>\n</p></p>"
  }
]