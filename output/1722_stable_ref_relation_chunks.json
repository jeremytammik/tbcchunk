[
  {
    "original_filename": "1722_stable_ref_relation",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\ntwitter:\n\nStable reference relationships in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon http://bit.ly/stablerefrel\n\nHåvard Leding explores relationships between stable reference of main elements and their sub-elements, related to the intriguing undocumented <code>ElementId</code> relationships and stable representation magic voodoo.\nWe need to access the sketch association to the element being sketched.\nI printed out stable references for 3 floors, and also the references for each <code>ModelLine</code> in their 3 <code>Sketch</code> elements...\n\n&ndash; \n...\n\nlinkedin:\n\nof [The Building Coder samples](https://github.com/jeremytammik/the_building_coder_samples/releases/tag/2019.0.145.4).\n\n-->"
  },
  {
    "original_filename": "1722_stable_ref_relation",
    "header_text": "Stable Reference Relationships",
    "local_header_href": "#stable-reference-relationships",
    "chunk_text": "### Stable Reference Relationships\n\nHåvard Leding of [Symetri](https://www.symetri.com) recently contributed\n[new RevitLookup commands for edges, faces and linked elements](https://thebuildingcoder.typepad.com/blog/2019/01/new-revitlookup-snoops-edge-face-link.html).\n\nHe now brings up a different topic, related\nthe intriguing [undocumented `ElementId` relationships](http://thebuildingcoder.typepad.com/blog/2011/11/undocumented-elementid-relationships.html)\nand [stable representation magic voodoo](http://thebuildingcoder.typepad.com/blog/2016/04/stable-reference-string-magic-voodoo.html).\n\nIn his own words:\n\nWe have a Revit Idea Station request to access \nthe [sketch association to the element being sketched](https://forums.autodesk.com/t5/revit-ideas/sketch-association-to-element-being-sketched/idi-p/8578998).\n \n> As a developer, I need access to the model lines that constitute the sketch lines for objects like Floors/Walls/Roofs etc.\nAs of now these sketch lines are contained in a Sketch.\nI need the stable reference of the Sketch element (or the ModelLines themselves) to reflect its subordinate relationship to the element being sketched.\nSo, the first part of a Sketch stable reference could be the UniqueId of a Floor, followed by its own Id.\n\nI printed out stable references for 3 floors, and also the references for each `ModelLine` in the 3 `Sketch` elements.\n\nI copy/pasted those into Excel and sorted them.\nAn obvious pattern emerges:\n\n<pre>\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ff91***FLOOR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ff92:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ff93:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ff94:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ff95:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ffa4***FLOOR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ffa5:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ffa6:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ffa7:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ffa8:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ffad***FLOOR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ffae:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ffaf:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ffb0:0:LINEAR\n37627a50-6c26-4b9d-a7cc-0deeb5800e11-0004ffb1:0:LINEAR\n</pre>\n\nI'm not sure this pattern can be fully trusted.\nThis is currently the only way I have found to connect sketch lines to the element they are sketching.\nThe lines would have to be sorted start to end.\nAnd, once in a `Curveloop`, sorted again by inner/outer loops.\n \nAn idea would be to put some data on the `Sketch` element that allows us to know which floor the sketch belongs to.\n\nStable references in Revit sometimes follow a format of \"Parent + sub identification\".\n\nHere are some examples with the parent part underlined:\n \n- Linked Element &ndash;\nA stable reference to a linked element is prefixed by the __RevitLinkedInstance.UniqueID__: \n__b4d5315c-7e9d-4bfe-a65e-ba68ec294640-0004fc27__:0:RVTLINK/b4d5315c-7e9d-4bfe-a65e-ba68ec294640-0004fc26:1471417\n- Face &ndash;\nA stable reference to a wall Face is prefixed by the __Wall.UniqueID__:\n__37627a50-6c26-4b9d-a7cc-0deeb5800e11-00050110__:28:SURFACE\n- Hatch pattern lines &ndash; \nA stable reference to a hatch pattern line is prefixed by the __Face.Reference__ it is placed on:\n__37627a50-6c26-4b9d-a7cc-0deeb5800e11-00050110:28:SURFACE__/1\n \nInvestigating this, I was hoping `Sketch` was using the same \"Parent + sub identification\" format.\n\nThat way we could get the element being sketched, i.e., the Parent.\n \nHaving something analogous like this would be nice:\n\n- Sketch &ndash; \nA stable reference to a Sketch is prefixed by the __Floor.UniqueID__ its belongs to:\n__17627a50-6c26-4b9d-a7cc-0deeb5800e11-00050110__:0:SKETCH\n\nI guess there already is a request for getting the profile of a Floor or Wall.\n\nTo do it now, we have to analyse each edge of each triangulated face.\n\nHere is an image of a Floor modelled by a landscape architect:\n\n<center>\n<img src=\"img/floor_by_landscape_architect.jpg\" alt=\"Floor modelled by a landscape architect\" width=\"423\">\n</center>\n\nMany thanks to Håvard for sharing these observations!"
  }
]