[
  {
    "original_filename": "0155_category_comparison_2",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<style>\n.blue { color: blue; }\n.teal { color: teal; }\n.maroon { color: maroon; }\n.green { color: green; }\n</style>"
  },
  {
    "original_filename": "0155_category_comparison_2",
    "header_text": "Category Comparison and Model Elements Revisited",
    "local_header_href": "#category-comparison-and-model-elements-revisited",
    "chunk_text": "<h3>Category Comparison and Model Elements Revisited</h3><p>This is a follow-up to two previous posts, on \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/01/category-comparison.html\">\ncategory comparison</a>\n\nand the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/05/selecting-model-elements.html\">\nselection of model elements</a>.\n\n<p>Regarding the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/01/category-comparison.html\">\ncategory comparison</a>,\n\nwe discussed the fact that categories cannot be compared directly, and one should use their element id instead.\nWe also underlined that every category comparison should be made language independent by using the built-in category enumeration and not comparing the localised category names.\n\nThe analysis of the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/05/selecting-model-elements.html\">\nmodel element selection</a>\n\nexamined how to eliminate the preview legend components from the selected elements, since they suddenly acquired geometry in Revit 2010 and also fit the other criteria applied in the selection process.</p>\n<p>As Miroslav Schonauer pointed out, the model element selection that I suggested in that post will not work, because various model elements exist that do not have a valid level assigned to them.\nHe suggests that the previous selection algorithm with an additional check added for the preview legend components probably remains the simplest and most reliable method.</p>\n<p>One deplorable aspect of the code presented there with the preview legend component check added is its language dependence.\nIt compares the element category name with the preview legend component one, which is \"Legend Components\".\nI left that in there because I thought I would use the alternative approach anyway, checking for a valid level.</p>\n<p>So now the issue is how to compare a given element's category against a built-in one without using the category name.\nIn previous similar situations, I achieved this by asking the document for the built-in category object and using its element id.\nThe Revit developers guide includes some sample code which demonstrates an extremely effective alternative method.\nIt avoids the string comparison and achieves language independence, and it also does not require the effort of querying the document settings for the element id of a built-it category.</p>\n<p>For built-in categories, the value of the element id is exactly the same as the integer resulting from casting the built-in category enumeration value.\nThe section 5.2.1 Category discusses details of the element category classification and explains:</p>\n<span style=\"color:darkblue\">\n<p>An element's category is determined by the Category ID.</p>\n<ul>\n<li>Category IDs are represented by the ElementId class.\n<li>Imported Category IDs correspond to elements in the document.\n<li>Most categories are built-in and their IDs are constants stored in ElementIds.\n<li>Each built-in category ID has a corresponding value in the BuiltInCategory Enumeration.\nThey can be converted to corresponding BuiltInCategory enumerated types.\n<li>If the category is not built-in, the ID is converted to a null value.\n</li></li></li></li></li></ul>\n</span>\n<p>The Code Region 14-1: 'Distinguishing permanent dimensions from constraints' in section 14.1 'Dimensions and Constraints' shows that we can actually use the built-in enum value to compare with an element category id directly, as in the following excerpted lines:</p>\n<pre class=\"code\">\n  <span class=\"blue\">if</span> ( (<span class=\"blue\">int</span>) <span class=\"teal\">BuiltInCategory</span>.OST_Dimensions\n    == dimension.Category.Id.Value )\n  {\n    message += <span class=\"maroon\">\"\\nDimension is a permanent dimension.\"</span>;\n  }\n</pre>\n<p>Making use of this for the model element selection, we can implement the following filter which is both language independent and efficient:</p>\n<pre class=\"code\">\n<span class=\"teal\">BuiltInCategory</span> _bicPreviewLegendComponent \n  = <span class=\"teal\">BuiltInCategory</span>.OST_PreviewLegendComponents;\n \n<span class=\"blue\">public</span> <span class=\"teal\">CmdResult</span> Execute(\n  <span class=\"teal\">ExternalCommandData</span> commandData,\n  <span class=\"blue\">ref</span> <span class=\"blue\">string</span> message,\n  <span class=\"teal\">ElementSet</span> elements )\n{\n  <span class=\"teal\">Application</span> app = commandData.Application;\n  <span class=\"teal\">Document</span> doc = app.ActiveDocument;\n \n  <span class=\"teal\">ElementIterator</span> it = doc.Elements;\n  <span class=\"blue\">string</span> s = <span class=\"blue\">string</span>.Empty;\n  <span class=\"blue\">int</span> count = 0;\n \n  Geo.<span class=\"teal\">Options</span> opt = app.Create.NewGeometryOptions();\n \n  <span class=\"blue\">int</span> iBic = (<span class=\"blue\">int</span>) _bicPreviewLegendComponent;\n \n  <span class=\"blue\">while</span>( it.MoveNext() )\n  {\n    <span class=\"teal\">Element</span> e = it.Current <span class=\"blue\">as</span> <span class=\"teal\">Element</span>;\n \n    <span class=\"blue\">if</span> ( !(e <span class=\"blue\">is</span> <span class=\"teal\">Symbol</span>)\n      &amp;&amp; !(e <span class=\"blue\">is</span> <span class=\"teal\">FamilyBase</span>)\n      &amp;&amp; (<span class=\"blue\">null</span> != e.Category)\n      &amp;&amp; ( iBic != e.Category.Id.Value )\n      &amp;&amp; (<span class=\"blue\">null</span> != e.get_Geometry( opt )) )\n    {\n      ++count;\n      s += <span class=\"blue\">string</span>.Format( \n        <span class=\"maroon\">\"\\r\\n  Category={0}; Name={1}; Id={2}\"</span>,\n        e.Category.Name, e.Name, \n        e.Id.Value.ToString() );\n    }\n  }\n \n  s = <span class=\"maroon\">\"There are \"</span> + count.ToString() \n    + <span class=\"maroon\">\" model elements:\"</span> + s;\n \n  <span class=\"teal\">LabUtils</span>.InfoMsg( s );\n \n  <span class=\"blue\">return</span> <span class=\"teal\">CmdResult</span>.Failed;\n}\n</pre>\n<p>Here is a snapshot of an updated version of the \n\n<a href=\"zip/rac_labs_2009-06-19.zip\">\nRevit API introduction labs</a>, \n\nincluding the updated version of Lab 2-2 to select all model elements using this criterion and other on-going improvements we have made. \nIn particular, it includes two completely new modules, Labs6 dealing with external application and event issues, and Labs7 demonstrating the form creation API.\nWe are still continuing the process of updating and enhancing them for the Revit 2010 API and its new features.\nAll of the labs are provided in two versions, one each for C# and VB.\nThis version also includes a set of HTML instructions for self-learning and AdnSamples.txt, an \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2008/11/loading-the-building-coder-samples.html\">\ninclude file</a>\n\nfor \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2008/09/loading-sdk-sam.html\">\nRvtSamples</a>\n\nthat I use to load all my external commands, updated to the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/05/porting-the-building-coder-samples.html\">\n2010 RvtSamples format</a>.</p>\n<h4>Revit Inside</h4>\n<p>By the way, if you are interested in seeing who else is using Revit, there is a \n\n<a href=\"http://www.revitinside.com\">\nRevit Inside</a>\n\nwebsite which tells you just that.\nThe people running the list are always interested in new entries as well, so don't hesitate to check it out and sign up if it applies to you.</p>\n</p>"
  },
  {
    "original_filename": "0155_category_comparison_2",
    "header_text": "Revit Inside",
    "local_header_href": "#revit-inside",
    "chunk_text": "<h4>Revit Inside</h4><p>By the way, if you are interested in seeing who else is using Revit, there is a \n\n<a href=\"http://www.revitinside.com\">\nRevit Inside</a>\n\nwebsite which tells you just that.\nThe people running the list are always interested in new entries as well, so don't hesitate to check it out and sign up if it applies to you.</p>"
  }
]