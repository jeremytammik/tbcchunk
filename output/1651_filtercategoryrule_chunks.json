[
  {
    "original_filename": "1651_filtercategoryrule",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<!--\n<script src=\"run_prettify.js\" type=\"text/javascript\"></script>\n<script src=\"https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js\" type=\"text/javascript\"></script>\n-->\n</head>\n\n<!---\n\n- 14200462 [Using FilterCategoryRule in the Revit API]\n  https://forums.autodesk.com/t5/revit-api-forum/using-filtercategoryrule-in-the-revit-api/m-p/7983645\n\nHow to use FilterCategoryRule in the #RevitAPI @AutodeskRevit #bim #dynamobim @AutodeskForge #ForgeDevCon http://bit.ly/filtercategoryrule\n\n@CaptainDan raised a very pertinent question in\nthe discussion forum on using <code>FilterCategoryRule</code> in the Revit API that\nled to some discussion and clarification with the development team:\nI have three questions regarding the filter rule represented by this class...\n\n--->"
  },
  {
    "original_filename": "1651_filtercategoryrule",
    "header_text": "How to use FilterCategoryRule",
    "local_header_href": "#how-to-use-filtercategoryrule",
    "chunk_text": "### How to use FilterCategoryRule\n\n[@CaptainDan](https://forums.autodesk.com/t5/user/viewprofilepage/user-id/1003305) raised\na very pertinent question in\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\non [using `FilterCategoryRule` in the Revit API](https://forums.autodesk.com/t5/revit-api-forum/using-filtercategoryrule-in-the-revit-api/m-p/7983645) that\nled to some discussion and clarification with the development team:\n\n**Question:** I have three questions regarding the filter rule represented by the class `FilterCategoryRule`:\n\n1. What does this rule correspond to in the Revit user interface?\n2. If this filters by category, then what is the relationship between the set of categories assigned to this rule and the set of categories passed\nto [`ParameterFilterElement.Create`](http://www.revitapidocs.com/2018.1/afa22520-52de-c6b3-fac8-246fe2f8e4fe.htm)?\n3. How do I successfully create a filter based on this filter rule?\n\nWhenever I try to create a filter using this filter rule, it throws a Revit exception of type `InternalException` saying:\n\n- *An internal error has occurred*\n\nI tried the same code in Revit 2017 and 2018 with the same exception occurring.\n\nI searched the Internet and SDK and couldn't find much mention of it anywhere.\n\nThe Revit API help docs on [FilterCategoryRule](http://www.revitapidocs.com/2018.1/7df5b10b-c423-b5c8-6492-1274d7a447d9.htm) just\nsay *A filter rule that matches elements of a set of categories*.\n\n\n\n**Answer:** Yes, the only significant mention of this that I can find is from The Building Coder\non [What's New in the Revit 2014 API](http://thebuildingcoder.typepad.com/blog/2013/04/whats-new-in-the-revit-2014-api.html)\n[small enhancements &amp; interface changes](http://thebuildingcoder.typepad.com/blog/2013/04/whats-new-in-the-revit-2014-api.html#3):\n\n####<a name=\"3\"></a>FilterCategoryRule\n\nThe new class FilterCategoryRule can be used in the definition of a ParameterFilterElement.\nIt represents a filter rule that matches elements of a set of categories.\n\nThe related method:\n\n- ParameterFilterElement.AllCategoriesFilterable()\n\nhas been replaced by\n\n- FilterCategoryRule.AllCategoriesFilterable()\n\nI passed on your questions to the development team, and they reply:\n\n1. Q: What does `FilterCategoryRule` correspond to in the Revit user interface?\n<br/>&ndash; A: There is no direct correspondence in Revit UI, this is the FilterRule to be used in API.\n\n2. Q: If this filters by category, then what is the relationship between the set of categories assigned to this rule and the set of categories passed to `ParameterFilterElement.Create()`?\n<br/>&ndash; A: There is no relation to `ParameterFilterElement.Create`.\n\n3. Q: How do I successfully create a filter based on this filter rule?\n<br/>&ndash; A: You cannot create a `ParameterFilterElement` based on this `FilterCategoryRule`, but you can create an `ElementParameterFilter`, an API construct, based on it.\n\nHere is an example:\n\n<pre class=\"code\">\n  // Find all walls and windows in the document\n\n  <span style=\"color:#2b91af;\">IList</span>&lt;<span style=\"color:#2b91af;\">ElementId</span>&gt;&nbsp;cats&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">List</span>&lt;<span style=\"color:#2b91af;\">ElementId</span>&gt;();\n  cats.Add(&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">ElementId</span>(&nbsp;<span style=\"color:#2b91af;\">BuiltInCategory</span>.OST_Walls&nbsp;)&nbsp;);\n  cats.Add(&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">ElementId</span>(&nbsp;<span style=\"color:#2b91af;\">BuiltInCategory</span>.OST_Windows&nbsp;)&nbsp;);\n  <span style=\"color:#2b91af;\">FilterCategoryRule</span>&nbsp;r&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">FilterCategoryRule</span>(&nbsp;cats&nbsp;);\n   \n  <span style=\"color:#2b91af;\">ElementParameterFilter</span>&nbsp;f&nbsp;\n  &nbsp;&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">ElementParameterFilter</span>(&nbsp;r,&nbsp;<span style=\"color:blue;\">true</span>&nbsp;);\n   \n  <span style=\"color:#2b91af;\">FilteredElementCollector</span>&nbsp;wallsAndWindows&nbsp;\n  &nbsp;&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">FilteredElementCollector</span>(&nbsp;doc&nbsp;)\n  &nbsp;&nbsp;&nbsp;&nbsp;.WherePasses(&nbsp;f&nbsp;);\n</pre>\n\nThe Revit API docs are confusing and not entirely correct, especially this statement: \"The new class FilterCategoryRule can be used in the definition of a ParameterFilterElement\". the `ParameterFilterElement.Create` method could potentially take a `FilterCategoryRule` object instead of a set of category ids, but this flavour of the `Create` method was never introduced. We have filed a development task to either correct the docs or add the method. Additional confusion comes from the two API names: `ParameterFilterElement` and `ElementParameterFilter` &nbsp; :-~ \n\nJust as [Benoit](https://forums.autodesk.com/t5/user/viewprofilepage/user-id/4496032) points\nout, `FilterCategoryRule` can simply be seen as an extension of\nthe [ElementCategoryFilter](http://www.revitapidocs.com/2018.1/b492ddf4-3058-8f9b-dfcc-8d5c4abb3605.htm)\nand the associated quick filter shortcut methods \n[OfCategory](http://www.revitapidocs.com/2018.1/c3523c35-4a07-9723-3c28-de3cc47b2ad0.htm)\nand [OfCategoryId](http://www.revitapidocs.com/2018.1/63304108-73f8-844e-82fc-5b8fad9839b0.htm).\n\nIt seems to me that it is completely equivalent to a logical or of a bunch of `ElementCategoryFilter` instances, such as I used in the MEP and structural filtered element collector examples:\n\n- [Retrieve MEP elements](http://thebuildingcoder.typepad.com/blog/2010/06/retrieve-mep-elements-and-connectors.html)\n- [Retrieve structural elements](http://thebuildingcoder.typepad.com/blog/2010/07/retrieve-structural-elements.html)\n\n<center>\n<img src=\"img/steel_ruler_closeup.jpg\" alt=\"Steel rule\" width=\"320\"/>\n</center>"
  }
]