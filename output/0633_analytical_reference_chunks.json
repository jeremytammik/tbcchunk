[
  {
    "original_filename": "0633_analytical_reference",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0633_analytical_reference",
    "header_text": "Reference to Analytical Curve",
    "local_header_href": "#reference-to-analytical-curve",
    "chunk_text": "<h3>Reference to Analytical Curve</h3><p>The \n\n<!-- \n\nThe Autodesk University 2011 Class Catalog is Live!  \n\nautode.sk/n9rymL \n#AU2011 \n\n<a href=\"http://au.autodesk.com/?nd=au2011_class_catalog&und=712\">\n\n-->\n<a href=\"http://au.autodesk.com/?nd=au2011_class_catalog\">Autodesk University 2011 Class Catalog</a> is \n\nnow live and includes a full listing of both AU Las Vegas and AU Virtual Classes.  \nHere are the my three classes:\n\n<ul>\n<li>Lecture <a href=\"http://au.autodesk.com/?nd=event_class&amp;session_id=9263&amp;jid=1725754\">CP4451</a>: Extensible Storage in the Revit 2012 API\n<li>Hands-On Lab <a href=\"http://au.autodesk.com/?nd=event_class&amp;session_id=9267&amp;jid=1725754\">CP6760-L</a>: Revit 2012 API Extensible Storage\n<li>Virtual <a href=\"http://au.autodesk.com/?nd=event_class&amp;session_id=9726&amp;jid=1725754\">CP4453</a>: Everything in Place with Revit MEP Programming\n</li></li></li></ul>\n<p>So I have lots to prepare. \nFor a full list of the classes presented by my colleagues in the ADN team, please refer to \n\n<a href=\"http://through-the-interface.typepad.com/through_the_interface/2011/08/preview-of-the-au-2011-class-catalog.html\">\nKean's post</a>.\n\n<p>Meanwhile, here is a structural issue for a change:\n\n<p>The Revit Structure API has undergone significant changes in every release lately.\nOnce the whole rebar functionality was updated, and in the last release it was the analytical model.\nThis obviously causes some complexity and upheaval.\n\n<p>In Revit Structure 2012, the analytical component was separated into its own independent Element, the AnalyticalModel element.  \nThis is different from previous releases, where AnalyticalModel was a proxy for the analytical portion of the physical Element.  \nThe interface to the AnalyticalModel was not changed, so the AnalyticalModel.getCurve method still works, for instance.\n\n<p>Therefore, each Structural Column and Structural Beam actually has two Elements in RST 2012: the physical portion, which is a FamilyInstance, and the \n\nanalytical portion, the AnalyticalModel.\n\n<p>One consequence of this is that the reference on the analytical model will be different than the reference on the physical element, because it \n\nis not on the physical element any more.\n\n<p>Here is a question concerning this raised and also answered by Elizabeth Shulok of \n\n<a href=\"http://structuralintegrators.com\">\nStructural Integrators, LLC</a>\n\non obtaining a \n\n<a href=\"http://wikihelp.autodesk.com/Revit/enu/2012/Help/API_Dev_Guide/0074-Revit_Ge74/0108-Geometry108/0111-Geometry111\">\nstable geometric reference</a> to\n\nthe end point of the analytical curve of a structural member element that highlights some of these changes:\n\n\n<p><strong>Question:</strong> I am trying to add a new point boundary condition to a Revit project via the API. \nIt requires a geometry reference to a beam, brace or column analytical line end. \nIn my code, after adding beams and columns and calling Regenerate, I find the column whose end coincides with the point of the boundary condition I want to add using a BoundingBoxContainsPointFilter ANDed with a StructuralInstanceUsageFilter. \nThe problem is that I cannot get a stable reference from the column's curve which I am getting from the AnalyticalModel. \nCalling get_EndPointReference(0) returns null. \nWhat could cause the curve of a newly added column not to have a reference?\n\nAnother alternative approach that I also tried instead of calling GetCurve or Curve on the analytical model was to call get_Geometry on the Element itself with the option argument ComputeReferences property set to true.\nI was then able to obtain the curve from the GeometryElement returned from get_Geometry, but that did not help either.\n\n<p><strong>Answer:</strong> In versions prior to 2012, you could get the analytical model curve from the Element Geometry property (using the get_Geometry method in C#). \nHowever, in Revit 2012, the analytical model curves cannot be retrieved this way.  \nThey can only be obtained from the AnalyticalModel class.\n\n<p>In this case, you can use the AnalyticalModelSelector.\n\n<p>We just added a new code sample using AnalyticalModelSelector to the Revit API help wiki;\nlook at the \n\n<a href=\"http://wikihelp.autodesk.com/Revit/enu/2012/Help/API_Dev_Guide/0000-API_Deve0/0122-Disciple122/0126-Revit_St126/0129-Loads129\">\n29-15 NewPointLoad() sample</a> at \n\nthe bottom of the page. \n\n<p>Getting the geometric reference to the analytical curve start point like this works well:\n\n<pre class=\"code\">\n  <span class=\"teal\">AnalyticalModel</span> analyticalModel = fiColumn\n    .GetAnalyticalModel() <span class=\"blue\">as</span> <span class=\"teal\">AnalyticalModel</span>;\n \n  <span class=\"teal\">Reference</span> startReference = <span class=\"blue\">null</span>;\n \n  <span class=\"blue\">if</span>( <span class=\"blue\">null</span> != analyticalModel )\n  {\n    <span class=\"teal\">Curve</span> curveCol = analyticalModel.GetCurve();\n    <span class=\"blue\">if</span>( <span class=\"blue\">null</span> != curveCol )\n    {\n      <span class=\"teal\">AnalyticalModelSelector</span> amSelector \n        = <span class=\"blue\">new</span> <span class=\"teal\">AnalyticalModelSelector</span>( curveCol );\n \n      amSelector.CurveSelector \n        = <span class=\"teal\">AnalyticalCurveSelector</span>.StartPoint;\n \n      startReference = analyticalModel\n        .GetReference( amSelector );\n    }\n  }\n</pre>\n<p>Many thanks to Elizabeth for her research and sharing this solution!\n</p></p></p></p></p></p></p></p></p></p></p></p></p></p>"
  }
]