[
  {
    "original_filename": "0727_balaji_setcompoundstr",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0727_balaji_setcompoundstr",
    "header_text": "Updating the Wall Compound Layer Structure",
    "local_header_href": "#updating-the-wall-compound-layer-structure",
    "chunk_text": "<h3>Updating the Wall Compound Layer Structure</h3><p>We have a new Revit API supporter on the DevTech team!\n\n<p>Balaji joined ADN DevTech a year or two ago and dived straight into supporting AutoCAD with great zest, setting new records in speed and efficiency.\nNow he addressed his first Revit API case, on how to update a wall compound layer structure.\n\n<p>We touched on this topic in the past when discussing the new \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/03/many-issues-resolved.html#1264438\">\nchanges made to the CompoundStructure class</a> in\n\nRevit 2012.\n\n<p>An example is also given by the CmdNewWallLayer external command in The Building Coder samples, which required a complete rewrite due to these changes when \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/04/migrating-the-building-coder-samples-to-revit-2012.html\">\nmigrating The Building Coder samples to Revit 2012</a>.\n\n<p>Here is Balaji's case:\n\n\n<p><strong>Question:</strong> I have been updating wall layers through the API, but I am having trouble with the layer thicknesses in a wall with a compound structure. What might I be doing wrong?\n\n<p><strong>Answer:</strong> As explained in the ADN technical solution on\n\n<a href=\"http://adn.autodesk.com/adn/servlet/devnote?siteID=4814862&amp;id=16779684&amp;linkID=4901650\">\nChanges to compound layer don't apply to wall type</a>, \n\naccessible to ADN members only, GetCompoundStructure works on a copy and the modifications to the compound structure do not change the original type until SetCompoundStructure is called.\n\n<p>Here is a snippet of sample code that uses the CompoundStructure SetLayerWidth method and works ok:\n\n<pre class=\"code\">\n  <span class=\"teal\">UIApplication</span> uiApp = commandData.Application;\n  <span class=\"teal\">UIDocument</span> uiDoc = uiApp.ActiveUIDocument;\n  <span class=\"teal\">Document</span> doc = uiDoc.Document;\n \n  <span class=\"teal\">Transaction</span> trans = <span class=\"blue\">new</span> <span class=\"teal\">Transaction</span>( doc );\n  trans.Start( <span class=\"maroon\">\"changeLayerWidth\"</span> );\n \n  <span class=\"teal\">Reference</span> ref1 = uiDoc.Selection.PickObject( \n    <span class=\"teal\">ObjectType</span>.Element, <span class=\"maroon\">\"Pick a wall\"</span> );\n \n  <span class=\"teal\">ElementId</span> id = ref1.ElementId;\n  <span class=\"teal\">Element</span> elem = doc.get_Element( id );\n  <span class=\"teal\">Wall</span> wall = elem <span class=\"blue\">as</span> <span class=\"teal\">Wall</span>;\n  <span class=\"blue\">if</span>( wall == <span class=\"blue\">null</span> )\n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Failed;\n \n  <span class=\"teal\">CompoundStructure</span> cs \n    = wall.WallType.GetCompoundStructure();\n \n  <span class=\"blue\">double</span> layerWidth = 0.2;\n  <span class=\"blue\">int</span> layerIndex = cs.GetFirstCoreLayerIndex();\n \n  <span class=\"teal\">IList</span>&lt;<span class=\"teal\">CompoundStructureLayer</span>&gt; cslayers \n    = cs.GetLayers();\n \n  <span class=\"blue\">foreach</span>( <span class=\"teal\">CompoundStructureLayer</span> csl <span class=\"blue\">in</span> cslayers )\n  {\n    cs.SetLayerWidth( layerIndex, layerWidth );\n    layerIndex++;\n  }\n  wall.WallType.SetCompoundStructure( cs );\n  trans.Commit();\n</pre>\n<p>I verified the total wall thickness and it does add up correctly.\n\n<p>Many thanks to Balaji for this solution, and congratulations on answering your first Revit API ADN case!\nWelcome to the club!\n\n</p></p></p></p></p></p></p></p></p></p>"
  }
]