[
  {
    "original_filename": "1451_custom_export_adn_2017",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<title>The Building Coder</title>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"3dwc.css\"/>\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?autoload=true\" defer=\"defer\"></script>\n</head>\n\n<!---\n\n- Migrated CustomExporterAdnMeshJson from Revit 2014 to Revit 2017\n  https://github.com/jeremytammik/CustomExporterAdnMeshJson/releases/tag/2017.0.0.1\n  prompted by comments from Helen Huang\n\nExporting RVT BIM to WebGL and Forge #revitapi #3dwebcoder @AutodeskForge #ForgeDevCon #3dwebaccel\n\nExporting RVT #BIM to #JSON, #WebGL and @AutodeskForge #revitapi #3dwebcoder @AutodeskRevit #threejs\n\n\nI am happy to say that I returned safe and sound to Switzerland from my travels for the Forge DevCon and Cloud Accelerator. Since then, I rounded off the hierarchical MEP system exporter to a JSON graph for interaction with it in the Forge viewer, worked on an update of the ADN JSON mesh exporter and helped my son Christopher getting started with C# scripting to drive audio effects for professional spatialized sound design for computer games\n&ndash; More TraverseAllSystems updates\n&ndash; CustomExporterAdnMeshJson updates\n&ndash; ADN JSON Exporter Alternatives to View RVT in WebGL\n&ndash; vA3C\n&ndash; The Forge Viewer\n&ndash; Getting started with Unity C# scripting\n&ndash; Opendesk at Autodesk Forge Accelerator Barcelona...\n\n-->"
  },
  {
    "original_filename": "1451_custom_export_adn_2017",
    "header_text": "Exporting RVT BIM to JSON, WebGL and Forge",
    "local_header_href": "#exporting-rvt-bim-to-json-webgl-and-forge",
    "chunk_text": "### Exporting RVT BIM to JSON, WebGL and Forge\n\nI am happy to say that I returned safe and sound to Switzerland from my long stay in San Francisco for\nthe [Forge DevCon](http://forge.autodesk.com/conference) developer conference\nand [Cloud Accelerator](http://autodeskcloudaccelerator.com).\n\nI travelled there via Vancouver, paradoxically saving a little bit on airfare costs:\n\n<!-- and enabling me to visit my son Christopher -->\n\n<center>\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/jeremytammik/albums/72157670359072255\" title=\"Vancouver\"><img src=\"https://c8.staticflickr.com/8/7554/27886955751_5bda328ae8_n.jpg\" width=\"320\" height=\"240\" alt=\"Vancouver\"></a><script async src=\"//embedr.flickr.com/assets/client-code.js\" charset=\"utf-8\"></script>\n</center>\n\nDuring the trip back and since, I rounded off the hierarchical MEP system exporter to a JSON graph for interaction with it in\nthe [Forge viewer](https://developer.autodesk.com/en/docs/viewer/v2/overview/),\nworked on an update of the ADN JSON mesh exporter, and, last but not least, helped Christopher getting started with C# scripting to drive audio effects for professional spatialized sound design in Unity computer games:\n\n- [More TraverseAllSystems updates](#2)\n- [CustomExporterAdnMeshJson updates](#3)\n- [ADN JSON Exporter Alternatives to View RVT in WebGL](#4)\n    - [vA3C](#5)\n    - [The Forge Viewer](#6)\n- [Getting started with Unity C# scripting](#7)\n- [Opendesk at Autodesk Forge Accelerator Barcelona](#8)"
  },
  {
    "original_filename": "1451_custom_export_adn_2017",
    "header_text": "<a name=\"2\"></a>More TraverseAllSystems Updates",
    "local_header_href": "#a-name2amore-traverseallsystems-updates",
    "chunk_text": "#### <a name=\"2\"></a>More TraverseAllSystems Updates\n\nAt the San Francisco cloud accelerator, I started working on\nthe [TraverseAllSystems](https://github.com/jeremytammik/TraverseAllSystems) add-in\nto [traverse all MEP system graphs](http://thebuildingcoder.typepad.com/blog/2016/06/traversing-and-exporting-all-mep-system-graphs.html) and\nexport their connected hierarchical structure to XML files and\na [top-down JSON graph](http://thebuildingcoder.typepad.com/blog/2016/06/store-mep-systems-in-hierarchical-json-graph.html) for\nthe [University of Southern California](http://www.usc.edu)\n[Facilities Management](http://facilities.usc.edu)\n[CAD Services](http://facilities.usc.edu/multisidebar_sublinks.asp?ItemID=236) team.\n\nHere is a picture from the last day at\nthe [Forge Cloud Accelerator](http://autodeskcloudaccelerator.com) of\nthe entire USC team, other accelerator participants, and, from the Autodesk side, me, Cyrille Fauvel, Augusto Gon√ßalves, Shiya Luo, Adam Nagy, Zhong John Wu, Xiaodong Liang and Philippe Leefsma:\n\n<center>\n<img src=\"img/2016-06-23_forge_accelerator_participants.jpg\" alt=\"San Francisco cloud accelerator participants\" width=\"500\">\n</center>\n\nThe aim of the TraverseAllSystems project is to present the MEP system graphs in a separate tree view panel integrated in\nthe [Forge viewer](https://developer.autodesk.com/en/docs/viewer/v2/overview) and\nhook up the tree view nodes bi-directionally with the 2D and 3D viewer elements.\n\nThe [simple MEP system traversal](http://thebuildingcoder.typepad.com/blog/2013/02/simple-mep-system-traversal.html) shows\nhow to retrieve an unsorted list of system elements, if the connection graph is not needed.\n\nWith the newest enhancements, TraverseAllSystems provides the following functionality:\n\n- Store the MEP system graph structure in JSON.\n- Implement both bottom-up and top-down storage according to\nthe [jsTree JSON spec](https://www.jstree.com/docs/json).\n- Support both element id and UniqueId node identifiers.\n- Store the JSON output in a shared parameter attached to the MEP system element,\nso that it is automatically included in the Forge SVF translation generated from the RVT input file.\n- Store the entire JSON graph for all systems on the project info singleton element in the RVT file instead of separate subgraphs on each individual system.\n- Implement a [jsTree test page](https://jeremytammik.github.io/TraverseAllSystems/test) on GitHub pages.\n- Integrate [pull request #1](https://github.com/jeremytammik/TraverseAllSystems/pull/1)\nfrom [Ziyu Cheng](https://github.com/ChengZY) adding\nsingle level trees listing all elements of each system.\n\nOne of the main new features is the gh-pages hosted online [jsTree test page](https://jeremytammik.github.io/TraverseAllSystems/test).\n\nThere is currently one manual step involved in generating the jsTree test page: I copy the JOSN graph string from the Visual Studio debug output window to the respective JSON source files in the test subfolder. That could easily be automated, but for now, I will leave it as it is.\n\nHere is the detailed list of the newer releases:\n\n- [2017.0.0.10](https://github.com/jeremytammik/TraverseAllSystems/releases/tag/2017.0.0.10) &ndash; implemented jstree test file and verified proper tree population.\n- [2017.0.0.11](https://github.com/jeremytammik/TraverseAllSystems/releases/tag/2017.0.0.11) &ndash; implemented test page in gh-pages and test link to it, split out test treedata into separate json file.\n- [2017.0.0.12](https://github.com/jeremytammik/TraverseAllSystems/releases/tag/2017.0.0.12) &ndash; added json sample data from rme_advanced_sample_model.\n- [2017.0.0.13](https://github.com/jeremytammik/TraverseAllSystems/releases/tag/2017.0.0.13) &ndash; removed duplicate root id -1.\n- [2017.0.0.14](https://github.com/jeremytammik/TraverseAllSystems/releases/tag/2017.0.0.14) &ndash; store entire json graph for all systems on project info instead of separate subgraph on each individual system.\n- [2017.0.0.15](https://github.com/jeremytammik/TraverseAllSystems/releases/tag/2017.0.0.15) &ndash; before integrating pull request #1 from @ChengZY.\n- [2017.0.0.16](https://github.com/jeremytammik/TraverseAllSystems/releases/tag/2017.0.0.16) &ndash; integrated pull request #1 by @ChengZY.\n- [2017.0.0.17](https://github.com/jeremytammik/TraverseAllSystems/releases/tag/2017.0.0.17) &ndash; split into three domain specific subgraphs and add full element description.\n- [2017.0.0.18](https://github.com/jeremytammik/TraverseAllSystems/releases/tag/2017.0.0.18) &ndash; removed redundant top-level nodes and used hash code to generate unique jstree ids for top-level project, mechanical, electrical and piping nodes.\n\nThe current state of this project is available from\nthe [TraverseAllSystems GitHub repository](https://github.com/jeremytammik/TraverseAllSystems), and the version discussed above\nis [release 2017.0.0.18](https://github.com/jeremytammik/TraverseAllSystems/releases/tag/2017.0.0.18).\n\nAs said, the next step will consist of the Forge viewer extension implementation displaying a custom panel in the user interface hosting a tree view of the MEP system graphs and implementing two-way linking and selection functionality back and forth between the tree view nodes and the 2D and 3D viewer elements.\n\n<!--- Do the Elements and ComnnectorManager properties return all system elements?\n\n/a/src/forge/usc-forge/\n\nhttps://docs.google.com/document/d/1nWrnWucfnIahIosIFKagMYlkjITldb3lZ7NF_IUAlSU/edit?usp=sharing_eid&invite=CIS997cK&ts=57684551\n\nhttps://github.com/kevinscake/usc-forge/\n\n- usc fm project\n  https://miniruby.atlassian.net/secure/WelcomeToJIRA.jspa jeremy.tammik@autodesk.com qy\n  https://miniruby.atlassian.net/secure/RapidBoard.jspa?projectKey=FOR&useStoredSettings=true&rapidView=3\n  https://docs.google.com/document/d/1nWrnWucfnIahIosIFKagMYlkjITldb3lZ7NF_IUAlSU/edit?usp=sharing_eid&invite=CIS997cK&ts=57684551\n\n--->"
  },
  {
    "original_filename": "1451_custom_export_adn_2017",
    "header_text": "<a name=\"3\"></a>CustomExporterAdnMeshJson Updates",
    "local_header_href": "#a-name3acustomexporteradnmeshjson-updates",
    "chunk_text": "#### <a name=\"3\"></a>CustomExporterAdnMeshJson Updates\n\nDuring the trip back to Europe, I had an extensive correspondence with Helen Huang via a series of comments\non [The Building Coder](http://thebuildingcoder.typepad.com) discussion\non the [ADN Mesh Data Custom Exporter to JSON](http://thebuildingcoder.typepad.com/blog/2013/07/adn-mesh-data-custom-exporter-to-json.html):\n\n**Question:** I tried to use the code to export the Revit sample project to JSON.\n\nHowever, I got a 'cannot divide by zero' exception in the `CustomerExporter.Export` function.\n\nMy Revit version is 2016.\n\nI wonder if you have a version of the JSON Exporter that works with this version of Revit.\n\nMuch thanks for your help!\n\n**Answer:** I no longer have Revit 2016 installed, so I cannot say.\n\nI am sure you will be able to find one.\n\nI do not think that the version of JSON library has any effect on the custom exporter.\n\nGood luck!\n\n**Question:** I wonder if you can also help me to understand the meaning of NormalIndices in your example.\nNot sure why all vertices are repeated three times here... Much thanks for your help!\n\n<pre>\n  \"NormalIndices\":[0,0,0, 1,1,1, 2,2,2, 3,3,3]\n</pre>\n\n**Answer:** Yes, this is easy to explain, although it highlights a rather inefficient aspect of the data structure used in this sample.\n\nThere are four triangles, each with three vertices, resulting in a total count of 12 vertices.\n\nHence the 12 numbers in the list of normal indices.\n\nEach one of these is an index into the list of normals.\n\n`Normals` defines coordinates for four normal vectors, one for each triangle, hence the values of these 12 numbers range from 0 to 3.\n\nEach group of 3 numbers specifies the normal vector for three triangle vertices.\n\nEach triangle has the same normal vector at each of its corners, so each number repeats three times.\n\nThe result is flat triangles, with sharp corners between each of them.\n\nI hope this clarifies.\n\n**Response:**\nI can upgrade to Revit 2017 if that is the one you are using. Let me try the exporter again with Revit 2017 and see if it works. Thanks!\n\n**Answer:** I created\na [GitHub repository for the CustomExporterAdnMeshJson project](https://github.com/jeremytammik/CustomExporterAdnMeshJson),\n[migrated the code to Revit 2017](https://github.com/jeremytammik/CustomExporterAdnMeshJson/releases/tag/2017.0.0.0) for\nyou, and performed a successful test using [version 2017.0.0.1](https://github.com/jeremytammik/CustomExporterAdnMeshJson/releases/tag/2017.0.0.1).\n\n**Response:** I tried the new code with Revit 2017, unfortunately I still got the same exception. I took a couple of screenshots for you. Can you please take a look and see what might be wrong? Also, I wonder if you can share the source code of the exporter. I will be able to step through the code find out more information for you to debug that way.\n\nBy the way my Revit 2017 is a trial version. Do you think it matters?\n\nThe following are the steps to reproduce. Hope they are helpful.\n\n- Build latest code\n- Run Revit 2017, open the rac_basic_sample_project in 3D view. Select one object, like the roof, and click the add in, and the exception will be thrown. I tried selection multiple objects, and also not selecting any objects before trying the exporter, but all ends up with the same exception.\n\nMuch thanks again for your help!\n\n**Answer:** Thank you very much for your testing and pointing this out.\n\nNo, I do not have access to the source code of the exporter, so I cannot provide that.\n\nYes, I can reproduce what you describe:\n\n<center>\n<img src=\"img/custom_exporter_adn_mesh_json_crash_3.png\" alt=\"Custom JSON exporter exception\" width=\"500\">\n</center>\n\nI removed the some of the calls to throw an exception in the custom export context class, but I still see the following lines logged in the Visual Studio debug output window just before and after the export context Finish method is called:\n\n<pre>\n  InstanceEnd\n  ElementEnd\n  ElementBegin id 423099\n  ElementEnd\n  Exception thrown: 'Autodesk.Revit.Exceptions.ArgumentException' in RevitAPI.dll\n  Finish\n  Exception thrown: 'Autodesk.Revit.Exceptions.ExternalApplicationException' in RevitAPI.dll\n</pre>\n\nSorry, I cannot explore this further myself, so I raised the issue <i><b>REVIT-94525</b> CustomExporter throws ExternalApplicationException after call to Finish</i> with the development team for them to analyse in more depth.\n\nI hope there is a simple solution to this.\n\nLater: Unexpected good news: wrap the call to exporter.Export in an exception handler and all is well,\ncf. [release 2017.0.0.3](https://github.com/jeremytammik/CustomExporterAdnMeshJson/releases/tag/2017.0.0.3).\n\nI rather suspect that this add-in code is flawed in some manner, though.\n\nI hope the devteam will clarify based on the exploration of REVIT-94525.\n\nMeanwhile, you have a stop-gap solution.\n\n**Response:** Thank Jeremy for your quick response. Can you please let me know how to follow up the issue that you have opened, REVIT-94525?\n\n**Answer:** All you can do about an internal development issue is wait, and prompt me or one of my colleagues for an update status when you feel you have waited long enough. The best channel for such a prompt is the [Revit API discussion forum](http://forums.autodesk.com/t5/Revit-API/bd-p/160), since that is monitored by the entire developer support team.\n\nSorry, that we cannot provide an externally accessible online access to the development database."
  },
  {
    "original_filename": "1451_custom_export_adn_2017",
    "header_text": "<a name=\"4\"></a>ADN JSON Exporter Alternatives to View RVT in WebGL",
    "local_header_href": "#a-name4aadn-json-exporter-alternatives-to-view-rvt-in-webgl",
    "chunk_text": "#### <a name=\"4\"></a>ADN JSON Exporter Alternatives to View RVT in WebGL\n\n**Response:** Thanks a lot for your time and effort. I tried your latest code, revision 2017.0.0.3, and was able to export the model finally. However, it does not seem right after I loaded it with the json/webgl viewer mentioned on this blog. Some of the components of the building are missing. I guess these components could be the ones that have caused the exceptions that we have seen before.\n\nI also looked at the exported json model, and found it does not contain the information on materials and textures...\nI wonder if you have another exporter which does export this information, along with the faces, indices and normals?\nIt does not have to use this particular json format...\n\nOur goal is to export the Revit model and show it in webgl, and hopefully, when a user clicks any component\nof the model in the web browser, we shall be able to display more information for that component, like the component's name and id... I guess we might have to come up with our own exporter at some point. but can you please point us to some good examples to get started...\n\nReally appreciate your help!\n\n**Answer:** Thank you for your appreciation and extremely sensible question.\n\nI was planning to get to that as well, to ask you what your final goal actually is.\n\nThis sample is really targeted at just demonstrating the Revit custom exporter and the custom ADN JSON format.\n\nFor real-world use, however, forget it.\n\nHappily, there are lots of alternatives.\n\nThe two alternatives of choice would be [vA3C](#5) and the [Forge Viewer](#6)."
  },
  {
    "original_filename": "1451_custom_export_adn_2017",
    "header_text": "<a name=\"5\"></a>vA3C",
    "local_header_href": "#a-name5ava3c",
    "chunk_text": "#### <a name=\"5\"></a>vA3C\n\n[vA3C](https://va3c.github.io) is an open-source WebGL AEC viewer, complete with a C# .NET Revit API add-in exporter. The advantage of this one is that it is completely open source, also based on the custom exporter, this time exporting the complete model to the\nstandard [three.js WebGL format](http://threejs.org).\nIts disadvantages: lack of support for materials and textures, does not perform well for really large models."
  },
  {
    "original_filename": "1451_custom_export_adn_2017",
    "header_text": "<a name=\"6\"></a>The Forge Viewer",
    "local_header_href": "#a-name6athe-forge-viewer",
    "chunk_text": "#### <a name=\"6\"></a>The Forge Viewer\n\nThe [Forge Viewer](https://developer-autodesk.github.io) is\nan important part of the official Autodesk Forge platform with full support for materials, textures, and really large models. In fact, it used to be nicknamed LMV for large model viewer.\n\nThe Forge viewer is completely open source and also based on three.js WebGL. It consumes a JSON stream in a format named `SVF`.\nThe Forge platform supports translation of over 60 CAD seed file formats to SVF, so you can display and interactively manipulate views coming from  basically any standard CAD format.\n\nThe translation process is not open source and happens on Autodesk servers.\n\nAll use of the entire Forge platform is completely free for all research and software development. Customers can use it for free up to a certain limit. The exact limit is currently in the process of being defined, and until September 15 absolutely all usage of Forge is completely free.\n\nProbably, the Forge viewer is the most promising possibility for you to explore further.\n\nFor more information, please refer to:\n\n- [vA3C](http://thebuildingcoder.typepad.com/blog/2014/05/rvtva3c-revit-va3c-generic-aec-viewer-json-export.html)\n- [Custom exporter](http://thebuildingcoder.typepad.com/blog/about-the-author.html#5.1)\n- [Forge Platform API](https://developer.autodesk.com)\n- [Forge](http://forge.autodesk.com)\n\nFor more information on samples connecting Revit models with Forge, please refer to my recent presentation\non [Freeing your BIM data](http://thebuildingcoder.typepad.com/blog/2016/06/free-your-bim-data-and-roomedit3d-thee-legged-forge-oauth.html).\n\nI also implemented a number of earlier samples on connecting the desktop and the cloud, e.g., RoomEditorApp, FireRatingCloud and Roomedit3d, all available from GitHub and extensively documented by The Building Coder."
  },
  {
    "original_filename": "1451_custom_export_adn_2017",
    "header_text": "<a name=\"7\"></a>Unity Scripting and C# Events",
    "local_header_href": "#a-name7aunity-scripting-and-c-events",
    "chunk_text": "#### <a name=\"7\"></a>Unity Scripting and C# Events\n\n<!-- My son [Christopher](http://tammik.ca) is a -->\n\nA professional independent sound designer friend is specialising in audio games and now learning C# for Unity scripting to implement their own personal sound design toolbelt within that framework.\n\nI am very impressed by the super powerful, clean, effective C# Unity API, and by the rapid progress they are making with it.\n\nFor instance, they are implementing their own events using delegates, dictionaries, abstract base classes, timers, separate threads, called co-routines in Unity &ndash; impressive stuff for just a couple of days of coding.\n\nFor the delegate implementation, the Unity discussion on [using C# events with Unity](http://forum.unity3d.com/threads/using-c-events-with-unity.58367) helped, especially the contribution by DifficultMass, supplying these lines of code:\n\n<pre class=\"code\">\n  class EventTriggerer\n  {\n    public event EventHandler OurEvent;\n\n    public void TriggerEvent()\n    {\n      if(OurEvent != null)\n      {\n        OurEvent();\n      }\n    }\n  }\n</pre>\n\n<!--\n\nHere is an early snapshot of the project as WIP:\n\n<center>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">I have been working on this <a href=\"https://twitter.com/hashtag/gameaudio?src=hash\">#gameaudio</a> script for <a href=\"https://twitter.com/unity3d\">@unity3d</a> over the weekend. Loads more ideas I want to add... <a href=\"https://twitter.com/hashtag/VR?src=hash\">#VR</a> <a href=\"https://t.co/07ezzqcgKT\">pic.twitter.com/07ezzqcgKT</a></p>&mdash; Chris Tammik (@chtammik) <a href=\"https://twitter.com/chtammik/status/747289609973862404\">June 27, 2016</a></blockquote>\n<script async src=\"http://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n</center>\n-->"
  },
  {
    "original_filename": "1451_custom_export_adn_2017",
    "header_text": "<a name=\"8\"></a>Opendesk at Autodesk Forge Accelerator Barcelona",
    "local_header_href": "#a-name8aopendesk-at-autodesk-forge-accelerator-barcelona",
    "chunk_text": "#### <a name=\"8\"></a>Opendesk at Autodesk Forge Accelerator Barcelona\n\nFor some background info on Forge and the\nrecent [Forge accelerator](http://autodeskcloudaccelerator.com) in\nBarcelona, here is feedback from one of the participating\ncompanies, [Opendesk at the Forge Accelerator](https://www.opendesk.cc/blog/opendesk-at-autodesk)."
  }
]