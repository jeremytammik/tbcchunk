[
  {
    "original_filename": "1615_directshape",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<!--\n<script src=\"run_prettify.js\" type=\"text/javascript\"></script>\n<script src=\"https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js\" type=\"text/javascript\"></script>\n-->\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\n- updated https://github.com/jeremytammik/DirectShapeFromFace -- direct shape from face\n  test sketch plane creation and refinding\n  generics for searching faces, edges, etc.\n  parameter filter\n\n- loft form creation speed ---  >> directshape\n  [Q] I have a developer from Revit Vanguard having a function which create a new mass family and load it in the project, but he cannot provide this function due to take much time to create a loft form.\n  He creates a form by using Document.FamilyCreate.NewLoftForm with ReferenceArray of CurveByPoints or ModelCurve.\n  I think that it seems to be general way to create Family.\n  I tested the attached minimal sample code, I got a similar result as he mentioned.\n  It takes about 4 minutes to create a family in the test code.\n  Eventually, he wants to visualize calculation result of sky view factor by 3D model.\n  And his addin already works well in ArchCad as the same function.\n  Is there any work-around to create a loft form more faster?\n  [A] depending on the kind of geometry he wants to create, he might be able to use a DirectShape element instead.\n  that should be about 100 times faster.\n  http://thebuildingcoder.typepad.com/blog/2014/05/directshape-performance-and-minimum-size.html\n  http://thebuildingcoder.typepad.com/blog/2014/11/directshape-versus-families-category-and-texture.html\n  http://thebuildingcoder.typepad.com/blog/2015/02/from-hack-to-app-obj-mesh-import-to-directshape.html\n\n- directshape 10467085 [Create surface from face] -- another DirectShape example\n\n- create direct shape instead of conceptual mass\n  creating wall and roof elements on face of mass\n  new topic group\n  http://forums.autodesk.com/t5/revit-api/create-a-surface-through-revit-api/m-p/5867952\n\n- 11770403 [Hermite,Nurbs Spline Do they need to be on a plane?]\nhttp://forums.autodesk.com/t5/revit-api/hermite-nurbs-spline-do-they-need-to-be-on-a-plane/m-p/6301635\n[Q] You state in Point 3 \"... create a DirectShape element using the 'solid' geometry created above.\" Where can I find code which shows how to do that?\n[A] You just have to package the solid in a GeometryObject Array, then DirectShape.CreateElement works: https://knowledge.autodesk.com/search-result/caas/CloudHelp/cloudhelp/2016/ENU/Revit-API/files/GUID-DF7B9D4A-5A8A-4E39-8721-B7782CBD7730-htm.html\n\n- 12950253 [Using API to change color (and/or material) of DirectShape]\n  https://forums.autodesk.com/t5/revit-api-forum/using-api-to-change-color-and-or-material-of-directshape/m-p/7064149\n\n- Re: Create DirectShape without representation when generating shape -- Toshiaki Isezaki\n\n- 12390855 [Create Direct Shape from Room]\n  http://forums.autodesk.com/t5/revit-api-forum/create-direct-shape-from-room/m-p/6703123\n  spatial geometry calculator versus room boundary\n\n- control direct shape visibility in family definition\n  13676056 [ファミリ内のDirectShapeについて -- About DirectShape in family]\n\nDirectShape topics and Happy New Year in #RevitAPI @AutodeskRevit #bim #dynamobim @AutodeskForge #ForgeDevCon http://bit.ly/directshape2018\n\nI'll begin the new year by discussing a bunch of topics addressing various aspects of <code>DirectShape</code> elements\n&ndash; Updated DirectShapeFromFace\n&ndash; Improve loft form creation speed using <code>DirectShape</code>\n&ndash; Create <code>DirectShape</code> instead of conceptual mass\n&ndash; Create surface from face\n&ndash; Create <code>DirectShape</code> from solid\n&ndash; Control <code>DirectShape</code> colour and material\n&ndash; Improve family performance suppressing <code>DirectShape</code> generation\n&ndash; Create <code>DirectShape</code> from room...\n\n--->"
  },
  {
    "original_filename": "1615_directshape",
    "header_text": "DirectShape Topics and Happy New Year!",
    "local_header_href": "#directshape-topics-and-happy-new-year",
    "chunk_text": "### DirectShape Topics and Happy New Year!\n\n<center>\n<p id=\"dis\" style=\"font-size: 150%; font-weight: bold; font-family: monospace; color:orange\">Happy New Year!</p>\n</center>\n\n<!-- The JavaScript Source http://www.javascriptsource.com Ben Joffe http://www.joffe.tk/ -->\n\n<script>\n\nvar text=\"Happy New Year!\";\n\nvar symtype=new Array(\" \",\"A\",\"a\",\"B\",\"b\",\"C\",\"c\",\"D\",\"d\",\"E\",\"e\",\"F\",\"f\",\"G\",\"g\",\"H\",\"h\",\"I\",\"i\",\"J\",\"j\",\"K\",\"k\",\"L\",\"l\",\"M\",\"m\",\"N\",\"n\",\"O\",\"o\",\"P\",\"p\",\"Q\",\"q\",\"R\",\"r\",\"S\",\"s\",\"T\",\"t\",\"U\",\"u\",\"V\",\"v\",\"W\",\"w\",\"X\",\"x\",\"Y\",\"y\",\"Z\",\"z\",\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\".\",\",\",\"&\",\"!\",\"?\",\"-\",\"_\");\n\nvar symarray=new Array();\n\nfor (var i=0; i<text.length; i++){\n  symarray[i]=\" \";\n}\nfunction scroll(){\n  for (var i=0; i<text.length; i++){\n    if (symarray[i]!=text.substring(i,i+1)) {\n      for (var x=0; x<70; x++) if (symarray[i]==symtype[x]) {symarray[i]=symtype[x+1]; break}\n    }\n  }\n  var outsym=\"\";\n  for (var i=0; i<text.length; i++) outsym+=symarray[i];\n  dis.innerHTML=outsym;\n  setTimeout('scroll()',100);\n}\nscroll();\n\n</script>\n\nI had a great break over Christmas and New Year and hope you did as well.\n\nI'll begin the new year by discussing a bunch of topics addressing various aspects of `DirectShape` elements:\n\n- [Updated DirectShapeFromFace](#2)\n- [Improve loft form creation speed using `DirectShape`](#3)\n- [Create `DirectShape` instead of conceptual mass](#4)\n- [Create surface from face](#5)\n- [Create `DirectShape` from solid](#6)\n- [Control `DirectShape` colour and material](#7)\n- [Improve family performance suppressing `DirectShape` generation](#8)\n- [Create `DirectShape` from room](#9)\n\n####<a name=\"2\"></a>Updated DirectShapeFromFace\n\nOne useful little `DirectShape` utility is  \nthe [DirectShapeFromFace](https://github.com/jeremytammik/DirectShapeFromFace) add-in.\n\nIt  creates a `DirectShape` element from a selected element face.\n\nWe initially discussed it in 2015, in the article\non [DirectShape From Face and Sketch Plane Reuse](http://thebuildingcoder.typepad.com/blog/2015/09/directshape-from-face-and-sketch-plane-reuse.html).\n\nIt demonstrates several approaches, including\na [simpler access to the picked face using `GetTotalTransform`](http://thebuildingcoder.typepad.com/blog/2015/09/simpler-directshape-from-face-restsharp-put-and-post.html#2).\n\nNow I migrated it from Revit 2016 to Revit 2018, replacing a couple of obsolete API calls.\n\n\n####<a name=\"3\"></a>Improve Loft Form Creation Speed using DirectShape\n\nOne of the most important features of direct shapes is the ability to generate geometry directly in place in the model without needing to create a separate family definition and instantiate that, resulting in a  vast speed improvement.\n\nFor example, a developer was creating a new mass family and loading it in the project, taking so much time to create a loft form that it ended up unusable.\n\nThe form was generated in a standard way to create families, using `Document.FamilyCreate.NewLoftForm` with a `ReferenceArray` of `CurveByPoint` or `ModelCurve` elements.\n\nIt takes about 4 minutes to create a family in this manner.\n\n**Question:** Is there any work-around to create a loft form faster?\n\n**Answer:** Depending on the kind of geometry you want to create, you might be able to use a `DirectShape` element instead:\n\n- [DirectShape performance and minimum size](http://thebuildingcoder.typepad.com/blog/2014/05/directshape-performance-and-minimum-size.html)\n- [DirectShape versus families, category and texture](http://thebuildingcoder.typepad.com/blog/2014/11/directshape-versus-families-category-and-texture.html)\n- [From Hack to App &ndash; OBJ Mesh Import to DirectShape](http://thebuildingcoder.typepad.com/blog/2015/02/from-hack-to-app-obj-mesh-import-to-directshape.html)\n\n\n####<a name=\"4\"></a>Create DirectShape Instead of Conceptual Mass\n\nI the same vein,\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\non [creating a surface through Revit API](http://forums.autodesk.com/t5/revit-api/create-a-surface-through-revit-api/m-p/5867952) suggests\nusing a `DirectShape` instead of a conceptual mass element and also introduces\nthe new topic group #5.50 dedicated to\nthe [`DirectShape` element](http://thebuildingcoder.typepad.com/blog/about-the-author.html#5.50).\n\n\n####<a name=\"5\"></a>Create Surface from Face\n\nAnother discussion also deals with creating a surface from a picked element face:\n\n**Question:** I'm working on a function that creates surfaces from selected faces.\nIt really does not matter what type of element the resulting surface is as long as it gets exported to Navisworks.\n\nWhat I have been able to do is to collect the faces with the `PickObjects` method.\nI have also succeeded creating a mass family representing a surface.\nThis I have achieved by collecting the edges of the face and then I have created the surface object by using `NewFormByCap`.\n\nBut this approach does not work on all faces, especially if one of the edges is a `HermiteSpline`.\nI have tried to create a mesh out of the face and then create a tiny surface of each of the triangles using the `NewFormByCap` method. This do sort of works, but it takes way too long &ndash; hours for just a single face.\n\nDo you have any idea how I can solve this issue? It does not have to be a surface; it can also be a very thin solid.\nThe function should work on all possible faces in Revit. Any help is appreciated.\n\n**Answer:** Surprisingly, yes, I do have a viable suggestion for you.\n\nIt is even significantly easier and simpler and more efficient than what you have been trying so far, and I think it can work for all surfaces.\n\nIn Revit 2015, the DirectShape element was introduced as a possibility to generate faceted geometry directly in the project space.\n\nAll previous methods to define custom geometry required a family definition, like the method you describe.\n\nHere is my simple suggestion:\n\n- Grab the surface that you are interested in and tessellate it. You now have a bunch of triangles.\n- Create a `DirectShape` based on these triangles.\n\nThis discussion ultimately gave rise to the [DirectShapeFromFace project discussed above](#2).\n\n\n####<a name=\"6\"></a>Create DirectShape from Solid\n\nAnother question on creating direct shapes was raised in\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\non whether [Hermite and Nurb Spline need to be created on a plane](http://forums.autodesk.com/t5/revit-api/hermite-nurbs-spline-do-they-need-to-be-on-a-plane/m-p/6301635).\nIt also compares `NewLoftForm` with `DirectShape`, and then ends up asking:\n\n**Question:** You state that you can \"... create a DirectShape element using the 'solid' geometry created above.\" Where can I find code which shows how to do that?\n\n**Answer:** You just have to package the solid in a `GeometryObject` array, then `DirectShape.CreateElement` works, as described in\nthe [knowledge base article on `DirectShape`](https://knowledge.autodesk.com/search-result/caas/CloudHelp/cloudhelp/2016/ENU/Revit-API/files/GUID-DF7B9D4A-5A8A-4E39-8721-B7782CBD7730-htm.html).\n\n\n####<a name=\"7\"></a>Control DirectShape Colour and Material\n\nLet's round off with some aspects of controlling `DirectShape` colour and material, e.g., \nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\non [using API to change color and/or material of DirectShape](https://forums.autodesk.com/t5/revit-api-forum/using-api-to-change-color-and-or-material-of-directshape/m-p/7064149):\n\n**Question:** When importing my IFC file, all elements get converted to `DirectShape` elements.\n\nBut they now get colored fully black when viewing in shaded mode, and there seems to be no way to change this.\n\nOnly workaround is to overwrite graphics per view, but I would rather work to a more solid solution.\n \nIs there some way to change the color of the `DirectShape` elements? From what I understood, a material could not be applied to a `DirectShape`.\n \nWhen I import more IFC's from the same source with different export settings, it seems I sometimes get different color results.\n\nSo, I can conclude that the color is stored somewhere within these `DirectShape` elements. I still cannot find where, and whether it can be changed though API.\n\n**Answer:** The best way to control the colour of a direct shape element is probably by setting an appropriate category or subcategory on it.\n \nAs you presumably know, there\nare [many ways to control the material and colour of a Revit element](http://thebuildingcoder.typepad.com/blog/about-the-author.html#5.24)\n \nIf you prefer setting the colour explicitly, you can look at\n \n- [Change element colour](http://thebuildingcoder.typepad.com/blog/2011/03/change-element-colour.html)\n- [How to change the colour of an element](https://forums.autodesk.com/t5/revit-api-forum/how-change-the-color-a-element/td-p/5651177)\n \nHere is some code for that using `OverrideGraphicSettings`\nto [change the colour of an extrusion object](https://forums.autodesk.com/t5/revit-api-forum/change-colour-of-extrusion-object/m-p/7060824):\n \n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:#2b91af;\">Color</span>&nbsp;color&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">Color</span>(&nbsp;0,&nbsp;0,&nbsp;0&nbsp;);&nbsp;<span style=\"color:green;\">//&nbsp;RGB&nbsp;(0,&nbsp;255,&nbsp;255)</span>\n&nbsp;&nbsp;<span style=\"color:#2b91af;\">OverrideGraphicSettings</span>&nbsp;ogs&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">OverrideGraphicSettings</span>();\n&nbsp;&nbsp;ogs.SetProjectionLineColor(&nbsp;color&nbsp;);\n&nbsp;&nbsp;ogs.SetProjectionFillColor(&nbsp;color&nbsp;);\n&nbsp;&nbsp;ogs.SetCutFillColor(&nbsp;color&nbsp;);\n&nbsp;&nbsp;ogs.SetCutLineColor(&nbsp;color&nbsp;);\n&nbsp;&nbsp;doc.ActiveView.SetElementOverrides(&nbsp;fiProfile.Id,&nbsp;ogs&nbsp;);\n</pre>\n\nHowever, controlling the material and colour via the direct shape category is much more BIMish!\n \nIf your IFC DirectShapes do not provide `Material` parameters you can set, and if you cannot change their categories, then you could try to:\n \n- Read their geometry\n- Create new `DirectShape` elements using this geometry\n- Delete the original IFC `DirectShape` elements\n\nThe advantage is that you have more control over the `DirectShape` properties at creation time.\n\n\n####<a name=\"8\"></a>Improve Family Performance Suppressing DirectShape Generation\n\n**Question:** I use `DirectShape` to accelerate creating shapes in my family definition.\n\nIt includes so many shapes now that Revit exhibits slow performance. \n \nCan I improve this?\n\nIs it possible to temporarily suppress the representation and drawing of DirectShape regeneration?\n\n**Answer:** Drawing of elements can be suppressed by hiding the associated category in the view, however it is unlikely that the impact of excessive element creation will be limited to creation. Having too many elements in a family will slow down family load and update times. Further I expect that performance problems may be encountered in the project environment as well. There is likely a better, more scalable solution to the problem they are trying to solve that doesn’t involve creation of too many elements.\n\nWhen you add an element to a family definition, you can always specify its visibility using\nthe [FamilyElementVisibility class](http://www.revitapidocs.com/2017/fae58e2d-817c-77f6-1747-58b0a4e01c7a.htm).\n \nThis includes both view direction and level of detail:\n \n- Fine / medium / coarse\n- 2D front / top / back\n- 3D\n \nThis applies to all geometry in a family definition.\n \nTherefore, you can simply define the visibility for all complex direct shapes to be visible only in 3D views and only in fine level of detail.\n \nI would expect that to solve the issue effectively.\n\nPlease note that unlike other elements, it is not yet possible to associate `DirectShape` elements in family definitions with visibility controls.\nIt should apply to all geometric elements, but the operation is actually element based, and has not been enabled for DirectShapes yet.\nThere doesn’t seem to be a Revit Ideas item filed for this functionality, although the team is already aware of the gap.\n\nHappily, this can be worked around making use of the fact that visibility can be set for a family instance nested in the family definition document and creating a `FamilyInstance` containing the `DirectShape` inside the family document.\n\n\n\n####<a name=\"9\"></a>Create DirectShape from Room\n\nFinally, to round off this collectio0n of DirectShape topics, yet\nanother [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\non [creating direct shape from room](http://forums.autodesk.com/t5/revit-api-forum/create-direct-shape-from-room/m-p/6703123) and \nusing the spatial geometry calculator versus room boundary to achieve that:\n\n**Question:** How can I create `DirectShape` from rooms with holes?\n \nI read many discussion and post but I wasn't able to solve the problem!\n \nMore info and source in this GitHub issue:\n\n- [GitHub issue](https://github.com/Tamu/Revit3Drooms/issues/1)\n- [Revit3Drooms source code](https://github.com/Tamu/Revit3Drooms)\n \nLast reading:\n\n- [2D polygon areas and outer loop](http://thebuildingcoder.typepad.com/blog/2008/12/2d-polygon-areas-and-outer-loop.html)\n- [Create mass from room](http://forums.autodesk.com/t5/revit-api-forum/create-mass-from-room/td-p/3674458)\n \nMany thanks for help!\n\n<center>\n<img src=\"img/3droom.png\" alt=\"3D room\" width=\"600\"/>\n</center>\n\n**Answer:** If you want the room with holes, then there will be nothing left.\n \nThe room is a hole.\n \nWhat else is a room except a hole?\n \nDo you mean that you would like to recreate the shape of all the walls with their openings?\n \nDo you mean that you have a room whose plan view includes holes?\n \nLet's assume the latter.\n \nIn that case, if your walls are all vertical, this is absolutely trivial.\n \nYou can collect the room boundary edges and assemble them into the outer and inner wall loops.\n \nThis is demonstrated very effectively by\nthe [2D room editor](https://github.com/jeremytammik/RoomEditorApp),\nwhich retrieves this information, converts it to a simplified 2D view in SVG, and displays the room outline in a web browser:\n \nHere is a [demo recording and lots of other supporting material](http://thebuildingcoder.typepad.com/blog/2016/10/connecting-desktop-and-cloud-at-rtc-material.html).\n \nIf you want a 3D direct shape instead of a 2D flat version, you will obviously need to determine the ceiling height and location and take that into account as well.\n \nUpdate:\n \nOK, I now went and read your problem description.\n \n:-)\n \nVery clear. Thank you for that.\n \nThank you also for your appreciation!\n \nThat issue is indeed addressed by\nthe [RoomEditorApp](https://github.com/jeremytammik/RoomEditorApp) that\nI already pointed to.\n \nWhen you retrieve the room boundary, the edges may not be contiguous in the right order.\n \nYou may need to order them yourself.\n \nThere are several ways of achieving that:\n \nDIY. I love do it yourself. Search for `SortCurvesContiguous`.\n \nExporterIFCUtils.ValidateCurveLoops. Maybe. The Edge.AsCurveFollowingFace method. Maybe. But read on through the following, and note the note in the last of the discussions listed below.\n \nFor the former, here is some more reading material:\n \n- [2D Polygon Areas and Outer Loop](http://thebuildingcoder.typepad.com/blog/2008/12/2d-polygon-areas-and-outer-loop.html)\n- [Curve Following Face and Bounding Box Implementation](http://thebuildingcoder.typepad.com/blog/2013/03/sort-and-orient-curves-to-form-a-contiguous-loop.html)\n- [Retrieving Plan View Room Boundary Polygon Loops](http://thebuildingcoder.typepad.com/blog/2013/03/revit-2014-api-and-room-plan-view-boundary-polygon-loops.html#3)\n- [Extrusion Analyser and Plan View Boundaries](http://thebuildingcoder.typepad.com/blog/2013/04/extrusion-analyser-and-plan-view-boundaries.html)\n- [Room and Furniture Loops Using Symbols](http://thebuildingcoder.typepad.com/blog/2013/04/room-and-furniture-loops-using-symbols.html)\n- [ContiguousCurveSorter](ttps://github.com/jeremytammik/RoomEditorApp/blob/master/RoomEditorApp/ContiguousCurveSorter.cs)\n- [Sorting Face Loop Edges](http://thebuildingcoder.typepad.com/blog/2015/01/autodesk-internship-in-california-and-sorting-edges.html#3)\n \nI have explored and written lots more on this topic, as you can see if you follow the various links in the discussions listed above.\n \nI am confident that this will give you all you need.\n \nI see that what you are after is basically the floor slabs under the rooms.\n \nI assume that you are not interested in querying the slabs for their geometry?\n \nYou want to create these shapes from the room boundaries?\n \nWell, I think you have all you need now for that.\n \n**Response:** You ask:\n\n> \"Do you mean that you have a room whose plan view includes holes?\"\n \nYes, I would like to create the volume of the room. If the room has holes (Because walls), I would also like to subtract the volume of the hole.\n \nIn short, I feel ... that you translated perfectly my strange English !\n\n> \"You want to create these shapes from the room boundaries?\"\n \nYes, exactly. For the elevation, I need only a fixed height (very simple).\n\nUpdate &ndash; here is the solution: \n\nIt was necessary to add a call in the boundary loop: `curveLoopList.Add(curveLoop);`\n\n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:blue;\">foreach</span>(&nbsp;IList&lt;<span style=\"color:#2b91af;\">BoundarySegment</span>&gt;&nbsp;b&nbsp;<span style=\"color:blue;\">in</span>&nbsp;boundaries&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;List&lt;<span style=\"color:#2b91af;\">Curve</span>&gt;&nbsp;profile&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;List&lt;<span style=\"color:#2b91af;\">Curve</span>&gt;();\n&nbsp;&nbsp;&nbsp;&nbsp;++iBoundary;\n&nbsp;&nbsp;&nbsp;&nbsp;iSegment&nbsp;=&nbsp;0;\n \n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">foreach</span>(&nbsp;<span style=\"color:#2b91af;\">BoundarySegment</span>&nbsp;s&nbsp;<span style=\"color:blue;\">in</span>&nbsp;b&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++iSegment;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Curve</span>&nbsp;curve&nbsp;=&nbsp;s.GetCurve();\n \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profile.Add(&nbsp;curve&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n \n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">try</span>\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">CurveLoop</span>&nbsp;curveLoop&nbsp;=&nbsp;<span style=\"color:#2b91af;\">CurveLoop</span>.Create(&nbsp;profile&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curveLoopList.Add(&nbsp;curveLoop&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">catch</span>(&nbsp;Exception&nbsp;ex&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Debug</span>.WriteLine(&nbsp;ex.Message&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n</pre>\n\nFull code/demo in\nthe [Revit3Drooms GitHub repository](https://github.com/Tamu/Revit3Drooms).\n\n**Answer:** Maybe I'm missing something here, but why can't you use the `SpatialElementGeometryCalculator`?\n\nThat gives you the solid you require for the `DirectShape` immediately; I've used this for quite a few implementations. \n\nDoes this not take holes into account?\n\n**Response:** The `SpatialElementGeometryCalculator` works for rooms?\n \nFor a general case this works well but I did not succeed for rooms. Have you already tried ?\n \n**Answer:** I haven't read through all your material, so I'm not sure about if your specific case needs something special, but it can extract solid geometry and I haven't seen any drawbacks. \n\nThe `Room` type directly inherits `SpatialElement`, so yes, it sure works.\n\nHere is a sample from the documentation:\n\n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Calculate&nbsp;a&nbsp;room&#39;s&nbsp;geometry&nbsp;and&nbsp;find&nbsp;its&nbsp;boundary&nbsp;faces</span>\n \n&nbsp;&nbsp;<span style=\"color:#2b91af;\">SpatialElementGeometryCalculator</span>&nbsp;calculator&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">SpatialElementGeometryCalculator</span>(&nbsp;doc&nbsp;);\n \n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Compute&nbsp;the&nbsp;room&nbsp;geometry&nbsp;</span>\n \n&nbsp;&nbsp;<span style=\"color:#2b91af;\">SpatialElementGeometryResults</span>&nbsp;results&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;calculator.CalculateSpatialElementGeometry(&nbsp;room&nbsp;);\n \n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Get&nbsp;the&nbsp;solid&nbsp;representing&nbsp;the&nbsp;room&nbsp;geometry</span>\n \n&nbsp;&nbsp;<span style=\"color:#2b91af;\">Solid</span>&nbsp;roomSolid&nbsp;=&nbsp;results.GetGeometry();&nbsp;\n \n&nbsp;&nbsp;<span style=\"color:blue;\">foreach</span>(&nbsp;<span style=\"color:#2b91af;\">Face</span>&nbsp;face&nbsp;<span style=\"color:blue;\">in</span>&nbsp;roomSolid.Faces&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">double</span>&nbsp;faceArea&nbsp;=&nbsp;face.Area;\n \n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Get&nbsp;the&nbsp;sub-faces&nbsp;for&nbsp;the&nbsp;face&nbsp;of&nbsp;the&nbsp;room</span>\n \n&nbsp;&nbsp;&nbsp;&nbsp;IList&lt;<span style=\"color:#2b91af;\">SpatialElementBoundarySubface</span>&gt;&nbsp;subfaceList&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;results.GetBoundaryFaceInfo(&nbsp;face&nbsp;);&nbsp;\n \n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">foreach</span>(&nbsp;<span style=\"color:#2b91af;\">SpatialElementBoundarySubface</span>&nbsp;subface&nbsp;<span style=\"color:blue;\">in</span>&nbsp;subfaceList&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;There&nbsp;are&nbsp;multiple&nbsp;sub-faces&nbsp;that&nbsp;define&nbsp;the&nbsp;face</span>\n \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;subfaceList.Count&nbsp;&gt;&nbsp;1&nbsp;)&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">double</span>&nbsp;subfaceArea&nbsp;=&nbsp;subface.GetSubface().Area;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;get&nbsp;the&nbsp;area&nbsp;of&nbsp;each&nbsp;sub-face</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;sub-faces&nbsp;exist&nbsp;in&nbsp;situations&nbsp;such&nbsp;as&nbsp;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;when&nbsp;a&nbsp;room-bounding&nbsp;wall&nbsp;has&nbsp;been</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;horizontally&nbsp;split&nbsp;and&nbsp;the&nbsp;faces&nbsp;of&nbsp;each</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;split&nbsp;wall&nbsp;combine&nbsp;to&nbsp;create&nbsp;the&nbsp;</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;entire&nbsp;face&nbsp;of&nbsp;the&nbsp;room</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n</pre>\n\n**Response:** Thank you very much! That seems really good!\n \nThe only special thing: I must have a cut to 1 ft from the floor.\n\n**Answer:** The `BooleanOperationsUtils` class gives you some options where I think the `CutWithHalfSpace` seems like the most useful one.\n\nHowever, I mean, if your code works, then go for it. I was just hinting at a more easy solution for future use. \n\n<!---\n\n####<a name=\"10\"></a>Control DirectShape Visibility in Family Definition\n\n13676056 [ファミリ内のDirectShapeについて -- About DirectShape in family]\n\n**Question:** \n\n**Answer:** \n\n<center>\n<img src=\"img/.png\" alt=\"\" width=\"100\"/>\n</center>\n\n<pre class=\"prettyprint\">\n</pre>\n\n<pre class=\"code\">\n</pre>\n\n--->\n\nOK, that is more than enough on direct shapes for now, isn't it?"
  }
]