[
  {
    "original_filename": "2000_materials",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\n- GetMaterialArea\n  https://autodesk.slack.com/archives/C0SR6NAP8/p1685384981134679\n  https://forums.autodesk.com/t5/revit-api-forum/method-getmaterialarea-appears-to-use-different-formulas-for/td-p/11988215\n\n- Materials, Material Assets (Appearance, Structural, Thermal) and the Visual API\n  https://forums.autodesk.com/t5/revit-api-forum/materials-material-assets-appearance-structural-thermal-and-the/td-p/12088469\n\n- filter for annotation families\n  https://autodesk.slack.com/archives/C0SR6NAP8/p1688664085416909\n\n- Revit Batch Processor (RBP)\n  https://github.com/bvn-architecture/RevitBatchProcessor\n  came up in\n  Is there a way to change the workset configuration of a revit file without opening revit?\n  https://stackoverflow.com/questions/76630229/is-there-a-way-to-change-the-workset-configuration-of-a-revit-file-without-openi\n\ntwitter:\n\nTwo very different aspects of BIM materials, GetMaterialArea behaviour, material assets and the Visual API, a powerful batch processor utility and filtering for annotations with the @AutodeskRevit #RevitAPI #BIM @DynamoBIM @AutodeskAPS https://autode.sk/materials\n\nTwo very different aspects of BIM materials, filtering for annotations and a powerful batch processor utility:\n&ndash; GetMaterialArea behaviour varies\n&ndash; Material assets and the Visual API\n&ndash; Filter for annotation families\n&ndash; Revit batch processor RBP...\n\nlinkedin:\n\nTwo very different aspects of BIM materials, GetMaterialArea behaviour, material assets and the Visual API, a powerful batch processor utility and filtering for annotations with the #RevitAPI\n\nhttps://autode.sk/materials\n\n- GetMaterialArea behaviour varies\n- Material assets and the Visual API\n- Filter for annotation families\n- Revit batch processor RBP...\n\n#BIM #DynamoBIM #AutodeskAPS #Revit #API #IFC #SDK #Autodesk #AEC #adsk\n\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\n\n<center>\n<img src=\"img/\" alt=\"\" title=\"\" width=\"600\"/>\n<p style=\"font-size: 80%; font-style:italic\"></p>\n</center>\n\n-->"
  },
  {
    "original_filename": "2000_materials",
    "header_text": "RBP, Materials, Assets and the Visual API",
    "local_header_href": "#rbp-materials-assets-and-the-visual-api",
    "chunk_text": "### RBP, Materials, Assets and the Visual API\n\nTwo very different aspects of BIM materials, filtering for annotations and a powerful batch processor utility:\n\n- [GetMaterialArea behaviour varies](#2)\n- [Material assets and the Visual API](#3)\n- [Filter for annotation families](#4)\n- [Revit batch processor RBP](#5)\n- [The Building Coder Blog Post &#35;2000](#6)"
  },
  {
    "original_filename": "2000_materials",
    "header_text": "GetMaterialArea Behaviour Varies",
    "local_header_href": "#2",
    "chunk_text": "####<a name=\"2\"></a> GetMaterialArea Behaviour Varies\n\nGetMaterialArea returns different results for different kinds of elements, as explained in\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\non the [method `GetMaterialArea` appears to use different formulas for computing the area depending on the element category](https://forums.autodesk.com/t5/revit-api-forum/method-getmaterialarea-appears-to-use-different-formulas-for/td-p/11988215):\n\n**Question:** How does the method GetMaterialArea compute the area depending on the element category? It appears to use different formulas for different categories. For a wall, it is the area of one of the side faces for a layer (which probably makes sense); for a window, however, the method returns the sum over all 6 faces (assuming a simple cuboid). Please provide documentation on how the method functions on different elements\nor a unified way of computing the area.\n\nI also noticed that GetMaterialIds returns null for elements of (at least) these categories:\n\n- Pipe, Flex Pipe, Duct, Flex Duct, Duct Insulation, Ramp\n\nGetMaterialArea(matId) and GetMaterialVolume(matId) returns 0 for these categories.\n\n**Answer 1:** You should check Category.HasMaterialQuantities for that, some categories don't support material quantities.\n\nHowever, it is noted that such material quantities are calculated either from compound structure layers or geometry.\nSince the `Window` isn't a compound structure, area will be taken from faces of geometry I suspect; `Wall`, on the other hand, has compound structure.\nThe geometry of the wall would at the same time be lacking the layers detail.\n\n**Answer 2:** I think the customer is referring mostly to the difference between system families and loaded families in Revit itself.\nThe API is probably returning the same values.\n\n- Hosts will return 1 face, because in construction, you would refer to the area of a wall material (for example) as the area to be covered when looking at the wall.\n- Stairs, railing, ramps, site, and curtain wall also have special behaviour.\n- Loaded families (like windows) will report an area including all faces.\n\nThis is confirmed and workarounds are posted in the Revit Clinic article\non [Material Takeoff Area Schedule](https://revitclinic.typepad.com/my_weblog/2009/10/material-takeoff-area.html).\nSome other special cases are listed in the Autodesk Support article\non [Material Takeoff shows incorrect values of areas and/or volumes in Revit](https://www.autodesk.com/support/technical/article/caas/sfdcarticles/sfdcarticles/Material-Takeoff-shows-incorrect-areas-in-Revit.html).\n\nAs far as the API goes, check out these 2 resources from The Building Coder and Scott Conover that may help confirm the API designed behaviour:\n\n- [Material Quantity Extraction](https://thebuildingcoder.typepad.com/blog/2010/02/material-quantity-extraction.html)\n- [Analyse Geometry of Buildings Using the Revit API](https://thebuildingcoder.typepad.com/au/2009/AU09_CP222-3_Analyze_Geometry_Revit_API.pdf) at AU 2009 by Scott Conover, Autodesk\n\nThis is from Scott's presentation:\n\nMaterial quantity extraction One common analytical requirement is to extract material quantities of elements in the document.  Revit 2010 introduced methods to directly obtain the material volumes and areas computed by Revit for material takeoff schedules:\n\n- Element.Materials &ndash; obtains a list of materials within an element\n- Element.GetMaterialVolume() &ndash; obtains the volume of a particular material in an element\n- Element.GetMaterialArea() &ndash; obtains the area of a particular material in an element\n\nThe methods apply to categories of elements where Category.HasMaterialQuantities property is true.\nIn practice, this is limited to elements that use compound structure, like walls, roofs, floors, ceilings, a few other basic 3D elements like stairs, plus 3D families where materials can be assigned to geometry of the family, like windows, doors, columns, MEP equipment and fixtures, and generic model families.\nNote that within these categories there are further restrictions about how material quantities can be extracted.\nFor example, curtain walls and curtain roofs will not report any material quantities themselves; the materials used by these constructs can be extracted from the individual panel elements that make up the curtain system.\nNote that the volumes and areas computed by Revit may be approximate in some cases.\nFor example, for individual layers within a wall, minor discrepancies might appear between the volumes visible in the model and those shown in the material takeoff schedule.\nThese discrepancies tend to occur when you use the wall sweep tool to add a sweep or a reveal to a wall, or under certain join conditions."
  },
  {
    "original_filename": "2000_materials",
    "header_text": "Material Assets and the Visual API",
    "local_header_href": "#3",
    "chunk_text": "####<a name=\"3\"></a> Material Assets and the Visual API\n\nA completely different aspect of materials is addressed by\nGary J. Orr of [MBI Companies Inc.](https://www.mbicompanies.com/),\nwho shares a nice VB.NET sample in\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\ndemonstrating the interaction\nwith [Materials, Material Assets (Appearance, Structural, Thermal) and the Visual API](https://forums.autodesk.com/t5/revit-api-forum/materials-material-assets-appearance-structural-thermal-and-the/m-p/12089438).\nIn his own words:\n\nThis has been a journey. The past few weeks have seen me spending all the time that I can spare reading the API help, reading posts going back years, reading blogs (which get really hard to pull targeted information out of sometimes).\n\nThen came trying to put it all together, Snippets of code from the API, some of which can cause just as much confusion as the help that they provide, translating snippets of code that I can barely understand because I don't speak that particular coding language, which is made even worse by the fact that it is usually written by programming professionals that use code shortcuts (which makes reading their examples even harder) and often refer to advanced coding techniques that I simply haven't ever learned since none of this is my real occupation...\n\nBut hey, I did it.\n\nI can now take materials and their related Assets apart and I can create/recreate them.\n\nYou are welcome to the [attached VB file `MaterialTools.vb`](zip/go_materials_visual_api.zip) if you are struggling with these same issues (dump it into a VS project with the appropriate references or copy the subs/functions into a VB macro with the appropriate mods for launching the included tools).\n\nIt has functions for collecting and logging the Properties of the Application resident Appearance Assets; the Assets within a Document; the materials within a document and their associated Properties and connected assets; and one for creating a new material with all new assets. Those functions will generate TXT and XML log files that can be used to further examine all of the above.\n\nI have attempted to document (with in line comments) the steps required and/or taken, along with why one method may have been chosen over another when such applied, as well as some cautions and some still outstanding questions and/or shortcomings that had to be worked around.\n\nIf you're well versed in Materials, and have both the time and desire, perhaps you can take a look and see if you have any answers for the commented questions that I still have and have left in the code.\n\nThere are still plenty of issues, some may just be because I haven't learned all I need to learn yet, but the bigger ones seem to be common from what I have found:\nOne biggie (in my opinion) is the lack of any direct correlation between the return values when you read Appearance Asset Properties to the Visual API Classes and their properties that should be used to work with them. This is a big complication and makes it really hard to avoid using strings and thereby keep your code language neutral. The descriptions in the API help do not help with that mapping the least little bit.\nAnother would be the absence of any clear and concise method to differentiate between Physical Property Sets... Structural vs Thermal.\n\nOf course, this may all just be an exercise in vanity from a wanna-be but perhaps some may find some of it helpful.\n\nLater: Oops,\nThe Asset Property type \"List\" was supposed to recurse to get the values of the list items, but I had forgotten to get back and actually make it do so.\n\nThat is fixed now.\nAlong the way I decided to actually do something with that massive volume of returns from GetRevitAppearanceAssets, i.e.: application.GetAssets(AssetType.Appearance).\nSo, I created an option to import one of each schema type into the current document.\n\nI still don't know the actual source of these assets since they don't match any of the Revit libraries (and I still don't understand why we can't access any material libraries via the API), but I did find something else that is unusual: the only PrismWoodSchema that is contained in that library,\n\n<center>\n<img src=\"img/go_visual_api_1.png\" alt=\"Materials and Visual API\" title=\"Materials and Visual API\" width=\"500\"/> <!-- Pixel Height: 143 Pixel Width: 610 -->\n</center>\n\nshows as being an \"Old Style\" rendering Asset once it has been imported into the document:\n\n<center>\n<img src=\"img/go_visual_api_2.png\" alt=\"Materials and Visual API\" title=\"Materials and Visual API\" width=\"500\"/> <!-- Pixel Height: 382 Pixel Width: 894 -->\n</center>\n\nYet, Assets using the PrismOpaqueSchema show as \"New Style\" Asset types (as would be expected for the above):\n\n<center>\n<img src=\"img/go_visual_api_3.png\" alt=\"Materials and Visual API\" title=\"Materials and Visual API\" width=\"500\"/> <!-- Pixel Height: 578 Pixel Width: 1,298 -->\n<br/>\n<img src=\"img/go_visual_api_4.png\" alt=\"Materials and Visual API\" title=\"Materials and Visual API\" width=\"500\"/> <!-- Pixel Height: 591 Pixel Width: 1,191 -->\n</center>\n\nJust another glitch?\n\nHere are the main problems I struggled with:\n\nOne biggie (in my opinion) is the lack of any direct correlation between the return values when you read Appearance Asset Properties to the Visual API Classes and their properties that should be used to work with them. This is a big complication and makes it really hard to avoid using strings and thereby keep your code language neutral. The descriptions in the API help do not help with that mapping the least little bit.\n\nAnother big one would be the absence of any clear and concise method to differentiate between Physical Property Sets... Structural vs Thermal.\n\nWe need a firm method of being able to differentiate Structural and Thermal Property Sets.\nPSE elements will often return both a thermal and a structural Property Set, and EVERY PSE element will return a structural (RevitLookup Snoop shows that pretty well)... yet they can only be used for the correct Property type, so something somewhere knows which one is which; we need that information in the API as well.\n\nThen, we have: where does application.GetAssets draw from?\nThere is nothing that matches what is found in that return list of assets anywhere that I can find in the system.\nThe PrismWoodSchema returned from that list shows as an \"Old style\" rendering Asset once pulled into a document, even though it is clearly a procedural Asset.\n\nWe need access to the AEC material Library as well as any user created libraries (as can be browsed to in the Material Browser.\n\nWe need access to the Asset libraries (as can be browsed to in the Assets dialog).\n\nThere are a few other requirements in my comments within the code, but most end up boiling down to one of these.\n\nWill that help get the development team started?\n\nBTW: this was written to the 2023 API, I haven't tested it for compatibility beyond that.\n\nMany thanks to Gary for sharing the results of his research!"
  },
  {
    "original_filename": "2000_materials",
    "header_text": "Filter for Annotation Families",
    "local_header_href": "#4",
    "chunk_text": "####<a name=\"4\"></a> Filter for Annotation Families\n\nA quick note on filtering for annotation families:\n\n**Question:** Is there an identifier which I can use to sort out annotation families vs other types of families using the Revit API?\nI'd like to iterate over the `IEnumerable` to then group items as I need them.\nThe code I'm currently using and would like to modify:\n\n<pre class=\"prettyprint\">\n  var families = new FilteredElementCollector(doc)\n    .OfClass(typeof(ElementType))\n    .Cast&lt;ElementType&gt;();\n</pre>\n\n**Answer:** See if this works for you:\nhttps://forum.dynamobim.com/t/how-can-i-collect-all-family-types-that-are-considered-annotation-symbols-in-revit/37480/10\n\nIt shows you that you need [`FamilySymbol`](https://www.revitapidocs.com/2024/a1acaed0-6a62-4c1d-94f5-4e27ce0923d3.htm) instead of `ElementType`.\n\nThen, filter for:\n\n<pre class=\"prettyprint\">\n  fs.Family.FamilyCategory.CategoryType\n    == CategoryType.Annotation\n</pre>\n\n**Response:** For some added context,\nI am hoping to first get all system families, then iterate over the collection of all system families and separate out the annotation families from that list.\nUltimately, I will end up with two CSV's, one with Annotation Families only, and the other CSV file with all system families minus annotation families which is why I think I was using `ElementType` instead of `FamilySymbol`.\n\n**Answer:** `FamilySymbol` should be fine in your case &ndash; it is derived from `ElementType`.\nElementTypes are more general.\nFor example, a `Wall` element can have a `WallType` which is also derived from `ElementType`.\n\n**Response:** I gave it a try, but now system families I was hoping to extract (prior to filtering out annotation families), like a basic wall, do not come through in my filter.\n\n**Answer:** Sorry my bad. You are right.\nFor element types that are not family symbols you will not be able to do\n\n<pre class=\"prettyprint\">\n  elem.Family.FamilyCategory.CategoryType\n</pre>\n\nYou may check its own category I guess.\n\n**Response:** That got me on the right track.\nI ended up having to filter out items which have null category information:\n\n<pre class=\"prettyprint\">\n  Category.CategoryType != CategoryType.Annotation\n</pre>\n\nThank you very much for your help!"
  },
  {
    "original_filename": "2000_materials",
    "header_text": "Revit Batch Processor RBP",
    "local_header_href": "#5",
    "chunk_text": "####<a name=\"5\"></a> Revit Batch Processor RBP\n\nLet's wrap up with a pointer to\nthe [Revit Batch Processor RBP](https://github.com/bvn-architecture/RevitBatchProcessor).\nIt looks like a very powerful and full-fledged utility; it came up in the StackOverflow question\nasking [is there a way to change the workset configuration of a Revit file without opening Revit?](https://stackoverflow.com/questions/76630229/is-there-a-way-to-change-the-workset-configuration-of-a-revit-file-without-openi)"
  },
  {
    "original_filename": "2000_materials",
    "header_text": "The Building Coder Blog Post &#35;2000",
    "local_header_href": "#6",
    "chunk_text": "####<a name=\"6\"></a> The Building Coder Blog Post &#35;2000\n\nActually, before closing, we have something to celebrate, a special issue, so to speak.\n\nThis blog post is The Building Coder's 2000th.\n\nYou can check out the entire chronological list in\nthe [GitHub tbc repository](https://github.com/jeremytammik/tbc).\n\nAll in all, The Building Coder has published over four hundred thousand lines of text, two-and-a-half million words and over 22 million characters since its inception in 2008.\n\nIt is also interesting to see what topics we started out covering back then; several are equally relevant and still recurring today:\n\n<pre>\n% wc *htm *md\n      12     301    1909 0001_welcome.htm\n       9     213    1366 0002_devtech.htm\n      69     553    4297 0003_getting_started.htm\n      68     756    5505 0004_revit_sdk_contents.htm\n      19     497    3322 0005_managing_sdk_samples.htm\n     122     916    6098 0006_sdk_samples_solution.htm\n     120     865    5890 0007_loading_sdk_samples.htm\n     125    1409    9349 0008_debugging.htm\n       8     376    2121 0009_what_next.htm\n     102    1062    8226 0010_selecting_all_walls.htm\n     447    3131   32490 0011_units.htm\n      66    1316    8954 0012_geometry_library.htm\n      44     524    3712 0013_geometry_viewers.htm\n...\n     491    2762   20716 1997_sdk_brep.md\n     267    1609   12882 1998_unittest_arcdim.md\n     323    2249   18196 1999_mep_calculation.md\n     259    2335   16834 2000_visual_api.md\n  417722 2480900 22669323 total\n</pre>\n\nLong live The Building Coder!\n\n####<a name=\"6.1\"></a>\n\n[LinkedIn feedback from Mikhail Smirnov](https://www.linkedin.com/feed/update/urn:li:activity:7085118894100623361?commentUrn=urn%3Ali%3Acomment%3A%28activity%3A7085118894100623361%2C7085135341363347457%29):\n\n> Thanks a lot for the article, Jeremy! As always, you are at the peak of the research wave.\n\nThank you for your appreciation!\nHowever, just to clarify: there is actually no research of mine in here at all.\nI am just as reporter, a librarian... there seems to be a greater lack of those than of researchers, programmers, and especially documenters...\nResearching and programming is much more fun!\nStill, someone has to do what I do, it seems..."
  }
]