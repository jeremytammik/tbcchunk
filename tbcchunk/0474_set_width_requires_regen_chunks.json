[
  {
    "original_filename": "0474_set_width_requires_regen",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0474_set_width_requires_regen",
    "header_text": "Setting Text Width Requires Regen",
    "local_header_href": "#setting-text-width-requires-regen",
    "chunk_text": "<h3>Setting Text Width Requires Regen</h3><p>I presented a general introduction to the topic of regeneration in the discussion of my first Revit 2011 add-in, the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/05/pipe-to-conduit-converter.html#6\">\npipe to conduit converter</a>, and\n\nin Kevin Vandecar's \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/10/filtered-element-collectors.html\">\nperformance tips and tricks</a>.\n\n<p>We discussed the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/04/manual-regeneration-mode-danger.html\">\ndanger of lacking regeneration calls</a>, \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/04/regeneration-option-best-practices.html\">\nbest regen practices</a> and\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/04/regeneration-option-best-practices.html\">\nsome performance issues</a> quite \n\na while ago, and an example of problems resulting from accessing stale data in the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/06/to-regenerate-or-not-to-regenerate.html\">\nlocation curve of a newly inserted family instance</a>.\n\n<p>Here is another interesting and very clear little example of one of the many problems that you can run into if you forget to regenerate appropriately, raised and resolved by Armand Marshall of \n\n<a href=\"http://www.eicengineers.com\">\nEIC Engineers, Inc.</a>:\n\n<p><strong>Question:</strong> I've been working on reading values from an Excel file and creating text in Revit from that.\nI read the discussion on \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/06/textnote-rotation.html\">\nTextNote rotation</a> and \n\nnotice that you read the TextNote.Width value.  \nWhen I create a TextNote myself and try to set the TextNote.Width, it doesn't seem to work:\n\n<pre class=\"code\">\n  <span class=\"teal\">Document</span> activeDoc = commandData.Application\n    .ActiveUIDocument.Document;\n \n  <span class=\"teal\">View</span> currentView = activeDoc.ActiveView;\n \n  <span class=\"teal\">XYZ</span> origin = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>( 0, 0, 0 );\n  <span class=\"teal\">XYZ</span> baseVec = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>( 0, 0, 0 );\n  <span class=\"teal\">XYZ</span> upVec = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>( 0, 0, 1 );\n \n  <span class=\"blue\">double</span> lineWid = 0.125;\n  <span class=\"blue\">string</span> strText = string1;\n \n  <span class=\"teal\">TextNote</span> textNote\n    = activeDoc.Create.NewTextNote(\n      currentView, origin, baseVec, upVec, lineWid,\n      <span class=\"teal\">TextAlignFlags</span>.TEF_ALIGN_CENTER\n      | <span class=\"teal\">TextAlignFlags</span>.TEF_ALIGN_MIDDLE, strText );\n \n  textNote.Width = 21.2;\n</pre>\n<p>Setting the width seems to have no effect.  \nI am trying to set the width wide enough to avoid the text wrapping.\n\n<p>If I display the value in a task dialog, i.e. TaskDialog.Show(\"Test\", textNote.Width.ToString()), it comes up and says that the width is zero.\n\n<p>Any idea what might be going on?\n\n<p><strong>Answer:</strong> Your code looks ok to me, and I am not aware of any issues with text notes and width at all.\nI am sure others are using this as well, so I cannot imagine what the problem might be.\n \n<p>The API documentation says: \n<span style=\"color:darkblue\">\nWith this method, the width of the TextNote object can be retrieved and changed. \nThe set method will calculate the real width of the TextNote. \nIf the requested width is less than the real width, the real width will be set instead of the requested width.</span>\n<p>Have you tried using different alignment flags? \nDifferent widths?\n\n<p><strong>Response:</strong> I figured out the problem!\n \n<p>After you create the TextNote, it is as if it doesn't exist until there is a regeneration.\n\n<p>So I added a call to activeDoc.Regenerate after creating it and before setting its width, and now it works fine.\n\n<p><strong>Answer:</strong> Yes, this is always a likely culprit, and I should definitely make a habit of always asking people what their regeneration option and transaction mode are before thinking of anything else.\n\n<p>Many thanks to Armand for this helpful example!\n</p></p></p></p></p></p></p></p></p></p></p></p></p></p></p>"
  }
]