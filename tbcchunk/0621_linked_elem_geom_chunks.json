[
  {
    "original_filename": "0621_linked_elem_geom",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0621_linked_elem_geom",
    "header_text": "Linked Element Geometry Access",
    "local_header_href": "#linked-element-geometry-access",
    "chunk_text": "<h3>Linked Element Geometry Access</h3><p>I just arrived in Greece to give a Revit API training here during the next few days.\nI am in a pleasant place called Κηφισια (Kifissia), a suburb of Athens.\n<!-- ·Æ¹Ã¹¬ --> \nI still need to get the training material set up properly...\n\n<p>Meanwhile, here are some notes on a different topic that I have been sitting on for a while:\n\n<p>Analysing the geometry of linked files is a challenge.\n\n<p>Certain basic information is actually easily accessible, as shown by the discussion on \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/02/list-linked-elements.html\">\nlisting elements in linked documents</a> and the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/02/list-linked-elements.html\">\nCmdLinkedFileElements</a> command.\n\n<p>More intense geometric analysis is not so easy, however. \nFor instance, the FindReferencesWithContextByDirection method does not work on linked elements, which is understandable, and even the Intersect method will fail when fed geometry from linked elements.\n\n<p>The Revit 2012 API introduces the new Instance.GetTransform and Instance.GetTotalTransform methods which help handle this.\nThese new methods provide the transform for a given Instance (which is the parent class for elements like family instances, link instances, and imported CAD content). \nGetTransform obtains the basic transform for the instance based on how the instance is placed. \nGetTotalTransform provides the transform modified with the true north transform, for instances like import instances.\n\n<p>The transform obtained can be applied to geometry elements using the new GeometryElement.GetTransformed method, which returns a copy of the geometry in the original element, transformed by the input coordinate transformation.\n\n<p>We had a look at this method recently to analyse \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/06/get-transformed-family-instance-geometry.html\">\ngetting the transformed family instance geometry</a> and\n\ntaking into account the transformation already built into the GetTransformed method.\n\n<p>Here is an explanation of some further aspects of this topic: <!-- by Scott Conover -->\n<p><strong>Question:</strong> I just don't understand why you say that geometry of the linked elements cannot be obtained. \nWhen walls, floors etc. are obtained from a linked document, it seems that I'm able to also obtain their geometry. \n\nObviously it would not even be possible to call the Intersect method without obtaining the geometry first. \nThe problem is that result is incorrect.\nWhy is it that the linked geometry appears to be OK but still is somehow incomplete?\n\n<p><strong>Answer:</strong> The geometry of the linked document is not necessarily the same as the geometry of the document itself.  \nWhen you get the elements from the document, the geometry does not reflect (for example) the transformation of the linked document into the coordinate system of the host document.  \nYou can now get the transformation into the current project using the inherited method Instance.GetTransform on the link instance, and the transformed geometry of an element using GeometryElement.GetTransformed.\n\n<p>Hopefully, by applying the appropriate transform retrieved from the link instance to the target curve, e.g. using Curve.Transformed, you will then be able to correctly detect the intersection.  \n\n<p>There are other potential differences regarding filters applied by the host document on the link which would not necessarily be reflected in the geometry of the document which is linked in.  So when we say that the geometry of the link is not truly available this is accurate; the geometry you can find from the document in memory doesn't know how the host modifies the link.\n</p></p></p></p></p></p></p></p></p></p></p></p></p>"
  }
]