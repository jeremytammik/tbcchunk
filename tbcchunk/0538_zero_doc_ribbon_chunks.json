[
  {
    "original_filename": "0538_zero_doc_ribbon",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0538_zero_doc_ribbon",
    "header_text": "Enable Ribbon Items in Zero Document State",
    "local_header_href": "#enable-ribbon-items-in-zero-document-state",
    "chunk_text": "<h3>Enable Ribbon Items in Zero Document State</h3><p>Several people have asked about how to activate their custom add-in panel items when Revit is in zero document state, i.e. when no document has been opened in the Revit user interface:</p><center>\n<img alt=\"Zero document state\" src=\"img/zero_doc_state.png\" width=\"400\"/>\n</center><p>For an external command, it is no big deal: if you set both its transaction mode and regeneration option to Manual, it will appear in the Revit ribbon panel under Add-Ins &gt; External &gt; External Tools and also be available in zero document state:</p><center>\n<img alt=\"Zero document state external tools\" src=\"img/zero_doc_state_external_tools.png\" width=\"400\"/>\n</center><p>However, as you can see, all of the panels defined by external applications are disabled in this state.\n\n<p>Here is the code of an initial version of the external application ZeroDocPanel creating the right-most ribbon panel and push button that you see above and which is disabled in zero document state:\n\n<pre class=\"code\">\n[<span class=\"teal\">Transaction</span>( <span class=\"teal\">TransactionMode</span>.Manual )]\n[<span class=\"teal\">Regeneration</span>( <span class=\"teal\">RegenerationOption</span>.Manual )]\n<span class=\"blue\">class</span> <span class=\"teal\">App</span> : <span class=\"teal\">IExternalApplication</span>\n{\n  <span class=\"blue\">public</span> <span class=\"blue\">const</span> <span class=\"blue\">string</span> Caption = <span class=\"maroon\">\"Zero Doc Panel\"</span>;\n  <span class=\"blue\">public</span> <span class=\"blue\">const</span> <span class=\"blue\">string</span> Caption2 = <span class=\"maroon\">\"Zero Doc Button\"</span>;\n \n  <span class=\"blue\">static</span> <span class=\"blue\">string</span> _path \n    = System.Reflection.<span class=\"teal\">Assembly</span>\n      .GetExecutingAssembly().Location;\n \n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> OnStartup( <span class=\"teal\">UIControlledApplication</span> a )\n  {\n    <span class=\"teal\">RibbonPanel</span> p = a.CreateRibbonPanel( Caption );\n \n    <span class=\"teal\">PushButton</span> b = p.AddItem(\n      <span class=\"blue\">new</span> <span class=\"teal\">PushButtonData</span>( Caption2, Caption2,\n        <span class=\"teal\">Path</span>.GetDirectoryName( _path ),\n        <span class=\"maroon\">\"ZeroDocPanel.Command\"</span> ) ) <span class=\"blue\">as</span> <span class=\"teal\">PushButton</span>;\n \n    b.ToolTip = <span class=\"maroon\">\"This is the zero doc panel button tooltip\"</span>;\n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n \n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> OnShutdown( <span class=\"teal\">UIControlledApplication</span> a )\n  {\n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n}\n</pre>\n<p>This leads to the following question:\n\n<p><strong>Question:</strong> I want to enable the ribbon items in a panel defined by my external application in zero document state. \nHow can I achieve that, please?\n\n<p>In the Revit API help file RevitAPI.chm, I see a statement saying that \"The push button will be disabled when there is no active document unless availability class of that button returns true\". \nCould you please elaborate on this?\n\n<p><strong>Answer:</strong> Yes, this statement is correct. \nButtons defined by an external application are disabled by default in zero document state. \nIf you provide an appropriate external command availability class implementation and return true, they will be enabled. Have you tried this?\n\n<p>We discussed the availability class in the presentation of the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/04/revitaddinutility.html\">\nRevitAddInUtility</a>, \n\nand also touched on it briefly when looking at the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/03/revit-2011-product-guids.html#1\">\nRevit 2011 product GUIDs</a>, the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/04/addin-manifest-and-guidize.html#2\">\nadd-in manifest tags</a>, and the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/05/pipe-to-conduit-converter.html\">\npipe to conduit converter</a>\n<p>Besides being applied to external commands, you can also use the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/09/simulating-a-ribbon-textbox-label.html\">\nPushButton AvailabilityClassName property</a> to\n\ncontrol visibility of individual buttons.\n\n<p>By the way, you have to read the documentation of the IExternalCommandAvailability interface pretty carefully. \nOne of the statements it makes is \"This interface should share the same assembly with add-in External Command\".\n\n<p>Let's enhance the external application presented above to enable its panel in zero document state.\nAs said, we need to implement the IExternalCommandAvailability interface.\nHere is a very trivial implementation that simply always returns true:\n\n<pre class=\"code\">\n<span class=\"blue\">public</span> <span class=\"blue\">class</span> <span class=\"teal\">Availability</span> \n  : <span class=\"teal\">IExternalCommandAvailability</span>\n{\n  <span class=\"blue\">public</span> <span class=\"blue\">bool</span> IsCommandAvailable(\n    <span class=\"teal\">UIApplication</span> a, \n    <span class=\"teal\">CategorySet</span> b )\n  {\n    <span class=\"blue\">return</span> <span class=\"blue\">true</span>;\n  }\n}\n</pre>\n<p>Here is the enhanced code of the ZeroDocPanel external application making use of the command availability class:\n\n<pre class=\"code\">\n[<span class=\"teal\">Transaction</span>( <span class=\"teal\">TransactionMode</span>.Manual )]\n[<span class=\"teal\">Regeneration</span>( <span class=\"teal\">RegenerationOption</span>.Manual )]\n<span class=\"blue\">class</span> <span class=\"teal\">App</span> : <span class=\"teal\">IExternalApplication</span>\n{\n  <span class=\"blue\">public</span> <span class=\"blue\">const</span> <span class=\"blue\">string</span> Caption = <span class=\"maroon\">\"Zero Doc Panel\"</span>;\n  <span class=\"blue\">public</span> <span class=\"blue\">const</span> <span class=\"blue\">string</span> Caption2 = <span class=\"maroon\">\"Zero Doc Button\"</span>;\n \n  <span class=\"blue\">static</span> <span class=\"blue\">string</span> _path \n    = System.Reflection.<span class=\"teal\">Assembly</span>\n      .GetExecutingAssembly().Location;\n \n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> OnStartup( \n    <span class=\"teal\">UIControlledApplication</span> a )\n  {\n    <span class=\"teal\">PushButtonData</span> d = <span class=\"blue\">new</span> <span class=\"teal\">PushButtonData</span>( \n      Caption2, Caption2, _path, \n      <span class=\"maroon\">\"ZeroDocPanel.Command\"</span> );\n \n    d.AvailabilityClassName \n      = <span class=\"maroon\">\"ZeroDocPanel.Availability\"</span>;\n \n    <span class=\"teal\">RibbonPanel</span> p = a.CreateRibbonPanel( Caption );\n \n    <span class=\"teal\">PushButton</span> b = p.AddItem( d ) <span class=\"blue\">as</span> <span class=\"teal\">PushButton</span>;\n \n    b.ToolTip \n      = <span class=\"maroon\">\"This is the zero doc panel button tooltip\"</span>;\n \n    <span class=\"green\">//b.AvailabilityClassName </span>\n    <span class=\"green\">//  = \"ZeroDocPanel.Availability\";</span>\n \n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n \n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> OnShutdown( \n    <span class=\"teal\">UIControlledApplication</span> a )\n  {\n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n}\n</pre>\n<p>One important thing to note is that the AvailabilityClassName property must be set on the PushButtonData instance before adding the push button to the panel, i.e. before calling the AddItem method with the PushButtonData information.\n\n<p>Setting this property afterwards will have no effect!\n\n<p>Alternatively, one can set the AvailabilityClassName property on the resulting PushButton instance itself after it has been added.\n\n<p>And, as said, the command availability class and external command implementation must live in the same .NET assembly.\nIn our case, both of them and the external application implementation as well all share the same assembly.\n\n<p>Here is the ZeroDocPanel external application showing its activated push button in zero document state:\n\n<center>\n<img alt=\"Zero document state ribbon panel enabled\" src=\"img/zero_doc_state_panel_enabled.png\" width=\"400\"/>\n</center>\n<p>Here is \n\n<!-- \n\nC:\\a\\j\\adn\\case\\bsd\\1266417\\src\\ZeroDocPanel\nC:\\a\\doc\\revit\\blog\\zip\\ZeroDocPanel.zip\n\n-->\n<a href=\"zip/ZeroDocPanel.zip\">\nZeroDocPanel.zip</a> containing \n\nthe entire source code and Visual Studio solution implementing this add-in.\n\n<a name=\"addendum\"></a>\n<p><strong>Addendum:</strong> As Arnošt points out in his comment below, the Transaction attribute shown above is unnecessary and will be ignored.\nI discuss this issue in more detail in an updated note on \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/02/external-application-attributes.html\">\nexternal application attributes</a>, \n\nand removed the attribute in the zip file above.\n</p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p>"
  }
]