[
  {
    "original_filename": "0834_create_dimension",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0834_create_dimension",
    "header_text": "Create Dimension between Two Lines",
    "local_header_href": "#create-dimension-between-two-lines",
    "chunk_text": "<h3>Create Dimension between Two Lines</h3><p>Another one of those recurring questions: how to create dimensioning.\n\n<p>I took the opportunity to highlight how to search the samples, find a solution, and apply a correction to RevitLookup yourself.\n\n<p>You have the code.\n\n<p>May the Force be with you.\n\n<p><strong>Question:</strong> I tried to create detail drawings programmatically using the ItemFactoryBase NewDimension method.\n\n<p>I am creating detail lines in the drafting view based the on the geometry wall elements and would like to use Revit dimensioning to insert measurements into the detail drawings.\n\n<p>How do I obtain the reference for the detail lines of a drafting view to be able to call the NewDimension method?\n\n<p>I am sure that this is possible, since I can create dimension lines in a drafting view using the dimension line commands on the Annotate ribbon.\n\n\n<p><strong>Answer:</strong> Whenever you are faced with a question like this, please always begin by studying the three main official sources of information:\n\n<ul>\n<li>The Revit API help file RevitAPI.chm.\n<li>The online wikihelp Revit \n\n<a href=\"http://wikihelp.autodesk.com/Revit/enu/2013/Help/00006-API_Developer%27s_Guide\">\nAPI Developer's Guide</a>.\n<li>The Revit SDK sample source code.\n</li></li></li></ul>\n<p>Normally, when researching an issue like this myself, I perform a global search across the entire project in the SDKSamples2013.sln solution.\n\n<p>This time, happily, I extended it to the entire samples directory instead, including RevitLookup.\nTo tell the truth, I even searched my whole hard disk for all C# files containing NewDimension, because there were not that many in total.\n\n<p>This turned up the following hits in the Revit SDK folder (copy and paste to an editor to see the truncated lines):\n\n<pre>\nC:\\...\\SDK\\RevitLookup\\CS\\Test\\TestElements.cs(1255):               //        m_revitApp.ActiveUIDocument.Document.Create.NewDimension(dimension.View, line, dimension.References, dimension.DimensionType);\nC:\\...\\SDK\\RevitLookup\\CS\\Test\\TestElements.cs(1470):            m_revitApp.ActiveUIDocument.Document.Create.NewDimension(m_revitApp.ActiveUIDocument.Document.ActiveView,\nC:\\...\\SDK\\RevitLookup\\CS\\Test\\TestElements.cs(1475):            m_revitApp.ActiveUIDocument.Document.FamilyCreate.NewDimension(m_revitApp.ActiveUIDocument.Document.ActiveView,\nC:\\...\\SDK\\RevitLookup\\CS\\Utils\\Elements.cs(272):            Dimension dimensionClone = app.ActiveUIDocument.Document.Create.NewDimension(dimension.View, line, dimension.References);\nC:\\...\\SDK\\Samples\\CreateDimensions\\CS\\Command.cs(213):                    Dimension newDimension = doc.Create.NewDimension(\nC:\\...\\SDK\\Samples\\CreateDimensions\\CS\\Command1.cs(219):                    Dimension newDimension = doc.Create.NewDimension(\nC:\\...\\SDK\\Samples\\FamilyCreation\\WindowWizard\\CS\\CreateDimension.cs(31):    /// The class allows users to create dimension using Document.FamilyCreate.NewDimension() function\nC:\\...\\SDK\\Samples\\FamilyCreation\\WindowWizard\\CS\\CreateDimension.cs(91):            dim = m_document.FamilyCreate.NewDimension(view, line, refArray);\nC:\\...\\SDK\\Samples\\FamilyCreation\\WindowWizard\\CS\\CreateDimension.cs(125):            dim = m_document.FamilyCreate.NewDimension(view, line, refArray);\nC:\\...\\SDK\\Samples\\FamilyCreation\\WindowWizard\\CS\\CreateDimension.cs(160):            dim = m_document.FamilyCreate.NewDimension(view, line, refArray);\n</pre>\n<p>The very first of those, in the RevitLookup test framework, looks like it should answer your question right away:\n\n<pre class=\"code\">\n  <span class=\"teal\">XYZ</span> location1 = <span class=\"teal\">GeomUtils</span>.kOrigin;\n  <span class=\"teal\">XYZ</span> location2 = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>( 20.0, 0.0, 0.0 );\n  <span class=\"teal\">XYZ</span> location3 = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>( 0.0, 20.0, 0.0 );\n  <span class=\"teal\">XYZ</span> location4 = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>( 20.0, 20.0, 0.0 );\n \n  <span class=\"teal\">Curve</span> curve1 = m_revitApp.Application.Create\n    .NewLine( location1, location2, <span class=\"blue\">true</span> );\n \n  <span class=\"teal\">Curve</span> curve2 = m_revitApp.Application.Create\n    .NewLine( location3, location4, <span class=\"blue\">true</span> );\n \n  <span class=\"teal\">DetailCurve</span> dCurve1 = <span class=\"blue\">null</span>;\n  <span class=\"teal\">DetailCurve</span> dCurve2 = <span class=\"blue\">null</span>;\n \n  <span class=\"blue\">if</span>( !doc.IsFamilyDocument )\n  {\n    dCurve1 = doc.Create.NewDetailCurve(\n      doc.ActiveView, curve1 );\n \n    dCurve2 = doc.Create.NewDetailCurve(\n      doc.ActiveView, curve2 );\n  }\n  <span class=\"blue\">else</span>\n  {\n    <span class=\"blue\">if</span>( <span class=\"blue\">null</span> != doc.OwnerFamily\n      &amp;&amp; <span class=\"blue\">null</span> != doc.OwnerFamily.FamilyCategory )\n    {\n      <span class=\"blue\">if</span>( !doc.OwnerFamily.FamilyCategory.Name\n        .Contains( <span class=\"maroon\">\"Detail\"</span> ) )\n      {\n        <span class=\"teal\">MessageBox</span>.Show(\n          <span class=\"maroon\">\"Please make sure you open a detail based family template.\"</span>,\n          <span class=\"maroon\">\"RevitLookup\"</span>, <span class=\"teal\">MessageBoxButtons</span>.OK,\n          <span class=\"teal\">MessageBoxIcon</span>.Information );\n \n        <span class=\"blue\">return</span>;\n      }\n    }\n    dCurve1 = doc.FamilyCreate.NewDetailCurve(\n      doc.ActiveView, curve1 );\n \n    dCurve2 = doc.FamilyCreate.NewDetailCurve(\n      doc.ActiveView, curve2 );\n  }\n \n  <span class=\"teal\">Line</span> line = m_revitApp.Application.Create.NewLine(\n    location2, location4, <span class=\"blue\">true</span> );\n \n  <span class=\"teal\">ReferenceArray</span> refArray = <span class=\"blue\">new</span> <span class=\"teal\">ReferenceArray</span>();\n \n  refArray.Append( dCurve1.GeometryCurve.Reference );\n  refArray.Append( dCurve2.GeometryCurve.Reference );\n \n  <span class=\"blue\">if</span>( !doc.IsFamilyDocument )\n  {\n    doc.Create.NewDimension( \n      doc.ActiveView, line, refArray );\n  }\n  <span class=\"blue\">else</span>\n  {\n    doc.FamilyCreate.NewDimension( \n      doc.ActiveView, line, refArray );\n  }\n</pre>\n<p>I tried running this sample command by selecting the ribbon tab Add-Ins &gt; Revit Lookup &gt; Test Framework... &gt; Object Hierarchy &gt; APIObject &gt; Element &gt; Dimension &gt; OK.\n\n<p>That calls the DimensionHardWired method to do the job.\n\n<p>Unfortunately, it throws an exception saying \"Attempt to modify the model outside of transaction\".\n\n<p>I fixed it by adding the following lines right at the beginning of the method:\n\n<pre class=\"code\">\n  <span class=\"blue\">using</span>( <span class=\"teal\">Transaction</span> tx = <span class=\"blue\">new</span> <span class=\"teal\">Transaction</span>( doc ) )\n  {\n    tx.Start( <span class=\"maroon\">\"DimensionHardWired\"</span> );\n</pre>\n<p>Obviously, I need to commit the transaction and close the using statement at the end again:\n\n<pre class=\"code\">\n    tx.Commit();\n  }\n</pre>\n<p>Now is successfully completes with the following result:\n\n<center>\n<img alt=\"New dimension\" src=\"img/new_dimension.png\"/>\n</center>\n<p>You can also look at two The Building Coder samples creating wall dimensioning, either by\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/02/dimension-walls-by-iterating-faces.html\">\niterating over the wall faces</a> to\n\npick the two suitable ones, or using \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/02/dimension-walls-using-findreferencesbydirection.html\">\nFindReferencesByDirection to shoot a ray</a> and\n\nfind them directly.\n\n<p>They both retrieve the geometry references from the wall faces, and not from a simple detail line, though.\n\n<p>All together, this should provide more than enough to solve your issue.\n\n\n<a name=\"2\"></a>\n<h4>Accessing the Path of a Family Document from the Family Instance</h4>\n<p>Before closing, here is pointer to a cool discovery by Saikat Bhattacharya: if you try to find the family document of a family instance and go through the path family instance &gt; family symbol &gt; family &gt; document, you end up at the document containing the family instance. \nIf you are actually after the family document defining the instance, you need to go through the EditFamily method instead.\nMore details on\n\n<a href=\"http://adndevblog.typepad.com/aec/2012/09/accessing-the-path-a-revit-family-document-from-the-family-instance.html\">\naccessing the path of a family document from an instance</a>.\n\n</p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0834_create_dimension",
    "header_text": "Accessing the Path of a Family Document from the Family Instance",
    "local_header_href": "#accessing-the-path-of-a-family-document-from-the-family-instance",
    "chunk_text": "<h4>Accessing the Path of a Family Document from the Family Instance</h4><p>Before closing, here is pointer to a cool discovery by Saikat Bhattacharya: if you try to find the family document of a family instance and go through the path family instance &gt; family symbol &gt; family &gt; document, you end up at the document containing the family instance. \nIf you are actually after the family document defining the instance, you need to go through the EditFamily method instead.\nMore details on\n\n<a href=\"http://adndevblog.typepad.com/aec/2012/09/accessing-the-path-a-revit-family-document-from-the-family-instance.html\">\naccessing the path of a family document from an instance</a>.\n\n</p>"
  }
]