[
  {
    "original_filename": "1702_window_handle",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\n- https://forums.autodesk.com/t5/revit-api-forum/how-to-get-plugin-ui-to-be-at-the-same-level-as-revit/m-p/8392848\n  asked a number of times.\n  https://thebuildingcoder.typepad.com/blog/2010/06/revit-parent-window.html\n\n- https://github.com/jeremytammik/the_building_coder_samples/issues/8\n  Q: the \"cmdpresskey\" method worked for me since Revit 2014 - Revit 2018.\n  I made keyboard shortcuts for many commands like Textnotes, Dimensions.\n  But, I could not make these keyboard shortcuts work anymore for Revit 2019.\n  A: Ok, I see the code now in CmdPressKeys.cs. Sorry for my case sensitivity. The problem is presumably caused by the line\n    IntPtr revitHandle = System.Diagnostics.Process\n     .GetCurrentProcess().MainWindowHandle;\n  Please refer to this explanation:\n  https://thebuildingcoder.typepad.com/blog/2017/10/modeless-form-keep-revit-focus-and-on-top.html#10\n  The solution is given here:\n  https://thebuildingcoder.typepad.com/blog/2018/04/whats-new-in-the-revit-2019-api.html#4.1.4\n  use UiApplication MainWindowHandle to address issue #8\n  I modified the code to use UiApplication MainWindowHandle to address issue #8 and removed use of JtWindowHandle in release 2019.0.143.10. please test and confirm that it works.\n  Also cf. [](https://forums.autodesk.com/t5/revit-api-forum/assign-a-name-to-a-string-c-process-getcurrentprocess/m-p/8365316)\n  To get a text from an IntPtr window handle:\n  https://www.pinvoke.net/default.aspx/user32/getwindowtext.html?diff=y\n  Revitalizer\n\nRevit window handle and parenting an add-in form in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon http://bit.ly/rvthwnd\n\nAccess to the Revit main window handle changed in Revit 2019, raising a couple of questions\n&ndash; Making Revit the add-in parent\n&ndash; The Revit 2019 <code>MainWindowHandle</code> API\n&ndash; Docking system and multiple main window explanation\n&ndash; Updating The Building Coder samples...\n\n-->"
  },
  {
    "original_filename": "1702_window_handle",
    "header_text": "Revit Window Handle and Parenting an Add-In Form",
    "local_header_href": "#revit-window-handle-and-parenting-an-add-in-form",
    "chunk_text": "### Revit Window Handle and Parenting an Add-In Form\n\nAccess to the Revit main window handle changed in Revit 2019, raising a couple of questions:\n\n- [Making Revit the add-in parent](#2) \n- [The Revit 2019 `MainWindowHandle` API](#3) \n- [Docking system and multiple main window explanation](#4) \n- [Updating The Building Coder samples](#5) \n\n<center>\n<img src=\"img/shattered_window.jpg\" alt=\"Shattered window\" width=\"320\">\n<p style=\"font-size: 80%; font-style:italic\">Shattered window &#169; Benoit Brummer, <a href=\"https://commons.wikimedia.org/wiki/User:Trougnouf\">@Trougnouf</a></p>\n</center>"
  },
  {
    "original_filename": "1702_window_handle",
    "header_text": "<a name=\"2\"></a> Making Revit the Add-In Parent",
    "local_header_href": "#a-name2a-making-revit-the-add-in-parent",
    "chunk_text": "#### <a name=\"2\"></a> Making Revit the Add-In Parent\n\nA question came up in \nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) question\non [how to get plugin UI to be at the same level as Revit](https://forums.autodesk.com/t5/revit-api-forum/how-to-get-plugin-ui-to-be-at-the-same-level-as-revit/m-p/8392848) that\nhas in fact been asked repeatedly in the past.\n\nSome of my past answers can be found by searching the forum for 'jtwindowhandle'.\n\nAs of Revit 2019, however, the answer needs to be modified and updated, so let's do so here and now:\n\n**Question:** I'm currently setting my plug-in's UI to `TopMost`.\n\nHowever, if I minimize Revit, my plugin stays on top.\n\nIs there a way to have my plug-in's UI to match the functionality of Revit?\n\n**Answer:** You have to ensure that your control is assigned the Revit main window as parent.\n\nFor instance, if you display your form using\nthe [.NET `ShowDialog` method](https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.form.showdialog),\nmake use of its overload taking an IWin32Window argument:\n\n- `ShowDialog(IWin32Window)` &ndash; Shows the form as a modal dialog box with the specified owner.\n\nThis approach was explained back in 2010 in the discussion on setting \nthe [Revit parent window](https://thebuildingcoder.typepad.com/blog/2010/06/revit-parent-window.html).\n\nPlease note that\nthe [Revit 2019 API provides direct access to the Revit main window handle](https://thebuildingcoder.typepad.com/blog/2018/08/whats-new-in-the-revit-20191-api.html#3.1.4)."
  },
  {
    "original_filename": "1702_window_handle",
    "header_text": "<a name=\"3\"></a> The Revit 2019 MainWindowHandle API",
    "local_header_href": "#a-name3a-the-revit-2019-mainwindowhandle-api",
    "chunk_text": "#### <a name=\"3\"></a> The Revit 2019 MainWindowHandle API\n\nHere is a brief quote from\nthe [Revit 2019 API news](https://thebuildingcoder.typepad.com/blog/2018/08/whats-new-in-the-revit-20191-api.html)\non the [direct access to the Revit main window handle](https://thebuildingcoder.typepad.com/blog/2018/08/whats-new-in-the-revit-20191-api.html#3.1.4):\n\n> <b>1.4. UI API changes</b>\n\n> <b>1.4.1. Main window handle access</b>\n\n> Two new properties in the `Autodesk.Revit.UI` namespace provide access to the handle of the Revit main window:\n\n> - `UIApplication.MainWindowHandle`\n> - `UIControlledApplication.MainWindowHandle`\n\n> This handle should be used when displaying modal dialogs and message windows to ensure that they are properly parented.\nUse these properties instead of System.Diagnostics.Process.GetCurrentProcess().MainWindowHandle,\nwhich is no longer a reliable method for retrieving the main window handle starting with Revit 2019.\n\nThe change was also pointed out by The Building Coder in October 2017 with\na [warning that things will change in the next release](https://thebuildingcoder.typepad.com/blog/2017/10/modeless-form-keep-revit-focus-and-on-top.html#10)."
  },
  {
    "original_filename": "1702_window_handle",
    "header_text": "<a name=\"4\"></a> Docking System and Multiple Main Window Explanation",
    "local_header_href": "#a-name4a-docking-system-and-multiple-main-window-explanation",
    "chunk_text": "#### <a name=\"4\"></a> Docking System and Multiple Main Window Explanation\n\nRevitalizer explains the need for the new property in his notes\non [assigning a name to a string in C# and `Process.GetCurrentProcess().MainWindowTitle`](https://forums.autodesk.com/t5/revit-api-forum/assign-a-name-to-a-string-c-process-getcurrentprocess/m-p/8365316):\n\n> Due to the new docking system introduced in Revit 2019, both the `UIApplication` and `UIControlledApplication` classes now sport a `MainWindowHandle` property.\n\n> It returns an `IntPtr` window handle that you can [P/Invoke `GetWindowText`](http://pinvoke.net/default.aspx/user32/GetWindowText.html) on to retrieve the window caption text.\n\n> In Revit 2019, if view windows are pulled off the main window, there may be more than one Revit application window.\n\n> If you open views in just one single Revit 2019 window, of course the 2018 code might still function, since it just finds the only one."
  },
  {
    "original_filename": "1702_window_handle",
    "header_text": "<a name=\"5\"></a> Updating The Building Coder Samples",
    "local_header_href": "#a-name5a-updating-the-building-coder-samples",
    "chunk_text": "#### <a name=\"5\"></a> Updating The Building Coder Samples\n\n[The Building Coder samples](https://github.com/jeremytammik/the_building_coder_samples) were\nstill using the now obsolete `JtWindowHandle` class up\nuntil [release 2019.0.143.9](https://github.com/jeremytammik/the_building_coder_samples/releases/tag/2019.0.143.9).\n\nThe update to switch to the new Revit `MainWindowHandle` property instead was prompted\nby [issue #8](https://github.com/jeremytammik/the_building_coder_samples/issues/8) about\na keyboard shortcut problem with `CmdPressKeys` in Revit 2019.\n\nThe code in CmdPressKeys.cs was still retrieving the Revit main window handle via a call to `GetCurrentProcess`:\n\n<pre class=\"code\">\n    IntPtr revitHandle = System.Diagnostics.Process\n     .GetCurrentProcess().MainWindowHandle;\n</pre>\n\nI modified it to use `UiApplication MainWindowHandle` instead and removed the use of `JtWindowHandle`\nin [release 2019.0.143.10](https://github.com/jeremytammik/the_building_coder_samples/releases/tag/2019.0.143.10).\n\nLook at the modifications made to the modules CmdPlaceFamilyInstance.cs, CmdPressKeys.cs and JtWindowHandle.cs in\nthe [diff between the two versions](https://github.com/jeremytammik/the_building_coder_samples/compare/2019.0.143.9...2019.0.143.10)."
  }
]