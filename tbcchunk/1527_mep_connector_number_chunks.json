[
  {
    "original_filename": "1527_mep_connector_number",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"run_prettify.js\" type=\"text/javascript\"></script>\n<!--\n<script src=\"https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js\" type=\"text/javascript\"></script>\n-->\n</head>\n\n<!---\n\nhttp://forums.autodesk.com/t5/revit-mep-forum/connector-numbers-of-mechanical-equipment/m-p/6870978/highlight/false#M38295\n\n#RevitAPI @AutodeskRevit #aec #bim #dynamobim @AutodeskForge\n\nI answered a question in the Revit MEP forum, prompted by Robert Klempau's direct mention in the thread on connector numbers of mechanical equipment. Since it is rather technical and even includes a snippet of Revit source code, let me reiterate it here for better readability and future reference &ndash; Question: I created a mechanical exhaust fan with four connectors...\n\nThe Revit MEP Connector Number \n\n-->"
  },
  {
    "original_filename": "1527_mep_connector_number",
    "header_text": "Revit MEP Connector Number",
    "local_header_href": "#revit-mep-connector-number",
    "chunk_text": "### Revit MEP Connector Number\n\nI answered a question in a forum I never participated in previously,\nthe [Revit MEP forum](http://forums.autodesk.com/t5/revit-mep-forum/bd-p/188),\nprompted by Robert Klempau's direct mention in the thread\non [connector numbers of mechanical equipment](http://forums.autodesk.com/t5/revit-mep-forum/connector-numbers-of-mechanical-equipment/m-p/6870978).\n\nSince it is rather technical and even includes a snippet of Revit source code, let me reiterate it here for better readability and future reference:\n\n**Question:** I created a mechanical exhaust fan with four connectors for testing something else.\n\nInterestingly, when I was creating a system, Revit asked me which connector I wanted to use. In the list of connectors, it looks like each one has its own connector number (connector 4 to 7).\n \nCan someone tell me where is this parameter saved in the Revit family, and am I able to change that?\n\n<center>\n<img src=\"img/mep_connector_nr_1.png\" alt=\"MEP connector number\" width=\"409\"/>\n</center>\n\n**Answer 1** Do you have any other type of connector in the family?\nUsually they are numbered after the placement sequence.\nTo include a text, use the description parameter of the connector properties; that will make your life easier in this selection window.\n\n**Answer 2:** \nI created a video showing what to do when adding connectors of the same system classification to your family.\n\nThat you see only connector 4 till 7 and not 1 till 4 can have several reasons.\n \n- There are other connectors in your model, like duct, conduit, cable tray or electrical connectors in your family.\n- There are connectors in your family, but you removed some of them.\n\nIn your case I see 4 Duct connectors and 1 electrical connector.\n \nDon't worry about the connector numbers.\n\nAs suggested, add the description to the connector so you know exactly which connector is which.\n\n<center>\n<img src=\"img/mep_connector_nr_2.png\" alt=\"MEP connector number\" width=\"366\"/>\n</center>\n\nHere is a video providing the full details:\n\n<center>\n<iframe src=\"https://screencast.autodesk.com/Embed/Timeline/0d5a99e1-726c-4410-a5ac-72fc4d5186a4\" width=\"480\" height=\"470\" frameborder=\"0\" scrolling=\"no\" allowfullscreen=\"allowfullscreen\" webkitallowfullscreen=\"webkitallowfullscreen\" style=\"display: inline;\"></iframe>\n</center>\n\n**Response:** You are right. There is an electrical connector. Besides that, initially there were two duct connectors and I removed them, then I added four duct connectors. That explains why my duct connectors in the dialog start from \"4\".\n \nHowever, if two initial duct connectors had been removed, why does the current duct connectors start numbering from \"2\"? Does it mean these two initial connectors are still in my family? Do I need to find them out and delete them?\n\n**Answer 1:** When you add a connector to your family, Revit will give it a number. \nThat connector always keeps that number.\nWhen you remove the connector, Revit will remove also that number. \nRevit will not use the deleted number again.\nEvery new connector gets the highest connector number in your family +1.\nSo, a removed connector will stay unused.\nI used the RevitLookup tool to take a deeper look in the Revit family and there you see that there are only the connectors that are present in the family.\n \n<center>\n<img src=\"img/mep_connector_nr_3.png\" alt=\"Snooping MEP connector\" width=\"705\"/>\n</center>\n\nMy conclusion: When removing a connector, it will be removed permanently and it will not reuse that connector number again.\n\nNote: The Snoop DB command is provided by the RevitLookup add-in I use to look directly into the Revit Database. Please see: \n\n- [Revit 2016: click here](http://forums.autodesk.com/t5/revit-api-forum/revitlookup-for-revit-2016-is-here/m-p/5600976)\n- [Revit 2017: click here](http://forums.autodesk.com/t5/revit-api-forum/revitlookup-for-revit-2017-is-here/m-p/6279580/highlight/true#M15603)\n \n**Answer 2:** Checking the Revit source code, there is one key function to get the 'Connector number' in the edit family environment:\n \n<pre class=\"code\">\n<span style=\"color:blue;\">int</span>&nbsp;ConnectorElem::defaultIndex()\n{\n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;...</span>\n&nbsp;&nbsp;\n<span style=\"color:blue;\">for</span>(&nbsp;elemIter.initIter();&nbsp;!elemIter.isDone();&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;elemIter.increment()&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pElem&nbsp;=&nbsp;getDocument()-&gt;getElement(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elemIter.getElementId()&nbsp;);\n \n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;!pElem&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">continue</span>;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n \n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;IS_A(&nbsp;ConnectorElem,&nbsp;pElem&nbsp;)&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pConnectorElem&nbsp;=&nbsp;downcast&nbsp;&lt;<span style=\"color:blue;\">const</span>&nbsp;ConnectorElem*&gt;&nbsp;(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pElem&nbsp;);\n \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nIndex&nbsp;=&nbsp;pConnectorElem-&gt;getIndex();\n \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;nIndex&nbsp;&gt;&nbsp;nMaxIndex&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nMaxIndex&nbsp;=&nbsp;nIndex;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n \n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;We&nbsp;want&nbsp;to&nbsp;start&nbsp;the&nbsp;indices&nbsp;at&nbsp;1&nbsp;if&nbsp;there&nbsp;are&nbsp;none.</span>\n \n&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;nMaxIndex&nbsp;&lt;=&nbsp;0&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;nMaxIndex&nbsp;=&nbsp;1;\n&nbsp;&nbsp;}\n&nbsp;&nbsp;<span style=\"color:blue;\">else</span>\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;nMaxIndex++;\n&nbsp;&nbsp;}\n \n&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;nMaxIndex;\n}\n</pre>\n  \nThe index that you refer to as connector number is serialized with the `ConnectorElem`, so it remains unchanged once the connector exists.\n \nBased on the above implementation, we can draw the following conclusions:\n \n- The index starts from 1. In some old family, you might also find an index 0, caused by old code.\n- The newly created connector index is the highest index + 1.\n- The index might not be continuous. If you remove an 'inner' connector whose index is in \\[1, maxIndex\\), maxIndex is kept, so the index will be skipped.\n- The index might be reused, if user removes all indices in \\[index, maxIndex\\].\n \nSo, to answer your questions:\n \n- When you add a connector to your family, Revit will give it a number &rarr; Yes.\n- That connector always keeps that number &rarr; Yes.\n- When you remove the connector, Revit will remove also that number &rarr; Yes.\n- Revit will no use the deleted number again &rarr; No: If you remove the maxIndex, the maxIndex will be reused.\n- Every new connector gets the highest connector number in your family +1 &rarr; Yes, so a removed connector will stay unused.\n- I used RevitLookup to take a deeper look in the Revit family and there you see that there are only the connectors that are present in the family &rarr; Index is a serialized parameter on the connector element, but it is not visible to the user."
  }
]