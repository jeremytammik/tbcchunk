[
  {
    "original_filename": "0794_obj_export_colour",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0794_obj_export_colour",
    "header_text": "OBJ Model Exporter with Colours",
    "local_header_href": "#obj-model-exporter-with-colours",
    "chunk_text": "<h3>OBJ Model Exporter with Colours</h3><p>I discussed the \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/06/obj-model-exporter-take-one.html\">\nfirst take of my OBJ exporter</a> last\n\nweek, still lacking colour support.\n\n<p>Adding colours turned out to be more complex than I had expected, and the result as it currently stands includes a couple of kludges, I'm afraid.\n\n<p>Still, for a quick hack it does a decent job of getting a rough idea across.\nFor instance, here is the result of exporting the basic sample project rac_basic_sample_project.rvt included in the Revit product distribution:</p>\n<center>\n<img alt=\"Basic sample model in OBJ\" src=\"img/obj_export_basic_model_inst.png\"/>\n</center>\n<p>The resulting OBJ file size is 363 KB, and here is the element count for that export operation:</p>\n<center>\n<img alt=\"Basic sample model element counts\" src=\"img/obj_export_basic_model_inst_msg.png\"/>\n</center>\n<p>I added code to access the element category's material and colour, as well as the material and colour of an individual face of the solid, in case it has been overridden.\nI also added support for a default colour, in case my algorithm produced nothing useful.\n\n<p>Some of the places I looked to learn about OBJ materials were the\n\n<a href=\"http://www.cs.clemson.edu/~dhouse/courses/405/docs/brief-obj-file-format.html\">\nOBJ file format</a>, a \n\n<a href=\"http://local.wasp.uwa.edu.au/~pbourke/dataformats/mtl\">\nvery detailed MTL format</a> description and a \n\n<a href=\"http://people.sc.fsu.edu/~jburkardt/data/mtl/mtl.html\">\nshorter one</a> including pointers to sample MTL files.\n\nUnfortunately, the specific link of greatest interest to me, to definitions of simple primary color materials, does not work.\n\n<p>Just like the vertices, the colours also need to be added to a lookup table in order to avoid duplication.\nFor an OBJ model, colours are defined by materials, which are specified in a separate material library file with the extension MTL, so the exported no created two parallel files.\nFor simplicity's sake, I just defined the ambient and diffuse colours for my materials and named them using the hexadecimal representation of the Revit colour byte values.\nThe first couple of entries in my material file look like this:\n\n<pre>\nnewmtl C0C0C0\nKa 0.75 0.75 0.75\nKd 0.75 0.75 0.75\nnewmtl DBDBDB\nKa 0.85546875 0.85546875 0.85546875\nKd 0.85546875 0.85546875 0.85546875\nnewmtl 453B2C\nKa 0.26953125 0.171875 0.23046875\nKd 0.26953125 0.171875 0.23046875\nnewmtl 7F7F7F\nKa 0.49609375 0.49609375 0.49609375\nKd 0.49609375 0.49609375 0.49609375\nnewmtl 000000\nKa 0 0 0\nKd 0 0 0\nnewmtl A7CAE4\nKa 0.65234375 0.890625 0.7890625\nKd 0.65234375 0.890625 0.7890625\nnewmtl DCCBAA\nKa 0.859375 0.6640625 0.79296875\nKd 0.859375 0.6640625 0.79296875\n</pre>\n<p>In the OBJ file, I start out by specifying the material library with this initial statement:\n\n<pre>\nmtllib jbasic2.mtl\n</pre>\n<p>The usemtl statement specifies which material to use, followed by faces referring to the vertex indices:\n\n<pre>\nusemtl DBDBDB\nf 210 212 310\nf 310 212 311\nf 311 312 313\nf 311 313 310\nf 314 315 211\nf 211 209 314\n</pre>\n<p>Here is \n\n<a href=\"zip/ObjExport.zip\">\nObjExport.zip</a> including\n\nthe entire source code, Visual Studio solution and add-in manifest for the OBJ exporter in its current state.\n\n<p>I would be glad to hear from you if you find this useful, and even more so if you discover possible enhancements to it.\n\n<p>The next step will be to explore how to make the model view ubiquitously available to mobile devices.\n\n<p>One tool for cloud-based access to 3D content that I just heard of is \n\n<a href=\"http://sunglass.io\">\nSunglass</a>,\n\nsupporting integration of desktop CAD and storage utilities such as Dropbox and, especially interesting for developers, including API access.\n\n<p><strong>Addendum:</strong> Do not use the obsolete ObjExport code provided above, since it does not handle multiple solids in the way required for a valid and complete export.\nPlease refer to the updated version 2 supporting \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2012/07/obj-model-exporter-with-multiple-solid-support.html\">\nmultiple solids per element</a> instead.</p></p></p></p></p></p></p></p></p></p></p></p>"
  }
]