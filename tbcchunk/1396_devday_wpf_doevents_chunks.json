[
  {
    "original_filename": "1396_devday_wpf_doevents",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"run_prettify.js\" type=\"text/javascript\"></script>\n<!---\n<script src=\"https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js\" type=\"text/javascript\"></script>\n-->\n</head>\n\n<!---\n\n- 11399855 [modeless dialog, external event and asynchronous API calls]\n  WPF DoEvents sample code\n\n#dotnet #csharp\n#fsharp #python\n#grevit\n#responsivedesign #typepad\n#ah8 #augi #dotnet\n#stingray #rendering\n#3dweb #3dviewAPI #html5 #threejs #webgl #3d #mobile #vr #ecommerce\n#Markdown #Fusion360 #Fusion360Hackathon\n#javascript\n#RestSharp #restAPI\n#mongoosejs #mongodb #nodejs\n#rtceur\n#xaml\n#3dweb #a360 #3dwebaccel #webgl @adskForge\n@AutodeskReCap @Adsk3dsMax\n#revitAPI #bim #aec #3dwebcoder #adsk #adskdevnetwrk @jimquanci @keanw\n#au2015 #rtceur\n#eraofconnection\n\nRevit API, Jeremy Tammik, akn_include\n\nDevDay Conference in Munich and WPF DoEvents #revitAPI #bim #aec #3dwebcoder #adsk @AutodeskRevit #adskdevnetwrk @jimquanci @keanw\n\nLet's talk about doing events, from two radically different perspectives, one great big external one and lots of teeny-weeny little internal ones.\nI'll share some pictures from the European DevDay conference and snow in Munich today, then discuss a WPF issue that came up last week\n&ndash; DevDay conference in Munich\n&ndash; WPF DoEvents...\n\n-->"
  },
  {
    "original_filename": "1396_devday_wpf_doevents",
    "header_text": "DevDay Conference in Munich and WPF DoEvents",
    "local_header_href": "#devday-conference-in-munich-and-wpf-doevents",
    "chunk_text": "### DevDay Conference in Munich and WPF DoEvents\n\nLet's talk about doing events, from two radically different perspectives, one great big external one and lots of teeny-weeny little internal ones.\n\nI'll share some pictures from the European DevDay conference and snow in Munich today, then discuss a WPF issue that came up last week:\n\n- [DevDay conference in Munich](#2)\n- [WPF DoEvents](#3)\n- [Addendum on WPF versus WinForms](#4)\n- [Addendum on Not Using Revit API within WPF `DataContext`](#5)\n- [WPF element id converter](#6)"
  },
  {
    "original_filename": "1396_devday_wpf_doevents",
    "header_text": "<a name=\"2\"></a>DevDay Conference in Munich",
    "local_header_href": "#a-name2adevday-conference-in-munich",
    "chunk_text": "#### <a name=\"2\"></a>DevDay Conference in Munich\n\nToday we held the one and only European DevDay conference in Munich:\n\n<center>\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/jeremytammik/albums/72157662970001709\" title=\"DevDay Conference Munich\"><img src=\"https://farm2.staticflickr.com/1675/23827373054_eb50a70d72_n.jpg\" width=\"320\" height=\"240\" alt=\"DevDay Conference Munich\"></a><script async src=\"//embedr.flickr.com/assets/client-code.js\" charset=\"utf-8\"></script>\n</center>\n\n[Jaime Rosales Duque](http://adndevblog.typepad.com/aec/jaime-rosales.html) came all the way from New York to help, and\n[Jim Quanci](http://dances-with-elephants.typepad.com/blog/about-the-author.html) even further, from San Francisco.\n\nWe have participants from all over Europe and even some from India.\n\nThe next few days are dedicated to an abbreviated [Cloud Accelerator](http://autodeskcloudaccelerator.com) here that I am looking forward to very much.\n\nMeanwhile, here is Maciej Szlek's WPF issue and solution:"
  },
  {
    "original_filename": "1396_devday_wpf_doevents",
    "header_text": "<a name=\"3\"></a>WPF DoEvents",
    "local_header_href": "#a-name3awpf-doevents",
    "chunk_text": "#### <a name=\"3\"></a>WPF DoEvents\n\nExactly two months back, we discussed [PickPoint with WPF and no threads attached](http://thebuildingcoder.typepad.com/blog/2015/11/pickpoint-with-wpf-and-no-threads.html).\n\nNow another modeless WPF issue was raised and solved by [Maciej 'Max' Szlek](http://maciejszlek.pl):\n\n**Question:** I'm creating a WPF addin that performs operations which will take much time.\n\nDuring this time the add-in dialogue don't respond until the operation ends, even when calling the external event Raise method by view-model command.\n\nDo you have some workaround to achieve dialogue responsively during performing API operations?\n\n**Answer:** Yes, I have heard about similar issues in the past involving blocking of modeless WPF forms.\n\nUnfortunately, I cannot find the relevant thread any longer.\n\nThe workarounds involved stuff like setting the window focus, e.g. using GetForegroundWindow and SetForegroundWindow, and allowing the WPF form to access the Windows message queue.\n\nI think Revit was somehow blocking the message queue, for some reason.\n\nI think the solution involved [calling the DoEvents method](http://stackoverflow.com/questions/5181777/use-of-application-doevents).\n\nA couple of WPF issues came up in the forum in the past couple of years, e.g.:\n\n- [Revit API preventing WPF window regeneration](http://forums.autodesk.com/t5/revit-API/revit-API-dll-preventing-wpf-window-regeneration/m-p/5545975)\n- [WPF window loses control when Revit API displays an error](http://forums.autodesk.com/t5/revit-API/wpf-window-loses-control-when-revit-API-displays-an-error/m-p/5319853)\n- [WPF tutorial using WPF in Winforms](http://tech.pro/tutorial/799/wpf-tutorial-using-wpf-in-winforms)\n\nOn the other hand, you can tell from these discussions that some people are successfully using WPF forms, and the development team are not aware of any issues with them.\n\nI recommend [sticking with Windows Forms](http://forums.autodesk.com/t5/revit-API/winforms-or-wpf/m-p/5558289) if you have a choice.\n\nHere is another recent article on [modeless WPF forms, PickPoint and multithreading](http://thebuildingcoder.typepad.com/blog/2015/11/pickpoint-with-wpf-and-no-threads.html), addressing other issues that also might be of interest to you,\nan [older one on WPF](http://thebuildingcoder.typepad.com/blog/2012/10/ensure-wpf-add-in-remains-in-foreground.html#2), and\na [comment on triggering an event from Jon](http://thebuildingcoder.typepad.com/blog/2013/12/triggering-immediate-external-event-execute.html?cid=6a00e553e16897883301a3fd3c071c970b#comment-6a00e553e16897883301a3fd3c071c970b).\n\nLater, one little addition; I searched for \"[Revit API WPF DoEvents](https://duckduckgo.com/?q=revit+API+WPF+doevents)\" and found this article\non [multithreading throwing exceptions in Revit 2015](http://thebuildingcoder.typepad.com/blog/2014/05/multithreading-throws-exceptions-in-revit-2015.html).\n\n**Response:** I grabbed this [DoEvents implementation on StackOverflow](http://stackoverflow.com/a/11899439) to\n\"start work on a method that runs on the Dispatcher thread, and it needs to block without blocking the UI Thread... implement a DoEvents based on the Dispatcher itself\".\n\nI don't like it, it's not too elegant, it forces to\nbreak [mvvm](https://de.wikipedia.org/wiki/Model_View_ViewModel) pattern, but it works.\n\nIf you would like to see my ugly non-refactored test code, clone\nmy [ExternalEventTests sample on BitBucket](https://bitbucket.org/kedziormsz/externaleventtests.git),\nalso [saved locally](zip/kedziormsz-externaleventtests-6c9eee0b346a.zip) here on The Building Coder.\n\nI haven't tested it much yet but it seems to be stable.\n\nYou can run it from the add-in manager &ndash; lack of static references to IExternalApplication.\n\nOn the occasion it allows to check if raised external events are queued or running next to each other. They are queued which is gooood but I think safer would be adapting below solution to the one external event &ndash; we don't know how the API engine will change in the future... ;) [pattern for semi-asynchronous Idling API access](http://thebuildingcoder.typepad.com/blog/2010/11/pattern-for-semi-asynchronous-idling-API-access.html)...\n\nAnyways thank you for your very accurate advice!\n\nWhat would be in your circle of interest is WpfCommand.\n\nWpfWindow contains a WPF implementation of the DoEvents method (in the way mentioned before) which is injected to ViewModel to minimize dependencies.\n\nViewModel contains 3 commands.\n\nThe first picks doors (it use part of my little cross API version framework) &ndash; simply to check how modeless WPF window would behave during hiding, picking and showing again.\n\nThe second and third flip doors &ndash; both have their own external event with different handler implementation. ViewModel's setStatus method calls injected DoEvents method.\n\nIf you have some more questions let me know.\n\nOh, and you can feel free to publish this solution on the blog of course, I don't have any problem with that ;)\n\n**Answer:** When you mention picking and flipping doors, that reminds me of the Revit SDK ModelessDialog `ModelessForm_ExternalEvent` and `ModelessForm_IdlingEvent` samples.\n\nAre you aware of those?\n\nIs there any similarity, or is your sample completely unrelated to those?\n\n**Response:** Yes, I'm aware of those, but my approach is quite different.\n\nCongratulations to Max on solving this, and many thanks for sharing it here with us!"
  },
  {
    "original_filename": "1396_devday_wpf_doevents",
    "header_text": "<a name=\"4\"></a>Addendum on WPF versus WinForms",
    "local_header_href": "#a-name4aaddendum-on-wpf-versus-winforms",
    "chunk_text": "#### <a name=\"4\"></a>Addendum on WPF versus WinForms\n\nJeroen Van Vlierden adds an update:\n\n> Just to let you know: I noticed that you mentioned my thread on\na [WPF window losing control when Revit API displays an error](http://forums.autodesk.com/t5/revit-API/wpf-window-loses-control-when-revit-API-displays-an-error/m-p/5319853) above.\n\n> I can add to this that I managed to work around the issue by converting the wpf form to a user control and using this user control in a winforms window with a wpf element host.\n\n> That works fine.\n\n> It was however disappointing that I was forced to do this after I spent a lot of work on my application.\n\n> Converting the application to winforms is no longer an option, so I will stick to this for now."
  },
  {
    "original_filename": "1396_devday_wpf_doevents",
    "header_text": "<a name=\"5\"></a>Addendum on Not Using Revit API within WPF `DataContext`",
    "local_header_href": "#a-name5aaddendum-on-not-using-revit-api-within-wpf-datacontext",
    "chunk_text": "#### <a name=\"5\"></a>Addendum on Not Using Revit API within WPF `DataContext`\n\nHps Anave shares another nugget of WPF experience in\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api/bd-p/160) thread \non [Revit API DLL preventing WPF window regeneration](http://forums.autodesk.com/t5/revit-api-forum/revit-api-dll-preventing-wpf-window-regeneration/m-p/6742531):\n\n> Well, after a very long time integrating WPF in my own programs, my recommendation is NOT to use any Revit API class inside the view model class where you assign to the WPF window's `DataContext`.\n\n> If ever you want to pass or get any information coming from an element or a parameter, it is better to extract its element Id's `IntegerValue`, and, when you are done with the WPF window, just create an `ElementId` from the integer value you acquired from the WPF window.\n\n> There may be other solutions out there but this is the solution I have so far.\n\nMany thanks to Hps for sharing this!"
  },
  {
    "original_filename": "1396_devday_wpf_doevents",
    "header_text": "<a name=\"6\"></a>WPF Element Id Converter",
    "local_header_href": "#a-name6awpf-element-id-converter",
    "chunk_text": "#### <a name=\"6\"></a>WPF Element Id Converter\n\nIn the same thread, Gonçalo Feio shared his WPF element id converter, saying, This works for me:\n\n<pre class=\"code\">\n<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">class</span>&nbsp;<span style=\"color:#2b91af;\">ElementIdConverter</span>&nbsp;:&nbsp;IValueConverter\n{\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">object</span>&nbsp;Convert(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">object</span>&nbsp;value,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Type</span>&nbsp;targetType,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">object</span>&nbsp;parameter,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;CultureInfo&nbsp;culture&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;value&nbsp;<span style=\"color:blue;\">is</span>&nbsp;R.ElementId&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;(&nbsp;value&nbsp;<span style=\"color:blue;\">as</span>&nbsp;ElementId&nbsp;).IntegerValue;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;-1;\n&nbsp;&nbsp;}\n \n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">object</span>&nbsp;ConvertBack(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">object</span>&nbsp;value,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Type</span>&nbsp;targetType,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">object</span>&nbsp;parameter,\n&nbsp;&nbsp;&nbsp;&nbsp;CultureInfo&nbsp;culture&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;value&nbsp;<span style=\"color:blue;\">is</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">int</span>&nbsp;id;\n \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">if</span>(&nbsp;<span style=\"color:blue;\">int</span>.TryParse(&nbsp;value&nbsp;<span style=\"color:blue;\">as</span>&nbsp;<span style=\"color:blue;\">string</span>,&nbsp;<span style=\"color:blue;\">out</span>&nbsp;id&nbsp;)&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:blue;\">new</span>&nbsp;ElementId(&nbsp;id&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;ElementId.InvalidElementId;\n&nbsp;&nbsp;}\n}\n</pre>\n\nIn this case, I expose a ElementId property in the view model.\n\nYou can also add validation to give some feedback to the end user.\n\nMany thanks to Gonçalo for sharing this!"
  },
  {
    "original_filename": "1396_devday_wpf_doevents",
    "header_text": "Hi",
    "local_header_href": "#hi",
    "chunk_text": "#### Hi\n\n"
  }
]