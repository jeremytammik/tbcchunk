[
  {
    "original_filename": "0129_new_2010_events",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<style>\n.blue { color: blue; }\n.teal { color: teal; }\n.maroon { color: maroon; }\n.green { color: green; }\n</style>"
  },
  {
    "original_filename": "0129_new_2010_events",
    "header_text": "New 2010 Events",
    "local_header_href": "#new-2010-events",
    "chunk_text": "<h3>New 2010 Events</h3><p>The Event API in Revit has been completely rewritten in 2010 to be compliant to the .NET event standard. \nThe old events are still available but have been deprecated. \n\n<a href=\"http://cadappdev.blogspot.com\">\nMatt Mason</a>\n\nalready posted an overview of some of the new \n\n<a href=\"http://cadappdev.blogspot.com/2009/03/whats-new-in-revit-2010-api-events.html\">\nevent handling</a>\n\nfeatures.\nTransitioning from the old events to the new ones can include some pitfalls, and one has now been uncovered.</p><p><strong>Question:</strong>\nMy application connects to a database when a project is opened.\nIt uses the following code which is called when a document is opened:</p><pre>\nvoid revitApp_OnDocumentOpened( Document doc )\n{\n  try {\n    doc.BeginTransaction();\n    // . . .\n    doc.EndTransaction();\n  }\n  catch (Exception ex)\n  {\n    MessageBox.Show( ex.Message );\n  }\n}\n</pre><p>In Revit 2009, this occasionally produces the following error message when doc.BeginTransaction() is called, especially when work sharing is enabled in a project:\n<i>\"Attempted to read or write protected memory. This is often an indication that other memory is corrupt.\"</i>\nThis worked fine in the past. What is going wrong now?</p><p><strong>Answer:</strong>\nThe OnDocumentOpened event is one of the old pre-2010 events.\nIn these, an API transaction can be started, but it is not guaranteed whether it will be successful or not.\nThis is one reason why the old events have been declared obsolete in 2010.\nThe Revit development team recommends moving on to the new 2010 events instead.\n\n<p>In this case, you can use the application.DocumentOpened event.\nIn this new event, you can modify the document directly without having to call BeginTransaction to open your own transaction.\nThe transaction required has already been created by the event framework before calling the event handler, so the document is immediately modifiable.\nThus, the calls to begin, end and abort a transaction are not allowed in the new event handlers and an InvalidOperationException is thrown if one of them is called during the event.\nHere is what the Revit API documentation on the DocumentOpened event has to say about this:</p>\n<!-- <span style=\"background-color:lightgrey\"> -->\n<span style=\"color:darkslateblue\">\n<p>This event is raised immediately after Revit has finished opening a document. It is raised even when document opening failed or was cancelled (during DocumentOpening event).\n\n<p>Check the 'Status' field in eventÂ’s argument to see whether the action itself was successful or not.\n\n<p>This event is not cancellable, for the process of opening document has already been finished.\n\n<p>If the action was successful, the document may be modified during this event.\nA transaction is already created at the time of the event and will be automatically closed at the end of the event.\nThere is no need to create another transaction during this event and it is, in fact, prohibited.\n\n<p>Please be aware that the following API functions are not available for the current document during this event:\n\n<ul>\n<li>Close()\n<li>BeginTransaction()\n<li>AbortTransaction()\n<li>EndTransaction()\n<li>Save()\n<li>SaveAs()\n</li></li></li></li></li></li></ul>\n<p>Exception InvalidOperationException will be thrown if any of the above methods is called during this event.\n\n<p>The DocumentOpened event is meant to replace the older OnDocumentOpened event, which is now Obsolete.\n\n</p></p></p></p></p></p></p></span>\n<p>Many thanks to Saikat Bhattacharya for handling this case!</p>\n<h4>Revit 2010 API Webcast</h4>\n<p>Don't forget to register for the upcoming \n\n<a href=\"http://www.adskconsulting.com/adn/cs/api_course_sched.php\">\nRevit 2010 API webcast</a>\n\nWednesday next week, April 29 2009.\nThe course name is Revit API, the language is English, and the location is 'Webcast'.</p>\n</p>"
  },
  {
    "original_filename": "0129_new_2010_events",
    "header_text": "Revit 2010 API Webcast",
    "local_header_href": "#revit-2010-api-webcast",
    "chunk_text": "<h4>Revit 2010 API Webcast</h4><p>Don't forget to register for the upcoming \n\n<a href=\"http://www.adskconsulting.com/adn/cs/api_course_sched.php\">\nRevit 2010 API webcast</a>\n\nWednesday next week, April 29 2009.\nThe course name is Revit API, the language is English, and the location is 'Webcast'.</p>"
  }
]