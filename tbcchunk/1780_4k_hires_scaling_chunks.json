[
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n<script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n</head>\n\n<!---\n\n\ntwitter:\n\nScaling an add-in for a 4K high resolution screen in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon http://bit.ly/scaleaddin4k\n\nAs high-resolution monitors grow ever more common, an important question arises on handling add-in scaling for 4K high resolution screens\n&ndash; Problem adapting a Revit add-in for 4K displays\n&ndash; Application properties for stand-alone apps\n&ndash; Application manifest \n&ndash; Separate UI component with IPC \n&ndash; Two solutions for adjusting Revit for 4K displays\n&ndash; Method 1 &ndash; Run hires monitor in low resolution\n&ndash; Method 2 &ndash; Adjust how Revit handles 4k displays\n&ndash; Discussion of the results...\n\nlinkedin:\n\nScaling an add-in for a 4K high resolution screen in the #RevitAPI \n\nhttp://bit.ly/scaleaddin4k\n\nAs high-resolution monitors grow ever more common, an important question arises on handling add-in scaling for 4K high resolution screens:\n\n- Problem adapting a Revit add-in for 4K displays\n- Application properties for stand-alone apps\n- Application manifest \n- Separate UI component with IPC \n- Two solutions for adjusting Revit for 4K displays\n- Method 1 - Run hires monitor in low resolution\n- Method 2 - Adjust how Revit handles 4k displays\n- Discussion of the results...\n\n#bim #DynamoBim #ForgeDevCon #Revit #API #IFC #SDK #AI #VisualStudio #Autodesk #AEC #adsk\n\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\n\n<p style=\"font-size: 80%; font-style:italic\"></p>\n\n-->"
  },
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "Scaling an Add-In for a 4K High Resolution Screen",
    "local_header_href": "#scaling-an-add-in-for-a-4k-high-resolution-screen",
    "chunk_text": "### Scaling an Add-In for a 4K High Resolution Screen\n\nAs high-resolution monitors grow ever more common, an important question arises on handling add-in scaling for 4K high resolution screens.\n\nBelow, CoderBoy shares some questions and answers on this topic:\n\n- [Problem adapting a Revit add-in for 4K displays](#2)\n- [Application properties for stand-alone apps](#3)\n- [Application manifest suggestion](#4)\n- [Separate UI component with IPC suggestion](#5)\n- [Solutions documented](#6)\n- [Adjusting Revit for 4K displays](#7)\n    - [Method 1 &ndash; Run hires monitor in low resolution](#7.1)\n    - [Method 2 &ndash; Adjust how Revit handles 4k displays](#7.2)\n- [Discussion of the results](#8)\n- [Call to move to WPF](#9)\n- [WinForms or WPF?](#10)"
  },
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "Problem Adapting a Revit Add-In for 4K Displays",
    "local_header_href": "#2",
    "chunk_text": "####<a name=\"2\"></a> Problem Adapting a Revit Add-In for 4K Displays\n\nWe are in need of your help.\nWe have been writing commercial Revit add-ins for over ten years now.\nWe followed the examples from Autodesk, which were all done using Windows Forms.\nWe even built our add-in template code from these examples.\nThe sample code in the Revit SDK also still uses Windows Forms.\n \nHowever, we have been getting more and more complaints from our customers that our add-ins don’t work properly when they run 4K monitors, because they have to scale up the monitors just to be able to read text on them; the native resolution is too high for the size of these desktop monitors to allow text to be readable at native scale.\nFor example, most users change the scale to 150% or even 200% in order to be able to read text.\nWhen this happens, our Windows Forms user interfaces get kind of jumbled up.\nScrolling doesn’t work right, buttons get pushed off the edge of the window, etc.\nAt least some of our add-ins essentially become unusable."
  },
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "Application Properties for Stand-Alone Apps",
    "local_header_href": "#3",
    "chunk_text": "####<a name=\"3\"></a> Application Properties for Stand-Alone Apps\n\nA workaround to this problem for our add-ins is to have whichever monitor is the primary monitor be scaled to 100% zoom.\nThen, the add-ins work fine on any screen, but some customers are now balking at that.\n \nIn my research on this subject, you can get Windows Forms applications to work well on 4K monitors by changing some of the application properties, for example like this:\n\n<pre class=\"code\">\nusing System.Runtime.InteropServices;\n  [DllImport(\"Shcore.dll\")]\n  static extern int SetProcessDpiAwareness(\n    int PROCESS_DPI_AWARENESS);\n    \n  private enum DpiAwareness {\n    None = 0,\n    SystemAware = 1,\n    PerMonitorAware = 2 }\n\n  SetProcessDpiAwareness(\n    (int) DpiAwareness.PerMonitorAware );\n</pre>\n\nWhile these things work well for standalone executables we write, I believe they must be done at the executable level, and as add-in creators for Revit we do not have control over Revit’s executable environment.\nSo, very sadly, as far as I can tell, these tricks don’t work for our Revit add-ins.\n \nWe have a rather breath-taking amount of code in our Revit add-ins, the significant majority of which is in the user interfaces.\nTo have to rewrite the user interfaces for all of our add-ins to use WPF would be crippling, to say the least.\n \nCan you please advise us on what we would need to do to modify our existing add-ins so they will scale and work correctly on scaled-up 4K monitors in a Revit environment?\nFor example, are there configuration settings for Revit which control the executable environment that we can advise our customers to change?\nOr, are there simple modifications to our code that we would need to implement in order for the WinForms engine on which they depend to run properly in a scaled-up 4K environment under Revit?\n \nWhat have other long-term add-in creators done with their legacy code to solve this problem, short of a complete rewrite of their add-ins, which would not be feasible for us?\n \nWe really need your help with this!\nThank you very much for any advice you can offer."
  },
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "Application Manifest Suggestion",
    "local_header_href": "#4",
    "chunk_text": "####<a name=\"4\"></a> Application Manifest Suggestion\n\nIn addition to setting DPI awareness in the code, it is also possible to use an application manifest.\nI think that this is worth investigating, although it may not be very straightforward for an add-in DLL.\n \nHere are some links:\n\n- [Application manifests](https://docs.microsoft.com/en-us/windows/win32/sbscs/application-manifests)\n- [DPI awareness and manifests](https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/mt846517(v%3Dvs.85))\n- [Registry key](https://support.microsoft.com/en-us/help/912949/some-third-party-applications-that-use-external-manifest-files-stop-wo) (for older Windows?)"
  },
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "Separate UI Component with IPC Suggestion",
    "local_header_href": "#5",
    "chunk_text": "####<a name=\"5\"></a> Separate UI Component with IPC Suggestion\n\nI am convinced that this can be solved without rewriting all your UI code.\n \nFor instance, if all else fails, simply disconnect your UI completely from your Revit add-in, run it in a separate process and use IPC to pass the information back and forth, as discussed and successfully implemented in\nthese [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) threads:\n \n- [Use IPC for disentanglement](https://thebuildingcoder.typepad.com/blog/2019/04/set-floor-level-and-use-ipc-for-disentanglement.html)\n- [Using a geometry viewer in a Revit add-in to preview results](https://forums.autodesk.com/t5/revit-api-forum/using-a-geometry-viewer-in-a-revit-addin-to-preview-results/m-p/8868232)\n \nThis assumes, of course, that you have not unnecessarily mixed up your UI code with Revit API stuff.\n\n**Response:** That is an extremely interesting idea!\n \nI’m sure some of our oldest apps do embed the Revit code in with the UI.\nSo, those would need some work to separate out.\nBut that would still be better and much faster than a whole rewrite.\n \nThank you so very much!"
  },
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "Solutions Documented",
    "local_header_href": "#6",
    "chunk_text": "####<a name=\"6\"></a> Solutions Documented\n\nI did some testing, and we only have a few of our add-ins (or reusable components) that are in pretty bad shape as far as WinForms in Revit on 4K goes.\nVery fortunately, most of our add-ins seem to work reasonably well!\nSome work, but require making their window large, so are awkward but functional, but a few things are downright unusable.\nOf course, it’s the more complicated ones that have the worst problems, but I guess that is to be expected.\nSo, the scope of the problem isn’t as big as we feared it might be.\n \nHowever, we think we found at least a short-term workaround for our WinForms on 4K display problems in all of our add-ins!\n \nIt turns out you can instruct Windows itself how to handle the scaling on a per-application basis, by modifying the launch icon properties.\n \nHere is a solution document\non [adjusting Revit for 4K displays](zip/coderboy_Adjusting_Revit_for_4K_Displays.pdf) that\ndescribes these simple settings changes:"
  },
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "Adjusting Revit for 4K Displays",
    "local_header_href": "#7",
    "chunk_text": "####<a name=\"7\"></a> Adjusting Revit for 4K Displays\n\nSome add-ins for Revit may not appear correctly when using a 4K display, especially in cases where the primary screen is not set to 100% scaling.\n\nThere are 2 approaches which may quickly resolve this:\n\n1. Tell the 4K monitor to run at 1920 x 1080 (or any other resolution) at **100% scaling**\n2. Adjust how only Revit is launched and handles 4K displays\n\n####<a name=\"7.1\"></a> Method 1 &ndash; Run Hires Monitor in Low Resolution\n\nRight-click on the desktop and select Display settings:\n\n<center>\n<img src=\"img/4k_solution_1_1.png\" alt=\"Display settings\" width=\"257\">\n</center>\n\nClick on the representation of the 4K monitor (click the “Identify” button if you’re not sure):\n\n<center>\n<img src=\"img/4k_solution_1_2.png\" alt=\"Display settings\" width=\"410\">\n</center>\n\nSet the Display resolution you like and, most importantly, set the scaling to 100% --\n\n<center>\n<img src=\"img/4k_solution_1_3.png\" alt=\"Display settings\" width=\"464\">\n</center>\n\nYou must log out and log back in for this change to take effect.\n\n####<a name=\"7.2\"></a> Method 2 &ndash; Adjust how Revit Handles 4K Displays\n\nAdjustments can be made to how Revit is launched that should correct these display issues.\n\nWith no Revit sessions running, right-click on the icon that launches Revit and select Properties:\n\n<center>\n<img src=\"img/4k_solution_2_1.png\" alt=\"Taskbar icon\" width=\"355\">\n<p style=\"font-size: 80%; font-style:italic\">Taskbar icon</p>\n</center>\n\n<center>\n<img src=\"img/4k_solution_2_2.png\" alt=\"Desktop icon\" width=\"329\">\n<p style=\"font-size: 80%; font-style:italic\">Desktop icon</p>\n</center>\n\nOn the next screen, select the Compatibility tab and click on “Change settings for all users” button at the bottom:\n\n<center>\n<img src=\"img/4k_solution_2_3.png\" alt=\"“Change settings\" width=\"298\">\n</center>\n\nNear the bottom of the next screen, click on the “Change high DPI settings” button:\n\n<center>\n<img src=\"img/4k_solution_2_4.png\" alt=\"“Change settings\" width=\"293\">\n</center>\n  \nOn the last screen, check the “Override high DPI scaling behavior. Scaling performed by:” checkbox and select **System**:\n\n<center>\n<img src=\"img/4k_solution_2_5.png\" alt=\"“Change settings\" width=\"274\">\n</center>\n\nClick OK on each dialog to save the settings."
  },
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "Discussion of the Results",
    "local_header_href": "#8",
    "chunk_text": "####<a name=\"8\"></a> Discussion of the Results\n\nWe haven’t observed any ill effects in Revit in our limited testing, but if you know of a reason for a user NOT to make these changes to their Revit start-up icon, please let us know.\n\nOne can copy the original start-up icon, modify the properties of the copy for a problematic add-in, and go back to the regular icon for normal use.\n\nWe haven’t heard any complaints other than the text being small on PDF exports.\n\nI ran a test, and it’s true, as seen in the following two images.\n\n“Default” is with no scaling adjustment of Revit when it’s launched:\n\n<center>\n<img src=\"img/4k_default.jpg\" alt=\"4K default\" width=\"620\">\n</center>\n\n“Adjusted” is with the scaling adjustment:\n\n<center>\n<img src=\"img/4k_adjusted_pdf.png\" alt=\"4K adjusted\" width=\"522\">\n</center>\n\nMuch of the text is small.\n \nMost actual Revit end users are happy to just set their screen resolution to 1920 x 1080 at 100% scaling.\n\nThat’s obviously the best solution to the issue.\n\nSome people say, “we have 4K, we should use it at 4K”, however, who don’t want to do that.\n\nMost of our apps are fine on 4K (80%?), but I’ve been spending some time trying to adjust our troublesome code to work better on 4K without a rewrite.\n\nI’ve had a little success, but there are still some real stumpers too, simple designs that just don’t want to cooperate.  \n\nTo clarify 'default' versus 'adjusted':\n\nThe “Default” PDF is with no scaling adjustment on the icon definition for how Revit is launched.  It’s what would appear if you just installed Revit for the first time on your 4K display and launched it immediately with no changes.  The text size on the PDFs comes out correctly.\n \nThe “Adjusted” PDF was generated by following Method 2 and doing nothing else. \n \nIf you look at the “Adjusted” PDF, the text in the bubbles is very small.\n\n<center>\n<img src=\"img/4k_adjusted_cropped.jpg\" alt=\"4K adjusted detail\" width=\"248\">\n</center>\n\nOn screen, the text looks correctly sized, but, in a PDF, it comes out small.\n\nIn the “Default” PDF, the text in the bubbles is normal sized, and comes out the same size as seen on-screen:\n\n<center>\n<img src=\"img/4k_default_cropped.jpg\" alt=\"4K default detail\" width=\"398\">\n</center>\n \nI think the best solution is Method 1. It incurs no issues at all.\n\nSecond-best is Method 2 plus setting two icons to launch Revit, as described above: One for “normal” on-screen use (applying Method 2) and one just for generating PDFs, which has no special scaling applied in the icon properties.  \n\nMany thanks to CoderBoy for the in-depth research and precise and complete documentation of the solution!"
  },
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "Call to Move to WPF",
    "local_header_href": "#9",
    "chunk_text": "####<a name=\"9\"></a> Call to Move to WPF\n\nJason Masters added several relevant thoughts to this topic in\nthe [comments below](https://thebuildingcoder.typepad.com/blog/2019/09/scaling-an-add-in-for-a-4k-high-resolution-screen.html#comment-4619001048),\na wish list entry\nto [update the SDK and developer documentation to WPF](https://forums.autodesk.com/t5/revit-ideas/update-sdk-developer-documentation-to-wpf/idi-p/9030473) in\nthe Revit Idea Station, and \nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\non [WinForms or WPF?](https://forums.autodesk.com/t5/revit-api-forum/winforms-or-wpf/m-p/9030525)\n\n**Question:** Is Autodesk planning on updating the official developer guides, samples and documentation?\n\nIsn't the root issue here that Autodesk's official documentation is recommending a UI Framework that's 17 years old?\n\nIf the documentation recommended and walked you through WPF from the start, no one would have this problem, because WPF scales properly across mixed and high resolution monitors...\n\nI know that I was burned by the same issue as CoderBoy and was very frustrated when I realized that I never should have bothered with WinForms to begin with.\n\n**Answer:** I am very sorry to hear your completely understandable frustration. Unfortunately, the best I can do is suggest that you file a wish list request for a revamped SDK in the Revit Idea Station, and discuss your Revit API plans with your peers in the Revit API discussion forum before investing too much into any obsolete frameworks. Personally, I am not a fan of graphical user interfaces in any shape and form. As far as I am concerned, the only user interface I ever need is an ASCII text editor. I am sure you can very effectively drive Revit\nfrom [emacs](https://en.wikipedia.org/wiki/Emacs) &nbsp; :-)\n\n**Response:** Haha well I agree with you wholeheartedly on that, convincing our users that all they need is a terminal might be a bit more of a challenge though! I have submitted a wish list item to the Revit Idea Station idea requesting\nto [update the SDK and developer documentation to WPF](https://forums.autodesk.com/t5/revit-ideas/update-sdk-developer-documentation-to-wpf/idi-p/9030473)."
  },
  {
    "original_filename": "1780_4k_hires_scaling",
    "header_text": "WinForms or WPF?",
    "local_header_href": "#10",
    "chunk_text": "####<a name=\"10\"></a> WinForms or WPF?\n\nThis is an old thread, but it's still highly ranked on Google, so I just wanted to chime in that I went down the WinForms path for about a year and I really regretted it. I would highly recommend that everyone go down the WPF route instead.\n\nFor one, WinForms often have some serious and practically unsolvable scaling issues on high resolution monitors, as discussed above. While Inter-Process Communication (IPC) is a good option for fixing this user's existing code base, implementing IPC is way more work than just using WPF to begin with, since WPF apps don't have scaling issues.\n\nAdditionally, WPF UIs are built in a much more modern way, with XML layout documents, separate style documents, and separate code / logic documents. This is much more similar to how UIs are built on other frameworks (like Android / iOS / macOS  / web development) and will better prepare you for expanding your development knowledge. This separation also tends to produce much cleaner, more flexible, and more reusable code.\n\nAnd lastly, because WPF is a more modern framework, I find that it's just far easier to produce apps that actually look good, and that my users actually enjoy opening up. As developers it's easy to focus on the back end data, but if you want to make a tool that people actually use, it needs to have a pleasing UI, and the styling / dynamic binding nature of WPF makes it far, far, far easier to produce at least halfway modern UXs."
  }
]