[
  {
    "original_filename": "0682_accessing_room_data",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0682_accessing_room_data",
    "header_text": "Accessing Room Data",
    "local_header_href": "#accessing-room-data",
    "chunk_text": "<h3>Accessing Room Data</h3><p>Happy <a href=\"http://en.wikipedia.org/wiki/Thanksgiving\">Thanksgiving</a> to all you Americans!\n\n<p>For me, Thursday November 24 is hopefully a happy travelling day, arriving in Las Vegas a few days in advance to acclimatize.\n\n<p>Here is a nice little beginner's question that I decided to answer by implementing a new command in The Building Coder samples:\n\n<p><strong>Question:</strong> How can I access the room information in a Revit BIM?\n\nI would like to see a list of all rooms with their position, properties, and boundary polygon.\n\n\n<p><strong>Answer:</strong> A list of rooms can be easily obtained using a filtered element collector.\n\n<p>Unfortunately, there is one small complication when trying to directly use the Room class for filtering. If you try that, the Revit API throws an exception:\n\n<p>\"Input type is of an element type that exists in the API, but not in Revit's native object model. Try using Autodesk.Revit.DB.SpatialElement instead, and then postprocessing the results to find the elements of interest.\"\n\n<p>This situation and how to handle it is described in several blog posts, e.g. on\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/08/filtering-for-a-nonnative-class.html\">\nfiltering for a non-native class</a> and the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/10/measurepanelarea-update.html\">\nMeasurePanelArea update</a>.\n\n<p>I wrote a new Building Coder sample command CmdListAllRooms for you which shows how to retrieve all rooms and list their basic information.\n\n<p>Here is the report it produces in the Visual Studio debug output window when run on the rac_basic_sample_project.rvt provided in the Revit Architecture installation (copy and paste to a text editor to see the truncated lines in full):\n\n<pre>\nRoom nr. '1' named 'BEDROOM 1 1' at (0,0,0) with bounding box &lt;null&gt; and area 0 sqf has 0 loops and 0 segments in first loop.\nRoom nr. '2' named 'BEDROOM 2 2' at (0,0,0) with bounding box &lt;null&gt; and area 0 sqf has 0 loops and 0 segments in first loop.\nRoom nr. '4' named 'BATH 4' at (0,0,0) with bounding box &lt;null&gt; and area 0 sqf has 0 loops and 0 segments in first loop.\nRoom nr. '5' named 'BEDROOM 1 5' at (-37.7,13.68,0) with bounding box ((-44.09,6.56,0),(-32.11,20.04,8)) and area 160.523659936209 sqf has 1 loop and 8 segments in first loop.\nRoom nr. '6' named 'BEDROOM 2 6' at (-25.19,13.68,0) with bounding box ((-31.72,6.56,0),(-19.61,20.04,8)) and area 162.29204125075 sqf has 1 loop and 9 segments in first loop.\nRoom nr. '7' named 'HALL 7' at (-30.33,21.65,0) with bounding box ((-35.47,20.43,0),(-19.42,23.7,8)) and area 52.541410916154 sqf has 1 loop and 6 segments in first loop.\nRoom nr. '8' named 'BATH 8' at (-38.52,23.22,0) with bounding box ((-44.09,20.43,0),(-35.86,26.87,8)) and area 52.9879883370874 sqf has 1 loop and 5 segments in first loop.\nRoom nr. '9' named 'STORAGE 9' at (-9.09,9.09,0) with bounding box ((-19.22,6.56,0),(0.75,15.04,8)) and area 104.9958666584 sqf has 1 loop and 8 segments in first loop.\nRoom nr. '10' named 'LIVING 10' at (0,0,0) with bounding box &lt;null&gt; and area 0 sqf has 0 loops and 0 segments in first loop.\nRoom nr. '11' named 'MECH 11' at (-25.47,25.29,0) with bounding box ((-35.47,24.1,0),(-19.61,26.87,8)) and area 44.0105942711896 sqf has 1 loop and 4 segments in first loop.\nRoom nr. '12' named 'LIVING ROOM 12' at (-12.69,20.48,0) with bounding box &lt;null&gt; and area 0 sqf has 0 loops and 0 segments in first loop.\n</pre>\n<p>It uses the helper method ListRoomData to list the room information for a given element:\n\n<pre class=\"code\">\n<span class=\"gray\">///</span><span class=\"green\"> </span><span class=\"gray\">&lt;summary&gt;</span>\n<span class=\"gray\">///</span><span class=\"green\"> List some properties of a given room to the </span>\n<span class=\"gray\">///</span><span class=\"green\"> Visual Studio debug output window.</span>\n<span class=\"gray\">///</span><span class=\"green\"> </span><span class=\"gray\">&lt;/summary&gt;</span>\n<span class=\"blue\">void</span> ListRoomData( <span class=\"teal\">Room</span> room )\n{\n  <span class=\"teal\">SpatialElementBoundaryOptions</span> opt\n    = <span class=\"blue\">new</span> <span class=\"teal\">SpatialElementBoundaryOptions</span>();\n \n  <span class=\"blue\">string</span> nr = room.Number;\n  <span class=\"blue\">string</span> name = room.Name;\n  <span class=\"blue\">double</span> area = room.Area;\n \n  <span class=\"teal\">Location</span> loc = room.Location;\n  <span class=\"teal\">LocationPoint</span> lp = loc <span class=\"blue\">as</span> <span class=\"teal\">LocationPoint</span>;\n  <span class=\"teal\">XYZ</span> p = ( <span class=\"blue\">null</span> == lp ) ? <span class=\"teal\">XYZ</span>.Zero : lp.Point;\n \n  <span class=\"teal\">BoundingBoxXYZ</span> bb = room.get_BoundingBox( <span class=\"blue\">null</span> );\n \n  <span class=\"teal\">IList</span>&lt;<span class=\"teal\">IList</span>&lt;<span class=\"teal\">BoundarySegment</span>&gt;&gt; boundary\n    = room.GetBoundarySegments( opt );\n \n  <span class=\"blue\">int</span> nLoops = boundary.Count;\n \n  <span class=\"blue\">int</span> nFirstLoopSegments = 0 &lt; nLoops \n    ? boundary[0].Count \n    : 0;\n \n  <span class=\"teal\">Debug</span>.Print( <span class=\"blue\">string</span>.Format(\n    <span class=\"maroon\">\"Room nr. '{0}' named '{1}' at {2} with \"</span>\n    + <span class=\"maroon\">\"bounding box {3} and area {4} sqf has \"</span>\n    + <span class=\"maroon\">\"{5} loop{6} and {7} segment{8} in first \"</span>\n    + <span class=\"maroon\">\"loop.\"</span>,\n    nr, name, <span class=\"teal\">Util</span>.PointString( p ),\n    BoundingBoxString2( bb ), area, nLoops,\n    <span class=\"teal\">Util</span>.PluralSuffix( nLoops ), nFirstLoopSegments,\n    <span class=\"teal\">Util</span>.PluralSuffix( nFirstLoopSegments ) ) );\n}\n</pre>\n<p>This method is called from the mainline Execute method which retrieves the rooms from the model:\n\n<pre class=\"code\">\n<span class=\"blue\">public</span> <span class=\"teal\">Result</span> Execute(\n  <span class=\"teal\">ExternalCommandData</span> commandData,\n  <span class=\"blue\">ref</span> <span class=\"blue\">string</span> message,\n  <span class=\"teal\">ElementSet</span> elements )\n{\n  <span class=\"teal\">UIApplication</span> uiapp = commandData.Application;\n  <span class=\"teal\">UIDocument</span> uidoc = uiapp.ActiveUIDocument;\n  <span class=\"teal\">Application</span> app = uiapp.Application;\n  <span class=\"teal\">Document</span> doc = uidoc.Document;\n \n  <span class=\"green\">// Filtering for Room elements throws an exception:</span>\n  <span class=\"green\">// Input type is of an element type that exists in </span>\n  <span class=\"green\">// the API, but not in Revit's native object model. </span>\n  <span class=\"green\">// Try using Autodesk.Revit.DB.SpatialElement </span>\n  <span class=\"green\">// instead, and then postprocessing the results to </span>\n  <span class=\"green\">// find the elements of interest.</span>\n \n  <span class=\"green\">//FilteredElementCollector a </span>\n  <span class=\"green\">//  = new FilteredElementCollector( doc )</span>\n  <span class=\"green\">//    .OfClass( typeof( Room ) );</span>\n \n  <span class=\"teal\">FilteredElementCollector</span> a\n    = <span class=\"blue\">new</span> <span class=\"teal\">FilteredElementCollector</span>( doc )\n      .OfClass( <span class=\"blue\">typeof</span>( <span class=\"teal\">SpatialElement</span> ) );\n \n  <span class=\"blue\">foreach</span>( <span class=\"teal\">SpatialElement</span> e <span class=\"blue\">in</span> a )\n  {\n    <span class=\"teal\">Room</span> room = e <span class=\"blue\">as</span> <span class=\"teal\">Room</span>;\n \n    <span class=\"blue\">if</span>( <span class=\"blue\">null</span> != room )\n    {\n      ListRoomData( room );\n    }\n  }\n  <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n}\n</pre>\n<p>Here is\n\n<a href=\"zip/bc_12_94.zip\">\nversion 2012.0.94.0</a> of\n\nThe Building Coder samples including the new CmdListAllRooms command.\n\n<p>A couple of other samples should be useful to you in this context as well:\n\n<ul>\n<li>Rooms SDK sample \n<li>RoomViewer SDK sample \n<li>The Building Coder sample command CmdRoomWallAdjacency\n</li></li></li></ul>\n<p>The Revit SDK sample Rooms demonstrates how to retrieve room information such as Number, Area, Department, etc., add room tags and change room numbers.\n\n<p>The RoomViewer SDK sample demonstrates the access and usage of the room boundary and displays the room boundary geometry in a dedicated viewer.\n\n<p>The Building Coder sample command CmdRoomWallAdjacency shows a more advanced usage of the room boundary information to\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/01/room-and-wall-adjacency.html\">\ndetermine room and wall adjacency</a>.\n\nThe access to the boundary information has changed since that sample was published, though, so you need to look at a more recent version of The Building Coder samples in order to run it in Revit 2012, for instance the version 2012.0.94.0 provided above.\n</p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p>"
  }
]