[
  {
    "original_filename": "1997_sdk_brep",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\nbrepbuilder\n\n- BRepBuilder fails on very simple example\n  https://forums.autodesk.com/t5/revit-api-forum/brepbuilder-fails-on-very-simple-example/m-p/12015942#M71909\n  /Users/jta/a/doc/revit/tbc/git/a/img/rpt_brep_organisation.png\n\n- Toposurface - Change interior point to boundary point?\n  https://forums.autodesk.com/t5/revit-api-forum/toposurface-change-interior-point-to-boundary-point/m-p/12015969#M71911\n\n- https://twitter.com/advany/status/1664451798793584642?s=20\n  https://twitter.com/advany/status/1664451798793584642?s=20\n  to_code_or_not_to_code.jpg\n  Ab Advany\n  [@advany](https://twitter.com/advany)\n  Supervised a project 2 week ago. Two programmers where hired to create an MVP. I have worked with both before.\n  - Alex from Germany. 100% code. 19 years experience.\n  - Hamid from Pakistan. Code + Copilot + GPT-4 + no-code. 4 years experience.\n  What do you think happened?\n\ntwitter:\n\nAn update for the @AutodeskRevit #RevitAPI SDK, an in-depth discussion of BRepBuilder organisation for  geometry generation, a Toposurface issue and a hint at where the software development industry may be headed #BIM @DynamoBIM @AutodeskAPS https://bit.ly/breporganisation\n\nAn update for the Revit SDK, an in-depth discussion of Revit geometry generation, a Toposurface issue and a hint at where the software development industry may be headed\n&ndash; Revit SDK update\n&ndash; BRepBuilder organisation\n&ndash; Change Toposurface interior point to boundary\n&ndash; To code or not to code, that is the question...\n\nlinkedin:\n\nAn update for the #RevitAPI SDK, an in-depth discussion of BRepBuilder organisation for geometry generation, a Toposurface issue and a hint at where the software development industry may be headed\n\nhttps://bit.ly/breporganisation\n\n- Revit SDK update\n- BRepBuilder organisation\n- Change Toposurface interior point to boundary\n- To code or not to code, that is the question...\n\n#BIM #DynamoBIM #AutodeskAPS #Revit #API #IFC #SDK #Autodesk #AEC #adsk\n\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\n\n<center>\n<img src=\"img/\" alt=\"\" title=\"\" width=\"600\"/>\n<p style=\"font-size: 80%; font-style:italic\"></p>\n</center>\n\n-->"
  },
  {
    "original_filename": "1997_sdk_brep",
    "header_text": "BRepBuilder and Toposurface Interior",
    "local_header_href": "#brepbuilder-and-toposurface-interior",
    "chunk_text": "### BRepBuilder and Toposurface Interior\n\nAn updated Revit SDK, an in-depth discussion of Revit geometry generation, a Toposurface issue and a hint at where the software development industry may be headed:\n\n- [Revit SDK Update](#1)\n- [BRepBuilder organisation](#2)\n- [Change Toposurface interior point to boundary](#3)\n- [To code or not to code, that is the question](#4)"
  },
  {
    "original_filename": "1997_sdk_brep",
    "header_text": "Revit SDK Update",
    "local_header_href": "#1",
    "chunk_text": "####<a name=\"1\"></a> Revit SDK Update\n\nThe age-old `developrevit` [Revit Developer Centre](http://autodesk.com/developrevit) shortcut\nnow redirects to a new target aligned with the rest of the Autodesk Platform Service APS APIs,\nto\n\n- [aps.autodesk.com/developer/overview/revit](https://aps.autodesk.com/developer/overview/revit)\n\nThere, you can now find the new Revit SDK for Revit 2024 updated on May 30, 2023, to fix some of the issues I\ndescribed in April [compiling the Revit 2024 SDK samples](https://thebuildingcoder.typepad.com/blog/2023/04/nice-accelerator-and-compiling-the-revit-2024-sdk.html#3) and\nsubsequently reported in the ticket REVIT-206304 *Update RvtSamples.txt for Revit 2024 SDK*."
  },
  {
    "original_filename": "1997_sdk_brep",
    "header_text": "BRepBuilder Organisation",
    "local_header_href": "#2",
    "chunk_text": "####<a name=\"2\"></a> BRepBuilder Organisation\n\nRichard [RPThomas108](https://forums.autodesk.com/t5/user/viewprofilepage/user-id/1035859) Thomas\nand Luiz Henrique [@ricaun](https://github.com/ricaun) Cassettari\nshare some illuminating insights on using the BRepBuilder addressing\nwhy [BRepBuilder fails on very simple example](https://forums.autodesk.com/t5/revit-api-forum/brepbuilder-fails-on-very-simple-example/m-p/12015942):\n\n**Question:** I get a \"Failure\" result on a very simple BRepBuilder example when I try to build a (4-sided triangle pyramid) Tetrahedron.\nI know about `TessellatedShapeBuilder`, but it fails for a quite complex object, and I hope to bypass this using the BREP instead.\n\n<pre class=\"prettyprint\">\npublic class Test{\n\n  public Test(){}\n\n  // Keep track of already created edges and their orientation\n  struct BrepEdge {\n    public BRepBuilderGeometryId id;\n    public XYZ p1, p2;\n  }\n  List&lt;BrepEdge&gt; brep_edges = new List&lt;BrepEdge&gt;();\n\n  // add edge to face loop\n  void AddEdgeToBREP( BRepBuilder brep, BRepBuilderGeometryId loop, XYZ a, XYZ b) {\n    foreach(var be in brep_edges) {\n      // ab is p1-p2\n      if(be.p1.DistanceTo(a) &lt; 1e-7 && be.p2.DistanceTo(b) &lt; 1e-7) { brep.AddCoEdge(loop, be.id, false);return; }\n      // ab is p2-p1 (reversed edge)\n      if(be.p1.DistanceTo(b) &lt; 1e-7 && be.p2.DistanceTo(a) &lt; 1e-7) { brep.AddCoEdge(loop, be.id, true); return; }\n    }\n    // must create a new edge\n    BRepBuilderGeometryId edge = brep.AddEdge(BRepBuilderEdgeGeometry.Create(a, b));\n    brep.AddCoEdge(loop, edge, false);\n    var bed = new BrepEdge();\n    bed.p1 = a;\n    bed.p2 = b;\n    bed.id = edge;\n    brep_edges.Add(bed);\n  }\n\n  // add triangle face to solid\n  private void AddTriangleToBREP( BRepBuilder brep, XYZ a, XYZ b, XYZ c ) {\n    Plane plane = Plane.CreateByThreePoints(a, b, c);\n    BRepBuilderGeometryId face = brep.AddFace(BRepBuilderSurfaceGeometry.Create(plane, null), true);\n    var loop = brep.AddLoop(face);\n    AddEdgeToBREP(brep, loop, a, b);\n    AddEdgeToBREP(brep, loop, b, c);\n    AddEdgeToBREP(brep, loop, c, a);\n    brep.FinishLoop(loop);\n    brep.FinishFace(face);\n  }\n\n  public void run() {\n    BRepBuilder brep = new BRepBuilder(BRepType.Solid);\n\n    var points = new List&lt;XYZ&gt;(4);\n    points.Add(new XYZ(0, 0, 0)); // 0 origin\n    points.Add(new XYZ(1, 0, 0)); // 1 right\n    points.Add(new XYZ(0, 1, 0)); // 2 back\n    points.Add(new XYZ(0, 0, 1)); // 3 top\n\n    AddTriangleToBREP(brep, points[2], points[1], points[0]); // bottom face\n    AddTriangleToBREP(brep, points[0], points[1], points[3]); // front face\n    AddTriangleToBREP(brep, points[1], points[2], points[3]); // diagonal face\n    AddTriangleToBREP(brep, points[2], points[0], points[3]); // left face\n\n    var outcome = brep.Finish(); // &lt;&lt;&lt;&lt;&lt; Failure\n\n    // throws: \"This BRepBuilder object hasn't completed building data or was unsuccessful building it.\n    // Built Geometry is unavailable. In order to access the built Geometry,\n    // Finish() must be called first. That will set the state to completed.\"\n    var res = brep.GetResult();\n  }\n}\n</pre>\n\n**Answer:** [DirectShape from BrepBuilder and Boolean](https://thebuildingcoder.typepad.com/blog/2018/02/directshape-from-brepbuilder-and-boolean.html) provides\nan example that does work.\n\nHowever, please note that BRepBuilder wasnâ€™t really meant for 'manually' constructing geometry. Its interface is rather cumbersome for that purpose. It was meant for translating existing geometry into Revit, with rather thorough validation of the input geometry.\n\n**Response:** I implemented a workaround using `TesselatedShapeBuilder`, but it's strange that I can't get the simplest example working with the BREP commands. Also, the error message is not very helpful.\n\nLater: I experienced the same error when try to create a simple pyramid shape as a prototype for recreating geometry from linked IFC file. I would like to use some external algorithm the geometry and convert the external data to a mesh and rebuilt the new shape. The API documentation does not provide much of information about why it failed.\n\n**Answer:** It takes a bit of organisation but it does work.\n\nIt isn't ideal for manual creation since (1) you need to arrange the edges so they are compatible and (2) the edges need to sit on the surface.\n\nI organised the above original into the below edge orders and directions and it worked fine. Each co-edge should be reversed on one face and not reversed on the other. Outer loops for a face should be anticlockwise with respect to the face normal (pointing outwards for a solid). So the edge is indicated as reversed on the face if it can't satisfy that e.g. the edge of two adjoining faces needs to be reversed on one of them.\n\n<center>\n<img src=\"img/rpt_brep_organisation.png\" alt=\"BRep organisation\" title=\"BRep organisation\" width=\"500\"/> <!-- Pixel Height: 572 Pixel Width: 729 -->\n</center>\n\n<pre class=\"prettyprint\">\n  Private Function Obj_230606a( _\n    ByVal commandData As ExternalCommandData,\n    ByRef message As String,\n    ByVal elements As ElementSet) As Result\n\n    Dim UIApp As UIApplication = commandData.Application\n    Dim UIDoc As UIDocument = commandData.Application.ActiveUIDocument\n    If UIDoc Is Nothing Then Return Result.Cancelled Else\n    Dim IntDoc As Document = UIDoc.Document\n\n    ' Only needs 6 edges '\n    ' Set on triangle if an edge of that triangle is reversed or not '\n    ' Each edge has two faces the edge should be reversed on one face and not on the other '\n    ' Outer loops should be anticlockwise with respect to normal '\n\n    Dim A As New TriangleSide(1, 0)\n    Dim B As New TriangleSide(0, 2)\n    Dim C As New TriangleSide(2, 1)\n    Dim D As New TriangleSide(1, 3)\n    Dim E As New TriangleSide(3, 0)\n    Dim F As New TriangleSide(3, 2)\n\n    Dim T_ABC As New Triangle(A, B, C, New Boolean(2) {False, False, False})\n    Dim T_ADE As New Triangle(A, D, E, New Boolean(2) {True, False, False})\n    Dim T_BEF As New Triangle(B, E, F, New Boolean(2) {True, True, False})\n    Dim T_CFD As New Triangle(C, F, D, New Boolean(2) {True, True, True})\n\n    Dim Triangles As Triangle() = New Triangle(3) {T_ABC, T_ADE, T_BEF, T_CFD}\n    Dim Edges As TriangleSide() = New TriangleSide(5) {A, B, C, D, E, F}\n\n    ' The coords '\n\n    Dim X As Double = 1\n    Dim Y As Double = 1\n    Dim Z As Double = 1\n\n    Dim Points As XYZ() = New XYZ(3) {\n      New XYZ(0, 0, 0),\n      New XYZ(X, 0, 0),\n      New XYZ(0, Y, 0),\n      New XYZ(0, 0, Z)}\n\n    Dim BrepB As New BRepBuilder(BRepType.Solid)\n\n    ' Faces '\n\n    For i = 0 To Triangles.Length - 1\n      Dim T As Triangle = Triangles(i)\n      Dim P As Plane = T.GetPlane(Points)\n      Triangles(i).FaceId = BrepB.AddFace(BRepBuilderSurfaceGeometry.Create(P, Nothing), False)\n    Next\n\n    ' Edges '\n\n    For i = 0 To Edges.Length - 1\n      Dim ed As TriangleSide = Edges(i)\n      Edges(i).EdgeId = BrepB.AddEdge(BRepBuilderEdgeGeometry.Create(ed.GetXYZ(0, Points), ed.GetXYZ(1, Points)))\n    Next\n\n    ' Face loops '\n\n    For i = 0 To Triangles.Length - 1\n      Dim T As Triangle = Triangles(i)\n      Triangles(i).LoopId = BrepB.AddLoop(T.FaceId)\n    Next\n\n    ' Co-edges '\n\n    For i = 0 To Triangles.Length - 1\n      Dim T As Triangle = Triangles(i)\n\n      For ia = 0 To 2\n        Dim ed As TriangleSide = T(ia)\n        BrepB.AddCoEdge(T.LoopId, ed.EdgeId, T.Sides_Reversed(ia))\n      Next\n      BrepB.FinishLoop(T.LoopId)\n      BrepB.FinishFace(T.FaceId)\n    Next\n\n    Dim Outcome As BRepBuilderOutcome = BrepB.Finish\n\n    Using Tx As New Transaction(IntDoc, \"DS\")\n      If Tx.Start = TransactionStatus.Started Then\n\n        Dim DS As DirectShape = DirectShape.CreateElement(IntDoc, New ElementId(BuiltInCategory.OST_GenericModel))\n        Dim S As Solid = BrepB.GetResult()\n        DS.SetShape(New GeometryObject() {S}.ToList)\n\n        Tx.Commit()\n      End If\n    End Using\n\n    Return Result.Succeeded\n  End Function\n\n  Public Class TriangleSide\n    Public Property EdgeId As BRepBuilderGeometryId\n    Public ReadOnly Property N1 As Integer\n    Public ReadOnly Property N2 As Integer\n    Public Function GetXYZ(Idx As Integer, Points As XYZ()) As XYZ\n      If Idx = 0 Then\n        Return Points(N1)\n      ElseIf Idx = 1 Then\n        Return Points(N2)\n      Else\n        Throw New ArgumentOutOfRangeException\n      End If\n    End Function\n    Public Sub New(Node1 As Integer, Node2 As Integer)\n      N1 = Node1\n      N2 = Node2\n    End Sub\n  End Class\n\n  Public Class Triangle\n    Public Property LoopId As BRepBuilderGeometryId\n    Public Property FaceId As BRepBuilderGeometryId\n    Public ReadOnly Property Sides_Reversed As Boolean()\n    Public ReadOnly Property S1 As TriangleSide\n    Public ReadOnly Property S2 As TriangleSide\n    Public ReadOnly Property S3 As TriangleSide\n\n    Public Function GetPlane(Points As XYZ()) As Plane\n\n      ' The edge ends could be reversed for a triangles, so use '\n      ' midpoints to ensure points are unique and not colinear '\n\n      Dim Mid1 As XYZ = (Points(S1.N1) + Points(S1.N2)) / 2\n      Dim Mid2 As XYZ = (Points(S2.N1) + Points(S2.N2)) / 2\n      Dim Mid3 As XYZ = (Points(S3.N1) + Points(S3.N2)) / 2\n\n      Return Plane.CreateByThreePoints(Mid1, Mid2, Mid3)\n    End Function\n\n    Default Public ReadOnly Property Side(Idx As Integer) As TriangleSide\n      Get\n        If Idx = 0 Then\n          Return S1\n        ElseIf Idx = 1 Then\n          Return S2\n        ElseIf Idx = 2 Then\n          Return S3\n        Else\n          Throw New ArgumentOutOfRangeException\n        End If\n      End Get\n    End Property\n\n    Public Sub New(Side1 As TriangleSide, Side2 As TriangleSide, Side3 As TriangleSide, Reversed As Boolean())\n      S1 = Side1\n      S2 = Side2\n      S3 = Side3\n\n      If Reversed.Length &lt;&gt; 3 Then\n        Throw New ArgumentOutOfRangeException\n      End If\n      Sides_Reversed = Reversed\n\n    End Sub\n  End Class\n</pre>\n\n**Response:** It took me a while to figure out how the edges and faces should be added before the detail explanation and sample code reaches me.\nThank you very much for your effort.\n\nThat is a really cool image; did you create it or you found in some Revit API presentation?\n\nIs kinda missing a Four-sided dice in that image ðŸ˜€\n\nAnother thing that is good to mention, is if your BRepType is Void, all the face normals must point into the void.\n\n**Answer:** Thanks @ricaun I drew it with AutoCAD after a couple of attempts at what I wanted to get across using pencil, paper and eraser (more eraser than pencil and paper).\n\nI'll have to check how important it is to set the boundaries of the surfaces.\nI'm sure I noticed previously and the other day that just specifying null may create a performance issue in Revit after the direct shape exists.\n\nThe best thing about the BRepBuilder in my view is that you can create single face solids. So all those API functions specific to the face class can be used on such.\n\n**Answer:** Regarding the boundaries, you say:\n\n> I'll have to check how important it is to set the boundaries of the surfaces. I'm sure I noticed previously and the other day that just specifying null may create a performance issue in Revit after the direct shape exists.\n\nIn my code, the boundaries of the surfaces are null as well, never have a problem but the most complex thing I did was create a copy of a Solid to change the Material. Works, but reordering and reversing each edge is painful.\n\n> @RPTHOMAS108 wrote: The best thing about the BRepBuilder in my view is that you can create single face solids. So all those API functions specific to the face class can be used on such.\n\nFor a simple face, it is possible to use `TessellatedShapeBuilder`: you can create a Solid, or a Mesh if that fails.\n\nIn this `D4` is much simpler to use than TessellatedFace &ndash; `D4` as in tetrahedron, a shape with 4 flat faces, a dice with 4 faces, or a `D4` if you are familiar with dice and RPG. ðŸ˜€\n\n<pre class=\"prettyprint\">\nvar shapeBuilder\n  = TessellatedShapeCreatorUtils.Create(\n    builder =&gt;\n  {\n    var points = new List&lt;XYZ&gt;(4);\n    points.Add(new XYZ(0, 0, 0)); // 0 origin\n    points.Add(new XYZ(1, 0, 0)); // 1 right\n    points.Add(new XYZ(0, 1, 0)); // 2 back\n    points.Add(new XYZ(0, 0, 1)); // 3 top\n\n    var materialId = ElementId.InvalidElementId;\n    // bottom face\n    builder.AddFace(new TessellatedFace(new[] {\n      points[2], points[1], points[0] }, materialId));\n    // front face\n    builder.AddFace(new TessellatedFace(new[] {\n      points[0], points[1], points[3] }, materialId));\n    // diagonal face\n    builder.AddFace(new TessellatedFace(new[] {\n      points[1], points[2], points[3] }, materialId));\n    // left face\n    builder.AddFace(new TessellatedFace(new[] {\n      points[2], points[0], points[3] }, materialId));\n  });\n</pre>\n\nHere is\nthe [full code of TessellatedShapeCreatorUtils.cs implementing this utility class](https://gist.github.com/ricaun/35baa2ed9f33de3487e46e4217b5e8bd)\n\n<pre class=\"prettyprint\">\npublic static class TessellatedShapeCreatorUtils\n{\n  public static TessellatedShapeBuilderResult Create(\n    Action&lt;TessellatedShapeBuilder&gt; actionBuilder)\n  {\n    TessellatedShapeBuilder builder = new TessellatedShapeBuilder();\n    builder.Target = TessellatedShapeBuilderTarget.AnyGeometry;\n    builder.Fallback = TessellatedShapeBuilderFallback.Mesh;\n    builder.OpenConnectedFaceSet(true);\n    actionBuilder?.Invoke(builder);\n    builder.CloseConnectedFaceSet();\n    builder.Build();\n    TessellatedShapeBuilderResult result = builder.GetBuildResult();\n    return result;\n  }\n}\n</pre>\n\nIf you are working with a Revit surface, `BRepBuilder` is the way to go.\n\nMany thanks to Richard and Luiz Henrique for the good advice, illuminating discussion and great sample code!"
  },
  {
    "original_filename": "1997_sdk_brep",
    "header_text": "Change Toposurface Interior Point to Boundary",
    "local_header_href": "#3",
    "chunk_text": "####<a name=\"3\"></a> Change Toposurface Interior Point to Boundary\n\nThe long-standing question\non [Toposurface &ndash; change interior point to boundary point](https://forums.autodesk.com/t5/revit-api-forum/toposurface-change-interior-point-to-boundary-point/m-p/12015969) finally\nreceives a clear and succinct suggestion for a solution\nby Mitchell Currie of [Struxi](https://www.struxi.com/):\n\n**Question:** Is there any way to change an interior point to a boundary point or vice versa using Revit's API?\nI want to do this so I can display the boundary of the topography I have generated correctly.\n\n<center>\n<img src=\"img/toposurface_boundary_interior_point.png\" alt=\"Toposurface boundary and interior points\" title=\"Toposurface boundary and interior points\" width=\"600\"/> <!-- Pixel Height: 726 Pixel Width: 1,180 -->\n</center>\n\n**Answer:** Use a subregion and hide it.\n\nThank you for the answer!"
  },
  {
    "original_filename": "1997_sdk_brep",
    "header_text": "To Code or Not to Code, That is the Question",
    "local_header_href": "#4",
    "chunk_text": "####<a name=\"4\"></a> To Code or Not to Code, That is the Question\n\nAn interesting [comparison of two programming approaches in modern times](https://twitter.com/advany/status/1664451798793584642?s=20)\nby [Ab Advany](https://twitter.com/advany):\n\n<center>\n<img src=\"img/to_code_or_not_to_code.jpg\" alt=\"To code or not to code\" title=\"To code or not to code\" width=\"600\"/> <!-- Pixel Height: 450 Pixel Width: 800 -->\n</center>\n\nSupervised a project 2 week ago.\nTwo programmers were hired to create an MVP.\nI have worked with both before:\n\n- Alex from Germany. 100% code. 19 years experience.\n- Hamid from Pakistan. Code + Copilot + GPT-4 + no-code. 4 years experience.\n\nWhat do you think happened?\n\nBoth programmers received Figma screens and detailed specs.\nA designer was available to assist them with the assets they needed, and there was also existing code that needed to be integrated.\nHamid finished the first version in one week with 100% test coverage of code and end-to-end testing of no-code parts.\n95% of the work seems to be finished and appears to work at first glance... ðŸ˜²\nHamid built the UI and front-end workflows in bubble, generated Cloudflare Workers using GPT-4, integrated existing code using Copilot, and generated tests using GPT-4 (playwright/ava).\n\nHamid's costs:\n\n- GPT-4: $211\n- Copilot: $20\n- Cloudflare: $5\n- Bubble: $134\n- Compensation: $2460 (41 hours worked)\n- Costs to host/run: $139/mo\n\nAlex finished around 7% of the tasks. Costs:\n\n- Vercel: $20\n- Compensation: $3500\n- Estimated to developing everything: $45k. And expects $11k for adding tests.\n- Costs to host/run: $20/mo\n\nThis was a project I supervised for a friend of mine with an agency.\nI only did it because I was really curious about how it would turn out.\n\nWe both thought that Hamid would be finished in 8-10 weeks while Alex would take a week or two extra, but the results amazed us!\n\nHe had a talk with Alex about this. His response? \"But it will be so much cheaper to run this app, and you'll have everything under control.\" Not understanding the opportunity costs of shipping 13 times slower and 25 times more expensive to develop.\n\nAlex was let go because he wants to \"code\" and doesn't trust no-code/AI...\n\nThe development agency of my friend has 100+ developers like Alex.\nNow he is going to retrain or replace them with developers like Hamid...\n\nI think people like Hamid will still have work five years from now, while people like Alex will have to find other jobs/professions.\nWhat do you think?"
  }
]