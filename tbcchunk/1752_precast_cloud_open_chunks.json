[
  {
    "original_filename": "1752_precast_cloud_open",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n\n</head>\n\n<!---\n\n- precast api\n  [Q] I saw a slide on Precast for Revit. The slide also indicates the Precast also exposes an API.\n  Could you direct where the API document is? It sounds as if it has its own specific API, instead of general Revit API.\n  [A] here is a blog post discussing the Autodesk Structural Precast Extension for Revit 2019, including a section on the API for precast automation:\n  https://blogs.autodesk.com/revit/2018/05/09/new-structural-precast-extension-for-revit-2019/\n  img/precast_api_slide.jpg\n\n- https://thebuildingcoder.typepad.com/blog/2018/04/whats-new-in-the-revit-2019-api.html#comment-4464470775\n\n- https://forums.autodesk.com/t5/revit-api-forum/how-to-implement-iopenfromcloudcallback-interface/m-p/8794693#M38829\n\ntwitter:\n\nStructural Precast API, cloud open callback interface and default implementation in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon http://bit.ly/precastapi\n\nAs usual, I am over-active in the Revit API discussion forum, so you can see most of what I have been up to right there.\nHere and now, I'll highlight one of those threads and clarify how to access the Revit 2019 Precast API\n&ndash; Structural Precast API\n&ndash; <code>IOpenFromCloudCallback</code> and the <code>DefaultOpenFromCloudCallback</code> class...\n\nlinkedin:\n\nStructural Precast API, cloud open callback interface and default implementation in the #RevitAPI\n\nhttp://bit.ly/precastapi\n\nAs usual, I am over-active in the Revit API discussion forum, so you can see most of what I have been up to right there.\n\nHere and now, I'll highlight one of those threads and clarify how to access the Revit 2019 Precast API:\n\n- Structural Precast API\n- <code>IOpenFromCloudCallback</code> and the <code>DefaultOpenFromCloudCallback</code> class...\n\n#bim #DynamoBim #ForgeDevCon #Revit #API #IFC #SDK #AI #VisualStudio #Autodesk #AEC #adsk\n\n-->"
  },
  {
    "original_filename": "1752_precast_cloud_open",
    "header_text": "Precast API and Cloud Open Callback",
    "local_header_href": "#precast-api-and-cloud-open-callback",
    "chunk_text": "### Precast API and Cloud Open Callback\n\nAs usual, I am over-active in \nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160), so\nyou can see most of what I have been up to right there.\n\nHere and now, I'll highlight one of those threads and clarify how to access the Revit 2019 Precast API:\n\n- [Structural Precast API](#2) \n- [`IOpenFromCloudCallback` and the `DefaultOpenFromCloudCallback` class](#3)"
  },
  {
    "original_filename": "1752_precast_cloud_open",
    "header_text": "Structural Precast API",
    "local_header_href": "#2",
    "chunk_text": "####<a name=\"2\"></a> Structural Precast API\n\n**Question:** I saw a slide on Precast for Revit:\n\n<center>\n<img src=\"img/precast_api_slide.jpg\" alt=\"Precast API slide\" width=\"720\">\n</center>\n\nThe slide indicates that Precast also exposes an API.\n\nIt sounds as if it has its own specific API, instead of the general Revit API.\n\nWhere can I find some information on this API, please?\n\n**Answer:** Check out the blog posts discussing\nthe [Structural Precast Extension](https://blogs.autodesk.com/revit/tag/structural-precast-extension), especially \nthe [Autodesk Structural Precast Extension for Revit 2019](https://blogs.autodesk.com/revit/2018/05/09/new-structural-precast-extension-for-revit-2019).\n\nIt includes a section on the *API for precast automation*.\n\nIts software installation folder *%programfiles%/Autodesk/Structural Precast for Revit 2019* provides a subfolder named `SDK` containing:\n\n- A help file that listing all the exposed classes, methods and properties;\n- An archive containing code samples"
  },
  {
    "original_filename": "1752_precast_cloud_open",
    "header_text": "IOpenFromCloudCallback and the DefaultOpenFromCloudCallback Class",
    "local_header_href": "#3",
    "chunk_text": "####<a name=\"3\"></a> IOpenFromCloudCallback and the DefaultOpenFromCloudCallback Class\n\nNext, let's highlight a question raised in\na [comment](https://thebuildingcoder.typepad.com/blog/2018/04/whats-new-in-the-revit-2019-api.html#comment-4464470775)\non [What's New in the Revit 2019 API](https://thebuildingcoder.typepad.com/blog/2018/04/whats-new-in-the-revit-2019-api.html) and\nalso in \nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\non [how to implement `IOpenFromCloudCallback` interface](https://forums.autodesk.com/t5/revit-api-forum/how-to-implement-iopenfromcloudcallback-interface/m-p/8794693):\n\n**Question:** I am using the Revit API 2019 to detach a model from BIM360 with the following code: \n\n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:#2b91af;\">UIApplication</span>&nbsp;app&nbsp;=&nbsp;commandData.Application;\n \n&nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;path&nbsp;=&nbsp;<span style=\"color:#a31515;\">&quot;BIM&nbsp;360://myfile&quot;</span>;\n&nbsp;&nbsp;<span style=\"color:#2b91af;\">ModelPath</span>&nbsp;modelPath&nbsp;=&nbsp;<span style=\"color:#2b91af;\">ModelPathUtils</span>\n&nbsp;&nbsp;&nbsp;&nbsp;.ConvertUserVisiblePathToModelPath(&nbsp;path&nbsp;);\n \n&nbsp;&nbsp;<span style=\"color:#2b91af;\">OpenOptions</span>&nbsp;openOptions&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">OpenOptions</span>();\n&nbsp;&nbsp;openOptions.DetachFromCentralOption&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style=\"color:#2b91af;\">DetachFromCentralOption</span>.DetachAndDiscardWorksets;\n \n&nbsp;&nbsp;<span style=\"color:blue;\">using</span>(&nbsp;<span style=\"color:#2b91af;\">Transaction</span>&nbsp;t&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">Transaction</span>(&nbsp;doc&nbsp;)&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;t.Start(&nbsp;<span style=\"color:#a31515;\">&quot;Open&nbsp;Cloud&nbsp;model&quot;</span>&nbsp;);\n \n&nbsp;&nbsp;&nbsp;&nbsp;app.OpenAndActivateDocument(&nbsp;modelPath,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;openOptions,&nbsp;<span style=\"color:blue;\">true</span>,&nbsp;<span style=\"color:#2b91af;\">IOpenFromCloudCallback</span>&nbsp;);\n \n&nbsp;&nbsp;&nbsp;&nbsp;t.Commit();\n&nbsp;&nbsp;}\n</pre>\n\nThe problem is, I don't know how to implement `IOpenFromCloudCallback` correctly, so if anyone has experience with this, please help me. \n\nThank you so much :)\n\nLater: I just figured out how to implement it like this:\n\n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:#2b91af;\">Result</span>&nbsp;Execute(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">ExternalCommandData</span>&nbsp;commandData,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">ref</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;message,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">ElementSet</span>&nbsp;elements&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">UIDocument</span>&nbsp;uIDocument&nbsp;=&nbsp;commandData.Application.ActiveUIDocument;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">UIApplication</span>&nbsp;app&nbsp;=&nbsp;commandData.Application;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">Document</span>&nbsp;document&nbsp;=&nbsp;uIDocument.Document;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">View</span>&nbsp;currentview&nbsp;=&nbsp;document.ActiveView;\n \n&nbsp;&nbsp;&nbsp;&nbsp;Guid&nbsp;projectid&nbsp;=&nbsp;Guid.Parse(&nbsp;<span style=\"color:#a31515;\">&quot;myProjectGUID&quot;</span>&nbsp;);\n&nbsp;&nbsp;&nbsp;&nbsp;Guid&nbsp;modelid&nbsp;=&nbsp;Guid.Parse(&nbsp;<span style=\"color:#a31515;\">&quot;myModelGUID&quot;</span>&nbsp;);\n \n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">ModelPath</span>&nbsp;modelPath&nbsp;=&nbsp;<span style=\"color:#2b91af;\">ModelPathUtils</span>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.ConvertCloudGUIDsToCloudPath(&nbsp;projectid,&nbsp;modelid&nbsp;);\n \n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">OpenOptions</span>&nbsp;openOptions&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">OpenOptions</span>();\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">IOpenFromCloudCallback</span>&nbsp;openFromCloudCallback&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">cloudinterdace</span>();\n \n&nbsp;&nbsp;&nbsp;&nbsp;app.OpenAndActivateDocument(&nbsp;modelPath,&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;openOptions,&nbsp;<span style=\"color:blue;\">true</span>,&nbsp;openFromCloudCallback&nbsp;);\n \n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;<span style=\"color:#2b91af;\">Result</span>.Succeeded;\n&nbsp;&nbsp;}\n \n<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">class</span>&nbsp;<span style=\"color:#2b91af;\">cloudinterdace</span>&nbsp;:&nbsp;<span style=\"color:#2b91af;\">IOpenFromCloudCallback</span>\n{\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:#2b91af;\">OpenConflictResult</span>&nbsp;OnOpenConflict(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:#2b91af;\">OpenConflictScenario</span>&nbsp;scenario&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">throw</span>&nbsp;<span style=\"color:blue;\">new</span>&nbsp;NotImplementedException();\n&nbsp;&nbsp;}\n}\n</pre>\n\n**Answer by Phil Xia:** I am Phil from Revit engineering team.\n\nI saw your sample and the exception thrown in your implementation of `IOpenFromCloudCallback`.\nThat is probably not a good choice.\n\nYou can use the default implementation provided by the `DefaultOpenFromCloudCallback` class that will always use the latest version for an open conflict.\n\nHere is the introduction for this callback in the *Revit API 2019 What's New* sections\non [Existing APIs now support open from cloud paths (Collaboration for Revit)](https://thebuildingcoder.typepad.com/blog/2018/04/whats-new-in-the-revit-2019-api.html#4.1.5)\nand [Callback for conflict cases when opening from a cloud path](https://thebuildingcoder.typepad.com/blog/2018/04/whats-new-in-the-revit-2019-api.html#4.1.5.2):\n\n<font color=\"darkblue\">\n\nThe callback method:\n\n- Autodesk.Revit.DB.IOpenFromCloudCallback.OnOpenConflict()\n\ncan be passed to the document open methods to gain to handle conflict cases.\nThe method is passed an `OpenConflictScenario` value identifying the reason for the conflict (Rollback, Relinquished or OutOfDate) and should return an `OpenConflictResult` with the desired response (keep local changes, discard local changes and open the latest version or cancel).\n\nThe new class:\n\n- DefaultOpenFromCloudCallback\n\nprovides a default way to handle conflicts: it always discards the local change and gets the latest version from the cloud.\n\n</font> \n\nThe [`OpenConflictScenario` enumeration](https://www.revitapidocs.com/2019/7db711fa-cfb1-39da-a184-5aaf4230b660.htm) lists the values you can use to implement your handling logic to return `KeepLocalChanges`, `DiscardLocalChangesAndOpenLatestVersion` or just cancel the opening.\n\n- Rollback &ndash; Central model is restored to an earlier version.\n- Relinquished &ndash; Ownership to model elements is relinquished.\n- OutOfDate &ndash; Model is out of date.\n\nMany thanks to Phil for jumping in and clarifying!"
  }
]