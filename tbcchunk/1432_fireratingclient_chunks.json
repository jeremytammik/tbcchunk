[
  {
    "original_filename": "1432_fireratingclient",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"run_prettify.js\" type=\"text/javascript\"></script>\n<!--\n<script src=\"https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js\" type=\"text/javascript\"></script>\n-->\n</head>\n\n<!---\n\nReal-Time BIM Update via FireRatingCloud Windows Client #revitAPI #3dwebcoder @AutodeskRevit #adsk #aec #bim @AutodeskForge #3dwebaccel\n\nToday, I address the first item in yesterday's to do list\n&ndash; Document and improve FireRatingClient, the stand-alone Windows client &ndash; we will need this to demonstrate the real-time BIM update from arbitrary sources\n&ndash; Context\n&ndash; FireRatingClient\n&ndash; Adding the <code>modified</code> Field\n&ndash; Updating the <code>modified</code> Field on Edit\n&ndash; FireRatingClient Live BIM Update Demo Recording\n&ndash; Download\n&ndash; To Do...\n\n-->"
  },
  {
    "original_filename": "1432_fireratingclient",
    "header_text": "Real-Time BIM Update via FireRatingCloud Windows Client",
    "local_header_href": "#real-time-bim-update-via-fireratingcloud-windows-client",
    "chunk_text": "### Real-Time BIM Update via FireRatingCloud Windows Client\n\nToday, I address the first item in [the to do list that I published yesterday](http://thebuildingcoder.typepad.com/blog/2016/04/real-time-bim-update-with-fireratingcloud-2017.html#11):\n\n- Document and improve [FireRatingClient](https://github.com/jeremytammik/FireRatingCloud/tree/master/FireRatingClient),\nthe stand-alone Windows client &ndash; we will need this to demonstrate the real-time BIM update from arbitrary sources.\n\nLet's look at this task in context and then address it right away:\n\n- [Context](#2)\n- [FireRatingClient](#3)\n- [Adding the `modified` Field](#4)\n- [Updating the `modified` Field on Edit](#5)\n- [FireRatingClient Live BIM Update Demo Recording](#6)\n- [Download](#7)\n- [To Do](#8)"
  },
  {
    "original_filename": "1432_fireratingclient",
    "header_text": "<a name=\"2\"></a>Context",
    "local_header_href": "#a-name2acontext",
    "chunk_text": "#### <a name=\"2\"></a>Context\n\nIn the past few days, I worked on updating and migrating my samples connecting BIM and the cloud:\n\n- [RoomEditorApp for Revit 2017](http://thebuildingcoder.typepad.com/blog/2016/04/room-editor-first-revit-2017-addin-migration.html#3)\n- [Real-Time BIM Update with FireRatingCloud 2017](http://thebuildingcoder.typepad.com/blog/2016/04/real-time-bim-update-with-fireratingcloud-2017.html)\n\nThe [RoomEditorApp](https://github.com/jeremytammik/RoomEditorApp) demonstrates\na full round-trip real-time connection between the Revit BIM and a simplified 2D view that can be graphically edited on any mobile device.\nAs a side effect, it also includes support for non-graphical editing of parameter values on family instances.\n\nThe [FireRatingCloud](https://github.com/jeremytammik/FireRatingCloud) sample is somewhat simpler.\nIt also demonstrates a full round-trip real-time connection between the Revit BIM and an external NoSQL database, in this case connecting to a MongoDB database via a node.js web server.\nIt supports non-graphical editing of a specific shared parameter value representing the fire rating values on door family instance elements.\n\nFor both these applications, the database and web server can be hosted either in the cloud or locally on the same system running Revit.\nOf course, global accessibility is easier to implement by hosting them on the web.\n\nThe stand-alone Windows client presented here shows that you can make selected BIM data available to absolutely anybody, absolutely anywhere, with a truly minimal amount of effort, providing full real-time round-trip editing capability."
  },
  {
    "original_filename": "1432_fireratingclient",
    "header_text": "<a name=\"3\"></a>FireRatingClient",
    "local_header_href": "#a-name3afireratingclient",
    "chunk_text": "#### <a name=\"3\"></a>FireRatingClient\n\nThis stand-alone Windows client to edit the FireRatingCloud database values was originally implemented by\nJose Ignacio Montes, [@montesherraiz](https://github.com/Montesherraiz), of [Avatar BIM](http://avatarbim.com) in\nMadrid, during the [BIM Programming Workshop](http://www.bimprogramming.com) in January.\n\nIt is extremely simple and obviously not fit for real-world use in a production environment in its current state.\n\nFor instance, the project name is not displayed, and elements cannot be filtered by project &ndash; or anything else either, for that matter &ndash; so currently all database records are loaded.\nThat will no longer work once there are enough records in the database.\n\nIt is totally inacceptable in the long run, but perfectly fine for my demonstration purposes here.\n\nAlso, simplicity is important for easier understanding.\n\nI will now add the newly implemented `modified` timestamp field to each door data record that it displays, and update that field automatically when the `firerating` value is edited.\n\nThe modified values are immediately written back to the mongo database.\n\nWith the new database polling functionality added yesterday to the Revit add-in, these modifications will be detected and immediately and automatically reflected in the BIM, provided we have subscribed to that notification.\n\nSo let's get going."
  },
  {
    "original_filename": "1432_fireratingclient",
    "header_text": "<a name=\"4\"></a>Adding the `modified` Field",
    "local_header_href": "#a-name4aadding-the-modified-field",
    "chunk_text": "#### <a name=\"4\"></a>Adding the `modified` Field\n\nIn order to support the real-time BIM update from the mongo database,\nI [implemented my own timestamp in C#](http://the3dwebcoder.typepad.com/blog/2016/04/fireratingcloud-document-modification-timestamp.html#5).\n\nFor simplicity, I use\na [Unix epoch timestamp](https://en.wikipedia.org/wiki/Unix_time),\ni.e., the count of seconds since January 1, 1970, and store it as a simple number in MongoDB.\n\nIn C#, it is implemented by the `DoorData` class:\n\n<pre class=\"code\">\n<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">class</span>&nbsp;<span style=\"color:#2b91af;\">DoorData</span>\n{\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;_id&nbsp;{&nbsp;<span style=\"color:blue;\">get</span>;&nbsp;<span style=\"color:blue;\">set</span>;&nbsp;}\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;project_id&nbsp;{&nbsp;<span style=\"color:blue;\">get</span>;&nbsp;<span style=\"color:blue;\">set</span>;&nbsp;}\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;level&nbsp;{&nbsp;<span style=\"color:blue;\">get</span>;&nbsp;<span style=\"color:blue;\">set</span>;&nbsp;}\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">string</span>&nbsp;tag&nbsp;{&nbsp;<span style=\"color:blue;\">get</span>;&nbsp;<span style=\"color:blue;\">set</span>;&nbsp;}\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">double</span>&nbsp;firerating&nbsp;{&nbsp;<span style=\"color:blue;\">get</span>;&nbsp;<span style=\"color:blue;\">set</span>;&nbsp;}\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;<span style=\"color:blue;\">uint</span>&nbsp;modified&nbsp;{&nbsp;<span style=\"color:blue;\">get</span>;&nbsp;<span style=\"color:blue;\">set</span>;&nbsp;}\n\n\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;Constructor&nbsp;to&nbsp;populate&nbsp;instance&nbsp;by&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;deserialising&nbsp;the&nbsp;REST&nbsp;GET&nbsp;response.</span>\n&nbsp;&nbsp;<span style=\"color:gray;\">///</span><span style=\"color:green;\">&nbsp;</span><span style=\"color:gray;\">&lt;/</span><span style=\"color:gray;\">summary</span><span style=\"color:gray;\">&gt;</span>\n&nbsp;&nbsp;<span style=\"color:blue;\">public</span>&nbsp;DoorData()\n&nbsp;&nbsp;{\n&nbsp;&nbsp;}\n</pre>\n\nThe corresponding [mongoose](http://mongoosejs.com) schema definition to hold it looks like this:\n\n<pre class=\"prettyprint\">\nvar doorSchema = new Schema(\n  { _id          : RvtUniqueId // suppress automatic generation\n    , project_id : String\n    , level      : String\n    , tag        : String\n    , firerating : Number\n    , modified   : Number },\n  { _id          : false } // suppress automatic generation\n);\n</pre>\n\nI updated the FireRatingClient to display the modified field and published the result\nas [release 2017.0.0.13](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.13).\n\nYou can see exactly what I changed to add the new column by looking at\nthe [diffs](https://github.com/jeremytammik/FireRatingCloud/compare/2017.0.0.12...2017.0.0.13).\n\nHere is the new form in all its glory:\n\n<center>\n<img src=\"img/fireratingclient_with_modified_field.png\" alt=\"FireRatingClient with modified field\" width=\"\">\n</center>\n\nAs I mentioned directly when initially implementing the `modified` timestamp, anyone who updates a database entry is now responsible for explicitly setting the correct modified value as well.\n\nThat is exactly what we are about to do right now for FireRatingClient."
  },
  {
    "original_filename": "1432_fireratingclient",
    "header_text": "<a name=\"5\"></a>Updating the `modified` Field on Edit",
    "local_header_href": "#a-name5aupdating-the-modified-field-on-edit",
    "chunk_text": "#### <a name=\"5\"></a>Updating the `modified` Field on Edit\n\nUpdating the `modified` field each time a door data record is edited turned out to be incredibly easy.\n\nJose already set up the Windows client to transmit each and every interactive edit immediately to the mongo db via REST in the `ExportData` method called by the `OnDoorsCellEditFinished` event handler.\n\nI added the timestamp update to it like this:\n\n<pre class=\"code\">\n<span style=\"color:blue;\">void</span>&nbsp;ExportData(&nbsp;<span style=\"color:#2b91af;\">DoorData</span>&nbsp;dd&nbsp;)\n{\n&nbsp;&nbsp;<span style=\"color:blue;\">uint</span>&nbsp;timestamp&nbsp;=&nbsp;<span style=\"color:#2b91af;\">Util</span>.UnixTimestamp();\n\n&nbsp;&nbsp;dd.modified&nbsp;=&nbsp;timestamp;\n\n&nbsp;&nbsp;<span style=\"color:blue;\">string</span>&nbsp;jsonResponse,&nbsp;errorMessage;\n\n  <span style=\"color:#2b91af;\">HttpStatusCode</span>&nbsp;sc&nbsp;=&nbsp;<span style=\"color:#2b91af;\">Util</span>.Put(&nbsp;\n  &nbsp;&nbsp;<span style=\"color:blue;\">out</span>&nbsp;jsonResponse,&nbsp;<span style=\"color:blue;\">out</span>&nbsp;errorMessage,\n  &nbsp;&nbsp;<span style=\"color:#a31515;\">&quot;doors/&quot;</span>&nbsp;+&nbsp;dd._id,&nbsp;dd&nbsp;);\n}\n\n<span style=\"color:blue;\">void</span>&nbsp;OnDoorsCellEditFinished(\n&nbsp;&nbsp;<span style=\"color:blue;\">object</span>&nbsp;sender,\n&nbsp;&nbsp;BrightIdeasSoftware.<span style=\"color:#2b91af;\">CellEditEventArgs</span>&nbsp;e&nbsp;)\n{\n&nbsp;&nbsp;ExportData(&nbsp;e.RowObject&nbsp;<span style=\"color:blue;\">as</span>&nbsp;<span style=\"color:#2b91af;\">DoorData</span>&nbsp;);\n}\n</pre>\n\nNow all I want to do further is set up a nice demo for you and record it."
  },
  {
    "original_filename": "1432_fireratingclient",
    "header_text": "<a name=\"6\"></a>FireRatingClient Live BIM Update Demo Recording",
    "local_header_href": "#a-name6afireratingclient-live-bim-update-demo-recording",
    "chunk_text": "#### <a name=\"6\"></a>FireRatingClient Live BIM Update Demo Recording\n\nHere is an four-minute recording demonstrating the final result,\n[real-time Revit BIM update via Windows Forms FireRatingClient](https://youtu.be/vJyXmxHgu9g):\n\n<center>\n<iframe width=\"420\" height=\"315\" src=\"https://www.youtube.com/embed/vJyXmxHgu9g?rel=0\" frameborder=\"0\" allowfullscreen></iframe>\n</center>"
  },
  {
    "original_filename": "1432_fireratingclient",
    "header_text": "<a name=\"7\"></a>Download",
    "local_header_href": "#a-name7adownload",
    "chunk_text": "#### <a name=\"7\"></a>Download\n\nThe versions of FireRatingCloud and FireRatingClient presented above\nare included in [release 2017.0.0.14](https://github.com/jeremytammik/FireRatingCloud/releases/tag/2017.0.0.14),\navailable from the [FireRatingCloud GitHub repository](https://github.com/jeremytammik/FireRatingCloud)."
  },
  {
    "original_filename": "1432_fireratingclient",
    "header_text": "<a name=\"8\"></a>To Do",
    "local_header_href": "#a-name8ato-do",
    "chunk_text": "#### <a name=\"8\"></a>To Do\n\nLet's update [the to do list that I published yesterday](http://thebuildingcoder.typepad.com/blog/2016/04/real-time-bim-update-with-fireratingcloud-2017.html#11).\n\nI have several more exciting tasks lined up, all related to connecting BIM and the cloud:\n\n- Completely rewrite the existing [RoomEditorApp](https://github.com/jeremytammik/RoomEditorApp) sample to move it from CouchDB to node.js plus MongoDB.\n- Implement the database portion of the [TrackChangesCloud](https://github.com/jeremytammik/TrackChangesCloud) sample.\n\nI think I'll tackle the latter first..."
  }
]