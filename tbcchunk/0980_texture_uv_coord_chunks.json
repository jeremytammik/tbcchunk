[
  {
    "original_filename": "0980_texture_uv_coord",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n<script src=\"http://thebuildingcoder.typepad.com/google-code-prettify/run_prettify.js\"></script>\n</head>"
  },
  {
    "original_filename": "0980_texture_uv_coord",
    "header_text": "Texture Bitmap and UV Coordinates",
    "local_header_href": "#texture-bitmap-and-uv-coordinates",
    "chunk_text": "<h3>Texture Bitmap and UV Coordinates</h3><p>Yesterday, I mentioned the new\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2013/07/graphics-pipeline-custom-exporter.html\">\ncustom exporter framework</a> providing\n\ndirect access to the Revit viewing and rendering graphics pipeline.</p><p>That brings new possibilities to a related area that we discussed way back in 2010: how to obtain\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/02/texture-data-uv-coordinates-and-fbx.html\">\ntexture data UV coordinates</a>.\n\nAt the time, the Revit API did not provide this information, and a work-around based on the Revit FBX export helped a little.</p><p>Happily, the custom exporter framework opens that up a bit more.\nLet us look at that and sundry other recent little queries:</p><ul>\n<li><a href=\"#2\">Obtaining texture UV coordinates</a></li>\n<li><a href=\"#3\">Texture bitmap access</a></li>\n<li><a href=\"#4\">Calculating and marking shaded areas in the BIM</a></li>\n<li><a href=\"#5\">Nested family predicate</a></li>\n<li><a href=\"#6\">IFC viewer</a></li>\n</ul><a name=\"2\"></a>"
  },
  {
    "original_filename": "0980_texture_uv_coord",
    "header_text": "Obtaining Texture UV Coordinates",
    "local_header_href": "#obtaining-texture-uv-coordinates",
    "chunk_text": "<h4>Obtaining Texture UV Coordinates</h4><p>This question was raised again in a\n\n<a href=\"http://forums.autodesk.com/t5/Autodesk-Revit-API/Obtaining-texture-UV-coordinates/m-p/3947006/highlight/false#M4060\">\nforum thread on obtaining texture UV coordinates</a>:</p><p><strong>Question:</strong> I coded a Revit plugin that renders a scene – and calculates the UV coordinates for each vertex.\nUnfortunately there are a number of situations where UV mapping is wrong – even with planar mapping.\nSo my question is, how can I get correct UV's?</p><p><strong>Answer by Arnošt Löbel:</strong> Indeed, the regular Revit geometry API does not provide accurate UV texture mapping data.</p><p>However, correct UVs can be retrieved from the CustomExporter via an ExportContext in Revit 2014, a.k.a. Visualization API.\nThe OnPolymesh callback of the context receives PolymeshTopology objects that have UVs for each mesh.</p><p>The CustomExporter should be used for most (if not all) export and render external applications.</p><p><strong>Response:</strong> I implemented the proposed solution and can confirm that it works extremely well.\nThank you!\nMy only criticism is that it still doesn't allow obtaining texture map named assigned to materials in the OnMaterial method.\nI also noticed that the ArchVision RPC (cutout geometry) props do not get sent to ExportContext.\nBut still a huge step forward.\n\n<p><strong>Answer by Arnošt:</strong> Thank you for making progress and reporting on it. :-)\nIt seems the Custom Exporter is the right tool for you to utilize.\nI am sorry about the textures and RPCs.\nHowever we are under rather strict copyright obligations and we are not allowed to export data for RPCs in any of our export formats, including custom exports.\nAs for the textures, although there are no such strict restrictions, the entire material component is – technically – not part of Revit code and its internal API does not allow us to acquire texture paths, at least not easily (as far as I know).\nHopefully, the material component keeps on improving going forward allowing us expanding the functionality of custom exporters in future releases of the Revit API.\n\n\n<a name=\"3\"></a>\n<h4>Texture Bitmap Access</h4>\n<p>As you can see from the item above, the texture UV coordinates are available, and the bitmap is not.</p>\n<p>As a workaround for that, Artur Brzegowy, who provided the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2013/07/graphics-pipeline-custom-exporter.html#5\">\ncustom exporter to Collada</a> published\n\nyesterday, suggested getting the texture memory data instead:</p>\n<p>One possibility might be to create a simple plane on the fly, assign the given material on it, and make a screen snapshot of the texture using document.ExportImage or some other method.</p>\n<p>Rudolf Honke was also interested in access to the texture bitmap, and initially suggested:</p>\n<p>We are obviously looking for a full texture bitmap like this:</p>\n<center>\n<img alt=\"Sample texture bitmap\" src=\"img/rh_texture_01.png\"/>\n</center>\n<p>The MaterialNode provides a property named ThumbnailFile returning the path if a file that contains a thumbnail image of the material.\nThat is not presumably to small a preview to be useful, not a full-scale image like above.</p>\n<p>We could also grab a texture preview image from the material browser:</p>\n<center>\n<img alt=\"Material browser\" src=\"img/rh_texture_02.png\" width=\"400\"/>\n</center>\n<p>Unfortunately, the preview image here does not just display the texture, but other objects as well.</p>\n<p>Based on Artur's idea, I suggested to Rudolf:</p>\n<ul>\n<li>Create a new temporary project</li>\n<li>Create a large cube</li>\n<li>Assign it the desired material</li>\n<li>Create a screen snapshot of that</li>\n</ul>\n<p>Rudolf reports: I tried it out and am happy to say that it works.</p>\n<p>I have one little issue with the line width, though:</p>\n<center>\n<img alt=\"Sample bitmap\" src=\"img/rh_texture_03.png\" width=\"200\"/>\n</center>\n<p>I am requesting TL, thin lines, because the image can be cropped better that way.\nThe thin lines appear just fine in the standard display.</p>\n<p>However, the exported images are adorned with a thick border.</p>\n<p>I can obtain the desired bitmap anyway, of course.</p>\n<p>Because of this, though, it might be better to grab the screen image directly rather than passing it through the Document.ExportImage method.\nThat would provide real 'what you see is what you get'.</p>\n<p>Here is a partial cropped screen snapshot of the result – the original sample image includes 86 different textures:</p>\n<center>\n<img alt=\"Texture bitmap results\" src=\"img/rh_texture_04.png\"/>\n</center>\n<a name=\"4\"></a>\n<h4>Calculating and Marking Shaded Areas in the BIM</h4>\n<p>On a completely different topic, say we have a roof with a tall chimney in a Revit building model and enable the sun settings so that shadows are displayed.\n\n<p><strong>Question:</strong> How can we programmatically find out which area on the roof is under shadow?\n\n<p><strong>Answer:</strong> Project both the chimney and the roof onto a plane in the direction of the sunlight and then calculate the overlap.\n\n<p><strong>Response:</strong> Will that be accurate?\nIs there a direct API to get the shaded area?\n\n<p><strong>Answer:</strong> Yes, of course it is accurate.\nNo, there is no direct API support for that.\n\n<p>You can use the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2013/04/extrusion-analyser-and-plan-view-boundaries.html\">\nextrusion analyser</a> to\n\ndetermine the shaded area projected onto a plane.\nProject the roof itself onto the same plane as well.\nThen use a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/02/boolean-operations-for-2d-polygons.html\">\n2D Boolean operation on the plane</a> to\n\ndetermine the overlap.</p>\n<p>Projecting these results from the plane back onto the roof for different hours of the day would enable you to display the outlines of the shadows as required.</p>\n<a name=\"5\"></a>\n<h4>Nested Family Predicate</h4>\n<p>Here is another unrelated topic, closer to the kernel Revit API this time:\n\n<p><strong>Question:</strong> How can I test whether a family is nested within another family, whether it has families nested within itself, and if so which ones?</p>\n<p><strong>Answer:</strong>  If a family A is nested within a family B, and the family is 'Shared', then you will also be able to see the elements and types of family A in any project containing family B.\n\n<p>One typical use of this is for furniture, e.g. a Table and Chairs family may contain a chair family that can be placed independently.</p>\n<p>If the family is not shared, which is the more typical case, then you need to open the family’s document to see the members it contains.\nThis can be achieved in memory via the EditFamily method.</p>\n<p>You can open family B and read the family elements in its database; A will appear as a Family element.\nFurthermore, there should be one or more family symbols of A and one or more family instances of A in B's database.</p>\n<p>Therefore, just running the appropriate filtered element collectors will answer the question quickly, easily and efficiently.</p>\n<p>Here are some previous discussions related to this:</p>\n<ul>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2009/05/nested-instance-geometry.html\">Nested instance geometry</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2009/11/nested-family.html\">Nested family</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2010/02/nested-family-instance.html\">Nested family instance</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2010/03/nested-family-utility-methods.html\">Nested family utility methods</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2011/04/nested-lighting-fixture-instances.html\">Nested lighting fixture instances</a></li>\n</ul>\n<a name=\"6\"></a>\n<h4>IFC Viewer</h4>\n<p>Finally, on yet another unrelated topic, here is some IFC news and pointers that might come in handy:\n\n<p>Navisworks supports IFC only, not ifcXML and ifcZip. The currently supported version is IFC2X3 and lower, not yet IFC4\n\n(<a href=\"http://www.buildingsmart-tech.org/specifications/ifc-overview/ifc-overview-summary\">IFC specification</a>).</p>\n<p>IFC doesn’t support texture. Colour support is also patchy, although the Navisworks 2014 SP1 significantly improves the situation.</p>\n<p>As regards IFC viewers, the <a href=\"http://www.solibri.com/\">Solibri model viewer</a> appears to be quite good.\n</p></p></p></p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0980_texture_uv_coord",
    "header_text": "Texture Bitmap Access",
    "local_header_href": "#texture-bitmap-access",
    "chunk_text": "<h4>Texture Bitmap Access</h4><p>As you can see from the item above, the texture UV coordinates are available, and the bitmap is not.</p><p>As a workaround for that, Artur Brzegowy, who provided the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2013/07/graphics-pipeline-custom-exporter.html#5\">\ncustom exporter to Collada</a> published\n\nyesterday, suggested getting the texture memory data instead:</p><p>One possibility might be to create a simple plane on the fly, assign the given material on it, and make a screen snapshot of the texture using document.ExportImage or some other method.</p><p>Rudolf Honke was also interested in access to the texture bitmap, and initially suggested:</p><p>We are obviously looking for a full texture bitmap like this:</p><center>\n<img alt=\"Sample texture bitmap\" src=\"img/rh_texture_01.png\"/>\n</center><p>The MaterialNode provides a property named ThumbnailFile returning the path if a file that contains a thumbnail image of the material.\nThat is not presumably to small a preview to be useful, not a full-scale image like above.</p><p>We could also grab a texture preview image from the material browser:</p><center>\n<img alt=\"Material browser\" src=\"img/rh_texture_02.png\" width=\"400\"/>\n</center><p>Unfortunately, the preview image here does not just display the texture, but other objects as well.</p><p>Based on Artur's idea, I suggested to Rudolf:</p><ul>\n<li>Create a new temporary project</li>\n<li>Create a large cube</li>\n<li>Assign it the desired material</li>\n<li>Create a screen snapshot of that</li>\n</ul><p>Rudolf reports: I tried it out and am happy to say that it works.</p><p>I have one little issue with the line width, though:</p><center>\n<img alt=\"Sample bitmap\" src=\"img/rh_texture_03.png\" width=\"200\"/>\n</center><p>I am requesting TL, thin lines, because the image can be cropped better that way.\nThe thin lines appear just fine in the standard display.</p><p>However, the exported images are adorned with a thick border.</p><p>I can obtain the desired bitmap anyway, of course.</p><p>Because of this, though, it might be better to grab the screen image directly rather than passing it through the Document.ExportImage method.\nThat would provide real 'what you see is what you get'.</p><p>Here is a partial cropped screen snapshot of the result – the original sample image includes 86 different textures:</p><center>\n<img alt=\"Texture bitmap results\" src=\"img/rh_texture_04.png\"/>\n</center><a name=\"4\"></a>"
  },
  {
    "original_filename": "0980_texture_uv_coord",
    "header_text": "Calculating and Marking Shaded Areas in the BIM",
    "local_header_href": "#calculating-and-marking-shaded-areas-in-the-bim",
    "chunk_text": "<h4>Calculating and Marking Shaded Areas in the BIM</h4><p>On a completely different topic, say we have a roof with a tall chimney in a Revit building model and enable the sun settings so that shadows are displayed.\n\n<p><strong>Question:</strong> How can we programmatically find out which area on the roof is under shadow?\n\n<p><strong>Answer:</strong> Project both the chimney and the roof onto a plane in the direction of the sunlight and then calculate the overlap.\n\n<p><strong>Response:</strong> Will that be accurate?\nIs there a direct API to get the shaded area?\n\n<p><strong>Answer:</strong> Yes, of course it is accurate.\nNo, there is no direct API support for that.\n\n<p>You can use the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2013/04/extrusion-analyser-and-plan-view-boundaries.html\">\nextrusion analyser</a> to\n\ndetermine the shaded area projected onto a plane.\nProject the roof itself onto the same plane as well.\nThen use a\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2009/02/boolean-operations-for-2d-polygons.html\">\n2D Boolean operation on the plane</a> to\n\ndetermine the overlap.</p>\n<p>Projecting these results from the plane back onto the roof for different hours of the day would enable you to display the outlines of the shadows as required.</p>\n<a name=\"5\"></a>\n<h4>Nested Family Predicate</h4>\n<p>Here is another unrelated topic, closer to the kernel Revit API this time:\n\n<p><strong>Question:</strong> How can I test whether a family is nested within another family, whether it has families nested within itself, and if so which ones?</p>\n<p><strong>Answer:</strong>  If a family A is nested within a family B, and the family is 'Shared', then you will also be able to see the elements and types of family A in any project containing family B.\n\n<p>One typical use of this is for furniture, e.g. a Table and Chairs family may contain a chair family that can be placed independently.</p>\n<p>If the family is not shared, which is the more typical case, then you need to open the family’s document to see the members it contains.\nThis can be achieved in memory via the EditFamily method.</p>\n<p>You can open family B and read the family elements in its database; A will appear as a Family element.\nFurthermore, there should be one or more family symbols of A and one or more family instances of A in B's database.</p>\n<p>Therefore, just running the appropriate filtered element collectors will answer the question quickly, easily and efficiently.</p>\n<p>Here are some previous discussions related to this:</p>\n<ul>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2009/05/nested-instance-geometry.html\">Nested instance geometry</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2009/11/nested-family.html\">Nested family</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2010/02/nested-family-instance.html\">Nested family instance</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2010/03/nested-family-utility-methods.html\">Nested family utility methods</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2011/04/nested-lighting-fixture-instances.html\">Nested lighting fixture instances</a></li>\n</ul>\n<a name=\"6\"></a>\n<h4>IFC Viewer</h4>\n<p>Finally, on yet another unrelated topic, here is some IFC news and pointers that might come in handy:\n\n<p>Navisworks supports IFC only, not ifcXML and ifcZip. The currently supported version is IFC2X3 and lower, not yet IFC4\n\n(<a href=\"http://www.buildingsmart-tech.org/specifications/ifc-overview/ifc-overview-summary\">IFC specification</a>).</p>\n<p>IFC doesn’t support texture. Colour support is also patchy, although the Navisworks 2014 SP1 significantly improves the situation.</p>\n<p>As regards IFC viewers, the <a href=\"http://www.solibri.com/\">Solibri model viewer</a> appears to be quite good.\n</p></p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0980_texture_uv_coord",
    "header_text": "Nested Family Predicate",
    "local_header_href": "#nested-family-predicate",
    "chunk_text": "<h4>Nested Family Predicate</h4><p>Here is another unrelated topic, closer to the kernel Revit API this time:\n\n<p><strong>Question:</strong> How can I test whether a family is nested within another family, whether it has families nested within itself, and if so which ones?</p>\n<p><strong>Answer:</strong>  If a family A is nested within a family B, and the family is 'Shared', then you will also be able to see the elements and types of family A in any project containing family B.\n\n<p>One typical use of this is for furniture, e.g. a Table and Chairs family may contain a chair family that can be placed independently.</p>\n<p>If the family is not shared, which is the more typical case, then you need to open the family’s document to see the members it contains.\nThis can be achieved in memory via the EditFamily method.</p>\n<p>You can open family B and read the family elements in its database; A will appear as a Family element.\nFurthermore, there should be one or more family symbols of A and one or more family instances of A in B's database.</p>\n<p>Therefore, just running the appropriate filtered element collectors will answer the question quickly, easily and efficiently.</p>\n<p>Here are some previous discussions related to this:</p>\n<ul>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2009/05/nested-instance-geometry.html\">Nested instance geometry</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2009/11/nested-family.html\">Nested family</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2010/02/nested-family-instance.html\">Nested family instance</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2010/03/nested-family-utility-methods.html\">Nested family utility methods</a></li>\n<li><a href=\"http://thebuildingcoder.typepad.com/blog/2011/04/nested-lighting-fixture-instances.html\">Nested lighting fixture instances</a></li>\n</ul>\n<a name=\"6\"></a>\n<h4>IFC Viewer</h4>\n<p>Finally, on yet another unrelated topic, here is some IFC news and pointers that might come in handy:\n\n<p>Navisworks supports IFC only, not ifcXML and ifcZip. The currently supported version is IFC2X3 and lower, not yet IFC4\n\n(<a href=\"http://www.buildingsmart-tech.org/specifications/ifc-overview/ifc-overview-summary\">IFC specification</a>).</p>\n<p>IFC doesn’t support texture. Colour support is also patchy, although the Navisworks 2014 SP1 significantly improves the situation.</p>\n<p>As regards IFC viewers, the <a href=\"http://www.solibri.com/\">Solibri model viewer</a> appears to be quite good.\n</p></p></p></p>"
  },
  {
    "original_filename": "0980_texture_uv_coord",
    "header_text": "IFC Viewer",
    "local_header_href": "#ifc-viewer",
    "chunk_text": "<h4>IFC Viewer</h4><p>Finally, on yet another unrelated topic, here is some IFC news and pointers that might come in handy:\n\n<p>Navisworks supports IFC only, not ifcXML and ifcZip. The currently supported version is IFC2X3 and lower, not yet IFC4\n\n(<a href=\"http://www.buildingsmart-tech.org/specifications/ifc-overview/ifc-overview-summary\">IFC specification</a>).</p>\n<p>IFC doesn’t support texture. Colour support is also patchy, although the Navisworks 2014 SP1 significantly improves the situation.</p>\n<p>As regards IFC viewers, the <a href=\"http://www.solibri.com/\">Solibri model viewer</a> appears to be quite good.\n</p></p>"
  }
]