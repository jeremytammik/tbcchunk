[
  {
    "original_filename": "0280_landxml",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0280_landxml",
    "header_text": "Import LandXML Surface",
    "local_header_href": "#import-landxml-surface",
    "chunk_text": "<h3>Import LandXML Surface</h3><p>Someone recently asked for an API within Revit for handling LandXML data.\nThere is no API for LandXML, but there is nothing to stop us from using standard XML parsing to read LandXML files and use the standard Revit API to generate terrain and other objects.\n\n<p>Here is a solution provided by Emmanuel Weyermann of Autodesk demonstrating how to parse a LandXML file and generate a topography surface in the Revit database from its data.\nI added it as a new external command CmdLandXml to The Building Coder sample application.\nIt prompts the user to select a LandXML input file, parses it to obtain a list of XYZ points, and passes this list to the dedicated API method NewTopographySurface to create the surface.\nHere is the entire code of the external command's Execute method:\n\n<pre class=\"code\">\n<span class=\"teal\">Application</span> app = commandData.Application;\n<span class=\"teal\">Document</span> doc = app.ActiveDocument;\n \nW.<span class=\"teal\">OpenFileDialog</span> dlg = <span class=\"blue\">new</span> W.<span class=\"teal\">OpenFileDialog</span>();\n \ndlg.Filter = <span class=\"maroon\">\"LandXML files (*.xml)|*.xml\"</span>;\n \ndlg.Title = <span class=\"maroon\">\"Import LandXML and \"</span>\n  + <span class=\"maroon\">\"Create TopographySurface\"</span>;\n \n<span class=\"blue\">if</span>( dlg.ShowDialog() != W.<span class=\"teal\">DialogResult</span>.OK )\n{\n  <span class=\"blue\">return</span> <span class=\"teal\">CmdResult</span>.Cancelled;\n}\n \n<span class=\"teal\">XmlDocument</span> xmlDoc = <span class=\"blue\">new</span> <span class=\"teal\">XmlDocument</span>();\nxmlDoc.Load( dlg.FileName );\n \n<span class=\"teal\">XmlNodeList</span> pnts \n  = xmlDoc.GetElementsByTagName( <span class=\"maroon\">\"Pnts\"</span> );\n \n<span class=\"blue\">char</span>[] separator = <span class=\"blue\">new</span> <span class=\"blue\">char</span>[] { <span class=\"maroon\">' '</span> };\n<span class=\"blue\">double</span> x = 0, y = 0, z = 0;\n<span class=\"teal\">XYZ</span> xyz;\n \n<span class=\"teal\">XYZArray</span> pts = app.Create.NewXYZArray();\n \n<span class=\"blue\">for</span>( <span class=\"blue\">int</span> k = 0; k &lt; pnts.Count; ++k )\n{\n  <span class=\"blue\">for</span>( <span class=\"blue\">int</span> i = 0; \n    i &lt; pnts[k].ChildNodes.Count; ++i )\n  {\n    <span class=\"blue\">int</span> j = 1;\n \n    <span class=\"blue\">string</span> text = pnts[k].ChildNodes[i].InnerText;\n    <span class=\"blue\">string</span>[] coords = text.Split( separator );\n \n    <span class=\"blue\">foreach</span>( <span class=\"blue\">string</span> coord <span class=\"blue\">in</span> coords )\n    {\n      <span class=\"blue\">switch</span>( j )\n      {\n        <span class=\"blue\">case</span> 1:\n          x = <span class=\"teal\">Double</span>.Parse( coord );\n          <span class=\"blue\">break</span>;\n        <span class=\"blue\">case</span> 2:\n          y = <span class=\"teal\">Double</span>.Parse( coord );\n          <span class=\"blue\">break</span>;\n        <span class=\"blue\">case</span> 3:\n          z = <span class=\"teal\">Double</span>.Parse( coord );\n          <span class=\"blue\">break</span>;\n        <span class=\"blue\">default</span>:\n          <span class=\"blue\">break</span>;\n      }\n      j++;\n    }\n    xyz = <span class=\"blue\">new</span> <span class=\"teal\">XYZ</span>( x, y, z );\n    pts.Append( xyz );\n  }\n}\n \n<span class=\"teal\">TopographySurface</span> surface \n  = doc.Create.NewTopographySurface( pts );\n \n<span class=\"blue\">return</span> <span class=\"teal\">CmdResult</span>.Succeeded;\n</pre>\n<p>You need to change the view property to display topography to see the resulting surface after running this command.\n\n<p>One limitation of this sample is that it does not check what units are defined on the LandXML file.\n\n<p>Here is a zip file\n\n<a href=\"zip/LandXMLfiles.zip\">LandXMLfiles.zip</a>\n\ncontaining Emmanuel's original solution as well as a sample LandXML input file.\nThe resulting topography surface displayed by Revit after reading in and processing the file looks like this:\n\n<center>\n<img alt=\"LandXML topography surface\" src=\"img/landxml_topography_surface.png\"/>\n</center>\n<p>Here is\n\n<a href=\"zip/bc11057.zip\">\nversion 1.1.0.57</a>\n\nof the complete Building Coder sample source code and Visual Studio solution including the new command.</p>\n<p>Many thanks to Emmanuel for providing this interesting sample!\n</p></p></p></p></p></p>"
  }
]