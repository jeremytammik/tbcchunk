[
  {
    "original_filename": "0319_object_relationship_vb",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0319_object_relationship_vb",
    "header_text": "Object Relationships in VB",
    "local_header_href": "#object-relationships-in-vb",
    "chunk_text": "<h3>Object Relationships in VB</h3><p>We recently presented Saikat Bhattacharya's neat little\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/03/object-relationships.html\">\nobject relationship</a> analyser and displayer, implemented in C#.\n\nYesterday I received a very friendly submission from Jose Guia saying \"Thought I would share my code as well, ... I converted the project to VB for sharing.\"\n\n<p>I compiled his solution and it works fine for me.\nI did run into two little issues which were easy to solve, both of them involving namespaces:\n\n<ul>\n<li>Different access to imported namespaces.\n<li>Different namespace when exporting the external command.\n</li></li></ul>\n<p>Jose initially used explicit import statements in the VB source code to access the Revit API functionality:\n\n<pre class=\"code\">\n<span class=\"blue\">Imports</span> Autodesk\n<span class=\"blue\">Imports</span> Autodesk.Revit\n<span class=\"blue\">Imports</span> Autodesk.Revit.Elements\n</pre>\n<p>I much prefer that approach, since it is similar to the syntax used in C#.\nHowever, when I tried to compile the code like that, it caused a number of errors like these\n(copy to an editor to see the full truncated lines):\n\n<pre class=\"code\">\n'Element' is not accessible in this context because it is 'Friend'.\n'Symbol' is not accessible in this context because it is 'Friend'.\n'FamilyBase' is not accessible in this context because it is 'Friend'.\n'ElementId' is not accessible in this context because it is 'Friend'.\n</pre>\n<p>The only way I found to resolve this was to remove the explicit import statements from the code and add global namespace importing requests to the project settings instead:</p>\n<center>\n<img alt=\"VB project references settings\" src=\"img/ObjRelVbReferences.png\"/>\n</center>\n<p>The global imports are defined at the bottom:</p>\n<center>\n<img alt=\"VB project global import settings\" src=\"img/ObjRelVbImports.png\"/>\n</center>\n<p>The second issue has to do with the exported namespace containing the external command.\nThe VB code specifies the same export namespace as the C# version in the source code, ObjRel:\n\n<pre class=\"code\">\n<span class=\"blue\">Namespace</span> ObjRel\n    <span class=\"blue\">Public</span> <span class=\"blue\">Class</span> Command\n        <span class=\"blue\">Implements</span> IExternalCommand\n</pre>\n<p>In spite of this, the Visual Studio environment surreptitiously prepends another namespace specified in the global project settings, the so-called root namespace, in this case ObjRelationsVB:\n\n<center>\n<img alt=\"VB project root namespace settings\" src=\"img/ObjRelVbRootNamespace.png\"/>\n</center>\n<p>Therefore, the class name entry in Revit.ini needs to be different for the C# and VB versions:\n\n<pre>\nECName2=Object Relationship\nECDescription2=Object Relationship Sample by Saikat\nECClassName2=ObjRel.Command\nECAssembly2=C:\\bin\\ObjRel.dll\n\nECName3=Object Relationship VB\nECDescription3=Object Relationship Sample by Jose\nECClassName3=ObjRelationsVB.ObjRel.Command\nECAssembly3=C:\\bin\\ObjRelationsVB.dll\n</pre>\n<p>Alternatively, of course, you can set the VB root namespace to an empty string, I hope.\nOr, alternatively, of course, you can use the\n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2010/03/addinmanager.html\">\nAdd-In Manager</a> to\n\nload the application as suggested by Joe, and avoid dealing with Revit.ini at all.\nOnce loaded, the VB port obviously presents the same functionality as Saikat's original C# version.\n\n<p>Here is Jose's complete\n\n<a href=\"zip/ObjRelationsVB.zip\">\nObjRelationsVB</a>\n\nsource code and Visual Studio solution.</p>\n<p>Very many thanks to Jose for sharing this code!\n</p></p></p></p></p></p></p></p></p>"
  }
]