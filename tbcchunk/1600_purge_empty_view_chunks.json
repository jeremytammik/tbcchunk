[
  {
    "original_filename": "1600_purge_empty_view",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<!--\n<script src=\"run_prettify.js\" type=\"text/javascript\"></script>\n<script src=\"https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js\" type=\"text/javascript\"></script>\n-->\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\n- https://forums.autodesk.com/t5/revit-api-forum/cf-1201-purge-unused-objects/m-p/7507455\n  13551712 [CF-1201 Purge unused objects]\n\n- https://forums.autodesk.com/t5/revit-api-forum/purge-unused-via-the-api/m-p/7525966\n  [Determining purgeable elements](http://thebuildingcoder.typepad.com/blog/2013/03/determining-purgeable-elements.html) and the thread \n  [Writing a purge utility](http://forums.autodesk.com/t5/revit-api/writing-a-purge-utility/m-p/2735359/highlight/true)\n\n- purge:\n[Types, Families and Materials](http://thebuildingcoder.typepad.com/blog/2017/04/forgefader-ui-lookup-builds-purge-and-room-instances.html#4)\n[Text Note Types](http://thebuildingcoder.typepad.com/blog/2010/11/purge-unused-text-note-types.html)\n[Determining Purgeable Elements](http://thebuildingcoder.typepad.com/blog/2013/03/determining-purgeable-elements.html)\n[Reference Planes Not Hosting Any Elements](http://thebuildingcoder.typepad.com/blog/2012/03/melbourne-devlab.html#2)\n[Unnamed Non-Hosting Reference Planes](http://thebuildingcoder.typepad.com/blog/2014/02/deleting-unnamed-non-hosting-reference-planes.html)\n09095866 [How to truly purge Project (Shared) Parameters](http://forums.autodesk.com/t5/Revit-API/How-to-truly-purge-Project-Shared-Parameters/m-p/4719271)\n13551712 [CF-1201 Purge unused objects](https://forums.autodesk.com/t5/revit-api-forum/cf-1201-purge-unused-objects/m-p/7507455)\nCF-1201 [Purge unused objects]\n\n- [Detecting empty views] Philipp Kast\n\n- https://chtammik.bandcamp.com/album/collection-from-the-past\ntweet: My son Chris released a music album, collection from the past, https://chtammik.bandcamp.com/album/collection-from-the-past by http://tammik.ca\n\nPurge and PostCommand #RevitAPI @AutodeskRevit #bim #dynamobim @AutodeskForge #ForgeDevCon http://bit.ly/purgepost\nDetecting empty views #RevitAPI @AutodeskRevit #bim #dynamobim @AutodeskForge #ForgeDevCon http://bit.ly/purgepost\n\nOne topic that keeps cropping up is how to purge different kinds of Revit database elements\n&ndash; Purge\n&ndash; Detecting empty views\n&ndash; JavaScript debugging tips\n&ndash; Collection from the past...\n\n--->"
  },
  {
    "original_filename": "1600_purge_empty_view",
    "header_text": "Purge and Detecting an Empty View",
    "local_header_href": "#purge-and-detecting-an-empty-view",
    "chunk_text": "### Purge and Detecting an Empty View\n\nI am behind schedule blogging, working too much on answering cases and participating in\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread \nwhile my colleagues are busy at DevCon and AU in Las Vegas.\n\nIn spite of that, this is blog number 1600, a nice round number to celebrate.\n\nOne topic that keeps cropping up is how to purge different kinds of Revit database elements:\n\n- [Purge and `PostCommand`](#2)\n- [Detecting empty views](#3)\n- [JavaScript debugging tips](#4)\n- [Collection from the past](#5)\n\n<center>\n<img src=\"img/purge_unused.png\" alt=\"Purge unused\" width=\"75\"/>\n</center>\n\n####<a name=\"2\"></a>Purge and PostCommand\n\nThe topic of purging various elements came up repeatedly in the past:\n\n- [Text note types](http://thebuildingcoder.typepad.com/blog/2010/11/purge-unused-text-note-types.html)\n- [Reference planes not hosting any elements](http://thebuildingcoder.typepad.com/blog/2012/03/melbourne-devlab.html#2)\n- [Determining purgeable elements](http://thebuildingcoder.typepad.com/blog/2013/03/determining-purgeable-elements.html)\n- [Unnamed non-hosting reference planes](http://thebuildingcoder.typepad.com/blog/2014/02/deleting-unnamed-non-hosting-reference-planes.html)\n- [Types, families and materials](http://thebuildingcoder.typepad.com/blog/2017/04/forgefader-ui-lookup-builds-purge-and-room-instances.html#4)\n\nTwo recent Revit API discussion threads re-raise the topic of programmatic access to the purge functionality:\n\n- [CF-1201 Purge unused objects](https://forums.autodesk.com/t5/revit-api-forum/cf-1201-purge-unused-objects/m-p/7507455)\n- [Purge unused via the API](https://forums.autodesk.com/t5/revit-api-forum/purge-unused-via-the-api/m-p/7525966)\n\nIn the latter, Thomas the Coder asks:\n\n**Question:** So I've read The Building Coder article\non [determining purgeable elements](http://thebuildingcoder.typepad.com/blog/2013/03/determining-purgeable-elements.html) and\nthe discussion forum thread \non [writing a purge utility](http://forums.autodesk.com/t5/revit-api/writing-a-purge-utility/m-p/2735359).\n \nThey both say that triggering the 'Purge Unused' button under the 'Manage' tab via code isn't possible and that you have to write your own code to handle the not so small task of doing it manually.\n\n**Answer by Ali [@imaliasad](https://forums.autodesk.com/t5/user/viewprofilepage/user-id/5242763) Asad:**\nI've come up with the solution, using [PostCommand](http://thebuildingcoder.typepad.com/blog/about-the-author.html#5.3) to launch the built-in Revit command:\n\n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:#2b91af;\">UIApplication</span>&nbsp;uiapp&nbsp;=&nbsp;commandData.Application;\n \n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;Store&nbsp;the&nbsp;ID&nbsp;of&nbsp;desired&nbsp;plugin&nbsp;button,</span>\n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;in&nbsp;this&nbsp;case&nbsp;its&nbsp;&#39;purge&nbsp;unused&#39;</span>\n \n&nbsp;&nbsp;<span style=\"color:#2b91af;\">String</span>&nbsp;s_commandToDisable&nbsp;=&nbsp;<span style=\"color:#a31515;\">&quot;ID_PURGE_UNUSED&quot;</span>;\n&nbsp;&nbsp;<span style=\"color:#2b91af;\">RevitCommandId</span>&nbsp;s_commandId&nbsp;=&nbsp;<span style=\"color:#2b91af;\">RevitCommandId</span>\n&nbsp;&nbsp;&nbsp;&nbsp;.LookupCommandId(&nbsp;s_commandToDisable&nbsp;);\n \n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;This&nbsp;revit&nbsp;button&nbsp;will&nbsp;run&nbsp;at&nbsp;the&nbsp;</span>\n&nbsp;&nbsp;<span style=\"color:green;\">//&nbsp;end&nbsp;of&nbsp;your&nbsp;application.&nbsp;</span>\n \n&nbsp;&nbsp;uiapp.PostCommand(&nbsp;s_commandId&nbsp;);\n</pre>\n\nThe limitation I'm facing: I can't run the Revit command button instantly; it runs after the add-in external command terminates.\n\n**Question:** How do I run the Revit command instantly within my add-in external command, before it terminates?\n\n**Answer:** `PostCommand` launches a Revit command. The command cannot run in parallel with your add-in,\nbecause there is [no multithreading support in the Revit API](http://thebuildingcoder.typepad.com/blog/2011/06/no-multithreading-in-revit.html)\nand [the Revit API is never ever thread safe](http://thebuildingcoder.typepad.com/blog/2014/11/the-revit-api-is-never-ever-thread-safe.html).\n\nTherefore, your add-in must terminate before the next command can run.\n\nYou can add another `PostCommand` to call a second add-in command to be executed afterwards to continue the process, or use other means, such\nas [Idling and external events for modeless access and driving Revit from outside](http://thebuildingcoder.typepad.com/blog/about-the-author.html#5.28).\n\nAlso note \nAli's [list of `PostCommand` limitations](https://stackoverflow.com/questions/47151567/how-to-call-revit-purge-button-from-the-revit-api) on\nStackOverflow.\n\n####<a name=\"3\"></a>Detecting Empty Views\n\nOn another related topic, my colleague Philipp Kast, Principal Engineer at Autodesk, shared an approach to detect empty views, i.e., views which do not display any visible object, and his research steps leading up to his current approach:\n\nI am working on the Revit Extractor. We are creating so-called master views, which are views for each phase in the Revit model.\n \nRecently we fixed an issue concerning empty views for phases that have no content.\n\nSo, we added the following code to detect whether a given view is empty:\n\n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:blue;\">private</span>&nbsp;<span style=\"color:blue;\">bool</span>&nbsp;IsEmptyMasterView(&nbsp;<span style=\"color:#2b91af;\">View</span>&nbsp;view&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">using</span>(&nbsp;<span style=\"color:#2b91af;\">FilteredElementCollector</span>&nbsp;collector&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">FilteredElementCollector</span>(&nbsp;doc,&nbsp;view.Id&nbsp;)&nbsp;)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;!collector.Any();\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;}\n</pre>\n \nThat worked well. But then a model came along that had empty views again, because it contained division and curtain elements that are not visible.\n\nSo, we adapted this code, basically skipping those categories:\n \n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:blue;\">using</span>(&nbsp;<span style=\"color:#2b91af;\">FilteredElementCollector</span>&nbsp;collector&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">FilteredElementCollector</span>(&nbsp;doc,&nbsp;view.Id&nbsp;)&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">var</span>&nbsp;invisibleCategories&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">HashSet</span>&lt;<span style=\"color:#2b91af;\">ElementId</span>&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">ElementId</span>(<span style=\"color:#2b91af;\">BuiltInCategory</span>.OST_Divisions),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">ElementId</span>(<span style=\"color:#2b91af;\">BuiltInCategory</span>.OST_CurtaSystemFaceManager)\n&nbsp;&nbsp;&nbsp;&nbsp;};\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;collector.All(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;element&nbsp;=&gt;&nbsp;element.Category&nbsp;!=&nbsp;<span style=\"color:blue;\">null</span>&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;invisibleCategories.Contains(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;element.Category.Id&nbsp;)&nbsp;);\n&nbsp;&nbsp;}\n</pre>\n \nNow again, yet another model includes other invisible elements.\n\nSo, I came up with the following check, by experimenting around:\n\n<pre class=\"code\">\n&nbsp;&nbsp;<span style=\"color:blue;\">using</span>(&nbsp;<span style=\"color:#2b91af;\">FilteredElementCollector</span>&nbsp;collector&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style=\"color:blue;\">new</span>&nbsp;<span style=\"color:#2b91af;\">FilteredElementCollector</span>(&nbsp;doc,&nbsp;view.Id&nbsp;)&nbsp;)\n&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color:blue;\">return</span>&nbsp;collector.All(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;element&nbsp;=&gt;&nbsp;element.Category&nbsp;!=&nbsp;<span style=\"color:blue;\">null</span>&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;!element.Category.get_AllowsVisibilityControl(&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;view&nbsp;)&nbsp;);\n&nbsp;&nbsp;}\n</pre>\n\nThis seems to work, but I’m not sure if it makes sense.\n\nAny comment or input would be appreciated.\n\nThank you!\n\nAnd thanks to Philipp for sharing this!\n\n\n####<a name=\"4\"></a>JavaScript Debugging Tips\n\nPhilippe [@F3lipek](https://twitter.com/F3lipek) Leefsma just pointed\nout [the 14 JavaScript debugging tips you probably didn't know](https://raygun.com/javascript-debugging-tips).\n\nThey are really helpful, so I'll make a note of them for myself here.\n\nThanks, Philippe!\n\n\n####<a name=\"5\"></a>Collection from the Past\n\nMy son Chris released a music album, [collection from the past](https://chtammik.bandcamp.com/album/collection-from-the-past), by [Chris Tammik](http://tammik.ca), saying:\n\nThis collection spans my composition catalogue from around 2011 to 2015. This time was mainly centred around me learning to handle digital audio editing and composition tools. \n\nAfter some months playing around with the Traktor DJ software I started exploring electronic music production with Ableton Live. I started working with sound professionally and made my passion to a job. In between I discovered REAPER as my ideal sound design environment. \n\nSince then I have focused more on the programing side of things and am now creating audio tools for video games. The release of this collection shall serve as a reminder for the stems of my passion for sound and the incredible journey I still find myself on. Hopefully you find something enjoyable here.\nThere are songs in various genres, sound design exercises, and pretty much each track has its own story &ndash; :)\n\n<center>\n<img src=\"img/banner_tammik_ca.png\" alt=\"Chris Tammik\" width=\"400\"/>\n</center>"
  }
]