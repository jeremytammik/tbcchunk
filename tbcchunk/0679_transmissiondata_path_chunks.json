[
  {
    "original_filename": "0679_transmissiondata_path",
    "header_text": "Access Central File TransmissionData on Revit Server",
    "local_header_href": "#access-central-file-transmissiondata-on-revit-server",
    "chunk_text": "<h3>Access Central File TransmissionData on Revit Server</h3><p>We already discussed using the TransmissionData class to \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/05/list-linked-files-and-transmissiondata.html\">\nlist linked files</a> and \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/10/using-the-writetransmissiondata-method.html\">\nmake changes using the WriteTransmissionData method</a>.\n\n<p>Here is another question on this topic answered by my colleague Joe Ye:\n\n<p><strong>Question:</strong> I want to access the TransmissionData object in a central file stored in the Revit Server. How can I achieve that via the Revit API, please?\n\n<p>I tried the suggestions listed in the developer guide and none of them worked for me.\n\n<p>I also tried using IsValidUserVisibleFullServerPath on various permutations of the server name, path and model name as reported in my journal file, but it returned false on all my attempts.\n\n<p><strong>Answer:</strong> To read the TransmissionData object, you need to call the static method TransmissionData.ReadTransmissionData. \nIt requires a ModelPath object. \nWe will show you how to construct the ModelPath object that refers to the central file.\n\n<p>There are two ways to construct a ModelPath object.\n\n<h4>Way #1</h4>\n<ul>\n<li>Compose the user-visible path string of the central file, e.g. using the string returned by ModelPathUtils.GetRevitServerPrefix plus the relative path.\nNote: The folder separator used in the relative path is a forward slash '/'. \nThe Revit 2012 API help documentation RevitAPI.chm mistakenly uses a backslash to separate folders. \nThe correct separator is a forward slash.\n<li>Create a ModelPath object via the ModelPathUtils.ConvertUserVisiblePathToModelPath method. \nPass in the string composed in the previous step.\n<li>Read the transmission data via the TransmissionData.ReadTransmissionData method. \nPass in the ModelPath obtained in the previous step.\n</li></li></li></ul>\n<p>Let's look at accessing the following central file on a Revit Server:</p>\n<center>\n<img alt=\"Revit Server central file\" src=\"img/revit_server_central_file.png\" width=\"600\"/>\n</center>\n<p>Here is the code showing the implementation of way #1:\n\n<pre class=\"code\">\n[<span class=\"teal\">TransactionAttribute</span>( <span class=\"teal\">TransactionMode</span>.Manual )]\n<span class=\"blue\">public</span> <span class=\"blue\">class</span> <span class=\"teal\">RevitCommand</span> : <span class=\"teal\">IExternalCommand</span>\n{\n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> Execute( \n    <span class=\"teal\">ExternalCommandData</span> commandData,\n    <span class=\"blue\">ref</span> <span class=\"blue\">string</span> messages, \n    <span class=\"teal\">ElementSet</span> elements )\n  {\n    <span class=\"teal\">UIApplication</span> app = commandData.Application;\n    <span class=\"teal\">Document</span> doc = app.ActiveUIDocument.Document;\n \n    <span class=\"teal\">Transaction</span> trans = <span class=\"blue\">new</span> <span class=\"teal\">Transaction</span>( doc );\n    trans.Start( <span class=\"maroon\">\"ExComm\"</span> );\n \n    <span class=\"blue\">string</span> visiblePath = <span class=\"teal\">ModelPathUtils</span>\n      .GetRevitServerPrefix() + <span class=\"maroon\">\"/testmodel.rvt\"</span>;\n \n    <span class=\"teal\">ModelPath</span> serverPath = <span class=\"teal\">ModelPathUtils</span>\n      .ConvertUserVisiblePathToModelPath( \n        visiblePath );\n \n    <span class=\"teal\">TransmissionData</span> transData = <span class=\"teal\">TransmissionData</span>\n      .ReadTransmissionData( serverPath );\n \n    <span class=\"blue\">if</span>( transData != <span class=\"blue\">null</span> )\n    {\n      <span class=\"green\">// Access the data in the transData here.</span>\n    }\n    <span class=\"blue\">else</span>\n    {\n      <span class=\"teal\">TaskDialog</span>.Show( <span class=\"maroon\">\"Transmission Data\"</span>,\n        <span class=\"maroon\">\"The document does not have any transmission data\"</span> );\n    }\n \n    trans.Commit();\n \n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n}\n</pre>\n<h4>Way #2</h4>\n<p>Use this if your program knows the local server name. \nThis is mostly not recommended, since the server name may be changed manually from the user interface by the Revit user.\n\n<ul>\n<li>Create a ServerPath object using ServerPath constructor taking the server name IP and the relative path without the initial forward slash.\n<p>Please note that the first parameter is the server name, not the string returned by the ModelPathUtils.GetRevitServerPrefix.\n<p>The second parameter does not include the initial forward slash. See the following sample code. \nThe folder separator is a forward slash '/' here as well.\n\n<li>Read the TransmissionData object via the TransmissionData.ReadTransmissionData method, passing in the ServerPath obtained in the previous step.\n</li></p></p></li></ul>\n<p>Here is the code showing the implementation of way#2.\n\n<pre class=\"code\">\n[<span class=\"teal\">TransactionAttribute</span>( <span class=\"teal\">TransactionMode</span>.Manual )]\n<span class=\"blue\">public</span> <span class=\"blue\">class</span> <span class=\"teal\">RevitCommand</span> : <span class=\"teal\">IExternalCommand</span>\n{\n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> Execute(\n    <span class=\"teal\">ExternalCommandData</span> commandData,\n    <span class=\"blue\">ref</span> <span class=\"blue\">string</span> messages,\n    <span class=\"teal\">ElementSet</span> elements )\n  {\n    <span class=\"teal\">UIApplication</span> app = commandData.Application;\n    <span class=\"teal\">Document</span> doc = app.ActiveUIDocument.Document;\n \n    <span class=\"teal\">Transaction</span> trans = <span class=\"blue\">new</span> <span class=\"teal\">Transaction</span>( doc );\n    trans.Start( <span class=\"maroon\">\"ExComm\"</span> );\n \n    <span class=\"teal\">ServerPath</span> serverPath = <span class=\"blue\">new</span> <span class=\"teal\">ServerPath</span>(\n      <span class=\"maroon\">\"SHACNG035WQRP\"</span>, <span class=\"maroon\">\"testmodel.rvt\"</span> );\n \n    <span class=\"teal\">TransmissionData</span> transData = <span class=\"teal\">TransmissionData</span>\n      .ReadTransmissionData( serverPath );\n \n    <span class=\"blue\">if</span>( transData != <span class=\"blue\">null</span> )\n    {\n      <span class=\"green\">// Access the data in the transData here.</span>\n    }\n    <span class=\"blue\">else</span>\n    {\n      <span class=\"teal\">TaskDialog</span>.Show( <span class=\"maroon\">\"Transmission Data\"</span>,\n        <span class=\"maroon\">\"The document does not have any transmission data\"</span> );\n    }\n    trans.Commit();\n \n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n}\n</pre>\n<!-- \n\nThe ServerPath must refer to a Revit model.\n\n<p>It is relative to the central server location, and of the form \"{prefix_string}\\{model_path}\". \nThe prefix string is localized and can be obtained via GetRevitServerPrefix.\nThe model path portion is a relative path to a Revit model. \nFor example, the following are all valid server paths:\n\n<pre>\n{prefix_string}\\hospital.rvt\n{prefix_string}\\Old Files\\hotel2.rvt\n{prefix_string}\\Old Files\\Last Week\\Tuesday\\hotel2.rvt\n</pre>\n\n<p>The following strings are not valid server paths:\n\n<pre>\n{prefix_string}\\Old Files\\.rvt\n{prefix_string}\\hospital\n</pre>\n\n<p>If this function returns false, it does not necessarily mean the given path is a file path. \nIt may be a malformed string.\n \n<p>The RVT filename extension is necessary. \nPlease use the back slash as a separator charactar.\n\n<p>It turned out that there is a mistake in the Revit API help doucment, RevitAPI.chm. The correct folder separator in the relative path in the Revit Server is forward slash, but not the backslash documented in the RevitAPI.chm. Sorry for that. We will update this.\n \n<p>I wrote the solution on how to access TransissionData object. It is attached herewith. \n\n<a href=\"\">\n</a>\n\n-->\n<!-- \n\n690_serverpath.htm\n\n06651564 [API Question - How to load, unload, edit path of Revit link files?] \n\n562_many_issues_resolved.htm\n583_list_links.htm\n659_writetransmissiondata.htm\n679_transmissiondata_path.htm\n690_serverpath.htm\n\n\n<h3>Setting up a Server Path</h3>\n\n<p>The Revit 2012 API introduced the new \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/05/list-linked-files-and-transmissiondata.html\">\nTransmissionData</a> class,\n\nwhich makes it possible to \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/03/many-issues-resolved.html#1267916\">\naccess and modify linked file information</a> in\n\na Revit model.\n\nThe location of a Revit \n\n<p><strong>Question:</strong>\n\n<pre class=\"code\">\n</pre>\n\n<a href=\"\">\n</a>\n\n-->\n</p></p></p></p></p></p></p></p></p></p>"
  },
  {
    "original_filename": "0679_transmissiondata_path",
    "header_text": "Way #1",
    "local_header_href": "#way-1",
    "chunk_text": "<h4>Way #1</h4><ul>\n<li>Compose the user-visible path string of the central file, e.g. using the string returned by ModelPathUtils.GetRevitServerPrefix plus the relative path.\nNote: The folder separator used in the relative path is a forward slash '/'. \nThe Revit 2012 API help documentation RevitAPI.chm mistakenly uses a backslash to separate folders. \nThe correct separator is a forward slash.\n<li>Create a ModelPath object via the ModelPathUtils.ConvertUserVisiblePathToModelPath method. \nPass in the string composed in the previous step.\n<li>Read the transmission data via the TransmissionData.ReadTransmissionData method. \nPass in the ModelPath obtained in the previous step.\n</li></li></li></ul><p>Let's look at accessing the following central file on a Revit Server:</p><center>\n<img alt=\"Revit Server central file\" src=\"img/revit_server_central_file.png\" width=\"600\"/>\n</center><p>Here is the code showing the implementation of way #1:\n\n<pre class=\"code\">\n[<span class=\"teal\">TransactionAttribute</span>( <span class=\"teal\">TransactionMode</span>.Manual )]\n<span class=\"blue\">public</span> <span class=\"blue\">class</span> <span class=\"teal\">RevitCommand</span> : <span class=\"teal\">IExternalCommand</span>\n{\n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> Execute( \n    <span class=\"teal\">ExternalCommandData</span> commandData,\n    <span class=\"blue\">ref</span> <span class=\"blue\">string</span> messages, \n    <span class=\"teal\">ElementSet</span> elements )\n  {\n    <span class=\"teal\">UIApplication</span> app = commandData.Application;\n    <span class=\"teal\">Document</span> doc = app.ActiveUIDocument.Document;\n \n    <span class=\"teal\">Transaction</span> trans = <span class=\"blue\">new</span> <span class=\"teal\">Transaction</span>( doc );\n    trans.Start( <span class=\"maroon\">\"ExComm\"</span> );\n \n    <span class=\"blue\">string</span> visiblePath = <span class=\"teal\">ModelPathUtils</span>\n      .GetRevitServerPrefix() + <span class=\"maroon\">\"/testmodel.rvt\"</span>;\n \n    <span class=\"teal\">ModelPath</span> serverPath = <span class=\"teal\">ModelPathUtils</span>\n      .ConvertUserVisiblePathToModelPath( \n        visiblePath );\n \n    <span class=\"teal\">TransmissionData</span> transData = <span class=\"teal\">TransmissionData</span>\n      .ReadTransmissionData( serverPath );\n \n    <span class=\"blue\">if</span>( transData != <span class=\"blue\">null</span> )\n    {\n      <span class=\"green\">// Access the data in the transData here.</span>\n    }\n    <span class=\"blue\">else</span>\n    {\n      <span class=\"teal\">TaskDialog</span>.Show( <span class=\"maroon\">\"Transmission Data\"</span>,\n        <span class=\"maroon\">\"The document does not have any transmission data\"</span> );\n    }\n \n    trans.Commit();\n \n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n}\n</pre>\n<h4>Way #2</h4>\n<p>Use this if your program knows the local server name. \nThis is mostly not recommended, since the server name may be changed manually from the user interface by the Revit user.\n\n<ul>\n<li>Create a ServerPath object using ServerPath constructor taking the server name IP and the relative path without the initial forward slash.\n<p>Please note that the first parameter is the server name, not the string returned by the ModelPathUtils.GetRevitServerPrefix.\n<p>The second parameter does not include the initial forward slash. See the following sample code. \nThe folder separator is a forward slash '/' here as well.\n\n<li>Read the TransmissionData object via the TransmissionData.ReadTransmissionData method, passing in the ServerPath obtained in the previous step.\n</li></p></p></li></ul>\n<p>Here is the code showing the implementation of way#2.\n\n<pre class=\"code\">\n[<span class=\"teal\">TransactionAttribute</span>( <span class=\"teal\">TransactionMode</span>.Manual )]\n<span class=\"blue\">public</span> <span class=\"blue\">class</span> <span class=\"teal\">RevitCommand</span> : <span class=\"teal\">IExternalCommand</span>\n{\n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> Execute(\n    <span class=\"teal\">ExternalCommandData</span> commandData,\n    <span class=\"blue\">ref</span> <span class=\"blue\">string</span> messages,\n    <span class=\"teal\">ElementSet</span> elements )\n  {\n    <span class=\"teal\">UIApplication</span> app = commandData.Application;\n    <span class=\"teal\">Document</span> doc = app.ActiveUIDocument.Document;\n \n    <span class=\"teal\">Transaction</span> trans = <span class=\"blue\">new</span> <span class=\"teal\">Transaction</span>( doc );\n    trans.Start( <span class=\"maroon\">\"ExComm\"</span> );\n \n    <span class=\"teal\">ServerPath</span> serverPath = <span class=\"blue\">new</span> <span class=\"teal\">ServerPath</span>(\n      <span class=\"maroon\">\"SHACNG035WQRP\"</span>, <span class=\"maroon\">\"testmodel.rvt\"</span> );\n \n    <span class=\"teal\">TransmissionData</span> transData = <span class=\"teal\">TransmissionData</span>\n      .ReadTransmissionData( serverPath );\n \n    <span class=\"blue\">if</span>( transData != <span class=\"blue\">null</span> )\n    {\n      <span class=\"green\">// Access the data in the transData here.</span>\n    }\n    <span class=\"blue\">else</span>\n    {\n      <span class=\"teal\">TaskDialog</span>.Show( <span class=\"maroon\">\"Transmission Data\"</span>,\n        <span class=\"maroon\">\"The document does not have any transmission data\"</span> );\n    }\n    trans.Commit();\n \n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n}\n</pre>\n<!-- \n\nThe ServerPath must refer to a Revit model.\n\n<p>It is relative to the central server location, and of the form \"{prefix_string}\\{model_path}\". \nThe prefix string is localized and can be obtained via GetRevitServerPrefix.\nThe model path portion is a relative path to a Revit model. \nFor example, the following are all valid server paths:\n\n<pre>\n{prefix_string}\\hospital.rvt\n{prefix_string}\\Old Files\\hotel2.rvt\n{prefix_string}\\Old Files\\Last Week\\Tuesday\\hotel2.rvt\n</pre>\n\n<p>The following strings are not valid server paths:\n\n<pre>\n{prefix_string}\\Old Files\\.rvt\n{prefix_string}\\hospital\n</pre>\n\n<p>If this function returns false, it does not necessarily mean the given path is a file path. \nIt may be a malformed string.\n \n<p>The RVT filename extension is necessary. \nPlease use the back slash as a separator charactar.\n\n<p>It turned out that there is a mistake in the Revit API help doucment, RevitAPI.chm. The correct folder separator in the relative path in the Revit Server is forward slash, but not the backslash documented in the RevitAPI.chm. Sorry for that. We will update this.\n \n<p>I wrote the solution on how to access TransissionData object. It is attached herewith. \n\n<a href=\"\">\n</a>\n\n-->\n<!-- \n\n690_serverpath.htm\n\n06651564 [API Question - How to load, unload, edit path of Revit link files?] \n\n562_many_issues_resolved.htm\n583_list_links.htm\n659_writetransmissiondata.htm\n679_transmissiondata_path.htm\n690_serverpath.htm\n\n\n<h3>Setting up a Server Path</h3>\n\n<p>The Revit 2012 API introduced the new \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/05/list-linked-files-and-transmissiondata.html\">\nTransmissionData</a> class,\n\nwhich makes it possible to \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/03/many-issues-resolved.html#1267916\">\naccess and modify linked file information</a> in\n\na Revit model.\n\nThe location of a Revit \n\n<p><strong>Question:</strong>\n\n<pre class=\"code\">\n</pre>\n\n<a href=\"\">\n</a>\n\n-->\n</p></p></p>"
  },
  {
    "original_filename": "0679_transmissiondata_path",
    "header_text": "Way #2",
    "local_header_href": "#way-2",
    "chunk_text": "<h4>Way #2</h4><p>Use this if your program knows the local server name. \nThis is mostly not recommended, since the server name may be changed manually from the user interface by the Revit user.\n\n<ul>\n<li>Create a ServerPath object using ServerPath constructor taking the server name IP and the relative path without the initial forward slash.\n<p>Please note that the first parameter is the server name, not the string returned by the ModelPathUtils.GetRevitServerPrefix.\n<p>The second parameter does not include the initial forward slash. See the following sample code. \nThe folder separator is a forward slash '/' here as well.\n\n<li>Read the TransmissionData object via the TransmissionData.ReadTransmissionData method, passing in the ServerPath obtained in the previous step.\n</li></p></p></li></ul>\n<p>Here is the code showing the implementation of way#2.\n\n<pre class=\"code\">\n[<span class=\"teal\">TransactionAttribute</span>( <span class=\"teal\">TransactionMode</span>.Manual )]\n<span class=\"blue\">public</span> <span class=\"blue\">class</span> <span class=\"teal\">RevitCommand</span> : <span class=\"teal\">IExternalCommand</span>\n{\n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> Execute(\n    <span class=\"teal\">ExternalCommandData</span> commandData,\n    <span class=\"blue\">ref</span> <span class=\"blue\">string</span> messages,\n    <span class=\"teal\">ElementSet</span> elements )\n  {\n    <span class=\"teal\">UIApplication</span> app = commandData.Application;\n    <span class=\"teal\">Document</span> doc = app.ActiveUIDocument.Document;\n \n    <span class=\"teal\">Transaction</span> trans = <span class=\"blue\">new</span> <span class=\"teal\">Transaction</span>( doc );\n    trans.Start( <span class=\"maroon\">\"ExComm\"</span> );\n \n    <span class=\"teal\">ServerPath</span> serverPath = <span class=\"blue\">new</span> <span class=\"teal\">ServerPath</span>(\n      <span class=\"maroon\">\"SHACNG035WQRP\"</span>, <span class=\"maroon\">\"testmodel.rvt\"</span> );\n \n    <span class=\"teal\">TransmissionData</span> transData = <span class=\"teal\">TransmissionData</span>\n      .ReadTransmissionData( serverPath );\n \n    <span class=\"blue\">if</span>( transData != <span class=\"blue\">null</span> )\n    {\n      <span class=\"green\">// Access the data in the transData here.</span>\n    }\n    <span class=\"blue\">else</span>\n    {\n      <span class=\"teal\">TaskDialog</span>.Show( <span class=\"maroon\">\"Transmission Data\"</span>,\n        <span class=\"maroon\">\"The document does not have any transmission data\"</span> );\n    }\n    trans.Commit();\n \n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n}\n</pre>\n<!-- \n\nThe ServerPath must refer to a Revit model.\n\n<p>It is relative to the central server location, and of the form \"{prefix_string}\\{model_path}\". \nThe prefix string is localized and can be obtained via GetRevitServerPrefix.\nThe model path portion is a relative path to a Revit model. \nFor example, the following are all valid server paths:\n\n<pre>\n{prefix_string}\\hospital.rvt\n{prefix_string}\\Old Files\\hotel2.rvt\n{prefix_string}\\Old Files\\Last Week\\Tuesday\\hotel2.rvt\n</pre>\n\n<p>The following strings are not valid server paths:\n\n<pre>\n{prefix_string}\\Old Files\\.rvt\n{prefix_string}\\hospital\n</pre>\n\n<p>If this function returns false, it does not necessarily mean the given path is a file path. \nIt may be a malformed string.\n \n<p>The RVT filename extension is necessary. \nPlease use the back slash as a separator charactar.\n\n<p>It turned out that there is a mistake in the Revit API help doucment, RevitAPI.chm. The correct folder separator in the relative path in the Revit Server is forward slash, but not the backslash documented in the RevitAPI.chm. Sorry for that. We will update this.\n \n<p>I wrote the solution on how to access TransissionData object. It is attached herewith. \n\n<a href=\"\">\n</a>\n\n-->\n<!-- \n\n690_serverpath.htm\n\n06651564 [API Question - How to load, unload, edit path of Revit link files?] \n\n562_many_issues_resolved.htm\n583_list_links.htm\n659_writetransmissiondata.htm\n679_transmissiondata_path.htm\n690_serverpath.htm\n\n\n<h3>Setting up a Server Path</h3>\n\n<p>The Revit 2012 API introduced the new \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/05/list-linked-files-and-transmissiondata.html\">\nTransmissionData</a> class,\n\nwhich makes it possible to \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/03/many-issues-resolved.html#1267916\">\naccess and modify linked file information</a> in\n\na Revit model.\n\nThe location of a Revit \n\n<p><strong>Question:</strong>\n\n<pre class=\"code\">\n</pre>\n\n<a href=\"\">\n</a>\n\n-->\n</p></p>"
  }
]