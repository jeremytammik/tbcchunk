[
  {
    "original_filename": "0726_doc_changed_event",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0726_doc_changed_event",
    "header_text": "Build Your Own Document Changed Event",
    "local_header_href": "#build-your-own-document-changed-event",
    "chunk_text": "<h3>Build Your Own Document Changed Event</h3><blockquote>\n<p><strong>P.S. (pre scriptum)</strong> As Arnošt Löbel very kindly pointed out, I gave this post a rather misleading title.\n\n<p>This post does <strong>not</strong> discuss the Revit API DocumentChanged event, which reacts when elements are modified.\n'Build your own Document Activated event' would actually more closely advertise my intentions, at least to those of you who already familiar with the DocumentChanged event.\n\n<p>Read on to see what it <strong>does</strong> discuss  :-)\n</p></p></p></blockquote><p>Welcome to this extra day of the year, the bisestile invented by Julius Caesar and his friends, bis sexto die, the repeated sixth day after the year's end on February 24<sup>th</sup>, sexto die ante Kalendas Martias, the sixth day before the month of March.\nAn event occuring every fourth year, except at the turn of each century.\n\n<p>The Revit API also provides a number of events.\nThey mostly occur more frequently than the leap year day, but there are still not as many as some would like.\nThe ones provided may actually cover a larger number of situations than you initially expect, though.\nHere is an example of making use of the ViewActivated event to react on document changes.\n\n<p><strong>Question:</strong> I can't find an event to notify me when the active document changes in Revit.\n\n<p>For example, if I have two RVT projects open in Revit, I would like an event to trigger when the user switches back and forth between them.\n\n\n<p><strong>Answer:</strong> One brute force approach to this would be subscribing to the Idling event and checking the active document property in your event handler.\nThis would be a vastly inefficient overkill, however.\n\n<p>A much more elegant solution is to subscribe to the ViewActivated event instead.\nSince there is only one active view for the session, it also triggers when the active document changes.\n\n<p>I implemented a vastly simplified external application named ViewActivatedOnDocChange providing a proof of concept of this idea and nothing more.\n\n<p>It omits a number of important steps such as unsubscribing from the event at shutdown and managing the event subscription to minimize the impact on performance.\n\n<p>Here is the entire external application implementation:\n\n<pre class=\"code\">\n<span class=\"blue\">static</span> <span class=\"blue\">string</span> ViewDescription( <span class=\"teal\">View</span> v )\n{\n  <span class=\"blue\">return</span> <span class=\"blue\">string</span>.Format(\n    <span class=\"maroon\">\"view '{0}' in document '{1}'\"</span>,\n    v.Name, v.Document.Title );\n}\n \n<span class=\"blue\">void</span> OnViewActivated(\n  <span class=\"blue\">object</span> sender,\n  <span class=\"teal\">ViewActivatedEventArgs</span> e )\n{\n  <span class=\"teal\">View</span> vPrevious = e.PreviousActiveView;\n  <span class=\"teal\">View</span> vCurrent = e.CurrentActiveView;\n \n  <span class=\"blue\">string</span> s = ( <span class=\"blue\">null</span> == vPrevious )\n    ? <span class=\"maroon\">\"no view at all\"</span>\n    : <span class=\"maroon\">\"previous \"</span> + ViewDescription( vPrevious );\n \n  <span class=\"teal\">Debug</span>.Print( <span class=\"blue\">string</span>.Format(\n    <span class=\"maroon\">\"Switching from {0} to new {1}.\"</span>,\n    s, ViewDescription( vCurrent ) ) );\n}\n \n<span class=\"blue\">public</span> <span class=\"teal\">Result</span> OnStartup( <span class=\"teal\">UIControlledApplication</span> a )\n{\n  a.ViewActivated\n    += <span class=\"blue\">new</span> <span class=\"teal\">EventHandler</span>&lt;<span class=\"teal\">ViewActivatedEventArgs</span>&gt;(\n      OnViewActivated );\n \n  <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n}\n \n<span class=\"blue\">public</span> <span class=\"teal\">Result</span> OnShutdown( <span class=\"teal\">UIControlledApplication</span> a )\n{\n  <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n}\n</pre>\n<p>This is the output produced in the Visual Studio debug output window by starting up Revit, loading the ViewActivatedOnDocChange add-in, and switching back and forth between a few different documents:\n\n<pre>\nSwitching from no view at all to\n  new view 'Level 1' in document 'walls.rvt'.\n\nSwitching from previous view 'Level 1'\n  in document 'walls.rvt' to new view\n  'Unnamed' in document 'Project1.rvt'.\n\nSwitching from previous view 'Unnamed'\n  in document 'Project1.rvt' to new view\n  'From Parking Area' in document\n  'rac_advanced_sample_project.rvt'.\n</pre>\n<p>Here is\n\n<a href=\"zip/ViewActivatedOnDocChange.zip\">\nViewActivatedOnDocChange.zip</a> containing\n\nthe complete source code, Visual Studio solution and add-in manifest for this external application.\n</p></p></p></p></p></p></p></p></p></p></p>"
  }
]