[
  {
    "original_filename": "0659_writetransmissiondata",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0659_writetransmissiondata",
    "header_text": "Using the WriteTransmissionData Method",
    "local_header_href": "#using-the-writetransmissiondata-method",
    "chunk_text": "<h3>Using the WriteTransmissionData Method</h3><p>I presented a sample to \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/05/list-linked-files-and-transmissiondata.html\">\nusing the TransmissionData class to list linked files</a>,\n\nand Mike Caruso submitted a \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/05/list-linked-files-and-transmissiondata.html?cid=6a00e553e168978833014e8890c564970d#comment-6a00e553e16897883301\">\ncomment</a> asking \n\nhow to use it to set a new path on a RVT file.\n\nFurthermore, Guming recently asked \n\n<a href=\"http://thebuildingcoder.typepad.com/blog/2011/09/analytical-model-isenabled-method-and-parameter.html?cid=6a00e553e168978833015435b29a1e970c#comment-6a00e553e168978833015435b29a1e970c\">\nhow to make use of the ExternalFileReference class</a>.\n\nHere is a sample answering both of these questions:\n\n<p><strong>Question:</strong> Can you demonstrate how I would load, unload and make changes to the path of linked Revit files?\n\n<p><strong>Answer:</strong> Loading, unloading and editing path to referenced RVT files is possible using methods on the TransmissionData class. \nPlease note that the host RVT file must be closed in order to be editable by these methods.\n\n<p>The Revit API help file RevitAPI.chm description of the TransmissionData class includes a sample code snippet defining the aptly named method UnloadRevitLinks to unload all Revit links.\n\n<p>Here is a sample external command based on that to change the Revit linked model path:\n\n<pre class=\"code\">\n<span class=\"gray\">///</span><span class=\"green\"> </span><span class=\"gray\">&lt;summary&gt;</span>\n<span class=\"gray\">///</span><span class=\"green\">  This command will change the path of all linked</span>\n<span class=\"gray\">///</span><span class=\"green\">  Revit files the next time the document at the </span>\n<span class=\"gray\">///</span><span class=\"green\">  given location is opened. </span>\n<span class=\"gray\">///</span><span class=\"green\">  Please refer to the TransmissionData reference</span>\n<span class=\"gray\">///</span><span class=\"green\">  for more details.</span>\n<span class=\"gray\">///</span><span class=\"green\"> </span><span class=\"gray\">&lt;/summary&gt;</span>\n[<span class=\"teal\">Transaction</span>( <span class=\"teal\">TransactionMode</span>.ReadOnly )]\n<span class=\"blue\">public</span> <span class=\"blue\">class</span> <span class=\"teal\">CmdChangeLinkedFilePath</span> : <span class=\"teal\">IExternalCommand</span>\n{\n  <span class=\"blue\">public</span> <span class=\"teal\">Result</span> Execute(\n    <span class=\"teal\">ExternalCommandData</span> commandData,\n    <span class=\"blue\">ref</span> <span class=\"blue\">string</span> message,\n    <span class=\"teal\">ElementSet</span> elements )\n  {\n    <span class=\"teal\">UIApplication</span> uiapp = commandData.Application;\n    <span class=\"teal\">UIDocument</span> uidoc = uiapp.ActiveUIDocument;\n    <span class=\"teal\">Application</span> app = uiapp.Application;\n    <span class=\"teal\">Document</span> doc = uidoc.Document;\n \n    <span class=\"teal\">FilePath</span> location = <span class=\"blue\">new</span> <span class=\"teal\">FilePath</span>( <span class=\"maroon\">\"C:/file.rvt\"</span> );\n \n    <span class=\"teal\">TransmissionData</span> transData\n      = <span class=\"teal\">TransmissionData</span>.ReadTransmissionData(\n        location );\n \n    <span class=\"blue\">if</span>( <span class=\"blue\">null</span> != transData )\n    {\n      <span class=\"green\">// Collect all (immediate) external </span>\n      <span class=\"green\">// references in the model</span>\n \n      <span class=\"teal\">ICollection</span>&lt;<span class=\"teal\">ElementId</span>&gt; externalReferences\n        = transData.GetAllExternalFileReferenceIds();\n \n      <span class=\"green\">// Find every reference that is a link</span>\n \n      <span class=\"blue\">foreach</span>( <span class=\"teal\">ElementId</span> refId <span class=\"blue\">in</span> externalReferences )\n      {\n        <span class=\"teal\">ExternalFileReference</span> extRef\n          = transData.GetLastSavedReferenceData(\n            refId );\n \n        <span class=\"blue\">if</span>( extRef.ExternalFileReferenceType\n          == <span class=\"teal\">ExternalFileReferenceType</span>.RevitLink )\n        {\n          <span class=\"green\">// Change the path of the linked file,</span>\n          <span class=\"green\">// leaving everything else unchanged:</span>\n \n          transData.SetDesiredReferenceData( refId,\n            <span class=\"blue\">new</span> <span class=\"teal\">FilePath</span>( <span class=\"maroon\">\"C:/MyNewPath/cut.rvt\"</span> ),\n            extRef.PathType, <span class=\"blue\">true</span> );\n        }\n      }\n \n      <span class=\"green\">// Make sure the IsTransmitted property is set</span>\n \n      transData.IsTransmitted = <span class=\"blue\">true</span>;\n \n      <span class=\"green\">// Modified transmission data must be saved </span>\n      <span class=\"green\">// back to the model</span>\n \n      <span class=\"teal\">TransmissionData</span>.WriteTransmissionData(\n        location, transData );\n    }\n    <span class=\"blue\">else</span>\n    {\n      <span class=\"teal\">TaskDialog</span>.Show( <span class=\"maroon\">\"Unload Links\"</span>,\n        <span class=\"maroon\">\"The document does not have\"</span>\n        + <span class=\"maroon\">\" any transmission data\"</span> );\n    }\n    <span class=\"blue\">return</span> <span class=\"teal\">Result</span>.Succeeded;\n  }\n}\n</pre>\n<p>By setting the four parameters of SetDesiredReferenceData method, you can also cause a loaded linked file to be unloaded, and vice versa.\n\n<p>Here is\n\n<a href=\"zip/bc_12_93.zip\">\nversion 2012.0.93.0</a> of\n\nThe Building Coder samples including the new CmdChangeLinkedFilePath command.\n\n<p><strong>Response:</strong> Thank you! \nThat worked like a charm.\n\n</p></p></p></p></p></p></p></p>"
  }
]