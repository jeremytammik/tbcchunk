[
  {
    "original_filename": "1970_webview2",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<link rel=\"stylesheet\" type=\"text/css\" href=\"bc.css\">\n<script src=\"https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js\" type=\"text/javascript\"></script>\n</head>\n\n<!---\n\n- wv2\n  https://autodesk.slack.com/archives/C0SR6NAP8/p1666290375135259\n  Michael Dewberry, 20 Oct at 20:26\n  Best practices for Revit add-ins using WebView2\n\n- get ref plane in element\n  https://autodesk.slack.com/archives/C0SR6NAP8/p1663057482687699\n\n- Remove Revisions on Sheets\n  https://forums.autodesk.com/t5/revit-api-forum/remove-revisions-on-sheets/m-p/11449618\n\n- LandXML P tag\n  https://forums.autodesk.com/t5/revit-api-forum/a-question-about-exporting-and-reading-landxml/m-p/11405400\n\ntwitter:\n\nUsing WebView2 in a #RevitAPI add-in, retrieving reference plane in element and removing revisions on sheets @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon https://autode.sk/webview2\n\nUsing WebView2 in an add-in and other interesting little titbits from the Revit API discussion forum\n&ndash; WebView2 and CefSharp in Revit add-ins\n&ndash; Retrieve reference plane in element\n&ndash; Remove revisions on sheets\n&ndash; LandXML <code>P</code> tag...\n\nlinkedin:\n\nUsing WebView2 in a #RevitAPI add-in, retrieving reference plane in element and removing revisions on sheets\n\nhttps://autode.sk/webview2\n\n- WebView2 and CefSharp in Revit add-ins\n- Retrieve reference plane in element\n- Remove revisions on sheets\n- LandXML <code>P</code> tag...\n\n#bim #DynamoBim #ForgeDevCon #Revit #API #IFC #SDK #AI #VisualStudio #Autodesk #AEC #adsk\n\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread\n\n<center>\n<img src=\"img/\" alt=\"\" title=\"\" width=\"600\" height=\"\"/>\n<p style=\"font-size: 80%; font-style:italic\"></p>\n</center>\n\n<pre class=\"code\">\n</pre>\n\n-->"
  },
  {
    "original_filename": "1970_webview2",
    "header_text": "WebView2, LandXML, RefPlane and Revision",
    "local_header_href": "#webview2-landxml-refplane-and-revision",
    "chunk_text": "### WebView2, LandXML, RefPlane and Revision\n\nQuestions on using WebView2 in an add-in cropped up now and then, so we share some clarification on that usage, plus a couple of other interesting little titbits from\nthe [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160):\n\n- [WebView2 and CefSharp in Revit add-ins](#2)\n- [WebView2 sample add-in project](#2.1)\n- [Retrieve reference plane in element](#3)\n- [Remove revisions on sheets](#4)\n- [LandXML `P` tag](#5)"
  },
  {
    "original_filename": "1970_webview2",
    "header_text": "WebView2 and CefSharp in Revit Add-Ins",
    "local_header_href": "#2",
    "chunk_text": "####<a name=\"2\"></a> WebView2 and CefSharp in Revit Add-Ins\n\nHere are some thoughts and experiences from an internal discussion aimed at defining best practices for Revit add-ins using WebView2:\n\n**Question:** I would like to make use of WebView2 in my add-in.\nWhat should I do?\n\n- Rely on future versions of Revit installing the evergreen runtime?\n- Use the same User Data Folder created by Revit for instances of the web view in add-ins?\n\nFor add-ins using WebView2 in Revit 2023 and earlier, before Revit itself includes it, is there a consensus on the best place to create a custom UDF?\n\nMy interpretation of the `CoreWebView2Environment.CreateAsync` docs are that all WebView2 invocations from the same process need to agree on the `options` object, but do not need to agree on the `userDataFolder`.\n\nA sensible location for the UDF might be a subfolder of *%LOCALAPPDATA%\\Autodesk\\Revit\\Autodesk Revit 2023*\n&ndash; this is where Revit is currently creating the CEF cache folder &ndash;\nbut it's not clear if we should namespace that subfolder name with our add-in name or not. \n\n**Answer:** You only need to agree on the UDF if you want to use the same main WV2 process, i.e., act like a \"tab\" in the browser as opposed to starting a new browser \"window\". \n The \"tab\" way &ndash; sharing the UDF and options &ndash; is more performant and uses less memory.\n\nIn that case, you need to use the same options as all the other instances.\nIf you use your own UDF, you are free to set any options you like.\n\nHowever, we are currently finding WV2 unstable with Revit and may choose not to use it, in which case we will continue using CEF.\n\n<!--\n\nWe are seeing what looks like crashes of the rendering subprocesses in some situations like opening certain large files... memory issues? Blocking the main thread for too long?\nWe don't know yet.\nIt also crashes after leaving Revit idle overnight.\n\n-->\n\nThe worst part is that if one instance of WV2 crashes, all the other instances stop working, even newly created ones after that.\nThe only remedy is to restart Revit.\nOther products' experience with WV2 seems to be fine and I haven't been able to reproduce these issues outside of Revit.\nYou might want to put your add-in through some tests.\n\n<!--\n\nActually, if it works for you without problems, we should probably compare notes how we are using and setting up WV2.\n\n-->\n\nIn Revit, we are working on a separate component that isolates the browser code from Revit and I would like all our uses to go through that.\nIt supports both CEF and WV2, so it's easy to switch which one we want to use.\nAmong other things, it takes care of setting up the UDF, so they are all in the same location.\n\nThe development builds of Revit include both WV2 and the evergreen runtime.\nIn fact, it was put into Revit even before we started the migration; looks like the SSO component uses it now.\n\nDynamo is currently fully committed to WebView2 from v2.17, so we are testing its stability there as well.\n\n**Response:** If there is a push to revert back to cefsharp, does this mean future releases won't have wv2?\n\n **Answer:** No, I think we will still be shipping both CefSharp and WV2 for some time, since our component needs both even if we're using just one of them.\n We will try to switch again once WV2 is more stable or once we have more time to figure out what's going on.\nIf anything, we might stop shipping CefSharp at some point. \n\nAlso, WV2 comes included in Win11 by default and can't be uninstalled (I think...), so that will be no issue hopefully soon.\n\n####<a name=\"2.1\"></a> WebView2 Sample Add-In Project\n\n[Alexander Laktionov](https://www.linkedin.com/in/alexander-laktionov-a50474162/), [@laksan1](https://github.com/laksan1),\nshared a WebView2 sample add-in on [LinkedIn](https://www.linkedin.com/posts/alexander-laktionov-a50474162_bim-revit-autodesk-activity-6967953596038438913-R0xk?utm_source=share&utm_medium=member_desktop):\n\nHave you ever wondered, \"How can I link a plugin in Revit to an application created on a web platform?\"\nUsually, plug-ins in Revit are created on a ribbon, but that's not the only way.\nYou can create your own panel in several ways:\n\n- RibbonPanel (built into Revit)\n- Dockable Panel (built into Revit)\n- Electron\n- Telegram (you can create commands and call your plugins)\n- Any web project and connect it to the Revit plugin via sockets (websockets or socket.io), specifically:\n- WebView2\n\nLet's talk about the last method.\nWhat is WebView2?\nThe Microsoft Edge WebView2 control allows you to embed web technologies (HTML, CSS, and JavaScript) into native applications.\nThe WebView2 control uses Microsoft Edge as a rendering mechanism to display web content in native applications.\nThe [WebView2Example GitHub repository](https://github.com/laksan1/WebView2Example) shows \nsuch an application.\n\nThe repository contains two projects.\nThe first is a frontend made in angular (you can use any other framework).\nIt uses a single `WebView2Service` file to interact with your plugin to send data to the Revit application.\nThe second project is a C# project that includes the nugget package `Microsoft.Web.WebView2`.\nFor introductory purposes, I made a simple project that updates floors in the Revit model when they are changed in the WPF window (WebView2).\n\n<center>\n<img src=\"img/webview2example.gif\" alt=\"WebView2Example\" title=\"WebView2Example\" width=\"800\"/>  <!-- 1958 x 1016 -->\n</center>\n\nMany thanks to Alexander for sharing this nice sample!"
  },
  {
    "original_filename": "1970_webview2",
    "header_text": "Retrieve Reference Plane in Element",
    "local_header_href": "#3",
    "chunk_text": "####<a name=\"3\"></a> Retrieve Reference Plane in Element\n\nSome clarification on how symbol and instance geometry is generated from the family definiton:\n\n**Question:** How can I retrieve a reference plane that is inside an element?\nI prefer to avoid opening and analysing the family file.\nIs it possible to get the reference plane directly from the element via Revit API?\n\n**Answer:** You don't need to open the family.\nIf there is a placed instance, you can call `GetReferenceByName` on that instance, or get all the references from it.\n\n**Response:** I am able to get the reference using \n\n<pre class=\"code\">\nReference reference=famInst.GetReferenceByName(\"Center (Left/Right)\");\n</pre>\n\nNow, how to get the reference plane from the reference?\n\n**Answer:** Use `GetGeometryObjectFromReference`.\n\n**Response:** That throws an exception saying that I cannot convert `GeometryObject` to `ReferencePlane`:\n\n<center>\n<img src=\"img/cast_geometryobject.png\" alt=\"Cast error\" title=\"Cast error\" width=\"1000\"/> <!-- 1168 x 37 -->\n</center>\n\n**Answer:** I think the problem is that you're actually getting back a surface instead of a plane, so your cast fails.\ntry casting to a surface, or, better yet, check out the underlying type in Visual Studio.\n\nA reference in an element is not a ReferencePlane element.\nIn the family definition, a ReferencePlane element is added, but in the family symbol and instance, all geometry generated is consumed into the single element.  \nTherefore, you are receiving a Surface or more specifically a Plane, which gives you the location of the plane.\nIf you want to attach a dimension to it, use the Reference you get originally.\nYou don't have access to a separate element from this."
  },
  {
    "original_filename": "1970_webview2",
    "header_text": "Remove Revisions on Sheets",
    "local_header_href": "#4",
    "chunk_text": "####<a name=\"4\"></a> Remove Revisions on Sheets\n\nTwo solutions\nto [remove revisions on sheets](https://forums.autodesk.com/t5/revit-api-forum/remove-revisions-on-sheets/m-p/11449618):\n\n**Question:** I am writing an addin to edit revisions for many sheets simultaneously.\nI see in the API that revisions can be added to a particular sheet using the `SetAdditionalRevisionIds` method.\nHowever, I don't see an obvious way to remove revisions currently on a sheet.\n(This is all assuming we are modifying revisions that were manually added and not controlled by any content on the sheet, e.g., revision clouds.)\nIs there a way to remove revisions from a sheet in the API?\n\n**Answer:** Use `GetAdditionalRevisionIds` &ndash; these are the revisions not created by revision clouds on the sheet or in any of the placed views.\n\nFrom the returned collection, remove the ids of the revisions that need removing.\n\nThen call `SetAdditionalRevisionIds` with the edited collection from above.\n\nP.S.: `GetAllRevisionIds` will return ALL revisions, from Revision clouds and \"Revision on sheet\" checkboxes.\n\nConclusion: `GetAllRevisionIds` - `GetAdditionalRevisionIds` = RevisionIds set by revision clouds.\n\nNote that deleting (and adding) revision clouds is only possible if the Issued state of the revision is off.\n\nThis is no needed for `SetAdditionalRevisionId` (like in UI).\n\n**Response:** I thought I tried this method, and it made no changes (the revisions were set to 'Issued').\nHowever, I must have done something wrong the first time, because when I reimplemented, it works great!\n\n**Answer 2:** This week I had to solve a similar problem.\nAnother way to approach this matter is by using the FilteredElementCollector.\nAssuming everything related to all the revisions on a sheet will be deleted, you can break it down in steps.\nFirst, delete all revision cloud tags, secondly delete the revision clouds and finally the revisions.\nBelow you can see an example.\nTo complete the routine, I also added a bit of code to avoid conflicts with revisions that are already issued.\nHopefully this will help somebody for future use.\n\n<pre class=\"code\">\nDim revs As New SortedList(Of String, Boolean)\nDim colRev As New FilteredElementCollector(doc)\n\nFor Each r As Revision In colRev.OfCategory(BuiltInCategory.OST_Revisions)\n   revs.Add(r.UniqueId, r.Issued)\n\n   r.Issued = False\nNext\n\nDim colRevClTags As New FilteredElementCollector(doc, sheet.Id)\ndoc.Delete(colRevClTags.OfCategory(BuiltInCategory.OST_RevisionCloudTags).ToElementIds)\n\nDim colRevCl As New FilteredElementCollector(doc, sheet.Id)\ndoc.Delete(colRevCl.OfCategory(BuiltInCategory.OST_RevisionClouds).ToElementIds)\n\nDim colRevs As New FilteredElementCollector(doc, sheet.Id)\ndoc.Delete(colRevs.OfCategory(BuiltInCategory.OST_Revisions).ToElementIds)\n\nFor Each r In revs\n   Dim rev As Revision = doc.GetElement(r.Key)\n\n   rev.Issued = r.Value\nNext\n</pre>\n\nLater: Little correction.\nI just edited the code fragment I posted yesterday.\nRecovering the issued state of a revision doesn't seem to work by using the element id.\nUsing the stable unique id instead fixes the problem.\n\n**Response:** Wow! Thanks for the solution!\nYours goes above and beyond my initial question.\nI'll convert it to C# and try it out when I have some time available."
  },
  {
    "original_filename": "1970_webview2",
    "header_text": "LandXML P Tag",
    "local_header_href": "#5",
    "chunk_text": "####<a name=\"5\"></a> LandXML P Tag\n\n[A question about exporting and reading LandXML](https://forums.autodesk.com/t5/revit-api-forum/a-question-about-exporting-and-reading-landxml/m-p/11405400),\nled to an explanation of the coordinate order in the `P` tag:\n\n\n**Question:** This may be a bit off-topic, but I wonder about [exporting toposurface to LandXML](https://thebuildingcoder.typepad.com/blog/2010/01/import-landxml-surface.html).\n\nIn LandXML, the `P` tag takes the coordinates in an unexpected order:\n \n<pre>\n  &lt;P id=\"1\"&gt;Y X Z&lt;/P&gt;\n</pre>\n\nWhy is the order of collocation (Y X Z) and not (X Y Z)?\n\n<center>\n<img src=\"img/landxml_p_tag_1.png\" alt=\"LandXML P tag\" title=\"LandXML P tag\" width=\"250\"/> <!-- 1013 x 635 -->\n<p/>\n<img src=\"img/landxml_p_tag_2.png\" alt=\"LandXML P tag\" title=\"LandXML P tag\" width=\"350\"/> <!-- 702 x 486 -->\n</center>\n\n**Answer:** Yes.\nThat is sort of off-topic.\nNot just here, but almost everywhere in the universe.\nThere are probably reasons for that definition, but who cares?\nAre you planning to change the LandXML definition?\nIf so, then you might want to discuss this with the people responsible for it\nat [LandXML.org](http://landxml.org).\n\nIn general, when I am programming something that connects with something else, I have to accept the given conditions and adapt to them.\nIt may help to know the underlying reasons, but only in theory, for my acceptance and motivation.\nIf I can accept the facts and motivate myself regardless, there is no need to understand the underlying reasons.\nActually, that applies to every aspect of life (and death):\n\"Ours is not to question why; ours is but to do or die.\"\n\nLater: I discovered an answer after all, in\nthe [LandXML specification for the `P` tag](http://www.landxml.org/schema/LandXML-1.2/documentation/LandXML-1.2Doc_P.html#Link07F5D020):\n\n> A surface point. it contains an id attribute and a space delimited \"northing easting elevation\" text value.\n\nThe order of northing, easting, elevation makes perfect sense in the LandXML domain, and translates directly to the Y, X, Z that you observe in the file format receiving its coordinates from an instance of the Revit `XYZ` class."
  }
]