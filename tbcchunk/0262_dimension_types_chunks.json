[
  {
    "original_filename": "0262_dimension_types",
    "header_text": "Introduction",
    "local_header_href": "#introduction",
    "chunk_text": "<head>\n<link href=\"bc.css\" rel=\"stylesheet\" type=\"text/css\"/>\n</head>"
  },
  {
    "original_filename": "0262_dimension_types",
    "header_text": "Distinguish Different Dimension Types",
    "local_header_href": "#distinguish-different-dimension-types",
    "chunk_text": "<h3>Distinguish Different Dimension Types</h3><p>I am back in Europe again after spending most of the weekend travelling, similarly to \n\n<a href=\"http://through-the-interface.typepad.com/through_the_interface/2009/12/asynchronous-messages-in-f-and-autocad.html\">\nKean</a> but \n\nin the opposite direction.\nIn his last post, Kean summarised some interesting views on the \n\n<a href=\"http://through-the-interface.typepad.com/through_the_interface/2009/12/the-evolution-of-autodesk-university.html\">\nevolution of Autodesk University</a>.\n\n<p>Returning to the Revit API, here is a nice can-do solution presenting a workaround created by my colleague Joe Ye of Autodesk and Henrik Bengtsson of \n\n<a href=\"http://www.lindab.se\">\nLindab</a> on \n\nhow to distinguish between the different kinds of dimension types.\n\n<p><strong>Question:</strong> I am creating a drafting view with dimensions and I have a small problem.\nThe function listed below works all right, but I had to hard code the dimension type name to look for.\nThe if statement comparing the type name with the hardcoded string \"Arrow - 2.5mm Arial\" should not be needed.\n\n<p>This is what the code should do:\n\n<ol>\n<li>Loop through the existing dimension types.\nIf the one I am looking for is found, return it directly.\nThe first time this function is called in a new document, it should not find anything.\n\n<li>The second loop should simply pick the first one, and then exit the loop.\nUnfortunately when the first item in the loop is used, I cannot set Dimension.DimensionType.\nThat is done outside this routine.\n\n<li>Duplicate the type picked in step 2, update its parameters appropriately, and return it.\n</li></li></li></ol>\n<p>In some way or another, there must be different dimension types included in the Document.DimensionTypes collection.\nWhen I grab the first one, it is unfortunately of the wrong type.\nHow can I find a correct type to duplicate?\n\n<p>I think that I use Linear Dimension Type, but there seem to be others as well.\n\n<p>I have looped though the parameters but I cannot find any that would tell me the dimension type.\nI see one named Linear_Dim_type, but it returns 1 in all cases, so that is no help.\n\n<pre class=\"code\">\n<span class=\"blue\">Public</span> <span class=\"blue\">Function</span> GetDimensionType( _\n  <span class=\"blue\">ByVal</span> doc <span class=\"blue\">As</span> Document, _\n  <span class=\"blue\">ByVal</span> name <span class=\"blue\">As</span> <span class=\"blue\">String</span>, _\n  <span class=\"blue\">ByVal</span> size <span class=\"blue\">As</span> <span class=\"blue\">Double</span>) _\n<span class=\"blue\">As</span> Symbols.DimensionType\n \n  <span class=\"blue\">Dim</span> dt <span class=\"blue\">As</span> Symbols.DimensionType = <span class=\"blue\">Nothing</span>\n \n  <span class=\"blue\">Try</span>\n \n    <span class=\"blue\">For</span> <span class=\"blue\">Each</span> itm <span class=\"blue\">As</span> Symbols.DimensionType <span class=\"blue\">In</span> doc.DimensionTypes\n \n      <span class=\"blue\">If</span> itm.Name = name <span class=\"blue\">Then</span>\n \n        dt = itm\n        <span class=\"blue\">Return</span> dt\n \n      <span class=\"blue\">End</span> <span class=\"blue\">If</span>\n \n    <span class=\"blue\">Next</span>\n \n    <span class=\"blue\">If</span> dt <span class=\"blue\">Is</span> <span class=\"blue\">Nothing</span> <span class=\"blue\">Then</span>\n \n      <span class=\"blue\">Dim</span> tmpdt <span class=\"blue\">As</span> Symbols.DimensionType = <span class=\"blue\">Nothing</span>\n \n      <span class=\"blue\">For</span> <span class=\"blue\">Each</span> itm <span class=\"blue\">As</span> Symbols.DimensionType <span class=\"blue\">In</span> doc.DimensionTypes\n \n        <span class=\"blue\">If</span> itm.Name = <span class=\"maroon\">\"Arrow - 2.5mm Arial\"</span> <span class=\"blue\">Then</span> <span class=\"green\">' hardcoded string</span>\n          tmpdt = itm\n          <span class=\"blue\">Exit</span> <span class=\"blue\">For</span>\n        <span class=\"blue\">End</span> <span class=\"blue\">If</span>\n \n      <span class=\"blue\">Next</span>\n \n      dt = tmpdt.Duplicate(name)\n \n      dt.Parameter( _\n        Parameters.BuiltInParameter.TEXT_SIZE) _\n        .Set(mmTofoot(size))\n      dt.Parameter( _\n        Parameters.BuiltInParameter.TEXT_DIST_TO_LINE) _\n        .Set(mmTofoot(1))\n \n    <span class=\"blue\">End</span> <span class=\"blue\">If</span>\n \n  <span class=\"blue\">Catch</span> ex <span class=\"blue\">As</span> Exception\n  <span class=\"blue\">End</span> <span class=\"blue\">Try</span>\n \n  <span class=\"blue\">Return</span> dt\n \n<span class=\"blue\">End</span> <span class=\"blue\">Function</span>\n</pre>\n<p>Here is a snippet of code showing how I call this routine:\n\n<pre class=\"code\">\n<span class=\"blue\">Dim</span> ref1 <span class=\"blue\">As</span> <span class=\"blue\">New</span> Reference\n<span class=\"blue\">Dim</span> ref2 <span class=\"blue\">As</span> <span class=\"blue\">New</span> Reference\n<span class=\"blue\">Dim</span> refArray <span class=\"blue\">As</span> <span class=\"blue\">New</span> ReferenceArray\nrefArray.Append(ref1)\nrefArray.Append(ref2)\n\n<span class=\"blue\">Dim</span> dimensionLine <span class=\"blue\">As</span> Line _\n  = app.Create.NewLine(refP1, refP2, <span class=\"blue\">True</span>)\n \n<span class=\"blue\">Dim</span> dimension <span class=\"blue\">As</span> Dimension _\n  = doc.Create.NewDimension(view, dimensionLine, refArray)\n \n<span class=\"green\">' this fails if the wrong type is returned:</span>\ndimension.DimensionType _\n  = GetDimensionType(doc, <span class=\"maroon\">\"Lindab-2.0\"</span>, 2.0)\n</pre>\n<p><strong>Answer:</strong> There are three kinds of dimension types\n\n<ul>\n<li>Angular\n<li>Linear\n<li>Radial\n</li></li></li></ul>\n<p>I agree that you probably trying to assign a wrong type of dimension style to the dimension.\n\n<p>So the question is how to distinguish them correctly.\n\n<p>I just investigated the properties and parameters of dimension style elements.\nI do not see any single value that would enable me to distinguish any one of these from the other two.\nSince Revit can distinguish them internally, I assume it has some additional data that we do not see in the API.\n\n<p>However, the three kinds of styles have different collections of parameters, and these can be used to distinguish them.\n\n<p>For example, the 'Dimension String Type' parameter only occurs on a Linear style.\nTherefore, if we can read a valid parameter value for this parameter, we know that it is a linear dimension style:</p>\n<center>\n<img alt=\"Linear dimension style element properties\" src=\"img/dim_style_linear.png\"/>\n</center>\n<p>To distinguish between the other two styles, I found that the 'Centerline Style', 'Centerline Pattern', 'Centerline Tick Mark' and 'Interior Tick Mark' parameters only occur on an angular style:</p>\n<center>\n<img alt=\"Angular dimension style element properties\" src=\"img/dim_style_angular.png\"/>\n</center>\n<p>A radial dimension style does not have these:</p>\n<center>\n<img alt=\"Radial dimension style element properties\" src=\"img/dim_style_radial.png\"/>\n</center>\n<p><strong>Response:</strong> I checked the return values of these parameters and unfortunately they all seem to exist. \nwhat I mean is that all dimension types have these... \nI was hoping that some of them would return 'Nothing'.\n\n<p><strong>Answer:</strong> If you access these parameters directly by calling Element.get_Parameter with a string name or built-in parameter argument, this might not work as expected.\nA specific parameter, for example Linear_Dim_Type, may well be invisible for Angular and Radial types, but it may still exist.\n\n<p>Please retrieve the parameters by iterating the ParameterSet returned by DimensionType.Parameters. \nThis collection will only return the parameters visible in the Properties Dialog. \nIn this way we can discover if the specific target parameter is valid in this ParameterSet. \nUse the same method to detect if specific parameters exist in the remaining two dimension types.\n\n<p><strong>Response:</strong> Here is a final version of the code. \nIt works for me in my project.\nThat does not guarantee that it will work in another environment.\nSo please just use this as a basic idea and test it in your context:\n\n<pre class=\"code\">\n<span class=\"blue\">Public</span> <span class=\"blue\">Function</span> GetDimensionType( _\n  <span class=\"blue\">ByVal</span> doc <span class=\"blue\">As</span> Document, _\n  <span class=\"blue\">ByVal</span> name <span class=\"blue\">As</span> <span class=\"blue\">String</span>, _\n  <span class=\"blue\">ByVal</span> size <span class=\"blue\">As</span> <span class=\"blue\">Double</span>) _\n<span class=\"blue\">As</span> Symbols.DimensionType\n \n  <span class=\"blue\">Dim</span> dt <span class=\"blue\">As</span> Symbols.DimensionType = <span class=\"blue\">Nothing</span>\n  <span class=\"blue\">Try</span>\n \n    <span class=\"blue\">For</span> <span class=\"blue\">Each</span> itm <span class=\"blue\">As</span> Symbols.DimensionType <span class=\"blue\">In</span> doc.DimensionTypes\n \n      <span class=\"blue\">If</span> itm.Name = name <span class=\"blue\">Then</span>\n \n        dt = itm\n        <span class=\"blue\">Return</span> dt\n \n      <span class=\"blue\">End</span> <span class=\"blue\">If</span>\n \n    <span class=\"blue\">Next</span>\n    <span class=\"blue\">If</span> dt <span class=\"blue\">Is</span> <span class=\"blue\">Nothing</span> <span class=\"blue\">Then</span>\n \n      <span class=\"blue\">Dim</span> tmpdt <span class=\"blue\">As</span> Symbols.DimensionType = <span class=\"blue\">Nothing</span>\n      <span class=\"blue\">For</span> <span class=\"blue\">Each</span> itm <span class=\"blue\">As</span> Symbols.DimensionType <span class=\"blue\">In</span> doc.DimensionTypes\n \n        <span class=\"blue\">If</span> <span class=\"blue\">Not</span> tmpdt <span class=\"blue\">Is</span> <span class=\"blue\">Nothing</span> <span class=\"blue\">Then</span>\n \n          <span class=\"blue\">Exit</span> <span class=\"blue\">For</span>\n \n        <span class=\"blue\">End</span> <span class=\"blue\">If</span>\n        <span class=\"blue\">For</span> <span class=\"blue\">Each</span> p <span class=\"blue\">As</span> Parameter <span class=\"blue\">In</span> itm.Parameters\n \n          <span class=\"blue\">Dim</span> id <span class=\"blue\">As</span> Parameters.InternalDefinition = p.Definition\n          <span class=\"blue\">If</span> id.BuiltInParameter = Parameters.BuiltInParameter.LINEAR_DIM_TYPE <span class=\"blue\">Then</span>\n \n            tmpdt = itm\n            <span class=\"blue\">Exit</span> <span class=\"blue\">For</span>\n \n          <span class=\"blue\">End</span> <span class=\"blue\">If</span>\n \n        <span class=\"blue\">Next</span>\n \n      <span class=\"blue\">Next</span>\n      dt = tmpdt.Duplicate(name)\n \n      dt.Parameter( _\n        Parameters.BuiltInParameter.TEXT_SIZE) _\n        .Set(mmTofoot(size))\n \n      dt.Parameter( _\n        Parameters.BuiltInParameter.TEXT_DIST_TO_LINE) _\n        .Set(mmTofoot(1))\n \n    <span class=\"blue\">End</span> <span class=\"blue\">If</span>\n \n  <span class=\"blue\">Catch</span> ex <span class=\"blue\">As</span> Exception\n  <span class=\"blue\">End</span> <span class=\"blue\">Try</span>\n \n  <span class=\"blue\">Return</span> dt\n \n<span class=\"blue\">End</span> <span class=\"blue\">Function</span>\n</pre>\n<p>If the lines above are truncated in your browser, simply copy and paste them to an editor.</p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p>"
  }
]